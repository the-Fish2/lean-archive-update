[
    {
        "content": "<p>Can somebody update the blueprint (or help me do it), please? <code>5487c1421a7894567e0b211f505f4b6c97edec73</code> (current HEAD on master) updated a type; it would be nice to update the blueprint accordingly. (Not urgent, of course.)</p>",
        "id": 420022876,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1707217463
    },
    {
        "content": "<p>I tried to do this myself, by following the instructions in the README. <code>inv all</code> errors for me, with the following output</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">$</span> <span class=\"n\">inv</span> <span class=\"n\">all</span>\n<span class=\"n\">Traceback</span> <span class=\"o\">(</span><span class=\"n\">most</span> <span class=\"n\">recent</span> <span class=\"n\">call</span> <span class=\"n\">last</span><span class=\"o\">):</span>\n  <span class=\"n\">File</span> <span class=\"s2\">\"/home/michael/VENV_mercurial/bin/inv\"</span><span class=\"o\">,</span> <span class=\"n\">line</span> <span class=\"mi\">8</span><span class=\"o\">,</span> <span class=\"k\">in</span> <span class=\"bp\">&lt;</span><span class=\"n\">module</span><span class=\"bp\">&gt;</span>\n    <span class=\"n\">sys.exit</span><span class=\"o\">(</span><span class=\"n\">program.run</span><span class=\"o\">())</span>\n             <span class=\"bp\">^^^^^^^^^^^^^</span>\n  <span class=\"n\">File</span> <span class=\"s2\">\"/home/michael/VENV_mercurial/lib/python3.11/site-packages/invoke/program.py\"</span><span class=\"o\">,</span> <span class=\"n\">line</span> <span class=\"mi\">387</span><span class=\"o\">,</span> <span class=\"k\">in</span> <span class=\"n\">run</span>\n    <span class=\"n\">self.parse_collection</span><span class=\"o\">()</span>\n  <span class=\"n\">File</span> <span class=\"s2\">\"/home/michael/VENV_mercurial/lib/python3.11/site-packages/invoke/program.py\"</span><span class=\"o\">,</span> <span class=\"n\">line</span> <span class=\"mi\">479</span><span class=\"o\">,</span> <span class=\"k\">in</span> <span class=\"n\">parse_collection</span>\n    <span class=\"n\">self.load_collection</span><span class=\"o\">()</span>\n  <span class=\"n\">File</span> <span class=\"s2\">\"/home/michael/VENV_mercurial/lib/python3.11/site-packages/invoke/program.py\"</span><span class=\"o\">,</span> <span class=\"n\">line</span> <span class=\"mi\">716</span><span class=\"o\">,</span> <span class=\"k\">in</span> <span class=\"n\">load_collection</span>\n    <span class=\"n\">module</span><span class=\"o\">,</span> <span class=\"n\">parent</span> <span class=\"bp\">=</span> <span class=\"n\">loader.load</span><span class=\"o\">(</span><span class=\"n\">coll_name</span><span class=\"o\">)</span>\n                     <span class=\"bp\">^^^^^^^^^^^^^^^^^^^^^^</span>\n  <span class=\"n\">File</span> <span class=\"s2\">\"/home/michael/VENV_mercurial/lib/python3.11/site-packages/invoke/loader.py\"</span><span class=\"o\">,</span> <span class=\"n\">line</span> <span class=\"mi\">91</span><span class=\"o\">,</span> <span class=\"k\">in</span> <span class=\"n\">load</span>\n    <span class=\"n\">spec.loader.exec_module</span><span class=\"o\">(</span><span class=\"n\">module</span><span class=\"o\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">\"&lt;frozen importlib._bootstrap_external&gt;\"</span><span class=\"o\">,</span> <span class=\"n\">line</span> <span class=\"mi\">940</span><span class=\"o\">,</span> <span class=\"k\">in</span> <span class=\"n\">exec_module</span>\n  <span class=\"n\">File</span> <span class=\"s2\">\"&lt;frozen importlib._bootstrap&gt;\"</span><span class=\"o\">,</span> <span class=\"n\">line</span> <span class=\"mi\">241</span><span class=\"o\">,</span> <span class=\"k\">in</span> <span class=\"n\">_call_with_frames_removed</span>\n  <span class=\"n\">File</span> <span class=\"s2\">\"[redacted]/sphere-eversion/tasks.py\"</span><span class=\"o\">,</span> <span class=\"n\">line</span> <span class=\"mi\">6</span><span class=\"o\">,</span> <span class=\"k\">in</span> <span class=\"bp\">&lt;</span><span class=\"n\">module</span><span class=\"bp\">&gt;</span>\n    <span class=\"k\">from</span> <span class=\"n\">mathlibtools.lib</span> <span class=\"kn\">import</span> <span class=\"n\">LeanProject</span>\n<span class=\"n\">ModuleNotFoundError</span><span class=\"o\">:</span> <span class=\"n\">No</span> <span class=\"n\">module</span> <span class=\"n\">named</span> <span class=\"bp\">'</span><span class=\"n\">mathlibtools'</span>\n</code></pre></div>",
        "id": 420022990,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1707217513
    },
    {
        "content": "<p>(I am installing plastex etc. in a virtual environment <code>VENV_mercurial</code>.) What am I missing?</p>",
        "id": 420023252,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1707217597
    },
    {
        "content": "<p>Are you sure the blueprint works with lean 4?</p>",
        "id": 420038574,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1707223363
    },
    {
        "content": "<p>This works:</p>\n<div class=\"codehilite\" data-code-language=\"Diff\"><pre><span></span><code><span class=\"gd\">--- tasks.py</span>\n<span class=\"gi\">+++ tasks.py</span>\n<span class=\"gu\">@@ -3,8 +3,6 @@ import shutil</span>\n<span class=\"w\"> </span>from pathlib import Path\n<span class=\"w\"> </span>from invoke import run, task\n\n<span class=\"gd\">-from mathlibtools.lib import LeanProject</span>\n<span class=\"gd\">-</span>\n<span class=\"w\"> </span>from blueprint.tasks import web, bp, print, serve\n\n<span class=\"w\"> </span>ROOT = Path(__file__).parent\n<span class=\"gu\">@@ -17,12 +15,7 @@ def doc(ctx):</span>\n<span class=\"w\"> </span>        run(f'pandoc -t html --mathjax -f markdown+tex_math_dollars+raw_tex {path.name} --template template.html -o ../docs/{path.with_suffix(\".html\").name}')\n<span class=\"w\"> </span>    os.chdir(cwd)\n\n<span class=\"gd\">-@task</span>\n<span class=\"gd\">-def decls(ctx):</span>\n<span class=\"gd\">-    proj = LeanProject.from_path(ROOT)</span>\n<span class=\"gd\">-    proj.pickle_decls(ROOT/'decls.pickle')</span>\n<span class=\"gd\">-</span>\n<span class=\"gd\">-@task(doc, decls, bp, web)</span>\n<span class=\"gi\">+@task(doc, bp, web)</span>\n<span class=\"w\"> </span>def all(ctx):\n<span class=\"w\"> </span>    shutil.rmtree(ROOT/'docs'/'blueprint', ignore_errors=True)\n<span class=\"w\"> </span>    shutil.copytree(ROOT/'blueprint'/'web', ROOT/'docs'/'blueprint')\n</code></pre></div>",
        "id": 420039495,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1707223674
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/stream/303200-sphere-eversion/topic/Updating.20blueprint.3F/near/420038574\">said</a>:</p>\n<blockquote>\n<p>Are you sure the blueprint works with lean 4?</p>\n</blockquote>\n<p>I have no idea. I assumed it would, but that might have been way too optimistic <span aria-label=\"big smile\" class=\"emoji emoji-1f604\" role=\"img\" title=\"big smile\">:big_smile:</span></p>",
        "id": 420054863,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1707228504
    },
    {
        "content": "<p>Your proposed change worked. (I had to install the Asana Math font locally, then it compiled.)</p>",
        "id": 420056518,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1707229044
    },
    {
        "content": "<p>The links to Lean declarations are broken; they were not migrated during the port.</p>",
        "id": 420056631,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1707229074
    },
    {
        "content": "<p>I pushed the regenerated blueprint to the <code>update-blueprint</code> branch. It's a mixed bag of changes</p>\n<ul>\n<li>generated the \"local to global\" chapter was never added to version control</li>\n<li>some layout changes are clearly for the better (e.g. triangle for collapsing/expanding output)</li>\n<li>some changes seem for the worse (lots of trailing whitespace now)</li>\n<li>other are a matter of taste (existing output is hard-wrapped at 80 characters; I'd argue that's not necessary). For just viewing the HTML, it probably doesn't matter much.</li>\n</ul>\n<p>The last two are more minor (but lots of churn).</p>",
        "id": 420058139,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1707229463
    },
    {
        "content": "<p>The blueprint has not been ported at all. I completely forgot about it at the end of the port.</p>",
        "id": 420080183,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1707235411
    },
    {
        "content": "<p>Makes sense! I had some free time and went over all <code>lean</code> commands in the blueprint, updating lemma names as needed (and also doing the same in doc comments). Two follow-up questions</p>\n<ul>\n<li>are there further commands I should check?</li>\n<li>does the blueprint need further updates?</li>\n</ul>",
        "id": 420300533,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1707325498
    },
    {
        "content": "<p>Thanks! In this project the blueprint is built locally and the result is pushed to the repo because it was the first project using this blueprint plugin and I hate CI setup. So if it builds for you then you can push it.</p>",
        "id": 420301782,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1707325873
    },
    {
        "content": "<p>Just pushed the updated version. While at it, I stumbled across some lemma names which appear to be Lean3-isms to me. Some I renamed <a href=\"https://github.com/leanprover-community/sphere-eversion/commit/3ad05af0ac3b8d8844af19a8923f16a5525f22f2\">directly</a>; I am less sure about</p>\n<ul>\n<li><code>one_jet_eucl_bundle_mk</code> and friends</li>\n<li><code>Smooth{At}.one_jet_comp</code> and <code>Smooth.one_jet_add</code></li>\n</ul>",
        "id": 420308656,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1707328136
    },
    {
        "content": "<p>Yes, I think there are lots of Lean 3 names that could be fixed.</p>",
        "id": 420312191,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1707329309
    },
    {
        "content": "<p>In non-mathlib projects the naming can be quite sloppy. Feel free to improve them (without worrying that they must resemble the bad Lean 3 name)!</p>",
        "id": 420321179,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1707332130
    },
    {
        "content": "<p>Thanks, that is helpful. I've tweaked a few names (pushed already). I will leave it at that for now.</p>",
        "id": 420322029,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1707332402
    },
    {
        "content": "<p>I just marked a student project where several of the declaration names were swearwords.</p>",
        "id": 420336752,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1707337677
    },
    {
        "content": "<p>Don't look up Lurie's LaTeX labels in old versions of Higher Topos Theory <span aria-label=\"grinning\" class=\"emoji emoji-1f600\" role=\"img\" title=\"grinning\">:grinning:</span></p>",
        "id": 420336964,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1707337751
    }
]