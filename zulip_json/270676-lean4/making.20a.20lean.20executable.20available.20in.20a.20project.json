[
    {
        "content": "<p>I have a fundamental misunderstanding of how to make a <code>lake exe myScript</code> available in a different project.</p>\n<p>Say that I have new lean project that provides <code>lake exe myScript</code>.  I would like now to make the script available in mathlib.  What steps should I take?</p>\n<p>I imagine that I should add a <code>require</code> line to the <code>lakefile</code> and this seems to work well.  What else should I do?  Specifically, how do I make sure that the path that lean uses is the correct one inside <code>.lake/package/myScript</code>s?  Is there anything else that I should do?</p>",
        "id": 443352589,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717786084
    },
    {
        "content": "<p>I have been trying this for a while with no success.  I could get <code>lake exe myScript --help</code> to display the help message, but can't get past errors like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">uncaught</span><span class=\"w\"> </span><span class=\"n\">exception</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unknown</span><span class=\"w\"> </span><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">myScript'</span>\n<span class=\"n\">You</span><span class=\"w\"> </span><span class=\"n\">might</span><span class=\"w\"> </span><span class=\"n\">need</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"bp\">'/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">damiano</span><span class=\"bp\">/</span><span class=\"n\">Lean4'</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">your</span><span class=\"w\"> </span><span class=\"n\">editor</span>\n</code></pre></div>\n<p>to show up.</p>",
        "id": 443352800,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717786161
    },
    {
        "content": "<p>If mathlib requires your project then <code>lake exe myScript</code> should work, no?</p>",
        "id": 443359962,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1717788509
    },
    {
        "content": "<p>I cannot get it to work.</p>",
        "id": 443360053,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717788534
    },
    {
        "content": "<p>I run <code>lake update myScript</code> and it seems to do something (no warnings, nor errors, just <code>info</code>s).</p>",
        "id": 443360142,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717788562
    },
    {
        "content": "<p>After that, <code>lake env myScript --help</code> works (note the <code>env</code>, not <code>exe</code>).</p>",
        "id": 443360218,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717788584
    },
    {
        "content": "<p>is it a lake executable or a script?</p>",
        "id": 443360282,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1717788599
    },
    {
        "content": "<p>But anything <code>exe</code> gives me the error above.</p>",
        "id": 443360290,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717788600
    },
    {
        "content": "<p>if it's a script then I think <code>lake run projName/myScript</code> is the syntax</p>",
        "id": 443360373,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1717788612
    },
    {
        "content": "<p>What is the difference between an executable and a script?</p>",
        "id": 443360459,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717788632
    },
    {
        "content": "<p>Anyway, <span class=\"user-mention\" data-user-id=\"315577\">@Mac Malone</span> is the person to ask</p>",
        "id": 443360495,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1717788638
    },
    {
        "content": "<p>I tried to write something like <code>lake exe mk_all</code>, but in a separate repo.</p>",
        "id": 443360538,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717788648
    },
    {
        "content": "<p>what does the lakefile of your external project look like?</p>",
        "id": 443360635,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1717788679
    },
    {
        "content": "<p><a href=\"https://github.com/adomani/UpdateDeprecations\">This is the repo</a> and the lakefile is</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lake</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lake</span><span class=\"w\"> </span><span class=\"n\">DSL</span>\n\n<span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">updateDeprecations</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">leanOptions</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span>\n<span class=\"w\">    </span><span class=\"bp\">⟨</span><span class=\"ss\">`pp.unicode.fun</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"bp\">⟩</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"c1\">-- pretty-prints `fun a ↦ b`</span>\n<span class=\"w\">    </span><span class=\"bp\">⟨</span><span class=\"ss\">`autoImplicit</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"bp\">⟩</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"bp\">⟨</span><span class=\"ss\">`relaxedAutoImplicit</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"o\">]</span>\n\n<span class=\"n\">require</span><span class=\"w\"> </span><span class=\"n\">Cli</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/leanprover/lean4-cli\"</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"w\"> </span><span class=\"s2\">\"main\"</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">default_target</span><span class=\"kd\">]</span>\n<span class=\"n\">lean_lib</span><span class=\"w\"> </span><span class=\"n\">UpdateDeprecations</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"c1\">--  -- add library configuration options here</span>\n\n<span class=\"sd\">/-- `lake exe update_deprecations` automatically updates deprecations. -/</span>\n<span class=\"kd\">@[</span><span class=\"n\">default_target</span><span class=\"kd\">]</span>\n<span class=\"n\">lean_exe</span><span class=\"w\"> </span><span class=\"n\">update_deprecations</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">srcDir</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"UpdateDeprecations\"</span>\n<span class=\"w\">  </span><span class=\"n\">root</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"ss\">`Main</span>\n<span class=\"w\">  </span><span class=\"n\">supportInterpreter</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">true</span>\n</code></pre></div>",
        "id": 443360929,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717788747
    },
    {
        "content": "<p>right, so I think <code>lake exe update_deprecations</code> should work in any project that requires this.</p>",
        "id": 443361000,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1717788774
    },
    {
        "content": "<p>(mostly cargo-culted from elsewhere, so could be nonsense, but in the project, <code>lake exe update_deprecations</code> works.)</p>",
        "id": 443361022,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717788781
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"243562\">Adam Topaz</span> <a href=\"#narrow/stream/270676-lean4/topic/making.20a.20lean.20executable.20available.20in.20a.20project/near/443361000\">said</a>:</p>\n<blockquote>\n<p>right, so I think <code>lake exe update_deprecations</code> should work in any project that requires this.</p>\n</blockquote>\n<p>I would have thought so as well, but...</p>",
        "id": 443361083,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717788800
    },
    {
        "content": "<p>how do you require this project in another one?</p>",
        "id": 443361179,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1717788829
    },
    {
        "content": "<p>I added</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">require</span><span class=\"w\"> </span><span class=\"n\">UpdateDeprecations</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/adomani/UpdateDeprecations\"</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"w\"> </span><span class=\"s2\">\"caps_dev\"</span>\n</code></pre></div>\n<p>after the other <code>require</code>s in mathlib.</p>",
        "id": 443361331,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717788866
    },
    {
        "content": "<p>It should be <code>require updateDeprecations from git ...</code> (note the capitalization)</p>",
        "id": 443361374,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1717788880
    },
    {
        "content": "<p>(<code>caps_dev</code> is a non-<code>master</code> branch in which I am doing some development.)</p>",
        "id": 443361398,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717788889
    },
    {
        "content": "<p>as far as I understand the <code>foo</code> in <code>require foo from ...</code> needs to match <code>foo</code> in <code>package foo where ...</code></p>",
        "id": 443361520,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1717788929
    },
    {
        "content": "<p>and still <code>lake update updateDeprecations</code> after changing the <code>require</code>, right?</p>",
        "id": 443361619,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717788958
    },
    {
        "content": "<p>maybe... may as well just to be safe</p>",
        "id": 443361729,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1717788981
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">update</span><span class=\"w\"> </span><span class=\"n\">updateDeprecations</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">updateDeprecations</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">adomani</span><span class=\"bp\">/</span><span class=\"n\">UpdateDeprecations</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"bp\">'././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">updateDeprecations'</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">mathlib</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">UpdateDeprecations'</span><span class=\"w\"> </span><span class=\"n\">was</span><span class=\"w\"> </span><span class=\"n\">required</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">updateDeprecations'</span>\n</code></pre></div>",
        "id": 443361770,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717788994
    },
    {
        "content": "<p>(the capitalisation again...)</p>",
        "id": 443361789,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717789003
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">update</span><span class=\"w\"> </span><span class=\"n\">UpdateDeprecations</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">updateDeprecations</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">adomani</span><span class=\"bp\">/</span><span class=\"n\">UpdateDeprecations</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"bp\">'././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">updateDeprecations'</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">mathlib</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">UpdateDeprecations'</span><span class=\"w\"> </span><span class=\"n\">was</span><span class=\"w\"> </span><span class=\"n\">required</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">updateDeprecations'</span>\n</code></pre></div>",
        "id": 443361821,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717789020
    },
    {
        "content": "<p>sigh... the only guess I have is to purge the lake manifest and/or <code>.lake</code> and try from scratch, but there may be a more surgical fix.</p>",
        "id": 443362075,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1717789086
    },
    {
        "content": "<p>I have been playing with this for a bit, but I had started by cloning mathlib again...</p>",
        "id": 443362225,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717789133
    },
    {
        "content": "<p>Anyway, besides the <code>require</code> line, I should not be adding anything else to the lakefile, right?</p>",
        "id": 443362318,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717789161
    },
    {
        "content": "<p>I think that's right.</p>",
        "id": 443362398,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1717789184
    },
    {
        "content": "<p>(to the lakefile or anywhere else in mathlib)</p>",
        "id": 443362400,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717789186
    },
    {
        "content": "<p>I have a feeling that what I am failing to communicate to lake is the path where the code is written.</p>",
        "id": 443362530,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717789215
    },
    {
        "content": "<p>(I can see the code in <code>.lake/packages//UpdateDeprecations</code>, but I get the impression that lake expects to find it inside the root dir of mathlib.)</p>",
        "id": 443362664,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717789250
    },
    {
        "content": "<p>I tested this in a plain lean project with the following lakefile:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lake</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lake</span><span class=\"w\"> </span><span class=\"n\">DSL</span>\n\n<span class=\"n\">require</span><span class=\"w\"> </span><span class=\"n\">updateDeprecations</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/adomani/UpdateDeprecations\"</span>\n\n<span class=\"n\">package</span><span class=\"w\"> </span><span class=\"bp\">«</span><span class=\"n\">test</span><span class=\"bp\">»</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"c1\">-- add package configuration options here</span>\n\n<span class=\"n\">lean_lib</span><span class=\"w\"> </span><span class=\"bp\">«</span><span class=\"n\">Test</span><span class=\"bp\">»</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"c1\">-- add library configuration options here</span>\n\n\n<span class=\"kd\">@[</span><span class=\"n\">default_target</span><span class=\"kd\">]</span>\n<span class=\"n\">lean_exe</span><span class=\"w\"> </span><span class=\"bp\">«</span><span class=\"n\">test</span><span class=\"bp\">»</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">root</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"ss\">`Main</span>\n</code></pre></div>",
        "id": 443363042,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1717789359
    },
    {
        "content": "<p>... and it works?</p>",
        "id": 443363087,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717789376
    },
    {
        "content": "<p>running <code>lake exe update_deprecations</code> worked with no errors (except for \"There are out of date oleans. Run <code>lake build</code> or <code>lake exe cache get</code> first\", which may be expected)</p>",
        "id": 443363125,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1717789387
    },
    {
        "content": "<p>Would you mind adding this file</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">hi</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">intro</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">deprecated</span><span class=\"w\"> </span><span class=\"n\">hi</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"bp\">.</span><span class=\"n\">the_old_hi</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">intro</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">True</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">constructor</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"bp\">.</span><span class=\"n\">the_old_hi</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">the_old_hi</span>\n</code></pre></div>\n<p>and running <code>lake exe update_deprecations --mods pathToFile</code>?</p>",
        "id": 443363249,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717789439
    },
    {
        "content": "<p>(after <code>lake build file</code>?)</p>",
        "id": 443363319,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717789449
    },
    {
        "content": "<p>Ideally, the script should change the file to</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">hi</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">intro</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">deprecated</span><span class=\"w\"> </span><span class=\"n\">hi</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"bp\">.</span><span class=\"n\">the_old_hi</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">intro</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">True</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">constructor</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hi</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hi</span>\n</code></pre></div>",
        "id": 443363450,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717789492
    },
    {
        "content": "<p>(in particular, it should succeed!)</p>",
        "id": 443363521,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717789512
    },
    {
        "content": "<p>It ran with no output to stdout, and the file remained</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">theorem</span><span class=\"w\"> </span><span class=\"n\">hi</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">intro</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">deprecated</span><span class=\"w\"> </span><span class=\"n\">hi</span><span class=\"kd\">]</span>\n<span class=\"kd\">theorem</span><span class=\"w\"> </span><span class=\"n\">True.the_old_hi</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">intro</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">True</span>\n<span class=\"kd\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">  </span><span class=\"n\">constructor</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">True.the_old_hi</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">the_old_hi</span>\n</code></pre></div>",
        "id": 443363564,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1717789527
    },
    {
        "content": "<p>Hmm, it should have told you that it changed 1 file, 2 replacements and should have changed the file...</p>",
        "id": 443363698,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717789564
    },
    {
        "content": "<p>Ok, thanks, I'll play with an \"empty\" project for a bit.</p>",
        "id": 443363750,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717789578
    },
    {
        "content": "<p>what's the path? is it the name of the module or the actual filepath?</p>",
        "id": 443363773,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1717789581
    },
    {
        "content": "<p>Whichever you prefer: the script handles both.</p>",
        "id": 443363824,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717789596
    },
    {
        "content": "<p>(unlike <code>lake build file</code>)</p>",
        "id": 443363896,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717789615
    },
    {
        "content": "<p>I ran it, but now it's giving me the message \"There are out of date oleans...\" no matter how many times I build the file.</p>",
        "id": 443364227,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1717789713
    },
    {
        "content": "<p>But in any case, the executable seems to be working in my test project.</p>",
        "id": 443364303,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1717789738
    },
    {
        "content": "<p>Ok, thank you very much for trying!  I'll debug more.  It is encouraging that it seems to run, maybe with bugs in my script!</p>",
        "id": 443364343,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717789753
    },
    {
        "content": "<p>No problem!</p>",
        "id": 443364572,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1717789841
    },
    {
        "content": "<p>Adam, I suspect that what you were seeing was maybe since your <code>toolchain</code> was not on <code>leanprover/lean4:v4.8.0-rc1</code> or later.  However, even with that, I still get the same error</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"n\">update_deprecations</span><span class=\"w\"> </span><span class=\"c1\">--mods Test/withDeprecations.lean</span>\n<span class=\"n\">uncaught</span><span class=\"w\"> </span><span class=\"n\">exception</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unknown</span><span class=\"w\"> </span><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">UpdateDeprecations'</span>\n<span class=\"n\">You</span><span class=\"w\"> </span><span class=\"n\">might</span><span class=\"w\"> </span><span class=\"n\">need</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"bp\">'/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">damiano</span><span class=\"bp\">/</span><span class=\"n\">gclones'</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">your</span><span class=\"w\"> </span><span class=\"n\">editor</span>\n</code></pre></div>\n<p><span aria-label=\"shrug\" class=\"emoji emoji-1f937\" role=\"img\" title=\"shrug\">:shrug:</span></p>",
        "id": 443367390,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717790666
    },
    {
        "content": "<p>Interesting: It works perfectly fine if I clone your repo and <code>require</code> it as a local dependency, but it gives the error you mentioned when requiring it from github...</p>\n<p>And I think the problem is in the line</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Environment</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">importModules</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[{</span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"ss\">`UpdateDeprecations.Main</span><span class=\"o\">}]</span><span class=\"w\"> </span><span class=\"o\">{}</span>\n</code></pre></div>\n<p>which throws the mentioned error <code>unknown package UpdateDeprecations</code>. However, I do not know why either.</p>",
        "id": 443400188,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1717804583
    },
    {
        "content": "<p>So with <code>require updateDeprecations from \"..\" / \"UpdateDeprecations\"</code> it does the following modifications as expected:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>--- a/Test/Basic.lean\n+++ b/Test/Basic.lean\n@@ -8,5 +8,5 @@ theorem True.the_old_hi : True := .intro\n open True\n example : True ∧ True := by\n   constructor\n-  exact True.the_old_hi\n-  exact the_old_hi\n+  exact hi\n+  exact hi\n</code></pre></div>",
        "id": 443400322,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1717804707
    },
    {
        "content": "<p>Actually, I think it's the <code>srcDir</code> in the <code>lean_exe</code> config that messes things up. With the following entry the script runs perfectly fine for me:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- `lake exe update_deprecations` automatically updates deprecations. -/</span>\n<span class=\"kd\">@[</span><span class=\"n\">default_target</span><span class=\"kd\">]</span>\n<span class=\"n\">lean_exe</span><span class=\"w\"> </span><span class=\"n\">update_deprecations</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"c1\">-- srcDir := \"UpdateDeprecations\"</span>\n<span class=\"w\">  </span><span class=\"n\">root</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"ss\">`UpdateDeprecations.Main</span>\n<span class=\"w\">  </span><span class=\"n\">supportInterpreter</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">true</span>\n</code></pre></div>\n<p>Don't ask me why... <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span> I'd love to understand why the <code>srcDir</code> only messes with things in the case where one has <code>require ... from git ...</code>, but not when <code>require ... from \"..\" / ...</code></p>",
        "id": 443401065,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1717805252
    },
    {
        "content": "<p>Is this a bug in lake?</p>",
        "id": 443404806,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1717807606
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"385895\">@Jon Eugster</span> thank you so much!  I will do some testing soon, but I am glad that you could get it to work!</p>",
        "id": 443429320,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717826413
    },
    {
        "content": "<p>I had also zoomed in on <code>importModules</code>, as you can see from the dbg_traces around it, but could not use that to fix the issue anyway...</p>",
        "id": 443429396,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717826466
    },
    {
        "content": "<p>By the way, I think that all the <code>lake exe cmd</code>s that mathlib uses are from scripts that are contained in mathlib's root dir.  I wonder whether this is just because something similar goes on there and it is not possible to just make them available in <code>.lake/packaged</code>...</p>",
        "id": 443430098,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717827088
    },
    {
        "content": "<p>E.g., if I wanted to disengage <code>lake exe mk_all</code> from mathlib, I would probably run in the same issue, right?</p>",
        "id": 443430165,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717827135
    },
    {
        "content": "<p>I tried, but I could not get the script to work on a new project even in the form <code>require ... from \"..\" / ...</code>.  I assume that <code>\"..\" / ...</code> refers to the relative path of the dir with the local clone of the <code>UpdateDeprecations</code> repo, right?</p>",
        "id": 443520068,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717879001
    },
    {
        "content": "<p>yes, relative from the downstream's project folder, so if e.g. <code>mathlib</code> and <code>std</code> were both folders inside a <code>Lean</code> folder, you could write <code>require std from \"..\" / \"std\"</code> in the <code>mathlib</code>'s lakefile.</p>\n<p>I can try to recreate a fully reproducible setup tomorrow and maybe also use it to issue an issue about the <code>srcDir</code> behaviour</p>",
        "id": 443531284,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1717887137
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"243562\">Adam Topaz</span> <a href=\"#narrow/stream/270676-lean4/topic/making.20a.20lean.20executable.20available.20in.20a.20project/near/443404806\">said</a>:</p>\n<blockquote>\n<p>Is this a bug in lake?</p>\n</blockquote>\n<p>It certainly sounds like one. <span aria-label=\"disappointed\" class=\"emoji emoji-1f61e\" role=\"img\" title=\"disappointed\">:disappointed:</span></p>",
        "id": 443602124,
        "sender_full_name": "Mac Malone",
        "timestamp": 1717945165
    },
    {
        "content": "<p>Well, hopefully it is one that can be fixed!  <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 443602155,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717945197
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span> could you try if just calling <code>lake build updateDeprecations</code>  (or capital U, forgot which one you had) before the <code>lake exe update_deprecations</code> works for you? (that's all in the repo the requires your <code>updateDeprecations</code>)</p>\n<p>Here is a repo with a full reproduction of what I think happens: <a href=\"https://github.com/joneugster/test_deprecation\">https://github.com/joneugster/test_deprecation</a> . I think it's just that <code>UpdateDeprecations.Main</code> is not built and therefore it cannot be imported. You can work around this by adding a post-update hook like this one: <a href=\"https://github.com/leanprover-community/lean4game/blob/446d0296f0bcb64a195ba595944dbf8e28c93a84/server/lakefile.lean#L27-L31\">build gameserver</a></p>",
        "id": 443766853,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1718024790
    },
    {
        "content": "<p>Jon, I followed the steps in your repo and I can reproduce your results for the initial version, requiring from git.  However, I was not able to get the \"local\" one to work: I used the commented out line in the lakefile, and commented out the initial one (from git) instead.</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$<span class=\"w\"> </span>lake<span class=\"w\"> </span>exe<span class=\"w\"> </span>update_deprecations\n⚠<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">1</span>/3<span class=\"o\">]</span><span class=\"w\"> </span>Built<span class=\"w\"> </span>Main\nwarning:<span class=\"w\"> </span>./././UpdateDeprecations/./UpdateDeprecations/Main.lean:4:10:<span class=\"w\"> </span>unused<span class=\"w\"> </span>variable<span class=\"w\"> </span><span class=\"sb\">`</span>args<span class=\"sb\">`</span>\nnote:<span class=\"w\"> </span>this<span class=\"w\"> </span>linter<span class=\"w\"> </span>can<span class=\"w\"> </span>be<span class=\"w\"> </span>disabled<span class=\"w\"> </span>with<span class=\"w\"> </span><span class=\"sb\">`</span>set_option<span class=\"w\"> </span>linter.unusedVariables<span class=\"w\"> </span><span class=\"nb\">false</span><span class=\"sb\">`</span>\nwarning:<span class=\"w\"> </span>./././UpdateDeprecations/./UpdateDeprecations/Main.lean:15:6:<span class=\"w\"> </span>unused<span class=\"w\"> </span>variable<span class=\"w\"> </span><span class=\"sb\">`</span>mFile<span class=\"sb\">`</span>\nnote:<span class=\"w\"> </span>this<span class=\"w\"> </span>linter<span class=\"w\"> </span>can<span class=\"w\"> </span>be<span class=\"w\"> </span>disabled<span class=\"w\"> </span>with<span class=\"w\"> </span><span class=\"sb\">`</span>set_option<span class=\"w\"> </span>linter.unusedVariables<span class=\"w\"> </span><span class=\"nb\">false</span><span class=\"sb\">`</span>\nwarning:<span class=\"w\"> </span>./././UpdateDeprecations/./UpdateDeprecations/Main.lean:19:6:<span class=\"w\"> </span>unused<span class=\"w\"> </span>variable<span class=\"w\"> </span><span class=\"sb\">`</span>env<span class=\"sb\">`</span>\nnote:<span class=\"w\"> </span>this<span class=\"w\"> </span>linter<span class=\"w\"> </span>can<span class=\"w\"> </span>be<span class=\"w\"> </span>disabled<span class=\"w\"> </span>with<span class=\"w\"> </span><span class=\"sb\">`</span>set_option<span class=\"w\"> </span>linter.unusedVariables<span class=\"w\"> </span><span class=\"nb\">false</span><span class=\"sb\">`</span>\ncurrent<span class=\"w\"> </span>dir:<span class=\"w\"> </span>/home/damiano/gclones/test_deprecation\nfirst<span class=\"w\"> </span>entry<span class=\"w\"> </span>of<span class=\"w\"> </span>search<span class=\"w\"> </span>path:<span class=\"w\"> </span>./././UpdateDeprecations/.lake/build/lib\nUse<span class=\"w\"> </span><span class=\"sb\">`</span>ls<span class=\"sb\">`</span><span class=\"w\"> </span>to<span class=\"w\"> </span>see<span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span>it<span class=\"w\"> </span>contains<span class=\"w\"> </span><span class=\"sb\">`</span>UpdateDeprecations/Main.olean<span class=\"sb\">`</span>\nuncaught<span class=\"w\"> </span>exception:<span class=\"w\"> </span>unknown<span class=\"w\"> </span>package<span class=\"w\"> </span><span class=\"s1\">'UpdateDeprecations'</span>\nYou<span class=\"w\"> </span>might<span class=\"w\"> </span>need<span class=\"w\"> </span>to<span class=\"w\"> </span>open<span class=\"w\"> </span><span class=\"s1\">'/home/damiano/gclones/test_deprecation'</span><span class=\"w\"> </span>as<span class=\"w\"> </span>a<span class=\"w\"> </span>workspace<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>your<span class=\"w\"> </span>editor\n</code></pre></div>",
        "id": 443775474,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1718027203
    },
    {
        "content": "<p>I just deleted the instructions for the local case, because I think that analysis was wrong and it doesn't actually matter if it's local or not.</p>\n<p>The only thing that matters is whether <code>./UpdateDeprecations/.lake/build/lib/UpdateDeprecations/Main.olean</code> exists or not.</p>\n<p>what does <code>ls ./UpdateDeprecations/.lake/build/lib</code> show right now?</p>",
        "id": 443776773,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1718027578
    },
    {
        "content": "<p>Here is what I see:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$<span class=\"w\"> </span>ls<span class=\"w\"> </span>./UpdateDeprecations/.lake/build/lib\nMain.ilean<span class=\"w\">  </span>Main.ilean.hash<span class=\"w\">  </span>Main.log.json<span class=\"w\">  </span>Main.olean<span class=\"w\">  </span>Main.olean.hash<span class=\"w\">  </span>Main.trace\n</code></pre></div>",
        "id": 443776890,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1718027618
    },
    {
        "content": "<p>and <code>lake exe update_deprecations</code> still gives you that error?</p>",
        "id": 443777043,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1718027656
    },
    {
        "content": "<p>Just now, next command issued after the one above:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$<span class=\"w\"> </span>lake<span class=\"w\"> </span>exe<span class=\"w\"> </span>update_deprecations\n⚠<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">1</span>/3<span class=\"o\">]</span><span class=\"w\"> </span>Replayed<span class=\"w\"> </span>Main\nwarning:<span class=\"w\"> </span>./././UpdateDeprecations/./UpdateDeprecations/Main.lean:4:10:<span class=\"w\"> </span>unused<span class=\"w\"> </span>variable<span class=\"w\"> </span><span class=\"sb\">`</span>args<span class=\"sb\">`</span>\nnote:<span class=\"w\"> </span>this<span class=\"w\"> </span>linter<span class=\"w\"> </span>can<span class=\"w\"> </span>be<span class=\"w\"> </span>disabled<span class=\"w\"> </span>with<span class=\"w\"> </span><span class=\"sb\">`</span>set_option<span class=\"w\"> </span>linter.unusedVariables<span class=\"w\"> </span><span class=\"nb\">false</span><span class=\"sb\">`</span>\nwarning:<span class=\"w\"> </span>./././UpdateDeprecations/./UpdateDeprecations/Main.lean:15:6:<span class=\"w\"> </span>unused<span class=\"w\"> </span>variable<span class=\"w\"> </span><span class=\"sb\">`</span>mFile<span class=\"sb\">`</span>\nnote:<span class=\"w\"> </span>this<span class=\"w\"> </span>linter<span class=\"w\"> </span>can<span class=\"w\"> </span>be<span class=\"w\"> </span>disabled<span class=\"w\"> </span>with<span class=\"w\"> </span><span class=\"sb\">`</span>set_option<span class=\"w\"> </span>linter.unusedVariables<span class=\"w\"> </span><span class=\"nb\">false</span><span class=\"sb\">`</span>\nwarning:<span class=\"w\"> </span>./././UpdateDeprecations/./UpdateDeprecations/Main.lean:19:6:<span class=\"w\"> </span>unused<span class=\"w\"> </span>variable<span class=\"w\"> </span><span class=\"sb\">`</span>env<span class=\"sb\">`</span>\nnote:<span class=\"w\"> </span>this<span class=\"w\"> </span>linter<span class=\"w\"> </span>can<span class=\"w\"> </span>be<span class=\"w\"> </span>disabled<span class=\"w\"> </span>with<span class=\"w\"> </span><span class=\"sb\">`</span>set_option<span class=\"w\"> </span>linter.unusedVariables<span class=\"w\"> </span><span class=\"nb\">false</span><span class=\"sb\">`</span>\ncurrent<span class=\"w\"> </span>dir:<span class=\"w\"> </span>/home/damiano/gclones/test_deprecation\nfirst<span class=\"w\"> </span>entry<span class=\"w\"> </span>of<span class=\"w\"> </span>search<span class=\"w\"> </span>path:<span class=\"w\"> </span>./././UpdateDeprecations/.lake/build/lib\nUse<span class=\"w\"> </span><span class=\"sb\">`</span>ls<span class=\"sb\">`</span><span class=\"w\"> </span>to<span class=\"w\"> </span>see<span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span>it<span class=\"w\"> </span>contains<span class=\"w\"> </span><span class=\"sb\">`</span>UpdateDeprecations/Main.olean<span class=\"sb\">`</span>\nuncaught<span class=\"w\"> </span>exception:<span class=\"w\"> </span>unknown<span class=\"w\"> </span>package<span class=\"w\"> </span><span class=\"s1\">'UpdateDeprecations'</span>\nYou<span class=\"w\"> </span>might<span class=\"w\"> </span>need<span class=\"w\"> </span>to<span class=\"w\"> </span>open<span class=\"w\"> </span><span class=\"s1\">'/home/damiano/gclones/test_deprecation'</span><span class=\"w\"> </span>as<span class=\"w\"> </span>a<span class=\"w\"> </span>workspace<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>your<span class=\"w\"> </span>editor\n</code></pre></div>",
        "id": 443777132,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1718027685
    },
    {
        "content": "<p>and the <code>lake-manifest</code> currently does have the local dependency in it?</p>",
        "id": 443777328,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1718027759
    },
    {
        "content": "<p>then something isn't quite rigtht with that part of the analysis :(</p>",
        "id": 443777486,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1718027798
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">cat</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">manifest</span><span class=\"bp\">.</span><span class=\"n\">json</span>\n<span class=\"o\">{</span><span class=\"s2\">\"version\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"s2\">\"packagesDir\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\".lake/packages\"</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"s2\">\"packages\"</span><span class=\"o\">:</span>\n<span class=\"w\"> </span><span class=\"o\">[{</span><span class=\"s2\">\"type\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"path\"</span><span class=\"o\">,</span>\n<span class=\"w\">   </span><span class=\"s2\">\"name\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"updateDeprecations\"</span><span class=\"o\">,</span>\n<span class=\"w\">   </span><span class=\"s2\">\"manifestFile\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"lake-manifest.json\"</span><span class=\"o\">,</span>\n<span class=\"w\">   </span><span class=\"s2\">\"inherited\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"o\">,</span>\n<span class=\"w\">   </span><span class=\"s2\">\"dir\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"./UpdateDeprecations\"</span><span class=\"o\">,</span>\n<span class=\"w\">   </span><span class=\"s2\">\"configFile\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"lakefile.lean\"</span><span class=\"o\">}],</span>\n<span class=\"w\"> </span><span class=\"s2\">\"name\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"test_deprecation\"</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"s2\">\"lakeDir\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\".lake\"</span><span class=\"o\">}</span>\n</code></pre></div>",
        "id": 443777494,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1718027802
    },
    {
        "content": "<p>(Note that I am not following very well what is going on, so I am not really able to help much more than by being willing to try things out on my computer...)</p>",
        "id": 443777839,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1718027897
    },
    {
        "content": "<p>Ah</p>",
        "id": 443778411,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1718028054
    },
    {
        "content": "<p>so you get this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">ls</span><span class=\"w\"> </span><span class=\"bp\">./</span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span>\n<span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">ilean</span><span class=\"w\">  </span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">ilean</span><span class=\"bp\">.</span><span class=\"n\">hash</span><span class=\"w\">  </span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">log</span><span class=\"bp\">.</span><span class=\"n\">json</span><span class=\"w\">  </span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">olean</span><span class=\"w\">  </span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">olean</span><span class=\"bp\">.</span><span class=\"n\">hash</span><span class=\"w\">  </span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">trace</span>\n</code></pre></div>\n<p>now if you do</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"n\">updateDeprecations</span>\n<span class=\"n\">ls</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">updateDeprecations</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span>\n</code></pre></div>\n<p>you might get more in that folder:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">ilean</span><span class=\"w\">       </span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">log</span><span class=\"bp\">.</span><span class=\"n\">json</span><span class=\"w\">  </span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">olean</span><span class=\"bp\">.</span><span class=\"n\">hash</span><span class=\"w\">  </span><span class=\"n\">UpdateDeprecations</span><span class=\"w\">        </span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">.</span><span class=\"n\">ilean</span><span class=\"bp\">.</span><span class=\"n\">hash</span><span class=\"w\">  </span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">.</span><span class=\"n\">olean</span><span class=\"w\">       </span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">.</span><span class=\"n\">trace</span>\n<span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">ilean</span><span class=\"bp\">.</span><span class=\"n\">hash</span><span class=\"w\">  </span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">olean</span><span class=\"w\">     </span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">trace</span><span class=\"w\">       </span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">.</span><span class=\"n\">ilean</span><span class=\"w\">  </span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">.</span><span class=\"n\">log</span><span class=\"bp\">.</span><span class=\"n\">json</span><span class=\"w\">    </span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">.</span><span class=\"n\">olean</span><span class=\"bp\">.</span><span class=\"n\">hash</span>\n</code></pre></div>",
        "id": 443778655,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1718028122
    },
    {
        "content": "<p>Here is what I get with literally what you said:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"n\">updateDeprecations</span>\n<span class=\"bp\">⚠</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">6</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Replayed</span><span class=\"w\"> </span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">.</span><span class=\"n\">Main</span>\n<span class=\"n\">warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">./././</span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">/././</span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">/</span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"mi\">10</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unused</span><span class=\"w\"> </span><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"ss\">`args</span><span class=\"bp\">`</span>\n<span class=\"n\">note</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"w\"> </span><span class=\"n\">can</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">disabled</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"ss\">`set_option</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">unusedVariables</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"bp\">`</span>\n<span class=\"n\">warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">./././</span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">/././</span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">/</span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">15</span><span class=\"o\">:</span><span class=\"mi\">6</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unused</span><span class=\"w\"> </span><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"ss\">`mFile</span><span class=\"bp\">`</span>\n<span class=\"n\">note</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"w\"> </span><span class=\"n\">can</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">disabled</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"ss\">`set_option</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">unusedVariables</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"bp\">`</span>\n<span class=\"n\">warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">./././</span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">/././</span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">/</span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">19</span><span class=\"o\">:</span><span class=\"mi\">6</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unused</span><span class=\"w\"> </span><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"ss\">`env</span><span class=\"bp\">`</span>\n<span class=\"n\">note</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"w\"> </span><span class=\"n\">can</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">disabled</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"ss\">`set_option</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">unusedVariables</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"bp\">`</span>\n<span class=\"bp\">⚠</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">4</span><span class=\"bp\">/</span><span class=\"mi\">6</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Replayed</span><span class=\"w\"> </span><span class=\"n\">Main</span>\n<span class=\"n\">warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">./././</span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">/./</span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">/</span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"mi\">10</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unused</span><span class=\"w\"> </span><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"ss\">`args</span><span class=\"bp\">`</span>\n<span class=\"n\">note</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"w\"> </span><span class=\"n\">can</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">disabled</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"ss\">`set_option</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">unusedVariables</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"bp\">`</span>\n<span class=\"n\">warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">./././</span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">/./</span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">/</span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">15</span><span class=\"o\">:</span><span class=\"mi\">6</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unused</span><span class=\"w\"> </span><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"ss\">`mFile</span><span class=\"bp\">`</span>\n<span class=\"n\">note</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"w\"> </span><span class=\"n\">can</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">disabled</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"ss\">`set_option</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">unusedVariables</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"bp\">`</span>\n<span class=\"n\">warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">./././</span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">/./</span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">/</span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">19</span><span class=\"o\">:</span><span class=\"mi\">6</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unused</span><span class=\"w\"> </span><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"ss\">`env</span><span class=\"bp\">`</span>\n<span class=\"n\">note</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"w\"> </span><span class=\"n\">can</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">disabled</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"ss\">`set_option</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">unusedVariables</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"bp\">`</span>\n<span class=\"n\">Build</span><span class=\"w\"> </span><span class=\"n\">completed</span><span class=\"w\"> </span><span class=\"n\">successfully</span><span class=\"bp\">.</span>\n\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">ls</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">updateDeprecations</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span>\n<span class=\"n\">ls</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cannot</span><span class=\"w\"> </span><span class=\"n\">access</span><span class=\"w\"> </span><span class=\"bp\">'.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">updateDeprecations</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib'</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">No</span><span class=\"w\"> </span><span class=\"n\">such</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"n\">directory</span>\n</code></pre></div>",
        "id": 443778943,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1718028201
    },
    {
        "content": "<p>Let me search for where <code>Main.ilean.hash</code> really is, though.</p>",
        "id": 443778997,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1718028219
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">find</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">iname</span><span class=\"w\"> </span><span class=\"bp\">'*</span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">ilean</span><span class=\"bp\">.</span><span class=\"n\">hash</span><span class=\"bp\">*'</span>\n<span class=\"bp\">./</span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">ilean</span><span class=\"bp\">.</span><span class=\"n\">hash</span>\n<span class=\"bp\">./</span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">/</span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">ilean</span><span class=\"bp\">.</span><span class=\"n\">hash</span>\n</code></pre></div>",
        "id": 443779162,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1718028262
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">ls</span><span class=\"w\"> </span><span class=\"bp\">./</span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">/</span>\n<span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">ilean</span><span class=\"w\">  </span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">ilean</span><span class=\"bp\">.</span><span class=\"n\">hash</span><span class=\"w\">  </span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">log</span><span class=\"bp\">.</span><span class=\"n\">json</span><span class=\"w\">  </span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">olean</span><span class=\"w\">  </span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">olean</span><span class=\"bp\">.</span><span class=\"n\">hash</span><span class=\"w\">  </span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">trace</span>\n</code></pre></div>\n<p>I seem to be missing the <code>UpdateDeprecations</code> files.</p>",
        "id": 443779323,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1718028316
    },
    {
        "content": "<p>Yes, that's what I meant to say, so without <code>lake build updateDeprecations</code> it doesn't have these and my claim is that if you run this build command and look at the same folder again, you'll find them there</p>",
        "id": 443779883,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1718028473
    },
    {
        "content": "<p>wait I'll better write that up again <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 443780138,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1718028543
    },
    {
        "content": "<p>Ah, but was this not what I did before?  I seem to be getting something different now:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"n\">updateDeprecations</span>\n<span class=\"bp\">⚠</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">6</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Replayed</span><span class=\"w\"> </span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">.</span><span class=\"n\">Main</span>\n<span class=\"n\">warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">./././</span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">/././</span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">/</span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"mi\">10</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unused</span><span class=\"w\"> </span><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"ss\">`args</span><span class=\"bp\">`</span>\n<span class=\"n\">note</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"w\"> </span><span class=\"n\">can</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">disabled</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"ss\">`set_option</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">unusedVariables</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"bp\">`</span>\n<span class=\"n\">warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">./././</span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">/././</span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">/</span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">15</span><span class=\"o\">:</span><span class=\"mi\">6</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unused</span><span class=\"w\"> </span><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"ss\">`mFile</span><span class=\"bp\">`</span>\n<span class=\"n\">note</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"w\"> </span><span class=\"n\">can</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">disabled</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"ss\">`set_option</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">unusedVariables</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"bp\">`</span>\n<span class=\"n\">warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">./././</span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">/././</span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">/</span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">19</span><span class=\"o\">:</span><span class=\"mi\">6</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unused</span><span class=\"w\"> </span><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"ss\">`env</span><span class=\"bp\">`</span>\n<span class=\"n\">note</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"w\"> </span><span class=\"n\">can</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">disabled</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"ss\">`set_option</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">unusedVariables</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"bp\">`</span>\n<span class=\"bp\">⚠</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">4</span><span class=\"bp\">/</span><span class=\"mi\">6</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Replayed</span><span class=\"w\"> </span><span class=\"n\">Main</span>\n<span class=\"n\">warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">./././</span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">/./</span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">/</span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"mi\">10</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unused</span><span class=\"w\"> </span><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"ss\">`args</span><span class=\"bp\">`</span>\n<span class=\"n\">note</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"w\"> </span><span class=\"n\">can</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">disabled</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"ss\">`set_option</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">unusedVariables</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"bp\">`</span>\n<span class=\"n\">warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">./././</span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">/./</span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">/</span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">15</span><span class=\"o\">:</span><span class=\"mi\">6</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unused</span><span class=\"w\"> </span><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"ss\">`mFile</span><span class=\"bp\">`</span>\n<span class=\"n\">note</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"w\"> </span><span class=\"n\">can</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">disabled</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"ss\">`set_option</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">unusedVariables</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"bp\">`</span>\n<span class=\"n\">warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">./././</span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">/./</span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">/</span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">19</span><span class=\"o\">:</span><span class=\"mi\">6</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unused</span><span class=\"w\"> </span><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"ss\">`env</span><span class=\"bp\">`</span>\n<span class=\"n\">note</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"w\"> </span><span class=\"n\">can</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">disabled</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"ss\">`set_option</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">unusedVariables</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"bp\">`</span>\n<span class=\"n\">Build</span><span class=\"w\"> </span><span class=\"n\">completed</span><span class=\"w\"> </span><span class=\"n\">successfully</span><span class=\"bp\">.</span>\n\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">ls</span><span class=\"w\"> </span><span class=\"bp\">./</span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span>\n<span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">ilean</span><span class=\"w\">       </span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">log</span><span class=\"bp\">.</span><span class=\"n\">json</span><span class=\"w\">  </span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">olean</span><span class=\"bp\">.</span><span class=\"n\">hash</span><span class=\"w\">  </span><span class=\"n\">UpdateDeprecations</span><span class=\"w\">        </span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">.</span><span class=\"n\">ilean</span><span class=\"bp\">.</span><span class=\"n\">hash</span><span class=\"w\">  </span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">.</span><span class=\"n\">olean</span><span class=\"w\">       </span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">.</span><span class=\"n\">trace</span>\n<span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">ilean</span><span class=\"bp\">.</span><span class=\"n\">hash</span><span class=\"w\">  </span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">olean</span><span class=\"w\">     </span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">trace</span><span class=\"w\">       </span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">.</span><span class=\"n\">ilean</span><span class=\"w\">  </span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">.</span><span class=\"n\">log</span><span class=\"bp\">.</span><span class=\"n\">json</span><span class=\"w\">    </span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">.</span><span class=\"n\">olean</span><span class=\"bp\">.</span><span class=\"n\">hash</span>\n</code></pre></div>",
        "id": 443780501,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1718028659
    },
    {
        "content": "<p>But this is (at least) the second time that I run <code>lake build updateDeprecations</code>, so does this mean that you need to run it a few times before it is done updating all that it should?</p>",
        "id": 443780694,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1718028720
    },
    {
        "content": "<p>(I am really trying to understand, but I can clearly see that there is something very basic that I am still failing to grasp.)</p>",
        "id": 443780873,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1718028774
    },
    {
        "content": "<p>I think with these tests, there are two folders <code>.lake/</code> and <code>UpdateDeprecations/.lake</code> and it's really hard to really do any clean tests and not accidentially have builds in these folders without realising, making it hard to really construct something reproducible.</p>\n<p>Anyways, I think the \"local repo\" was a distraction and has nothing to do with it. And I just got lucky because I had the local repo built accidentially and didn't clear that properly.</p>\n<p>I think the behaviour that is important here is the following:</p>\n<p>start from a fresh copy of the repo, e.g. <code>git clone</code>or in the repo:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">checkout</span><span class=\"w\"> </span><span class=\"c1\">-- .</span>\n<span class=\"n\">rm</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">rf</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">update_deprecations</span>\n<span class=\"n\">ls</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">updateDeprecations</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span>\n</code></pre></div>\n<p>shows: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">ilean</span><span class=\"w\">  </span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">ilean</span><span class=\"bp\">.</span><span class=\"n\">hash</span><span class=\"w\">  </span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">log</span><span class=\"bp\">.</span><span class=\"n\">json</span><span class=\"w\">  </span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">olean</span><span class=\"w\">  </span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">olean</span><span class=\"bp\">.</span><span class=\"n\">hash</span><span class=\"w\">  </span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">trace</span>\n</code></pre></div>\n<p>but then doing</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"n\">updateDeprecations</span>\n<span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">update_deprecations</span>\n<span class=\"n\">ls</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">updateDeprecations</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span>\n</code></pre></div>\n<p>shows</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">ilean</span><span class=\"w\">       </span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">log</span><span class=\"bp\">.</span><span class=\"n\">json</span><span class=\"w\">  </span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">olean</span><span class=\"bp\">.</span><span class=\"n\">hash</span><span class=\"w\">  </span><span class=\"n\">UpdateDeprecations</span><span class=\"w\">        </span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">.</span><span class=\"n\">ilean</span><span class=\"bp\">.</span><span class=\"n\">hash</span><span class=\"w\">  </span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">.</span><span class=\"n\">olean</span><span class=\"w\">       </span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">.</span><span class=\"n\">trace</span>\n<span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">ilean</span><span class=\"bp\">.</span><span class=\"n\">hash</span><span class=\"w\">  </span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">olean</span><span class=\"w\">     </span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">trace</span><span class=\"w\">       </span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">.</span><span class=\"n\">ilean</span><span class=\"w\">  </span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">.</span><span class=\"n\">log</span><span class=\"bp\">.</span><span class=\"n\">json</span><span class=\"w\">    </span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">.</span><span class=\"n\">olean</span><span class=\"bp\">.</span><span class=\"n\">hash</span>\n</code></pre></div>\n<p>the first round of theses then fails because it doesn't find a file <code>.lake/packages/updateDeprecations/.lake/build/lib/UpdateDeprecations/Main.olean</code> and while the second round succeeds, there are now two identical files</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">updateDeprecations</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">olean</span>\n<span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">updateDeprecations</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">/</span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">olean</span>\n</code></pre></div>\n<p>floating around.</p>",
        "id": 443783320,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1718029508
    },
    {
        "content": "<p>Ok, I can empirically confirm that this is indeed what seems to happen.  The expectation though would be that running <code>lake exe update_deprecations</code> should implicitly run <code>lake build updateDeprecations</code>, in case this was not ran already?  And that there should not be duplication, I imagine?</p>",
        "id": 443785826,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1718030238
    },
    {
        "content": "<p>That seems correct. Here is a smaller reproduction: <a href=\"https://github.com/joneugster/testSrcDir2\">https://github.com/joneugster/testSrcDir2</a></p>\n<p>I guess if the duplication caused by <code>srcDir</code> is considered a bug, and that one would be addressed, then the implicit calling of <code>lake build ...</code> wouldn't be necessary.</p>",
        "id": 443792753,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1718032086
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/lean4/pull/4419\">lean4#4419</a></p>",
        "id": 443796363,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1718032836
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"315577\">Mac Malone</span> <a href=\"#narrow/stream/270676-lean4/topic/making.20a.20lean.20executable.20available.20in.20a.20project/near/443602124\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"243562\">Adam Topaz</span> <a href=\"#narrow/stream/270676-lean4/topic/making.20a.20lean.20executable.20available.20in.20a.20project/near/443404806\">said</a>:</p>\n<blockquote>\n<p>Is this a bug in lake?</p>\n</blockquote>\n<p>It certainly sounds like one. <span aria-label=\"disappointed\" class=\"emoji emoji-1f61e\" role=\"img\" title=\"disappointed\">:disappointed:</span></p>\n</blockquote>\n<p>I just saw the report in <a href=\"https://github.com/leanprover/lean4/pull/4419\">lean4#4419</a>. I left a comment there, but I will repeat and elaborate a bit there. It was not clear to me orginally that the source of this issue was the attempt to import the main module of an executable. That is purposely designed to not be directly doable. This is because importing an module that defines <code>main</code> causes a number of problems for Lean. Thus, it appears things were working as intended. </p>\n<p>On the flip side, the fact that the issue here was unclear indicates there is probably something Lake should be doing to make this more obvious for the end user. One possibility is for Lake to complain if a library imports a module defined as an executable.</p>",
        "id": 443887463,
        "sender_full_name": "Mac Malone",
        "timestamp": 1718064827
    },
    {
        "content": "<p>Once I understood what happened I also assumed that it might be \"working as intended\", which I guess I didn't really write in the report explicitely. But by the time I understood what was happening, I thought it might be as well noted in form of an issue.</p>\n<p>I agree that just failing better from Lean's/lake's side would be good. I think I deleted that sentense accidentially but I meant to write something like</p>\n<blockquote>\n<p>A simpler fix could be to just improve the error message as the current message <code>You might need to open 'parentDir/' as a workspace in your editor</code> (from <a href=\"#narrow/stream/270676-lean4/topic/Retrieving.20all.20diagnostics\">here</a>) is in this case wrong and misleading</p>\n</blockquote>",
        "id": 443888884,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1718065783
    },
    {
        "content": "<p>So, here is a summary to clear up some of my confusion.</p>\n<p>I define a lean command in a <code>myCmd</code> repo.  In this repo, I add it as <code>lean_exe</code> in my <code>lakefile</code> and it just works for me.</p>\n<p>However, I would like to run it <code>lean exe myCmd</code> in a separate repo <code>newRepo</code>.  For this, I add a <code>require</code> statement to the <code>lakefile</code> of <code>newRepo</code>  and in that same <code>lakefile</code> I add <code>lean_lib myCmd</code> and <em>not</em> a <code>lean_exe</code> entry.</p>\n<p>Is this correct?</p>",
        "id": 443911422,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1718079507
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/stream/270676-lean4/topic/making.20a.20lean.20executable.20available.20in.20a.20project/near/443911422\">said</a>:</p>\n<blockquote>\n<p>I define a lean command in a <code>myCmd</code> repo. In this repo, I add it as <code>lean_exe</code> in my <code>lakefile</code> and it just works for me.</p>\n<p>However, I would like to run it <code>lean exe myCmd</code> in a separate repo <code>newRepo</code>.  For this, I add a <code>require</code> statement to the <code>lakefile</code> of <code>newRepo</code>  and in that same <code>lakefile</code> I add <code>lean_lib myCmd</code> and <em>not</em> a <code>lean_exe</code> entry.</p>\n<p>Is this correct?</p>\n</blockquote>\n<p>No. The problem here was not the configuration of <code>lean_exe</code>/<code>lean_lib</code>. You should run a <code>lean_exe myCmd</code> always as <code>lake exe myCmd</code>.</p>\n<p>The problem here is with how your <code>UpdateDeprecations.Main</code> is defined. You should generally never be importing a module which defines <code>main</code> (i.e., the root of of <code>lean_exe</code>) as Lean does special compilation for such modules that makes them not intended for libraries. Currently your <code>UpdateDeprecations.Main</code> is imported by <code>UpdateDeprecations</code> and is also imported via <code>importModules</code>.</p>\n<p>The best way to fix this would to be to define a root-level <code>Main.lean</code> file containing the <code>main</code> function which imports <code>UpdateDeprecations</code> (the library) and have <code>importModules</code> similar import <code>UpdateDeprecations</code>. And ideal folder structure would look like:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>repo/\n  UpdateDeprecations.lean -- `UpdateDeprecations.Main` w/o `main`\n  TUD.lean -- your practice file\n  Test.lean -- your test file\n  Main.lean -- file with `main` function\n  lakefile.lean\n</code></pre></div>\n<p>The contents of <code>Main.lean</code> would be:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">UpdateDeprecations</span>\n\n<span class=\"sd\">/-- The entrypoint to the `lake exe update_deprecations` executable. -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">args</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">UInt32</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">UpdateDeprecations</span><span class=\"bp\">.</span><span class=\"n\">updateDeprecations</span><span class=\"bp\">.</span><span class=\"n\">validate</span><span class=\"w\"> </span><span class=\"n\">args</span>\n</code></pre></div>\n<p>And your lakefile <code>lean_lib</code> / <code>lean_exe</code> would then look like this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">lean_lib</span><span class=\"w\"> </span><span class=\"n\">UpdateDeprecations</span>\n\n<span class=\"sd\">/-- `lake exe update_deprecations` automatically updates deprecations. -/</span>\n<span class=\"kd\">@[</span><span class=\"n\">default_target</span><span class=\"kd\">]</span>\n<span class=\"n\">lean_exe</span><span class=\"w\"> </span><span class=\"n\">update_deprecations</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">root</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"ss\">`Main</span>\n<span class=\"w\">  </span><span class=\"n\">supportInterpreter</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">true</span>\n</code></pre></div>\n<p>You can then run your <code>update_deprecations</code> executable from any package (itself or downstream dependecies like <code>newRepo</code>) using <code>lake exe update_deprecations</code>.</p>",
        "id": 443932969,
        "sender_full_name": "Mac Malone",
        "timestamp": 1718090697
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"315577\">@Mac Malone</span> thank you so much for this detailed explanation!  I could follow all the steps, correct my mistakes and now indeed I was able to use the <code>UpdateDeprecations</code> via <code>lake exe update_deprecations</code> on <code>Mathlib</code> with just the <code>require</code> line!</p>",
        "id": 443960987,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1718099617
    }
]