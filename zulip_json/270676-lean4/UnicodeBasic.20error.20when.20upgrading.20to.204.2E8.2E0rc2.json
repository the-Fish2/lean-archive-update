[
    {
        "content": "<p>In my project directory, after changing in <code>lean-toolchain</code> from rc1 to <code>leanprover/lean4:v4.8.0-rc2</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">UnicodeBasic</span><span class=\"bp\">/</span><span class=\"n\">lakefile</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">24</span><span class=\"o\">:</span><span class=\"mi\">12</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">invalid</span><span class=\"w\"> </span><span class=\"n\">field</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">Lake</span><span class=\"bp\">.</span><span class=\"n\">LogIO</span><span class=\"bp\">.</span><span class=\"n\">captureLog'</span><span class=\"w\"> </span><span class=\"n\">does</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">argument</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Lake</span><span class=\"bp\">.</span><span class=\"n\">LogIO</span><span class=\"w\"> </span><span class=\"bp\">...</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">that</span><span class=\"w\"> </span><span class=\"n\">can</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">used</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">it</span><span class=\"w\"> </span><span class=\"n\">must</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">explicit</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"n\">implicit</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">unique</span><span class=\"w\"> </span><span class=\"n\">name</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">UnicodeBasic</span><span class=\"bp\">/</span><span class=\"n\">lakefile</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">configuration</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">errors</span>\n</code></pre></div>\n<p>I remove the package directory <code>.lake/packages/UnicodeBasic/</code> and try again, </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UnicodeBasic</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">fgdorais</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"bp\">-</span><span class=\"n\">unicode</span><span class=\"bp\">-</span><span class=\"n\">basic</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"bp\">'././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">UnicodeBasic'</span>\n</code></pre></div>\n<p>and the same error comes up. How to fix?</p>",
        "id": 441675691,
        "sender_full_name": "Ralf Stephan",
        "timestamp": 1717152325
    },
    {
        "content": "<p>I don't know anything about this stuff but my instinct is that you should post your <code>lakefile.lean</code> in full so people understand better what's happening in your situation.</p>",
        "id": 441676174,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1717152470
    },
    {
        "content": "<p>However, the lean version seems successfuly changed. Still...</p>",
        "id": 441676281,
        "sender_full_name": "Ralf Stephan",
        "timestamp": 1717152492
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lake</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lake</span><span class=\"w\"> </span><span class=\"n\">DSL</span>\n\n<span class=\"n\">package</span><span class=\"w\"> </span><span class=\"bp\">«</span><span class=\"n\">infinite</span><span class=\"bp\">-</span><span class=\"n\">primes</span><span class=\"bp\">-</span><span class=\"n\">via</span><span class=\"bp\">-</span><span class=\"n\">log</span><span class=\"bp\">»</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"c1\">-- Settings applied to both builds and interactive editing</span>\n<span class=\"w\">  </span><span class=\"n\">leanOptions</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span>\n<span class=\"w\">    </span><span class=\"bp\">⟨</span><span class=\"ss\">`pp.unicode.fun</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"c1\">-- pretty-prints `fun a ↦ b`</span>\n<span class=\"w\">  </span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"c1\">-- add any additional package configuration options here</span>\n\n<span class=\"n\">require</span><span class=\"w\"> </span><span class=\"n\">mathlib</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">git</span>\n<span class=\"w\">  </span><span class=\"s2\">\"https://github.com/leanprover-community/mathlib4.git\"</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">default_target</span><span class=\"kd\">]</span>\n<span class=\"n\">lean_lib</span><span class=\"w\"> </span><span class=\"bp\">«</span><span class=\"n\">InfinitePrimesViaLog</span><span class=\"bp\">»</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"c1\">-- add any library configuration options here</span>\n\n<span class=\"n\">require</span><span class=\"w\"> </span><span class=\"n\">checkdecls</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/PatrickMassot/checkdecls.git\"</span>\n\n<span class=\"n\">meta</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">get_config?</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"s2\">\"dev\"</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"n\">require</span><span class=\"w\"> </span><span class=\"bp\">«</span><span class=\"n\">doc</span><span class=\"bp\">-</span><span class=\"n\">gen4</span><span class=\"bp\">»</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">git</span>\n<span class=\"w\">  </span><span class=\"s2\">\"https://github.com/leanprover/doc-gen4\"</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"w\"> </span><span class=\"s2\">\"main\"</span>\n</code></pre></div>",
        "id": 441676455,
        "sender_full_name": "Ralf Stephan",
        "timestamp": 1717152545
    },
    {
        "content": "<p>This error prevents any file from compiling using rc2 here, so it is a problem.</p>",
        "id": 441677792,
        "sender_full_name": "Ralf Stephan",
        "timestamp": 1717152912
    },
    {
        "content": "<p>Maybe you meant I should post the <code>UnicodeBasic/lakefile.lean</code>?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c\">/-</span>\n<span class=\"cm\">Copyright © 2023 François G. Dorais. All rights reserved.</span>\n<span class=\"cm\">Released under Apache 2.0 license as described in the file LICENSE.</span>\n<span class=\"cm\">-/</span>\n\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lake</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lake</span><span class=\"w\"> </span><span class=\"n\">DSL</span>\n\n<span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">UnicodeBasic</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">default_target</span><span class=\"kd\">]</span>\n<span class=\"n\">lean_lib</span><span class=\"w\"> </span><span class=\"n\">UnicodeBasic</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">  </span><span class=\"n\">precompileModules</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"o\">}</span>\n\n<span class=\"n\">lean_exe</span><span class=\"w\"> </span><span class=\"n\">UnicodeTool</span>\n\n<span class=\"sd\">/-- Update data files from the Unicode Character Database (UCD) -/</span>\n<span class=\"n\">script</span><span class=\"w\"> </span><span class=\"n\">UpdateUCD</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">dataDir</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">FilePath</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"./data\"</span>\n<span class=\"w\">  </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"s2\">\"UnicodeData.txt\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"PropList.txt\"</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">url</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"https://www.unicode.org/Public/UCD/latest/ucd/\"</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">file</span>\n<span class=\"w\">    </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">println</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"Downloading UCD/{file}\"</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">download</span><span class=\"w\"> </span><span class=\"n\">url</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">dataDir</span><span class=\"bp\">/</span><span class=\"n\">file</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">captureLog</span><span class=\"w\">    </span><span class=\"c1\">-- &lt;==== this</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n</code></pre></div>",
        "id": 441678227,
        "sender_full_name": "Ralf Stephan",
        "timestamp": 1717153049
    },
    {
        "content": "<p>Commit your changes and/or make a backup (to make sure you can go back and try something else if necessary), then try <code>lake update</code> in the top-level project directory.</p>",
        "id": 441678515,
        "sender_full_name": "Richard Copley",
        "timestamp": 1717153143
    },
    {
        "content": "<p>Just to be clear: I don't know what I mean, I just felt like more data might be helpful.</p>",
        "id": 441678517,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1717153144
    },
    {
        "content": "<p>Okay, after <code>lake update</code> several repos were updated, among them:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UnicodeBasic</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">updating</span><span class=\"w\"> </span><span class=\"n\">repository</span><span class=\"w\"> </span><span class=\"bp\">'././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">UnicodeBasic'</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">revision</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">effd8b8771cfd7ece69db99448168078e113c61f'</span>\n</code></pre></div>\n<p>Now files compile without error, thanks. I shall submit a PR adding something about updating in general to the community page <code>install/project.html</code>.</p>",
        "id": 441680419,
        "sender_full_name": "Ralf Stephan",
        "timestamp": 1717153658
    },
    {
        "content": "<p><code>lake update</code> is not a good solution for everyone: if people depend on mathlib and another repo which mathlib also relies on then <code>lake update</code> wil update everything and give possibly incompatible versions of dependencies. It's a very delicate issue and is constantly causing problems.</p>",
        "id": 441681462,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1717153995
    },
    {
        "content": "<p>Is there a page / thread where people can be pointed to for updating a project?</p>",
        "id": 441682408,
        "sender_full_name": "Ralf Stephan",
        "timestamp": 1717154361
    },
    {
        "content": "<p>I think there's a link from the main mathlib4 README about \"depending on mathlib\"</p>",
        "id": 441684394,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1717155181
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/leanprover-community.github.io/pull/478\">https://github.com/leanprover-community/leanprover-community.github.io/pull/478</a></p>\n<p>Please add/change if inaccurate.</p>",
        "id": 441723682,
        "sender_full_name": "Ralf Stephan",
        "timestamp": 1717166255
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/stream/270676-lean4/topic/UnicodeBasic.20error.20when.20upgrading.20to.204.2E8.2E0rc2/near/441681462\">said</a>:</p>\n<blockquote>\n<p><code>lake update</code> is not a good solution for everyone: if people depend on mathlib and another repo which mathlib also relies on then <code>lake update</code> wil update everything and give possibly incompatible versions of dependencies. It's a very delicate issue and is constantly causing problems.</p>\n</blockquote>\n<p>I don't think that's true anymore? Certainly <code>lake update</code> on PFR (which depends on APAP which depends on mathlib) works fine</p>",
        "id": 441767991,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1717177629
    },
    {
        "content": "<p>Oh that's good to know! I'll try it on FLT next time and see what happens :-)</p>",
        "id": 441772651,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1717179132
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/stream/270676-lean4/topic/UnicodeBasic.20error.20when.20upgrading.20to.204.2E8.2E0rc2/near/441767991\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/stream/270676-lean4/topic/UnicodeBasic.20error.20when.20upgrading.20to.204.2E8.2E0rc2/near/441681462\">said</a>:</p>\n<blockquote>\n<p><code>lake update</code> is not a good solution for everyone: if people depend on mathlib and another repo which mathlib also relies on then <code>lake update</code> wil update everything and give possibly incompatible versions of dependencies. It's a very delicate issue and is constantly causing problems.</p>\n</blockquote>\n<p>I don't think that's true anymore? Certainly <code>lake update</code> on PFR (which depends on APAP which depends on mathlib) works fine</p>\n</blockquote>\n<p>You mean</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">curl</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">raw</span><span class=\"bp\">.</span><span class=\"n\">githubusercontent</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"bp\">/</span><span class=\"n\">master</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">toolchain</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">toolchain</span>\n<span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">Kenv</span><span class=\"bp\">=</span><span class=\"n\">dev</span><span class=\"w\"> </span><span class=\"n\">update</span>\n</code></pre></div>\n<p>works fine, right? A raw <code>lake update</code> still bites.</p>",
        "id": 441776050,
        "sender_full_name": "Utensil Song",
        "timestamp": 1717180210
    },
    {
        "content": "<p>Your script dodges 3 delicate issues.</p>",
        "id": 441776319,
        "sender_full_name": "Utensil Song",
        "timestamp": 1717180303
    },
    {
        "content": "<p>Ah well maybe we should make my script the default <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 441786946,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1717183575
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/stream/270676-lean4/topic/UnicodeBasic.20error.20when.20upgrading.20to.204.2E8.2E0rc2/near/441681462\">said</a>:</p>\n<blockquote>\n<p>if people depend on mathlib and another repo which mathlib also relies on then <code>lake update</code> wil update everything and give possibly incompatible versions of dependencies.</p>\n</blockquote>\n<p>This is still true, but also you shouldn't ever \"depend on mathlib and another repo which mathlib also relies on\" unless this incompatibility is actually what you want. If you have Mathlib in your lakefile, then you should not have Aesop or batteries or quote4 or ...</p>",
        "id": 441791020,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1717184989
    },
    {
        "content": "<p>I think the main situation that might be problematic is one where your have multiple independent direct dependencies that both depend on the same third package</p>",
        "id": 441802241,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1717188244
    },
    {
        "content": "<p>Yes, but in that case any update at all is probably problematic, manual or otherwise</p>",
        "id": 441818197,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1717194298
    },
    {
        "content": "<p>Quick update from the UnicodeBasic maintainer. It seems that the issue has been resolved but here are some details.</p>\n<p>Updates to UnicodeBasic happen within a day of every lean core update, to the extent possible.</p>\n<p>The underlying issue is due to lake's monad refactoring. This was patched in UnicodeBasic revision <code>2a272ebb3af6ce1bcd6c997a5675d674a839716e</code> on May 21.</p>\n<p>The UnicodeBasic requirement is from doc-gen4 which currently uses UnicodeBasic revision <code>effd8b8771cfd7ece69db99448168078e113c61f</code>, which includes the patch mentioned above.</p>\n<p>Please let me know of any other issues with UnicodeBasic, or submit an issue at <a href=\"https://github.com/fgdorais/lean4-unicode-basic\">https://github.com/fgdorais/lean4-unicode-basic</a></p>",
        "id": 441846096,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1717210570
    }
]