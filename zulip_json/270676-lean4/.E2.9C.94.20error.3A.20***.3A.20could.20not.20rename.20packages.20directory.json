[
    {
        "content": "<p>This is a report of bug. </p>\n<p>How to reproduce it:</p>\n<ol>\n<li>create a lean project</li>\n<li>Add a library called <code>Lib</code> to the lakefile as a dependency</li>\n<li>run <code>lake update</code></li>\n<li>run <code>lake build</code>. The build is assumed to succeed.</li>\n<li>remove <code>Lib</code> from lakefile</li>\n<li>run <code>lake update</code></li>\n<li><code>error: ***: could not rename packages directory (.\\.lake/packages -&gt; .\\.lake\\packages): no error (error code: 0)</code> error occurs.</li>\n</ol>",
        "id": 429852044,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1711543866
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">❯</span> <span class=\"n\">lean</span> <span class=\"c1\">--version</span>\n<span class=\"n\">Lean</span> <span class=\"o\">(</span><span class=\"n\">version</span> <span class=\"mi\">4</span><span class=\"bp\">.</span><span class=\"mi\">6</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"o\">,</span> <span class=\"n\">x86_64</span><span class=\"bp\">-</span><span class=\"n\">w64</span><span class=\"bp\">-</span><span class=\"n\">windows</span><span class=\"bp\">-</span><span class=\"n\">gnu</span><span class=\"o\">,</span> <span class=\"n\">commit</span> <span class=\"n\">a5bc9013ab13</span><span class=\"o\">,</span> <span class=\"n\">Release</span><span class=\"o\">)</span>\n\n<span class=\"bp\">❯</span> <span class=\"n\">lake</span> <span class=\"c1\">--version</span>\n<span class=\"n\">Lake</span> <span class=\"n\">version</span> <span class=\"mi\">5</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">-</span><span class=\"n\">a5bc901</span> <span class=\"o\">(</span><span class=\"n\">Lean</span> <span class=\"n\">version</span> <span class=\"mi\">4</span><span class=\"bp\">.</span><span class=\"mi\">6</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 429852146,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1711543915
    },
    {
        "content": "<p>On Windows, right? Could you please try ensuring that no lake/lean processes are running before doing step 6 and report back?</p>",
        "id": 429852209,
        "sender_full_name": "Richard Copley",
        "timestamp": 1711543928
    },
    {
        "content": "<p>Manually deleting the <code>.lake</code> directory will allow <code>lake update</code> to succeed, but it is tedious to do this every time a dependency is deleted.</p>",
        "id": 429852454,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1711544019
    },
    {
        "content": "<blockquote>\n<p>On Windows, right?</p>\n</blockquote>\n<p>Yes.</p>\n<blockquote>\n<p>Could you please try ensuring that no lake/lean processes are running before doing step 6 and report back?</p>\n</blockquote>\n<p>How can I make sure that the lake/lean process is not running?</p>",
        "id": 429852657,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1711544092
    },
    {
        "content": "<p>(i) Close your editor; and/or (ii) <code>taskkill /f /t /im lake.exe</code></p>",
        "id": 429852764,
        "sender_full_name": "Richard Copley",
        "timestamp": 1711544128
    },
    {
        "content": "<p>I closed the editor and then did <code>lake update</code> and it worked.</p>",
        "id": 429853077,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1711544231
    },
    {
        "content": "<p>However, there is no message prompting you to 'close the editor', and it is true that it can be a tedious and time-consuming process.</p>",
        "id": 429853301,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1711544303
    },
    {
        "content": "<p>The error message mentions \"rename\", but I did not rename.</p>",
        "id": 429853419,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1711544347
    },
    {
        "content": "<p>This seems to be tripping a lot of people up recently. There's a combination of things going wrong. (See <a href=\"#narrow/stream/113488-general/topic/.60lake.20update.60.20broken.20on.20Windows.20.28.3F.29/near/429126203\">this thread</a> for one.)</p>\n<ul>\n<li>The rename is a mistake anyway (the file paths \".\\.lake/packages\" and \".\\.lake\\packages\" are the same, so the renaming would have no effect if it succeeded).</li>\n<li>The error code 0 is also a mistake (it comes from <code>errno</code>, but the system call in question sets <code>GetLastError()</code>). The actual Windows error code is 5 (Access denied).</li>\n</ul>\n<p>Both those mistakes ought to get fixed, but <code>lake update</code> might still fail because, roughly speaking, Windows doesn't allow open files to be replaced.<br>\nI think I agree that a message suggesting what to do would be helpful.</p>",
        "id": 429855907,
        "sender_full_name": "Richard Copley",
        "timestamp": 1711545151
    },
    {
        "content": "<p>If the Lake developers know about this issue, I am happy with that.</p>",
        "id": 429856215,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1711545245
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"626349\">Asei Inoue</span> has marked this topic as resolved.</p>",
        "id": 429900813,
        "sender_full_name": "Notification Bot",
        "timestamp": 1711556935
    },
    {
        "content": "<p>The second issue is fixed in master</p>",
        "id": 429901880,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1711557230
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"626349\">@Asei Inoue</span>, in order to know that Mac Malone (the lake dev) knows about an issue, you either need to make sure there is an open issue on the lean4 repo, or ping him here!</p>",
        "id": 429952022,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1711574649
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"626349\">Asei Inoue</span> has marked this topic as unresolved.</p>",
        "id": 429965314,
        "sender_full_name": "Notification Bot",
        "timestamp": 1711581749
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/lean4/pull/3795\">lean4#3795</a> <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span></p>",
        "id": 429970454,
        "sender_full_name": "Mac Malone",
        "timestamp": 1711584878
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"626349\">Asei Inoue</span> has marked this topic as resolved.</p>",
        "id": 430040486,
        "sender_full_name": "Notification Bot",
        "timestamp": 1711623181
    }
]