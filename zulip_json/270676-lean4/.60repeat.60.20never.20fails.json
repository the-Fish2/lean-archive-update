[
    {
        "content": "<p>In the following, <code>repeat</code> succeeds even though <code>Nat.ad_com</code> is an unknown identifier :</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">example</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">Nat</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">=</span> <span class=\"n\">b</span> <span class=\"bp\">+</span> <span class=\"n\">a</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n  <span class=\"n\">repeat</span> <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">Nat.ad_com</span><span class=\"o\">]</span> <span class=\"c1\">-- succeeds, even though `Nat.ad_com` does not exist.</span>\n  <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">Nat.add_comm</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>Is this the desired behaviour? Wouldn't it be better to require <code>repeat</code> to apply the sequence at least once, or fail if it does not? Like this: </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">syntax</span> <span class=\"s2\">\"repeat₂ \"</span> <span class=\"n\">tacticSeq</span> <span class=\"o\">:</span> <span class=\"n\">tactic</span>\n<span class=\"n\">macro_rules</span>\n  <span class=\"bp\">|</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|</span> <span class=\"n\">repeat₂</span> <span class=\"bp\">$</span><span class=\"n\">seq</span><span class=\"o\">)</span> <span class=\"bp\">=&gt;</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">seq</span><span class=\"o\">)</span><span class=\"bp\">;</span> <span class=\"n\">first</span> <span class=\"bp\">|</span> <span class=\"n\">repeat₂</span> <span class=\"bp\">$</span><span class=\"n\">seq</span> <span class=\"bp\">|</span> <span class=\"n\">skip</span><span class=\"o\">)</span>\n<span class=\"c1\">-- original:                   `(tactic| first | ($seq); repeat  $seq | skip)</span>\n\n<span class=\"c1\">-- `repeat` fails if no progress made:</span>\n<span class=\"kd\">example</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">Nat</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">=</span> <span class=\"n\">b</span> <span class=\"bp\">+</span> <span class=\"n\">a</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n  <span class=\"n\">repeat₂</span> <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">Nat.ad_com</span><span class=\"o\">]</span> <span class=\"c1\">-- Fails with \"unknown identifier `Nat.ad_com`\"</span>\n  <span class=\"n\">repeat₂</span> <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">Nat.add_comm</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 425894354,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1710158751
    },
    {
        "content": "<p>I see that <code>Std</code> implements <code>repeat'</code> and <code>repeat1'</code> which implements this difference (the latter needs to succeed at least once), and <code>Mathlib</code> implements <code>repeat1</code>, so I assume this is indeed the desired behaviour <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 425896984,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1710159688
    },
    {
        "content": "<p>It feels like having an unknown identifier there should error regardless, but I suppose that would be at odd with the way tactics are executed</p>",
        "id": 425905653,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1710162610
    }
]