[
    {
        "content": "<p>I'm having problem when compiling lean code.<br>\nAfter cloning the latest version of <code>https://github.com/abentkamp/duper</code>, I ran <code>lake build</code> in the folder and lean raised an error</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">libc</span><span class=\"bp\">++</span><span class=\"n\">abi</span><span class=\"o\">:</span> <span class=\"n\">terminating</span> <span class=\"bp\">&lt;...&gt;</span><span class=\"n\">lean</span><span class=\"o\">::</span><span class=\"n\">exception</span><span class=\"o\">:</span> <span class=\"n\">error</span> <span class=\"n\">loading</span> <span class=\"n\">library</span> <span class=\"n\">Duper</span><span class=\"bp\">-</span><span class=\"n\">Util</span><span class=\"bp\">-</span><span class=\"n\">Misc.dll</span><span class=\"o\">:</span> <span class=\"mi\">126</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">external</span> <span class=\"n\">command</span> <span class=\"bp\">`&lt;...\\</span><span class=\"n\">lean.exe</span><span class=\"bp\">&gt;`</span> <span class=\"n\">exited</span> <span class=\"k\">with</span> <span class=\"n\">code</span> <span class=\"mi\">3221226505</span>\n</code></pre></div>\n<p>What should I do to make it work?<br>\nThe complete error message:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">stderr</span><span class=\"o\">:</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">Building</span> <span class=\"n\">Duper.Clause</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"bp\">&gt;</span> <span class=\"n\">LEAN_PATH</span><span class=\"bp\">=.\\</span><span class=\"n\">lean_packages</span><span class=\"bp\">\\</span><span class=\"n\">std</span><span class=\"bp\">\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"bp\">;.\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span> <span class=\"bp\">&lt;...&gt;\\</span><span class=\"n\">lean.exe</span> <span class=\"bp\">.\\.\\.\\</span><span class=\"n\">Duper</span><span class=\"bp\">\\</span><span class=\"n\">Clause.lean</span> <span class=\"bp\">-</span><span class=\"n\">R</span> <span class=\"bp\">.\\.\\.</span> <span class=\"bp\">-</span><span class=\"n\">o</span> <span class=\"bp\">.\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"bp\">\\</span><span class=\"n\">Duper</span><span class=\"bp\">\\</span><span class=\"n\">Clause.olean</span> <span class=\"bp\">-</span><span class=\"n\">i</span> <span class=\"bp\">.\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"bp\">\\</span><span class=\"n\">Duper</span><span class=\"bp\">\\</span><span class=\"n\">Clause.ilean</span> <span class=\"bp\">-</span><span class=\"n\">c</span> <span class=\"bp\">.\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">ir</span><span class=\"bp\">\\</span><span class=\"n\">Duper</span><span class=\"bp\">\\</span><span class=\"n\">Clause.c</span> <span class=\"c1\">--load-dynlib=Duper-Util-Misc.dll --load-dynlib=Duper-Expr.dll --load-dynlib=Duper-Order.dll</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">stderr</span><span class=\"o\">:</span>\n<span class=\"n\">libc</span><span class=\"bp\">++</span><span class=\"n\">abi</span><span class=\"o\">:</span> <span class=\"n\">terminating</span> <span class=\"n\">due</span> <span class=\"n\">to</span> <span class=\"n\">uncaught</span> <span class=\"n\">exception</span> <span class=\"n\">of</span> <span class=\"n\">type</span> <span class=\"n\">lean</span><span class=\"o\">::</span><span class=\"n\">exception</span><span class=\"o\">:</span> <span class=\"n\">error</span> <span class=\"n\">loading</span> <span class=\"n\">library</span> <span class=\"n\">Duper</span><span class=\"bp\">-</span><span class=\"n\">Util</span><span class=\"bp\">-</span><span class=\"n\">Misc.dll</span><span class=\"o\">:</span> <span class=\"mi\">126</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">external</span> <span class=\"n\">command</span> <span class=\"bp\">`</span><span class=\"n\">c</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Users</span><span class=\"bp\">\\</span><span class=\"n\">yiche</span><span class=\"bp\">\\.</span><span class=\"n\">elan</span><span class=\"bp\">\\</span><span class=\"n\">toolchains</span><span class=\"bp\">\\</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---nightly-2022-11-19\\bin\\lean.exe` exited with code 3221226505</span>\n</code></pre></div>",
        "id": 311557468,
        "sender_full_name": "Yicheng Qian",
        "timestamp": 1669111525
    },
    {
        "content": "<p>Ah. I've tried WSL, and it compiled successfully. However I just can't get it to compile on Windows.</p>",
        "id": 311652922,
        "sender_full_name": "Yicheng Qian",
        "timestamp": 1669133042
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"315577\">@Mac</span> 126 is <code>ERROR_MOD_NOT_FOUND</code>, so the <code>PATH</code> may not be correctly set up. Unfortunately, the error message doesn't tell us whether the mentioned DLL or any of its dependencies was not found.</p>",
        "id": 311654753,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1669133602
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110024\">@Sebastian Ullrich</span>  Yeah the problem is that augmented PATH environment variable does not properly forward to the worker processes on Windows. This is a relatively recent phenomenon that I think may be related to the changes in <a href=\"https://github.com/leanprover/lean4/pull/1739\">lean4#1759</a>. However, I have a fix in the works which should solve this regardless. This plan is deploy it with the v4.1.0 release by the end of the month.</p>",
        "id": 311928336,
        "sender_full_name": "Mac",
        "timestamp": 1669252005
    },
    {
        "content": "<p>This is an old thread, but the closest I can find that's like the errors I'm facing. I'm trying to make FFI to a third-party library work on Windows CI (which already works on Mac and Ubuntu CI) with <a href=\"https://github.com/utensil/ginac-lean/blob/main/lakefile.lean\">this lakefile</a>, the library .a and .dll compiled, linked successfully, the FFI .dll compiled and linked successfully, but I have this final error 126:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">✔</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">6</span><span class=\"bp\">/</span><span class=\"mi\">17</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Built</span><span class=\"w\"> </span><span class=\"n\">GinacLean</span><span class=\"bp\">/</span><span class=\"n\">libginac_ffi</span>\n<span class=\"bp\">✖</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">7</span><span class=\"bp\">/</span><span class=\"mi\">17</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Building</span><span class=\"w\"> </span><span class=\"n\">Ginac</span><span class=\"bp\">.</span><span class=\"n\">Symbol</span>\n<span class=\"n\">trace</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">.&gt;</span><span class=\"w\"> </span><span class=\"n\">LEAN_PATH</span><span class=\"bp\">=.\\.\\.</span><span class=\"n\">lake</span><span class=\"bp\">\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"w\"> </span><span class=\"n\">PATH</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Users</span><span class=\"bp\">\\</span><span class=\"n\">runneradmin</span><span class=\"bp\">\\.</span><span class=\"n\">elan</span><span class=\"bp\">\\</span><span class=\"n\">toolchains</span><span class=\"bp\">\\</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.8.0\\bin\\lean.exe --load-dynlib=.\\.\\.lake\\build\\lib\\cln.dll --load-dynlib=.\\.\\.lake\\build\\lib\\ginac.dll .\\.\\lean\\.\\Ginac\\Symbol.lean -R .\\.\\lean\\. -o .\\.\\.lake\\build\\lib\\Ginac\\Symbol.olean -i .\\.\\.lake\\build\\lib\\Ginac\\Symbol.ilean -c .\\.\\.lake\\build\\ir\\Ginac\\Symbol.c --json</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">stderr</span><span class=\"o\">:</span>\n<span class=\"n\">libc</span><span class=\"bp\">++</span><span class=\"n\">abi</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">terminating</span><span class=\"w\"> </span><span class=\"n\">due</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">uncaught</span><span class=\"w\"> </span><span class=\"n\">exception</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">lean</span><span class=\"bp\">::</span><span class=\"n\">exception</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"n\">loading</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"w\"> </span><span class=\"bp\">.\\.\\.</span><span class=\"n\">lake</span><span class=\"bp\">\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"bp\">\\</span><span class=\"n\">ginac</span><span class=\"bp\">.</span><span class=\"n\">dll</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">126</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">exited</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"mi\">3221226505</span>\n<span class=\"n\">Some</span><span class=\"w\"> </span><span class=\"n\">builds</span><span class=\"w\"> </span><span class=\"n\">logged</span><span class=\"w\"> </span><span class=\"n\">failures</span><span class=\"o\">:</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Ginac</span><span class=\"bp\">.</span><span class=\"n\">Symbol</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"n\">failed</span>\n</code></pre></div>\n<p>I can confirm that the DLL with that name is right at that relative path, as I've made sure it's there for the previous linking steps. According to this thread, this could be some environment variable issues, also as indicated by the empty <code>PATH</code> before the lean.exe. But previous issues are supposed to be fixed, and I can't figure out what I can do to help the situation from the lakefile.</p>\n<p><span class=\"user-mention\" data-user-id=\"315577\">@Mac Malone</span> Do you have some idea? Thanks!</p>",
        "id": 443824398,
        "sender_full_name": "Utensil Song",
        "timestamp": 1718040848
    },
    {
        "content": "<p>Well, <code>lake env lake build</code> to the rescue again. CI green. <span aria-label=\"joy\" class=\"emoji emoji-1f602\" role=\"img\" title=\"joy\">:joy:</span></p>",
        "id": 443835296,
        "sender_full_name": "Utensil Song",
        "timestamp": 1718043483
    }
]