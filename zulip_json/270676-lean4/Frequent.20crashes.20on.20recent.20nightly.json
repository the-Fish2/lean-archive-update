[
    {
        "content": "<p>On nightly-2024-02-27, when I type quickly, the Lean server frequently crashes with</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>libc++abi: terminating due to uncaught exception of type lean::interrupted\n[Error - 11:32:48 AM] Request textDocument/completion failed.\n  Message: Server process for file:///home/jannis/uni/aesop/work/Aesop/Builder/NormSimp.lean crashed, likely due to a stack overflow or a bug.\n  Code: -32902\n</code></pre></div>\n<p>I don't have a way to reliably reproduce this, but it happens consistently on both VSCode and Emacs. The speed of the typing seems to make a difference. Other than that, I haven't found any specific triggers yet.</p>\n<p>I'll try to find the nightly that introduced this, but I'd be curious whether anyone else can reproduce.</p>\n<p><a href=\"https://github.com/leanprover/lean4/pull/3528\">lean4#3528</a></p>",
        "id": 423791834,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1709117200
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110024\">@Sebastian Ullrich</span> is this the one you fixed here? <a href=\"https://github.com/leanprover/lean4/pull/3500\">https://github.com/leanprover/lean4/pull/3500</a></p>",
        "id": 423792148,
        "sender_full_name": "Henrik BÃ¶ving",
        "timestamp": 1709117320
    },
    {
        "content": "<p>Yes!</p>",
        "id": 423792272,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1709117364
    },
    {
        "content": "<p>Okay great, thanks!</p>",
        "id": 423797364,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1709119195
    },
    {
        "content": "<p>Actually, this patch <a href=\"https://github.com/leanprover/lean4-nightly/releases/tag/nightly-2024-02-27\">should be included in 2024-02-27</a>. So this does not yet seem to be fully fixed.</p>",
        "id": 423797920,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1709119402
    },
    {
        "content": "<p>I can reproduce the issue on nightly 02-23, but not on 02-22. This makes it seem likely that <a href=\"https://github.com/leanprover/lean4/pull/3421\">lean4#3421</a>, which was first included in 02-23, is indeed the culprit. I can still reproduce the issue on 02-27, which includes the PR <a href=\"https://github.com/leanprover/lean4/pull/3500\">lean4#3500</a> that should have fixed it.</p>\n<p>I've been using the file <code>Std/Data/HashMap/WF.lean</code> from <code>bump/nightly-2024-02-27</code> for my tests. It seems like you need a non-trivial file for the issue to occur; otherwise I guess elaboration is too fast to get interrupted.</p>",
        "id": 423802476,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1709121272
    },
    {
        "content": "<p>Okay, I can reproduce using the actual release</p>",
        "id": 423807582,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1709123322
    }
]