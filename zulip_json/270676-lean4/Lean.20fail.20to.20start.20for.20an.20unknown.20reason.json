[
    {
        "content": "<p><a href=\"/user_uploads/3121/vRYeVe5AB2fdsf9Q8JmElcun/image.png\">image.png</a><br>\nI cloned a repository formalising-mathematics-2024, and I have the lean4 extension in my vscode, but when I tried to edit one of the files, lean was not working. normally It would show no goal or something like that, but no response. I tried to do the instructions for installing the lean4 (Actually it was just about installing git, vscode, and extension ). I even reinstalled the vscode, what can I do to fix this?</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/vRYeVe5AB2fdsf9Q8JmElcun/image.png\" title=\"image.png\"><img src=\"/user_uploads/3121/vRYeVe5AB2fdsf9Q8JmElcun/image.png\"></a></div>",
        "id": 430445359,
        "sender_full_name": "iz",
        "timestamp": 1711860117
    },
    {
        "content": "<p>Does the server still fail to start if you restart it via the <code>Lean 4: Server: Restart Server</code> command?  You can access this command by opening the Command Palette in VSCode via <code>Ctrl+Shift+P</code> or <code>Cmd+Shift+P</code> )on MacOS), typing said command, and pressing enter.</p>",
        "id": 430448122,
        "sender_full_name": "Mac Malone",
        "timestamp": 1711863227
    },
    {
        "content": "<p>The red bar counts as a response of sorts. Does anything interesting show up if you click on \"all messages\" in the infoview?</p>",
        "id": 430448921,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1711864104
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/stream/270676-lean4/topic/Lean.20fail.20to.20start.20for.20an.20unknown.20reason/near/430448921\">said</a>:</p>\n<blockquote>\n<p>The red bar counts as a response of sorts. Does anything interesting show up if you click on \"all messages\" in the infoview?</p>\n</blockquote>\n<p>the only message says:<br>\nImports are out of date and must be rebuilt; use the \"Restart File\" command in your editor. <br>\nI suppose I need to update something<span aria-label=\"face with monocle\" class=\"emoji emoji-1f9d0\" role=\"img\" title=\"face with monocle\">:face_with_monocle:</span></p>",
        "id": 430449482,
        "sender_full_name": "iz",
        "timestamp": 1711864609
    },
    {
        "content": "<p>that's the expected behavior, you are supposed to press the button</p>",
        "id": 430449653,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711864692
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"315577\">Mac Malone</span> <a href=\"#narrow/stream/270676-lean4/topic/Lean.20fail.20to.20start.20for.20an.20unknown.20reason/near/430448122\">said</a>:</p>\n<blockquote>\n<p>Does the server still fail to start if you restart it via the <code>Lean 4: Server: Restart Server</code> command?  You can access this command by opening the Command Palette in VSCode via <code>Ctrl+Shift+P</code> or <code>Cmd+Shift+P</code> )on MacOS), typing said command, and pressing enter.</p>\n</blockquote>\n<p>It was still not working, I think it's about the import thing cause the message said that</p>",
        "id": 430449674,
        "sender_full_name": "iz",
        "timestamp": 1711864706
    },
    {
        "content": "<p>the fact that this message also fills the screen with a red highlight is something we plan to fix</p>",
        "id": 430449710,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711864733
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/270676-lean4/topic/Lean.20fail.20to.20start.20for.20an.20unknown.20reason/near/430449653\">said</a>:</p>\n<blockquote>\n<p>that's the expected behavior, you are supposed to press the button</p>\n</blockquote>\n<p>but simply pressing the button\"restart file\" will give me the same response, I suppose I have something to update?</p>",
        "id": 430449789,
        "sender_full_name": "iz",
        "timestamp": 1711864792
    },
    {
        "content": "<p>if a popup did not appear, you can also manually trigger it using <code>Lean 4: Server: Restart File</code> from the Ctrl+Shift+P menu</p>",
        "id": 430449806,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711864800
    },
    {
        "content": "<p>no you do not have to update anything, or at least the feedback so far does not indicate this</p>",
        "id": 430449946,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711864853
    },
    {
        "content": "<p>another thing you can try is <code>lake build</code> from the terminal</p>",
        "id": 430450007,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711864879
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/270676-lean4/topic/Lean.20fail.20to.20start.20for.20an.20unknown.20reason/near/430450007\">said</a>:</p>\n<blockquote>\n<p>another thing you can try is <code>lake build</code> from the terminal</p>\n</blockquote>\n<p>I will try this</p>",
        "id": 430450164,
        "sender_full_name": "iz",
        "timestamp": 1711864953
    },
    {
        "content": "<p>note that \"Restart File\" and \"Restart Server\" are different commands. Usually when you get in this state \"Restart Server\" will not fix it but \"Restart File\" will</p>",
        "id": 430450244,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711865005
    },
    {
        "content": "<p>I suppose there is somthing about lake cause when I tried for the first time I saw the message \"lake file configuration changed\" but only for once, I am trying the lake build. I believe the both restart commands cannot fix it cause I tried them both for a few times.</p>",
        "id": 430451335,
        "sender_full_name": "iz",
        "timestamp": 1711865576
    },
    {
        "content": "<p>cc: <span class=\"user-mention\" data-user-id=\"315577\">@Mac Malone</span> do you know why the server would misinterpret \"lake configuration changed\" as \"files are not up to date\"?</p>",
        "id": 430453226,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711866878
    },
    {
        "content": "<p>It's working, thank you. after lake build and restarting the file</p>",
        "id": 430459427,
        "sender_full_name": "iz",
        "timestamp": 1711873487
    },
    {
        "content": "<p>Looks like I'll perhaps have to re-add the stale dependency notifications for older versions of Lean 4 where the <code>fullRange</code> span of the diagnostic doesn't cover the full file and the \"Restart File\" error doesn't show up under \"Messages\", only \"All Messages\".</p>",
        "id": 430465800,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1711880132
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/270676-lean4/topic/Lean.20fail.20to.20start.20for.20an.20unknown.20reason/near/430453226\">said</a>:</p>\n<blockquote>\n<p>cc: <span class=\"user-mention silent\" data-user-id=\"315577\">Mac Malone</span> do you know why the server would misinterpret \"lake configuration changed\" as \"files are not up to date\"?</p>\n</blockquote>\n<p>The \"lake configuration changed\" message is from the extension. We register file watchers for <code>lakefile.lean</code> and <code>lean-toolchain</code> and issue a notification to restart the server when these files change.<br>\nI'm not sure yet why this message triggers when opening this repo.</p>",
        "id": 430466335,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1711880676
    },
    {
        "content": "<p>oh, my interpretation was that <code>lake</code> was complaining that it needed a <code>lake update</code></p>",
        "id": 430466485,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711880826
    },
    {
        "content": "<p>when <code>lake</code> is in this state, will the server \"Restart File\" button work as intended?</p>",
        "id": 430466514,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711880855
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"705534\">iz</span> <a href=\"#narrow/stream/270676-lean4/topic/Lean.20fail.20to.20start.20for.20an.20unknown.20reason/near/430449789\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/270676-lean4/topic/Lean.20fail.20to.20start.20for.20an.20unknown.20reason/near/430449653\">said</a>:</p>\n<blockquote>\n<p>that's the expected behavior, you are supposed to press the button</p>\n</blockquote>\n<p>but simply pressing the button\"restart file\" will give me the same response, I suppose I have something to update?</p>\n</blockquote>\n<p>I cloned the repo, opened <code>Sheet1.lean</code> and clicked the \"Restart File\" button in the bottom right of the InfoView when the message showed up and it started building just fine, though <code>lake exe get cache</code> should have been run beforehand.</p>",
        "id": 430466571,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1711880899
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/270676-lean4/topic/Lean.20fail.20to.20start.20for.20an.20unknown.20reason/near/430466485\">said</a>:</p>\n<blockquote>\n<p>oh, my interpretation was that <code>lake</code> was complaining that it needed a <code>lake update</code></p>\n</blockquote>\n<p>I don't think Lake has the power to issue notifications with buttons that run VS Code commands :-)</p>\n<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/270676-lean4/topic/Lean.20fail.20to.20start.20for.20an.20unknown.20reason/near/430466514\">said</a>:</p>\n<blockquote>\n<p>when <code>lake</code> is in this state, will the server \"Restart File\" button work as intended?</p>\n</blockquote>\n<p>Yes.</p>",
        "id": 430466592,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1711880942
    },
    {
        "content": "<p>I'm not sure where lake's complaint goes when the server is calling lake (probably nowhere?)</p>",
        "id": 430466617,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711880994
    },
    {
        "content": "<p>the situation that seems bad here that I'd like to get to the bottom of is where pressing \"Restart File\" causes it to fail and produce an error saying to try \"Restart File\" again</p>",
        "id": 430466677,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711881042
    },
    {
        "content": "<p>I'm sure it's the result of bad local configuration but it's still not something that should happen</p>",
        "id": 430466710,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711881082
    },
    {
        "content": "<p>I tested it and it seems to work fine. I suspect that <span class=\"user-mention\" data-user-id=\"705534\">@iz</span> may have pressed the \"Restart Server\" button, not the \"Restart File\" button?</p>",
        "id": 430466728,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1711881115
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"221921\">Marc Huisinga</span> <a href=\"#narrow/stream/270676-lean4/topic/Lean.20fail.20to.20start.20for.20an.20unknown.20reason/near/430466571\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"705534\">iz</span> <a href=\"#narrow/stream/270676-lean4/topic/Lean.20fail.20to.20start.20for.20an.20unknown.20reason/near/430449789\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/270676-lean4/topic/Lean.20fail.20to.20start.20for.20an.20unknown.20reason/near/430449653\">said</a>:</p>\n<blockquote>\n<p>that's the expected behavior, you are supposed to press the button</p>\n</blockquote>\n<p>but simply pressing the button\"restart file\" will give me the same response, I suppose I have something to update?</p>\n</blockquote>\n<p>I cloned the repo, opened <code>Sheet1.lean</code> and clicked the \"Restart File\" button in the bottom right of the InfoView when the message showed up and it started building just fine, though <code>lake exe get cache</code> should have been run beforehand.</p>\n</blockquote>\n<p>I think my computer took too long after I clicked restart button and nothing other than the message appeared, what I did was basically trying restart file repeatedly, and somehow after I run the “lake build” and few more trials of restarting, the lean4 started to work properly(my computer might be a bit slow)</p>",
        "id": 430466778,
        "sender_full_name": "iz",
        "timestamp": 1711881138
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"221921\">Marc Huisinga</span> <a href=\"#narrow/stream/270676-lean4/topic/Lean.20fail.20to.20start.20for.20an.20unknown.20reason/near/430466728\">said</a>:</p>\n<blockquote>\n<p>I tested it and it seems to work fine. I suspect that <span class=\"user-mention silent\" data-user-id=\"705534\">iz</span> may have pressed the \"Restart Server\" button, not the \"Restart File\" button?</p>\n</blockquote>\n<p>I was only actually clicking restart file button</p>",
        "id": 430466790,
        "sender_full_name": "iz",
        "timestamp": 1711881164
    },
    {
        "content": "<p>I don't think there is even a restart server button</p>",
        "id": 430466802,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711881184
    },
    {
        "content": "<p>well, maybe in the lean menu</p>",
        "id": 430466813,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711881195
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/270676-lean4/topic/Lean.20fail.20to.20start.20for.20an.20unknown.20reason/near/430466802\">said</a>:</p>\n<blockquote>\n<p>I don't think there is even a restart server button</p>\n</blockquote>\n<p>There is, in the \"Lake configuration changed\" notification. It even covers the \"Restart File\" button :(</p>",
        "id": 430466828,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1711881215
    },
    {
        "content": "<p>I just noticed there is a new always-present restart file button in the infoview</p>",
        "id": 430466882,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711881243
    },
    {
        "content": "<p>Yes, see <a href=\"#narrow/stream/270676-lean4/topic/import.20must.20be.20rebuilt/near/429907606\">https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/import.20must.20be.20rebuilt/near/429907606</a></p>",
        "id": 430466908,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1711881284
    },
    {
        "content": "<p>what signals that a restart is necessary?</p>",
        "id": 430466938,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711881339
    },
    {
        "content": "<p>At least in the next Lean 4 RC, these kinds of errors will show up under \"Messages\" in the whole file, so as long as you have the InfoView open, it will be visible</p>",
        "id": 430467000,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1711881382
    },
    {
        "content": "<p>But older Lean 4 versions don't do that, so I may need to re-add the notifications for compatibility with older Lean 4 versions (only for the older versions, though)</p>",
        "id": 430467016,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1711881410
    },
    {
        "content": "<p>ah, okay just tried it and I see we still have the wall of red message</p>",
        "id": 430467051,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711881454
    },
    {
        "content": "<p>I doubted that my computer might be too slow when loading, it took sometime to give the correct response. I found it working fine after going back from using the online editor gitpod for a while.</p>",
        "id": 430467140,
        "sender_full_name": "iz",
        "timestamp": 1711881536
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"705534\">iz</span> <a href=\"#narrow/stream/270676-lean4/topic/Lean.20fail.20to.20start.20for.20an.20unknown.20reason/near/430467140\">said</a>:</p>\n<blockquote>\n<p>I doubted that my computer might be too slow when loading, it took sometime to give the correct response. I found it working fine after going back from using the online editor gitpod for a while.</p>\n</blockquote>\n<p>By the way, the Lean language client startup should be much quicker in newer Lean versions.</p>",
        "id": 430467192,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1711881602
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"221921\">Marc Huisinga</span> <a href=\"#narrow/stream/270676-lean4/topic/Lean.20fail.20to.20start.20for.20an.20unknown.20reason/near/430467000\">said</a>:</p>\n<blockquote>\n<p>At least in the next Lean 4 RC, these kinds of errors will show up under \"Messages\" in the whole file, so as long as you have the InfoView open, it will be visible</p>\n</blockquote>\n<p>I actually don't get the message immediately. I see a massive red gutter and an error highlight on the first line, and a closed \"All Messages (1)\" in the infoview and \"No info found.\" for the main view. I expect this a side effect of the mechanism to avoid too-long error highlights, the message is not actually shown unless the cursor is on the first line or you have all messages open</p>",
        "id": 430467255,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711881642
    },
    {
        "content": "<p>I'm not testing this on the latest lean though, only the latest version of the extension</p>",
        "id": 430467328,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711881722
    },
    {
        "content": "<p>maybe that's what you were saying about backcompat</p>",
        "id": 430467362,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711881752
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/270676-lean4/topic/Lean.20fail.20to.20start.20for.20an.20unknown.20reason/near/430467051\">said</a>:</p>\n<blockquote>\n<p>ah, okay just tried it and I see we still have the wall of red message</p>\n</blockquote>\n<p>By the way, the language server stops processing the file when this kind of import error is returned, so \"error for the whole file\" like all other header errors is the right severity here.</p>",
        "id": 430467481,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1711881877
    },
    {
        "content": "<p>I think \"error\" is the wrong severity, because it's not a problem in the user's code</p>",
        "id": 430467507,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711881911
    },
    {
        "content": "<p>it's also confusing for red files to show up in the explorer view just because something was open but not checked</p>",
        "id": 430467531,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711881961
    },
    {
        "content": "<p>e.g. if I make a change in file A and files B and C depend on it, and file B is open in another tab, I will see only B turn red in the explorer</p>",
        "id": 430467601,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711882013
    },
    {
        "content": "<p>I would opt for something like no highlights in the code at all (and no messages), and a big banner over the infoview saying that the checker is not running and you should use the big green \"Start\" button to start it</p>",
        "id": 430467806,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711882256
    },
    {
        "content": "<p>possibly also a gutter indication of some kind for those who don't use the infoview or don't have it open. But gray not red</p>",
        "id": 430467948,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711882400
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/270676-lean4/topic/Lean.20fail.20to.20start.20for.20an.20unknown.20reason/near/430467507\">said</a>:</p>\n<blockquote>\n<p>I think \"error\" is the wrong severity, because it's not a problem in the user's code</p>\n</blockquote>\n<p>There is no other severity that communicates an issue that cannot be recovered from until further action is taken but wasn't caused by \"user code\". \"Information\", \"hint\" and \"warning\" all do not accurately signal that the language server will literally not process the file.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/270676-lean4/topic/Lean.20fail.20to.20start.20for.20an.20unknown.20reason/near/430467531\">said</a>:</p>\n<blockquote>\n<p>it's also confusing for red files to show up in the explorer view just because something was open but not checked</p>\n</blockquote>\n<p>I don't understand what \"open but not checked\" means.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/270676-lean4/topic/Lean.20fail.20to.20start.20for.20an.20unknown.20reason/near/430467601\">said</a>:</p>\n<blockquote>\n<p>e.g. if I make a change in file A and files B and C depend on it, and file B is open in another tab, I will see only B turn red in the explorer</p>\n</blockquote>\n<p>If B is open in another tab, it will not turn red at all. This only happens when you first open the file. <a href=\"https://github.com/leanprover/lean4/pull/393\">lean4#393</a> (in the next RC) will instead issue an \"info\" diagnostic because the language server can keep processing the file in this case.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/270676-lean4/topic/Lean.20fail.20to.20start.20for.20an.20unknown.20reason/near/430467806\">said</a>:</p>\n<blockquote>\n<p>I would opt for something like no highlights in the code at all (and no messages), and a big banner over the infoview saying that the checker is not running and you should use the big green \"Start\" button to start it</p>\n</blockquote>\n<p>Programming users sometimes use Lean 4 without the InfoView (instead using the problems pane in VS Code), so these errors also need to show up <em>somewhere</em> else.</p>",
        "id": 430467952,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1711882407
    },
    {
        "content": "<p>making it show up on hovers is also a possibility, although it sounds a bit obnoxious</p>",
        "id": 430468029,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711882456
    },
    {
        "content": "<p>To be clear, we are limited by LSP here in terms of the diagnostic severities we have available</p>",
        "id": 430468041,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1711882472
    },
    {
        "content": "<p>I don't think this should be an LSP \"diagnostic\" at all</p>",
        "id": 430468050,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711882488
    },
    {
        "content": "<p>we have nothing to say about the user's code</p>",
        "id": 430468056,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711882500
    },
    {
        "content": "<p>we have something to say about the system state</p>",
        "id": 430468068,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711882512
    },
    {
        "content": "<p>it should be indicated by an icon in the status bar, a banner in the infoview, a gutter indicator, something like that. Not messages, which are for problems <em>in the code</em></p>",
        "id": 430468142,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711882566
    },
    {
        "content": "<p>it would be good to see how other LSP extensions handle this kind of thing. Most of the cases I can think of are done via status indicators or notifications</p>",
        "id": 430468208,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711882671
    },
    {
        "content": "<p>and as you say, I don't think LSP directly helps here</p>",
        "id": 430468252,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711882686
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/270676-lean4/topic/Lean.20fail.20to.20start.20for.20an.20unknown.20reason/near/430468208\">said</a>:</p>\n<blockquote>\n<p>it would be good to see how other LSP extensions handle this kind of thing. Most of the cases I can think of are done via status indicators or notifications</p>\n</blockquote>\n<p>Status indicators are way too hidden, notifications are way too noisy. I think that of the tools that VS Code gives us, diagnostics are the best fit, even if they are not optimal by nature of also highlighting a part of the code (though I don't think highlighting a part of the header is really all that confusing, since to me it communicates that there's probably something wrong with the context of the file).</p>\n<p>One thing also worth pointing out is that we added the <code>fullRange</code> field to diagnostics long ago to make diagnostics better fit this kind of use-case, but it was unfortunately disabled shortly afterwards by accident and I've only re-enabled it again very recently.</p>",
        "id": 430468647,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1711883131
    },
    {
        "content": "<blockquote>\n<p>Status indicators are way too hidden</p>\n</blockquote>\n<p>My experience with the rust-analyzer status indicator is that it's quite noticeable, but it does this by being full red highlight over the text in the status bar. It is used when reading Cargo.toml fails for example</p>",
        "id": 430469342,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711883878
    },
    {
        "content": "<blockquote>\n<p>though I don't think highlighting a part of the header is really all that confusing</p>\n</blockquote>\n<p>It is very confusing that it highlights only the first import. It gives the impression that the error is with that import</p>",
        "id": 430469492,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711884004
    },
    {
        "content": "<p>it's also usually very far from the part of the file I'm looking at at the moment</p>",
        "id": 430469523,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711884041
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/270676-lean4/topic/Lean.20fail.20to.20start.20for.20an.20unknown.20reason/near/430469492\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p>though I don't think highlighting a part of the header is really all that confusing</p>\n</blockquote>\n<p>It is very confusing that it highlights only the first import. It gives the impression that the error is with that import</p>\n</blockquote>\n<p>I agree, we could probably improve this.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/270676-lean4/topic/Lean.20fail.20to.20start.20for.20an.20unknown.20reason/near/430469523\">said</a>:</p>\n<blockquote>\n<p>it's also usually very far from the part of the file I'm looking at at the moment</p>\n</blockquote>\n<p>That's why it always shows up under \"Messages\" now on the next RC :-)</p>",
        "id": 430469543,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1711884073
    },
    {
        "content": "<p>and there is no point in drawing my attention to the beginning of the file to fix something over there and take me away from the current context</p>",
        "id": 430469545,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711884078
    },
    {
        "content": "<p>To me \"wall of red\" very strongly suggests \"you fool, you've broken <em>everything</em>\" which is hard for newcomers to deal with</p>",
        "id": 430469671,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711884231
    },
    {
        "content": "<p>Would this all become far less relevant if instead of the instructions in my README telling people to clone the repo and then type some gobble-de-gook about cache get, we could just tell people to \"install\" the repo via some VS Code interface, which does (a) cloning (the part which everyone seems to be able to do) (b) getting cache (a part which trips people up) (c) opening the right folder (another part which trips people up)? Or is this somehow not possible?</p>",
        "id": 430469974,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1711884485
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/stream/270676-lean4/topic/Lean.20fail.20to.20start.20for.20an.20unknown.20reason/near/430469974\">said</a>:</p>\n<blockquote>\n<p>Would this all become far less relevant if instead of the instructions in my README telling people to clone the repo and then type some gobble-de-gook about cache get, we could just tell people to \"install\" the repo via some VS Code interface, which does (a) cloning (the part which everyone seems to be able to do) (b) getting cache (a part which trips people up) (c) opening the right folder (another part which trips people up)? Or is this somehow not possible?</p>\n</blockquote>\n<p>The VS Code extension should already do this with the \"Download Project\" command, let me check.</p>",
        "id": 430469992,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1711884519
    },
    {
        "content": "<p>Yes, it works just fine with the formalizing mathematics repository.</p>",
        "id": 430470189,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1711884739
    },
    {
        "content": "<p>(Forall menu &gt; Open project &gt; Download project)</p>",
        "id": 430470202,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1711884777
    },
    {
        "content": "<p>I should change the README then!</p>",
        "id": 430470205,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1711884779
    },
    {
        "content": "<p>Kevin, feel free to use the test <a href=\"#narrow/stream/287929-mathlib4/topic/.60new-contributor.60.20labelling.20workflow.20broken.3F/near/429698388\">here</a>.</p>",
        "id": 430470434,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1711885020
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/stream/270676-lean4/topic/Lean.20fail.20to.20start.20for.20an.20unknown.20reason/near/430470434\">said</a>:</p>\n<blockquote>\n<p>Kevin, feel free to use the test <a href=\"#narrow/stream/287929-mathlib4/topic/.60new-contributor.60.20labelling.20workflow.20broken.3F/near/429698388\">here</a>.</p>\n</blockquote>\n<p>To be clear, you shouldn't need to:</p>\n<ul>\n<li>Manually navigate to the folder you want to open. At the end, the extension will show a popup that asks you whether you want to re-open VS Code in that folder.</li>\n<li>Manually download the cache. The VS Code extension tries to call <code>lake exe get cache</code> when it makes sense in case we are in a Mathlib context. All the project-level commands in the VS Code extension (Creating projects, downloading projects, building projects, cleaning projects, updating a dependency) try to call <code>lake exe get cache</code> at a point where it makes sense.</li>\n</ul>",
        "id": 430470599,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1711885190
    },
    {
        "content": "<hr>\n<h1>Installing <code>mathlib4</code></h1>\n<ol>\n<li>\n<p>Open VSCode, open the <code>lean4</code> extension and click on the <code>∀</code> symbol at the top-right.</p>\n</li>\n<li>\n<p>Choose <code>Open project ...</code> --&gt; <code>Project: Download project ...</code><br>\n   This should automatically suggests <code>mathlib4</code>, so just type <code>Enter</code>.</p>\n</li>\n<li>\n<p>Choose a folder where you want to download <code>mathlib4</code>.<br>\n   Wait for the download -- this may take a while, since <code>mathlib4</code> and its cache occupy ~5GB.</p>\n</li>\n<li>\n<p>You are good to go!</p>\n</li>\n</ol>\n<p>This should produce a project <em>with a working cache</em>.</p>\n<p>If, at some point, you want to download the remote cache (assuming that it is available, since you pushed your project and CI built it for you), then in the <code>∀</code> menu, you can find <code>Project Actions...</code> --&gt; <code>Project: Fetch Mathlib build cache</code> that will save you from having to compile locally <code>mathlib4</code> (a process that can take somewhere in the region of 1 hour to complete).</p>\n<hr>",
        "id": 430471342,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1711885970
    },
    {
        "content": "<p>I removed one of the steps: does this look alright now?</p>",
        "id": 430471359,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1711885982
    },
    {
        "content": "<p>You don't need to run <code>Fetch Mathlib Build Cache</code> directly after <code>Download Project</code> because the latter will already do that for you.</p>",
        "id": 430471393,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1711886040
    },
    {
        "content": "<p>I added a clarification: I think that mentioning that you <em>can</em> download the cache (later on) is useful advice!</p>",
        "id": 430471492,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1711886138
    },
    {
        "content": "<p>Yes, if you are working with Git, then you may still need to run the command occasionally :-)</p>",
        "id": 430471554,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1711886173
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 430495073,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1711907677
    }
]