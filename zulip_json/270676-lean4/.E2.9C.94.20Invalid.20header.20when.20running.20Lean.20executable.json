[
    {
        "content": "<p>I have a project which I recently bumped from Lean 4.1.0 to 4.7.0-rc2 that makes use of <code>import Lean</code> and starts with</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">unsafe</span> <span class=\"kd\">def</span> <span class=\"n\">Main</span><span class=\"o\">:</span> <span class=\"n\">IO</span> <span class=\"n\">Unit</span> <span class=\"o\">:=</span> <span class=\"k\">do</span>\n  <span class=\"n\">Lean.enableInitializersExecution</span>\n  <span class=\"n\">Lean.initSearchPath</span> <span class=\"o\">(</span><span class=\"bp\">‚Üê</span> <span class=\"n\">Lean.findSysroot</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">sp</span> <span class=\"o\">:=</span> <span class=\"n\">System.SearchPath.parse</span> <span class=\"n\">sp</span><span class=\"o\">)</span>\n  <span class=\"bp\">...</span>\n</code></pre></div>\n<p>However when I run it, </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">uncaught</span> <span class=\"n\">exception</span><span class=\"o\">:</span> <span class=\"n\">failed</span> <span class=\"n\">to</span> <span class=\"n\">read</span> <span class=\"n\">file</span> <span class=\"bp\">'/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">aniva</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---4.7.0-rc2/lib/lean/Init.olean', invalid header</span>\n</code></pre></div>\n<p>Is there a way to fix this?</p>",
        "id": 426682190,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1710484684
    },
    {
        "content": "<p>how are you running it?</p>",
        "id": 426682737,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1710485046
    },
    {
        "content": "<p>you should ensure that the lean version that is running is the same version as the one specified in the search path you are passing</p>",
        "id": 426682809,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1710485128
    },
    {
        "content": "<p>the mismatch could happen if the lean version in your project which you used to compile the binary is not the same as the lean version in which you are running your program (e.g. if it is a program which analyzes a target project which has a different <code>lean-toolchain</code> than your project)</p>",
        "id": 426682974,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1710485251
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/270676-lean4/topic/Invalid.20header.20when.20running.20Lean.20executable/near/426682737\">said</a>:</p>\n<blockquote>\n<p>how are you running it?</p>\n</blockquote>\n<p>I'm just running it via <code>lake env</code> with <code>4.7.0-rc2</code> set as the default. It isn't dependent on any other projects</p>",
        "id": 426684535,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1710486309
    },
    {
        "content": "<p>try deleting <code>.lake</code> and rebuilding the project</p>",
        "id": 426685190,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1710486744
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/270676-lean4/topic/Invalid.20header.20when.20running.20Lean.20executable/near/426685190\">said</a>:</p>\n<blockquote>\n<p>try deleting <code>.lake</code> and rebuilding the project</p>\n</blockquote>\n<p>I did that and nothing changed</p>\n<p>The <code>lean-toolchain</code> file has <code>leanprover/lean4:4.7.0-rc2</code></p>",
        "id": 426687228,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1710487840
    },
    {
        "content": "<p>nevermind I found the problem. The build directory has changed from <code>build</code> to <code>.lake/build</code></p>",
        "id": 426687471,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1710487974
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"599027\">Leni Aniva</span> has marked this topic as resolved.</p>",
        "id": 426687478,
        "sender_full_name": "Notification Bot",
        "timestamp": 1710487978
    },
    {
        "content": "<p>Oh! Yeah sorry for that, there have been a lot of changes recently but hopefully things like where lake puts files are becoming a lot more stable now.</p>",
        "id": 426701242,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1710493975
    }
]