[
    {
        "content": "<p>Hello everybody.<br>\nI am working on a definition of the log2 function, to practice, this is my implementation:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">def</span> <span class=\"n\">log2</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"o\">:=</span> <span class=\"n\">go</span> <span class=\"n\">x</span> <span class=\"mi\">0</span> <span class=\"n\">where</span>\n  <span class=\"n\">go</span>\n  <span class=\"bp\">|</span> <span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"n\">_</span> <span class=\"bp\">=&gt;</span> <span class=\"mi\">0</span>\n  <span class=\"bp\">|</span> <span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"n\">y</span> <span class=\"bp\">=&gt;</span> <span class=\"n\">y</span>\n  <span class=\"bp\">|</span> <span class=\"n\">x</span><span class=\"o\">,</span><span class=\"n\">y</span> <span class=\"bp\">=&gt;</span>\n    <span class=\"k\">have</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"bp\">&gt;</span> <span class=\"mi\">1</span> <span class=\"o\">:=</span> <span class=\"gr\">sorry</span>\n    <span class=\"k\">have</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"bp\">/</span> <span class=\"mi\">2</span> <span class=\"bp\">&lt;</span> <span class=\"n\">x</span> <span class=\"o\">:=</span> <span class=\"n\">Nat.log2_terminates</span> <span class=\"n\">x</span> <span class=\"n\">this</span>\n    <span class=\"n\">go</span> <span class=\"o\">(</span><span class=\"n\">x</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">y</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>As you can see, my termination proof uses sorry, because I was not able to prove x &gt; 1. How can I use the fact that the pattern match got this far into the proof?</p>",
        "id": 420770300,
        "sender_full_name": "Bernardo Borges",
        "timestamp": 1707540379
    },
    {
        "content": "<p>Can you use <code>| x + 2, y =&gt;</code> in your last pattern match, and adjust the rest accordingly?  Proving <code>x + 2 &gt; 1</code> should be easy!  (Untested)</p>",
        "id": 420772407,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1707542577
    },
    {
        "content": "<p>Damiano’s suggestion is probably the best . Or don’t use <code>match</code> but <code>if h0 : x = 0 …  else if h1 : x = 1 … </code>.<br>\nI think some people have considered making this “overlap hypothesis” available in the cases somehow, but it needs a good syntax and needs someone doing it.</p>",
        "id": 420793980,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1707565851
    },
    {
        "content": "<p>I tryied the x+2 solution but I didnt make an improvement with this.<br>\nThen, with <span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span> suggestion, I replaced the matchi with if's that get the proof, but the code changed dramatically:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">def</span> <span class=\"n\">log2</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"o\">:=</span>\n  <span class=\"k\">if</span> <span class=\"n\">h0</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"bp\">&gt;</span> <span class=\"mi\">1</span> <span class=\"k\">then</span>\n    <span class=\"n\">go</span> <span class=\"n\">x</span> <span class=\"mi\">1</span> <span class=\"n\">h0</span>\n  <span class=\"k\">else</span> <span class=\"mi\">0</span>\n  <span class=\"n\">where</span>\n  <span class=\"n\">go</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"bp\">&gt;</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"o\">:=</span>\n    <span class=\"k\">have</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"bp\">/</span> <span class=\"mi\">2</span> <span class=\"bp\">&lt;</span> <span class=\"n\">x</span> <span class=\"o\">:=</span> <span class=\"n\">Nat.log2_terminates</span> <span class=\"n\">x</span> <span class=\"n\">h</span>\n    <span class=\"k\">if</span> <span class=\"n\">h0</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"bp\">/</span> <span class=\"mi\">2</span> <span class=\"bp\">&gt;</span> <span class=\"mi\">1</span> <span class=\"k\">then</span>\n      <span class=\"n\">go</span> <span class=\"o\">(</span><span class=\"n\">x</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">y</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">h0</span>\n    <span class=\"k\">else</span> <span class=\"n\">y</span>\n</code></pre></div>",
        "id": 420808002,
        "sender_full_name": "Bernardo Borges",
        "timestamp": 1707578449
    }
]