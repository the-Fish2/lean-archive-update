[
    {
        "content": "<p><code>simp!</code> (or equivalently, <code>simp</code> with <code>autoUnfold := true</code>) seems to ignore any explicitly listed declarations. This means that changing <code>simp</code> to <code>simp!</code> can cause it to no longer unfold:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">def</span> <span class=\"n\">ff</span> <span class=\"o\">:=</span> <span class=\"n\">false</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check_tactic</span> <span class=\"n\">not</span> <span class=\"n\">ff</span> <span class=\"bp\">~&gt;</span> <span class=\"n\">true</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">ff</span><span class=\"o\">]</span>\n<span class=\"bp\">#</span><span class=\"n\">check_tactic</span> <span class=\"n\">not</span> <span class=\"n\">ff</span> <span class=\"bp\">~&gt;</span> <span class=\"n\">true</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"bp\">!</span> <span class=\"o\">[</span><span class=\"n\">ff</span><span class=\"o\">]</span> <span class=\"c1\">-- simp made no progress</span>\n</code></pre></div>\n<p>Is this the intended behavior? There is no warning that <code>ff</code> is ignored by <code>simp!</code>.</p>\n<p>Also, using <code>simp?!</code> seems to ignore auto unfolding, and its suggestion is incorrect.</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">check_tactic</span> <span class=\"n\">not</span> <span class=\"n\">ff</span> <span class=\"bp\">~&gt;</span> <span class=\"n\">true</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"bp\">?!</span> <span class=\"o\">[</span><span class=\"n\">ff</span><span class=\"o\">]</span> <span class=\"c1\">-- Try this: simp! only [ff, Bool.not_false]</span>\n<span class=\"bp\">#</span><span class=\"n\">check_tactic</span> <span class=\"n\">not</span> <span class=\"n\">ff</span> <span class=\"bp\">~&gt;</span> <span class=\"n\">true</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"bp\">!</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">ff</span><span class=\"o\">,</span> <span class=\"n\">Bool.not_false</span><span class=\"o\">]</span> <span class=\"c1\">-- simp made no progress</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check_tactic</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">::</span> <span class=\"n\">xs</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">map</span> <span class=\"n\">f</span> <span class=\"bp\">~&gt;</span> <span class=\"n\">f</span> <span class=\"n\">x</span> <span class=\"o\">::</span> <span class=\"n\">xs.map</span> <span class=\"n\">f</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"bp\">!</span> <span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"n\">List.map_cons</span><span class=\"o\">]</span>\n<span class=\"bp\">#</span><span class=\"n\">check_tactic</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">::</span> <span class=\"n\">xs</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">map</span> <span class=\"n\">f</span> <span class=\"bp\">~&gt;</span> <span class=\"n\">f</span> <span class=\"n\">x</span> <span class=\"o\">::</span> <span class=\"n\">xs.map</span> <span class=\"n\">f</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"bp\">?!</span> <span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"n\">List.map_cons</span><span class=\"o\">]</span> <span class=\"c1\">-- simp made no progress</span>\n</code></pre></div>",
        "id": 438587561,
        "sender_full_name": "Parth Shastri",
        "timestamp": 1715696504
    },
    {
        "content": "<p>this seems like it should be reported as a bug? <span class=\"user-mention\" data-user-id=\"497571\">@Parth Shastri</span></p>\n<p>At very minimum, if <code>autoUnfold</code> <em>can't</em> support a list of extra simp lemmas it should emit a warning...</p>",
        "id": 439397945,
        "sender_full_name": "James Gallicchio",
        "timestamp": 1716084177
    }
]