[
    {
        "content": "<p>Is a heartbeat just an atomic operation? I find sometimes that some theorems with much lower heartbeat counts can take longer to run than theorems with higher heartbeat counts...</p>",
        "id": 411000265,
        "sender_full_name": "Eric Rodriguez",
        "timestamp": 1704282388
    },
    {
        "content": "<p>The docstring for the <code>maxHeartbeats</code> option says \"A heartbeat is number of (small) memory allocations (in thousands), 0 means no limit\".</p>",
        "id": 411000819,
        "sender_full_name": "Richard Copley",
        "timestamp": 1704282675
    },
    {
        "content": "<p>Yes that's quite possible, heartbeats do not necessarily correspond to real time and track something different and maybe slightly more deterministic, but low heartbeats doesn't necessarily mean fast eg</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">Mathlib.Util.SleepHeartbeats</span>\n<span class=\"kn\">import</span> <span class=\"n\">Mathlib.Util.CountHeartbeats</span>\n\n<span class=\"n\">count_heartbeats</span> <span class=\"k\">in</span>\n<span class=\"kd\">theorem</span> <span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"mi\">1</span><span class=\"bp\">=</span> <span class=\"mi\">1</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n  <span class=\"n\">sleep_heartbeats</span> <span class=\"mi\">1000</span>\n  <span class=\"n\">rfl</span>\n\n<span class=\"n\">elab</span> <span class=\"s2\">\"sleep\"</span> <span class=\"o\">:</span> <span class=\"n\">tactic</span> <span class=\"bp\">=&gt;</span> <span class=\"k\">do</span> <span class=\"n\">IO.sleep</span> <span class=\"mi\">5000</span>\n\n<span class=\"n\">count_heartbeats</span> <span class=\"k\">in</span>\n<span class=\"kd\">theorem</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"mi\">1</span><span class=\"bp\">=</span> <span class=\"mi\">1</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n  <span class=\"n\">sleep</span>\n  <span class=\"n\">rfl</span>\n</code></pre></div>",
        "id": 411000826,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1704282679
    }
]