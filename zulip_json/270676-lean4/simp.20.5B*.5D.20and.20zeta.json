[
    {
        "content": "<p>I just got surprised by:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">example</span> <span class=\"o\">:</span> <span class=\"n\">True</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n  <span class=\"k\">let</span> <span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"n\">Nat</span> <span class=\"o\">:=</span> <span class=\"mi\">0</span>\n  <span class=\"c1\">-- have : 2 * n = 0 := by simp [*]</span>\n  <span class=\"k\">have</span> <span class=\"o\">:</span> <span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"n\">n</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">n</span><span class=\"o\">]</span>\n  <span class=\"n\">trivial</span>\n</code></pre></div>\n<p>where the commented out version does not work. Is this on purpose or an oversight? Of course this is not crucial at all, but it seems to violate the principle of least surprise.</p>",
        "id": 436769721,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1714680871
    },
    {
        "content": "<p>I had the vague impression that <code>*</code> was supposed to mean \"all prop hypotheses\", but I may be wrong</p>",
        "id": 436772026,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1714681848
    },
    {
        "content": "<p>That would make sense. I really only want to check this is the intended behavior and not some forgotten edge case.</p>",
        "id": 436772139,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1714681901
    },
    {
        "content": "<p>In that case the docstring could be a bit more precise. It currently says “* <code>simp [*]</code> simplifies the main goal target using the lemmas tagged with the attribute <code>[simp]</code> and all hypotheses.”</p>",
        "id": 436772260,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1714681945
    },
    {
        "content": "<p>The word “hypotheses” could indeed mean Prop and not every element of the local context.</p>",
        "id": 436772349,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1714681988
    },
    {
        "content": "<p>The docstrings aren't the most consistent when it comes to \"hypothesis\" vs \"local variable\"</p>",
        "id": 436772416,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1714682025
    },
    {
        "content": "<p>I don't know whether or not this is an oversight, but I might have expected <code>simp [*]</code> to do zeta reduction</p>",
        "id": 436772515,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1714682061
    },
    {
        "content": "<p>Oh, that explains a simp failure I had a hard diagnosing just now!</p>",
        "id": 436772915,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1714682243
    },
    {
        "content": "<p>I can't speak for Lean core here, but I think it would be reasonable to make an RFC that <code>simp [*]</code> should turn on <code>zetaDelta</code>.</p>",
        "id": 436773384,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1714682447
    },
    {
        "content": "<p>I recall this being an explicit point of discussion / design decision, although I don't recall the reasoning</p>",
        "id": 436773519,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1714682514
    },
    {
        "content": "<p>Does turning on <code>zetaDelta</code> actually help here?</p>",
        "id": 436773591,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1714682529
    },
    {
        "content": "<p>Sure it helps.</p>",
        "id": 436773927,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1714682691
    },
    {
        "content": "<p>It would be good one way or the other to document whether <code>[*]</code> includes local variables.</p>\n<p>I guess one issue is that you can't turn off <code>zetaDelta</code> if <code>[*]</code> turns it on, since there's no good way to see whether a user specified a config option or left it at its default value.</p>",
        "id": 436774540,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1714682975
    },
    {
        "content": "<p>Discussed in <a href=\"https://github.com/leanprover/lean4/pull/3520\">lean4#3520</a></p>",
        "id": 436849571,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1714729323
    }
]