[
    {
        "content": "<p>Continuing with the \"puzzle\" tradition, here is something that surprised me today.</p>\n<p>Does <code>simp</code> make progress in the code below?</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">example</span> <span class=\"o\">{</span><span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"n\">Nat</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">n</span> <span class=\"bp\">=</span> <span class=\"n\">n</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n  <span class=\"k\">let</span> <span class=\"n\">n0</span> <span class=\"o\">:=</span> <span class=\"n\">n</span>\n  <span class=\"n\">simp</span> <span class=\"n\">at</span> <span class=\"n\">n0</span>  <span class=\"c1\">-- does this `simp` make progress?</span>\n  <span class=\"n\">rfl</span>\n</code></pre></div>\n<p>If so, what is the progress?</p>",
        "id": 428286633,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1711098267
    },
    {
        "content": "<p>It appears that the simp is not making any progress!</p>",
        "id": 428438079,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1711163535
    },
    {
        "content": "<p>If you insert a second <code>simp at n0</code>, that one doesn't make progress. Even with <code>pp.raw</code> I can't see what the progress might be.</p>",
        "id": 428438608,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1711164067
    },
    {
        "content": "<p>Is it removing some <code>mdata</code>?</p>",
        "id": 428439128,
        "sender_full_name": "Timo Carlin-Burns",
        "timestamp": 1711164566
    },
    {
        "content": "<p>None that I see. You can see the metadata with <code>pp.raw</code></p>",
        "id": 428439143,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1711164592
    },
    {
        "content": "<p>Oh, I think I got the answer now.</p>",
        "id": 428439219,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1711164639
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"500038\">Timo Carlin-Burns</span> <a href=\"#narrow/stream/270676-lean4/topic/.60simp.60.20puzzle/near/428439128\">said</a>:</p>\n<blockquote>\n<p>Is it removing some <code>mdata</code>?</p>\n</blockquote>\n<p>This is often a good guess, but in this case the <code>mdata</code> is added to the <em>goal</em> and in general I think that <code>simp</code> does not remove <code>mdata</code>.</p>",
        "id": 428594583,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1711168338
    },
    {
        "content": "<p>Btw, <code>have</code> instead of <code>let</code> would behave in the same way.</p>",
        "id": 428594630,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1711168389
    },
    {
        "content": "<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p>My guess is that it's instantiating a metavariable. If you write <code>let n0 : Nat := n</code> then it no longer makes progress.</p>\n</div></div>",
        "id": 428745825,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1711168522
    },
    {
        "content": "<p>Indeed, Kyle's analysis aligns with mine!</p>",
        "id": 428745908,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1711168578
    },
    {
        "content": "<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Spoiler</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p><code>simp</code> changes the <code>Expr</code> of <code>n0</code> from <code>mvar</code> to <code>const</code>.</p>\n</div></div>",
        "id": 428897212,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1711168833
    }
]