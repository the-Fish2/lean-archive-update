[
    {
        "content": "<p>Any ideas what is going wrong here?</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>ali@Alistairs-MBP<span class=\"w\"> </span>~<span class=\"w\"> </span>%<span class=\"w\"> </span>lake<span class=\"w\"> </span>new<span class=\"w\"> </span><span class=\"nb\">test</span><span class=\"w\"> </span>math\nali@Alistairs-MBP<span class=\"w\"> </span>~<span class=\"w\"> </span>%<span class=\"w\"> </span><span class=\"nb\">cd</span><span class=\"w\"> </span><span class=\"nb\">test</span>\nali@Alistairs-MBP<span class=\"w\"> </span><span class=\"nb\">test</span><span class=\"w\"> </span>%<span class=\"w\"> </span>lake<span class=\"w\"> </span>update\ntest:<span class=\"w\"> </span>no<span class=\"w\"> </span>previous<span class=\"w\"> </span>manifest,<span class=\"w\"> </span>creating<span class=\"w\"> </span>one<span class=\"w\"> </span>from<span class=\"w\"> </span>scratch\nmathlib:<span class=\"w\"> </span>cloning<span class=\"w\"> </span>https://github.com/leanprover-community/mathlib4.git<span class=\"w\"> </span>to<span class=\"w\"> </span><span class=\"s1\">'./.lake/packages/mathlib'</span>\nerror:<span class=\"w\"> </span>&gt;<span class=\"w\"> </span>git<span class=\"w\"> </span>clone<span class=\"w\"> </span>https://github.com/leanprover-community/mathlib4.git<span class=\"w\"> </span>./.lake/packages/mathlib\nerror:<span class=\"w\"> </span>stderr:\nCloning<span class=\"w\"> </span>into<span class=\"w\"> </span><span class=\"s1\">'./.lake/packages/mathlib'</span>...\nerror:<span class=\"w\"> </span>RPC<span class=\"w\"> </span>failed<span class=\"p\">;</span><span class=\"w\"> </span>curl<span class=\"w\"> </span><span class=\"m\">92</span><span class=\"w\"> </span>HTTP/2<span class=\"w\"> </span>stream<span class=\"w\"> </span><span class=\"m\">5</span><span class=\"w\"> </span>was<span class=\"w\"> </span>not<span class=\"w\"> </span>closed<span class=\"w\"> </span>cleanly:<span class=\"w\"> </span>CANCEL<span class=\"w\"> </span><span class=\"o\">(</span>err<span class=\"w\"> </span><span class=\"m\">8</span><span class=\"o\">)</span>\nerror:<span class=\"w\"> </span><span class=\"m\">7531</span><span class=\"w\"> </span>bytes<span class=\"w\"> </span>of<span class=\"w\"> </span>body<span class=\"w\"> </span>are<span class=\"w\"> </span>still<span class=\"w\"> </span>expected\nfetch-pack:<span class=\"w\"> </span>unexpected<span class=\"w\"> </span>disconnect<span class=\"w\"> </span><span class=\"k\">while</span><span class=\"w\"> </span>reading<span class=\"w\"> </span>sideband<span class=\"w\"> </span>packet\nfatal:<span class=\"w\"> </span>early<span class=\"w\"> </span>EOF\nfatal:<span class=\"w\"> </span>fetch-pack:<span class=\"w\"> </span>invalid<span class=\"w\"> </span>index-pack<span class=\"w\"> </span>output\nerror:<span class=\"w\"> </span>external<span class=\"w\"> </span><span class=\"nb\">command</span><span class=\"w\"> </span><span class=\"sb\">`</span>git<span class=\"sb\">`</span><span class=\"w\"> </span>exited<span class=\"w\"> </span>with<span class=\"w\"> </span>code<span class=\"w\"> </span><span class=\"m\">128</span>\n</code></pre></div>",
        "id": 422125456,
        "sender_full_name": "A.",
        "timestamp": 1708287265
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>ali@Alistairs-MBP<span class=\"w\"> </span>~<span class=\"w\"> </span>%<span class=\"w\"> </span>elan<span class=\"w\"> </span>show\ninstalled<span class=\"w\"> </span>toolchains\n--------------------\n\nstable<span class=\"w\"> </span><span class=\"o\">(</span>default<span class=\"o\">)</span>\n...\nleanprover/lean4:v4.6.0-rc1\n\nactive<span class=\"w\"> </span>toolchain\n----------------\n\nstable<span class=\"w\"> </span><span class=\"o\">(</span>default<span class=\"o\">)</span>\nLean<span class=\"w\"> </span><span class=\"o\">(</span>version<span class=\"w\"> </span><span class=\"m\">4</span>.5.0,<span class=\"w\"> </span>commit<span class=\"w\"> </span>1a3021f98e55,<span class=\"w\"> </span>Release<span class=\"o\">)</span>\n</code></pre></div>",
        "id": 422125968,
        "sender_full_name": "A.",
        "timestamp": 1708287720
    },
    {
        "content": "<p>This seems like a network issue. Can you try again?</p>",
        "id": 422126294,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1708287934
    },
    {
        "content": "<p>Yes it has been happening all day</p>",
        "id": 422126378,
        "sender_full_name": "A.",
        "timestamp": 1708287983
    },
    {
        "content": "<p>I'm not sure how to help, then :/</p>",
        "id": 422126462,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1708288069
    },
    {
        "content": "<p>Well thanks, your answer suggests I should try again from another location. Maybe I'll get the chance tomorrow or the day after.</p>",
        "id": 422126574,
        "sender_full_name": "A.",
        "timestamp": 1708288143
    },
    {
        "content": "<p>I'm not sure if this is related, or just an unfortunate coincidence, but on an older project:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>ali@Alistairs-MBP<span class=\"w\"> </span>exists-unique<span class=\"w\"> </span>%<span class=\"w\"> </span>lake<span class=\"w\"> </span>update\nmathlib:<span class=\"w\"> </span>updating<span class=\"w\"> </span>repository<span class=\"w\"> </span><span class=\"s1\">'./lake-packages/mathlib'</span><span class=\"w\"> </span>to<span class=\"w\"> </span>revision<span class=\"w\"> </span><span class=\"s1\">'d475374f5e4e7ad1260dd93b29d3995ff3129941'</span>\nerror:<span class=\"w\"> </span>./lake-packages/mathlib/lakefile.lean:6:2:<span class=\"w\"> </span>error:<span class=\"w\"> </span><span class=\"s1\">'leanOptions'</span><span class=\"w\"> </span>is<span class=\"w\"> </span>not<span class=\"w\"> </span>a<span class=\"w\"> </span>field<span class=\"w\"> </span>of<span class=\"w\"> </span>structure<span class=\"w\"> </span><span class=\"s1\">'Lake.PackageConfig'</span>\nerror:<span class=\"w\"> </span>./lake-packages/mathlib/lakefile.lean:76:2:<span class=\"w\"> </span>error:<span class=\"w\"> </span>unexpected<span class=\"w\"> </span>identifier<span class=\"p\">;</span><span class=\"w\"> </span>expected<span class=\"w\"> </span><span class=\"s1\">'abbrev'</span>,<span class=\"w\"> </span><span class=\"s1\">'add_decl_doc'</span>,<span class=\"w\"> </span><span class=\"s1\">'axiom'</span>,<span class=\"w\"> </span><span class=\"s1\">'builtin_initialize'</span>,<span class=\"w\"> </span><span class=\"s1\">'class'</span>,<span class=\"w\"> </span><span class=\"s1\">'custom_data'</span>,<span class=\"w\"> </span><span class=\"s1\">'declare_opaque_type'</span>,<span class=\"w\"> </span><span class=\"s1\">'declare_simp_like_tactic'</span>,<span class=\"w\"> </span><span class=\"s1\">'declare_syntax_cat'</span>,<span class=\"w\"> </span><span class=\"s1\">'def'</span>,<span class=\"w\"> </span><span class=\"s1\">'elab'</span>,<span class=\"w\"> </span><span class=\"s1\">'elab_rules'</span>,<span class=\"w\"> </span><span class=\"s1\">'example'</span>,<span class=\"w\"> </span><span class=\"s1\">'extern_lib'</span>,<span class=\"w\"> </span><span class=\"s1\">'family_def'</span>,<span class=\"w\"> </span><span class=\"s1\">'inductive'</span>,<span class=\"w\"> </span><span class=\"s1\">'infix'</span>,<span class=\"w\"> </span><span class=\"s1\">'infixl'</span>,<span class=\"w\"> </span><span class=\"s1\">'infixr'</span>,<span class=\"w\"> </span><span class=\"s1\">'initialize'</span>,<span class=\"w\"> </span><span class=\"s1\">'instance'</span>,<span class=\"w\"> </span><span class=\"s1\">'lean_exe'</span>,<span class=\"w\"> </span><span class=\"s1\">'lean_lib'</span>,<span class=\"w\"> </span><span class=\"s1\">'library_data'</span>,<span class=\"w\"> </span><span class=\"s1\">'library_facet'</span>,<span class=\"w\"> </span><span class=\"s1\">'macro'</span>,<span class=\"w\"> </span><span class=\"s1\">'macro_rules'</span>,<span class=\"w\"> </span><span class=\"s1\">'module_data'</span>,<span class=\"w\"> </span><span class=\"s1\">'module_facet'</span>,<span class=\"w\"> </span><span class=\"s1\">'notation'</span>,<span class=\"w\"> </span><span class=\"s1\">'opaque'</span>,<span class=\"w\"> </span><span class=\"s1\">'package'</span>,<span class=\"w\"> </span><span class=\"s1\">'package_data'</span>,<span class=\"w\"> </span><span class=\"s1\">'package_facet'</span>,<span class=\"w\"> </span><span class=\"s1\">'postfix'</span>,<span class=\"w\"> </span><span class=\"s1\">'prefix'</span>,<span class=\"w\"> </span><span class=\"s1\">'register_builtin_option'</span>,<span class=\"w\"> </span><span class=\"s1\">'register_option'</span>,<span class=\"w\"> </span><span class=\"s1\">'script'</span>,<span class=\"w\"> </span><span class=\"s1\">'structure'</span>,<span class=\"w\"> </span><span class=\"s1\">'syntax'</span>,<span class=\"w\"> </span><span class=\"s1\">'target'</span>,<span class=\"w\"> </span><span class=\"s1\">'target_data'</span>,<span class=\"w\"> </span><span class=\"s1\">'theorem'</span><span class=\"w\"> </span>or<span class=\"w\"> </span><span class=\"s1\">'unif_hint'</span>\nerror:<span class=\"w\"> </span>./lake-packages/mathlib/lakefile.lean:<span class=\"w\"> </span>package<span class=\"w\"> </span>configuration<span class=\"w\"> </span>has<span class=\"w\"> </span>errors\n</code></pre></div>",
        "id": 422127723,
        "sender_full_name": "A.",
        "timestamp": 1708289062
    },
    {
        "content": "<p>Do you have a <code>lean-toolchain</code> file at the root of your project?</p>",
        "id": 422127771,
        "sender_full_name": "Emilie (Shad Amethyst)",
        "timestamp": 1708289118
    },
    {
        "content": "<p>I do! It says</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4.2.0</span><span class=\"bp\">-</span><span class=\"n\">rc1</span>\n</code></pre></div>",
        "id": 422127849,
        "sender_full_name": "A.",
        "timestamp": 1708289173
    },
    {
        "content": "<p>Oh, it should be <code>leanprover/lean4:v4.6.0-rc1</code>, from this mathlib commit</p>",
        "id": 422127862,
        "sender_full_name": "Emilie (Shad Amethyst)",
        "timestamp": 1708289190
    },
    {
        "content": "<p>Normally <code>lake update</code> should do that for you</p>",
        "id": 422127882,
        "sender_full_name": "Emilie (Shad Amethyst)",
        "timestamp": 1708289217
    },
    {
        "content": "<p>Yeah, this is a known issue when you update over a change in the lakefile syntax</p>",
        "id": 422128005,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1708289308
    },
    {
        "content": "<p>Hmm I am obviously very unclear about what lake update is for</p>",
        "id": 422128011,
        "sender_full_name": "A.",
        "timestamp": 1708289315
    },
    {
        "content": "<p><code>lake update</code> updates your dependencies, so you now depend on the latest version of mathlib</p>",
        "id": 422128049,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1708289363
    },
    {
        "content": "<p>Unfortunately it has some rough edges, of which this is probably the most prominent</p>",
        "id": 422128074,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1708289393
    },
    {
        "content": "<p>Try updating your lean-toolchain file manually and running <code>lake update</code> again</p>",
        "id": 422128133,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1708289415
    },
    {
        "content": "<p>Thanks! but I didn't actually want to update it; I only started messing with <code>lake update</code> because <code>lake exe cache get</code> was failing. I guess that was a wrong turning.</p>",
        "id": 422128315,
        "sender_full_name": "A.",
        "timestamp": 1708289594
    },
    {
        "content": "<p>Yeah, in that case you'll probably need to revert changes to lake-something.json</p>",
        "id": 422128552,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1708289785
    },
    {
        "content": "<p>Just going through what others have already said: for the original issue: I can't reproduce, so this is more evidence that it's a network issue at your end:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">buzzard</span><span class=\"bp\">@</span><span class=\"n\">brutus</span><span class=\"o\">:</span><span class=\"bp\">~/</span><span class=\"n\">crap</span><span class=\"bp\">$</span> <span class=\"n\">lake</span> <span class=\"n\">new</span> <span class=\"n\">test</span> <span class=\"n\">math</span>\n<span class=\"n\">buzzard</span><span class=\"bp\">@</span><span class=\"n\">brutus</span><span class=\"o\">:</span><span class=\"bp\">~/</span><span class=\"n\">crap</span><span class=\"bp\">$</span> <span class=\"n\">cd</span> <span class=\"n\">test</span>\n<span class=\"n\">buzzard</span><span class=\"bp\">@</span><span class=\"n\">brutus</span><span class=\"o\">:</span><span class=\"bp\">~/</span><span class=\"n\">crap</span><span class=\"bp\">/</span><span class=\"n\">test</span><span class=\"bp\">$</span> <span class=\"n\">lake</span> <span class=\"n\">update</span>\n<span class=\"n\">test</span><span class=\"o\">:</span> <span class=\"n\">no</span> <span class=\"n\">previous</span> <span class=\"n\">manifest</span><span class=\"o\">,</span> <span class=\"n\">creating</span> <span class=\"n\">one</span> <span class=\"k\">from</span> <span class=\"n\">scratch</span>\n<span class=\"n\">mathlib</span><span class=\"o\">:</span> <span class=\"n\">cloning</span> <span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github.com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4.git</span> <span class=\"n\">to</span> <span class=\"bp\">'./.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib'</span>\n<span class=\"n\">std</span><span class=\"o\">:</span> <span class=\"n\">cloning</span> <span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github.com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">std4</span> <span class=\"n\">to</span> <span class=\"bp\">'./.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">std'</span>\n<span class=\"n\">Qq</span><span class=\"o\">:</span> <span class=\"n\">cloning</span> <span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github.com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">quote4</span> <span class=\"n\">to</span> <span class=\"bp\">'./.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">Qq'</span>\n<span class=\"o\">(</span><span class=\"n\">etc</span> <span class=\"n\">etc</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>For the second one, unfortunately indeed this is expected; follow the instructions for updating a project <a href=\"https://github.com/leanprover-community/mathlib4/wiki/Using-mathlib4-as-a-dependency#updating-mathlib4\">here</a> if you want to update (and it sounds like you don't), and if you're in a mess after typing <code>lake update</code> before that <code>curl</code> command (which edits the <code>lean-toolchain</code> to what it needs to be) then  probably you can use git to revert back to your former state, by just dumping all the changes that were made since you started tinkering.</p>",
        "id": 422134114,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1708294696
    },
    {
        "content": "<p>I have travelled two hundred miles but still the same problem as at the top of this thread <span aria-label=\"sad\" class=\"emoji emoji-2639\" role=\"img\" title=\"sad\">:sad:</span> . I understand it's probably not a Lean problem as such but I am at a bit of a loss.</p>",
        "id": 422949211,
        "sender_full_name": "A.",
        "timestamp": 1708663049
    },
    {
        "content": "<p>are you able to run the <code>git clone https://github.com/leanprover-community/mathlib4.git ./.lake/packages/mathlib</code> line manually?</p>",
        "id": 422949461,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1708663255
    },
    {
        "content": "<p>Apparently not</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>ali@Alistairs-MBP<span class=\"w\"> </span><span class=\"nb\">test</span><span class=\"w\"> </span>%<span class=\"w\"> </span>git<span class=\"w\"> </span>clone<span class=\"w\"> </span>https://github.com/leanprover-community/mathlib4.git<span class=\"w\"> </span>./.lake/packages/mathlib\nCloning<span class=\"w\"> </span>into<span class=\"w\"> </span><span class=\"s1\">'./.lake/packages/mathlib'</span>...\nremote:<span class=\"w\"> </span>Enumerating<span class=\"w\"> </span>objects:<span class=\"w\"> </span><span class=\"m\">280781</span>,<span class=\"w\"> </span><span class=\"k\">done</span>.\nremote:<span class=\"w\"> </span>Counting<span class=\"w\"> </span>objects:<span class=\"w\"> </span><span class=\"m\">100</span>%<span class=\"w\"> </span><span class=\"o\">(</span><span class=\"m\">324</span>/324<span class=\"o\">)</span>,<span class=\"w\"> </span><span class=\"k\">done</span>.\nremote:<span class=\"w\"> </span>Compressing<span class=\"w\"> </span>objects:<span class=\"w\"> </span><span class=\"m\">100</span>%<span class=\"w\"> </span><span class=\"o\">(</span><span class=\"m\">149</span>/149<span class=\"o\">)</span>,<span class=\"w\"> </span><span class=\"k\">done</span>.\nerror:<span class=\"w\"> </span><span class=\"m\">3839</span><span class=\"w\"> </span>bytes<span class=\"w\"> </span>of<span class=\"w\"> </span>body<span class=\"w\"> </span>are<span class=\"w\"> </span>still<span class=\"w\"> </span>expected4<span class=\"w\"> </span>MiB<span class=\"w\"> </span><span class=\"p\">|</span><span class=\"w\"> </span><span class=\"m\">368</span>.00<span class=\"w\"> </span>KiB/s\nfetch-pack:<span class=\"w\"> </span>unexpected<span class=\"w\"> </span>disconnect<span class=\"w\"> </span><span class=\"k\">while</span><span class=\"w\"> </span>reading<span class=\"w\"> </span>sideband<span class=\"w\"> </span>packet\nfatal:<span class=\"w\"> </span>early<span class=\"w\"> </span>EOF\nfatal:<span class=\"w\"> </span>fetch-pack:<span class=\"w\"> </span>invalid<span class=\"w\"> </span>index-pack<span class=\"w\"> </span>output\n</code></pre></div>",
        "id": 422949744,
        "sender_full_name": "A.",
        "timestamp": 1708663543
    },
    {
        "content": "<p>If you're on windows, switch off your antivirus and try again?</p>",
        "id": 422966722,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1708675332
    }
]