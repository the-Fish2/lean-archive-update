[
    {
        "content": "<p>Consider the following MWE:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">Mathlib.CategoryTheory.Category.Basic</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">CategoryTheory</span>\n\n<span class=\"kd\">universe</span> <span class=\"n\">v</span> <span class=\"n\">v₁</span> <span class=\"n\">u</span> <span class=\"n\">u₁</span> <span class=\"n\">u₂</span>\n<span class=\"kd\">variable</span> <span class=\"o\">{</span><span class=\"n\">C</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">Category.</span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"o\">,</span> <span class=\"n\">u</span><span class=\"o\">}</span> <span class=\"n\">C</span><span class=\"o\">]</span>\n\n\n<span class=\"kn\">section</span> <span class=\"bp\">«</span><span class=\"kd\">notation</span><span class=\"bp\">»</span>\n<span class=\"c1\">--  open Lean Macro Parser Syntax Tactic PrettyPrinter Qq Elab.Term in</span>\n<span class=\"c1\">--  #check ℕ</span>\n<span class=\"kd\">end</span> <span class=\"bp\">«</span><span class=\"kd\">notation</span><span class=\"bp\">»</span>\n</code></pre></div>\n<p>As written, all is well. But if the two commented lines are uncommented, Lean reports an error under my use of <code>Category</code>:  <code>too many explicit universe levels for 'Lean.Parser.Category'</code>. Even though the open package occurs after the line, within its own section, and in fact within an <code>open in</code> declaration so it should only apply to the next line, apparently none of that stops Lean from \"backporting\" my open declaration so that it confuses it the line before.</p>\n<p>Am I missing a reason this is intended behavior, or is this just a bug?</p>",
        "id": 429967675,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1711583263
    },
    {
        "content": "<p>This is not great, but not too surprising. The <code>variable</code> statements unfortunately can't be processed once and for all, but need to be re-elaborated, and this opens the door to bad situations like this.</p>\n<p>It is going to need to be addressed in intra-file parallelism, so we will get there eventually, but it's unlikely there'll be a fast fix for this one, unfortunately. (It is \"just\" a bug!)</p>\n<p>I guess in the meantime my suggestion is to keep your category theory code and meta code separate, and avoid opening both <code>Category</code>s at once! :-)</p>",
        "id": 429968148,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1711583547
    },
    {
        "content": "<p>Alright, just wanted to make sure I wasn't going mad :p. Thanks!</p>",
        "id": 429977738,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1711589917
    }
]