[
    {
        "content": "<p>Nixpkgs (b8697e57f10292a6165a20f03d2f42920dfaf973) elan 3.1.0/3.1.1 is having problems after <a href=\"https://github.com/leanprover/elan/pull/121\">elan#121</a> because the wrapper generated by <code>nix_patch_if_needed</code> points to the temporary location files are now extracted to, not to their final destination. Output of <code>lake exe cache get</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">downloading</span> <span class=\"n\">component</span> <span class=\"bp\">'</span><span class=\"n\">lean'</span>\n<span class=\"n\">Total</span><span class=\"o\">:</span> <span class=\"mi\">168</span><span class=\"bp\">.</span><span class=\"mi\">9</span> <span class=\"n\">MiB</span> <span class=\"n\">Speed</span><span class=\"o\">:</span>  <span class=\"mi\">25</span><span class=\"bp\">.</span><span class=\"mi\">9</span> <span class=\"n\">MiB</span><span class=\"bp\">/</span><span class=\"n\">s</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">installing</span> <span class=\"n\">component</span> <span class=\"bp\">'</span><span class=\"n\">lean'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"o\">[</span><span class=\"mi\">2</span><span class=\"bp\">/</span><span class=\"mi\">9</span><span class=\"o\">]</span> <span class=\"n\">Compiling</span> <span class=\"n\">Cache.IO</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"o\">[</span><span class=\"mi\">3</span><span class=\"bp\">/</span><span class=\"mi\">9</span><span class=\"o\">]</span> <span class=\"n\">Compiling</span> <span class=\"n\">Cache.Hashing</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"o\">[</span><span class=\"mi\">4</span><span class=\"bp\">/</span><span class=\"mi\">9</span><span class=\"o\">]</span> <span class=\"n\">Compiling</span> <span class=\"n\">Cache.Requests</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"bp\">&gt;</span> <span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">collares</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.7.0-rc2/bin/leanc -c -o ./.lake/build/ir/Cache/IO.c.o ./.lake/build/ir/Cache/IO.c -O3 -DNDEBUG</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">stderr</span><span class=\"o\">:</span>\n<span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">collares</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.7.0-rc2/bin/leanc: line 2: /home/collares/.elan/toolchains/leanprover--lean4---v4.7.tmp/bin/leanc.orig: No such file or directory</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">external</span> <span class=\"n\">command</span> <span class=\"bp\">`/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">collares</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.7.0-rc2/bin/leanc` exited with code 127</span>\n</code></pre></div>\n<p>See also:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">$</span> <span class=\"n\">cat</span> <span class=\"bp\">~/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.7.0-rc1/bin/leanc</span>\n<span class=\"bp\">#!</span> <span class=\"bp\">/</span><span class=\"n\">nix</span><span class=\"bp\">/</span><span class=\"n\">store</span><span class=\"bp\">/</span><span class=\"mi\">087167</span><span class=\"n\">dfxal194pm54cmcbbxsfy3cjgn</span><span class=\"bp\">-</span><span class=\"n\">bash</span><span class=\"bp\">-</span><span class=\"mi\">5</span><span class=\"bp\">.</span><span class=\"mi\">2</span><span class=\"n\">p26</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"n\">bash</span>\n<span class=\"n\">LEAN_CC</span><span class=\"bp\">=</span><span class=\"s2\">\"${LEAN_CC:-/nix/store/ln6zld1ia7rxddmxgbpfhrmb42rbxdw8-gcc-wrapper-13.2.0/bin/cc}\"</span> <span class=\"n\">exec</span> <span class=\"bp\">-</span><span class=\"n\">a</span> <span class=\"s2\">\"$0\"</span> <span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">collares</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.7.tmp/bin/leanc.orig \"$@\" -L /home/collares/.elan/toolchains/leanprover--lean4---v4.7.tmp/lib  # use bundled libraries, but not bundled compiler that doesn't know about NIX_LDFLAGS</span>\n</code></pre></div>",
        "id": 425067332,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1709725549
    },
    {
        "content": "<p>I can't see anything strange about the v4.7.0-rc2 release... the diff from v4.7.0-rc1 is quite small.</p>",
        "id": 425067993,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1709725784
    },
    {
        "content": "<p>Sorry, you're right! I thought I had deleted the <code>.lake</code> directory but I didn't. This also affects v4.7.0-rc1, and I didn't notice because I used an older elan to install -rc1. This is fallout from <a href=\"https://github.com/leanprover/elan/pull/121\">elan#121</a>. Edited my initial post to reflect this.</p>",
        "id": 425068767,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1709726058
    },
    {
        "content": "<p>Can we use a relative path?</p>",
        "id": 425075963,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1709728636
    },
    {
        "content": "<p>I think I just ran into this. Is someone working on this? (Using <code>elan</code> from nixpkgs stable for now.)</p>",
        "id": 425276839,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1709808759
    },
    {
        "content": "<p><a href=\"https://github.com/NixOS/nixpkgs/pull/289941#issuecomment-1981132915\">https://github.com/NixOS/nixpkgs/pull/289941#issuecomment-1981132915</a> suggested temporarily reverting the temp dir change, while the relative path change is not implemented.</p>",
        "id": 425277680,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1709809061
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110024\">Sebastian Ullrich</span> <a href=\"#narrow/stream/270676-lean4/topic/elan.203.2E1.2E0.2F3.2E1.2E1.20on.20Nixpkgs/near/425075963\">said</a>:</p>\n<blockquote>\n<p>Can we use a relative path?</p>\n</blockquote>\n<p>Probably not trivially, as the <code>leanc</code> will be called from other places, but the usual dance with</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">parent_path</span><span class=\"bp\">=</span><span class=\"s2\">\"$(dirname \"</span><span class=\"bp\">$</span><span class=\"o\">{</span><span class=\"n\">BASH_SOURCE</span><span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"o\">]}</span><span class=\"s2\">\")\"</span>\n</code></pre></div>\n<p>and then using that path below should work.</p>",
        "id": 425680729,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1709985493
    },
    {
        "content": "<p><a href=\"https://github.com/NixOS/nixpkgs/pull/294514\">https://github.com/NixOS/nixpkgs/pull/294514</a></p>",
        "id": 425693660,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1709996668
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span> <a href=\"#narrow/stream/270676-lean4/topic/elan.203.2E1.2E0.2F3.2E1.2E1.20on.20Nixpkgs/near/425276839\">said</a>:</p>\n<blockquote>\n<p>I think I just ran into this. Is someone working on this? (Using <code>elan</code> from nixpkgs stable for now.)</p>\n</blockquote>\n<p>(how) can I do this, while keeping the rest on unstable?</p>",
        "id": 425841411,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1710136692
    },
    {
        "content": "<p>This is fixed on unstable now</p>",
        "id": 425876705,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1710152354
    },
    {
        "content": "<p>(with the caveat that you have to manually uninstall \"bad\" toolchains and let the newest version of elan reinstall them)</p>",
        "id": 425927686,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1710169126
    }
]