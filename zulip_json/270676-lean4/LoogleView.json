[
    {
        "content": "<p>As of 0.0.162, the VS Code extension has a built-in <a href=\"https://github.com/leanprover/vscode-lean4/pull/469\">LoogleView</a> with unicode input support that can be opened using the 'Loogle: Search' command. Thanks to <span class=\"user-mention\" data-user-id=\"466334\">@Shreyas Srinivas</span> for developing the <a href=\"https://marketplace.visualstudio.com/items?itemName=ShreyasSrinivas.loogle-lean\">Loogle Lean extension</a> - it was very helpful for integrating this feature into the Lean VS Code extension.</p>\n<p><a href=\"/user_uploads/3121/ViMvkl3-js-ScR9S-QexjBJc/Recording-2024-06-14-at-19.16.47.gif\">Recording-2024-06-14-at-19.16.47.gif</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/ViMvkl3-js-ScR9S-QexjBJc/Recording-2024-06-14-at-19.16.47.gif\" title=\"Recording-2024-06-14-at-19.16.47.gif\"><img src=\"/user_uploads/3121/ViMvkl3-js-ScR9S-QexjBJc/Recording-2024-06-14-at-19.16.47.gif\"></a></div><p>Another result of this is that the unicode input mechanism of the VS Code extension has been factored out into a separate TypeScript component and can now be installed from NPM if you want to implement your own unicode input mechanisms that are similar to the one in VS Code. The logic of the LoogleView unicode input component has also been factored out into a separate package if you simply want to use a HTML input component that supports unicode input.</p>\n<p>The packages can be found here:</p>\n<ul>\n<li>Unicode input logic: <a href=\"https://www.npmjs.com/package/@leanprover/unicode-input\">https://www.npmjs.com/package/@leanprover/unicode-input</a></li>\n<li>Unicode input component: <a href=\"https://www.npmjs.com/package/@leanprover/unicode-input-component\">https://www.npmjs.com/package/@leanprover/unicode-input-component</a></li>\n</ul>",
        "id": 445326343,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1718707781
    },
    {
        "content": "<p>Two questions: Doesn't this override the loogle lean extension's shortcut <code>Ctrl+Shift+L</code>?</p>",
        "id": 445327171,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1718708116
    },
    {
        "content": "<p>And is that extension still useful for its different workflow?</p>",
        "id": 445327210,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1718708136
    },
    {
        "content": "<p>I personally use it for quick inserts of defs</p>",
        "id": 445327238,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1718708148
    },
    {
        "content": "<p>One possibility is that I could integrate the quick search workflow into the vscode extension</p>",
        "id": 445327599,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1718708282
    },
    {
        "content": "<p>Are there plans to use these unicode packages in doc-gen's search?</p>",
        "id": 445327686,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1718708314
    },
    {
        "content": "<p>Not right now no.</p>",
        "id": 445327818,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1718708362
    },
    {
        "content": "<p>What would you want to use them for? All of the relevant definitions that you might search for should be ASCII shouldn't they?</p>",
        "id": 445327913,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1718708402
    },
    {
        "content": "<p>No, I often need to search for non-ascii names</p>",
        "id": 445328184,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1718708478
    },
    {
        "content": "<p>LinearMap.mk\\_2, CliffordAlgebra.\\iota_sq_scalar etc</p>",
        "id": 445328239,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1718708497
    },
    {
        "content": "<p>I see. I guess we could include it over some CDN. I would definitely want to avoid having NPM as a dependency for building doc-gen.</p>",
        "id": 445329776,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1718708985
    },
    {
        "content": "<p>Also, <span class=\"user-mention\" data-user-id=\"221921\">@Marc Huisinga</span> and <span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span>  : what's the preferrence for the loogle lean extension in general. I'd prefer to  leave it as it is (maybe add unicode support in the input but nothing more).</p>",
        "id": 445331142,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1718709309
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/stream/270676-lean4/topic/LoogleView/near/445327599\">said</a>:</p>\n<blockquote>\n<p>One possibility is that I could integrate the quick search workflow into the vscode extension</p>\n</blockquote>\n<p>I really like the quick pick dialog in principle but the fact that we can't properly make it support unicode input and the fact that it is relatively limited in terms of the available space for displaying types is a deal-breaker to me and why I went with a webview instead. The webview is certainly a bit more clunky in terms of input. I would prefer not to support multiple different ways to display loogle queries in the VS Code extension.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/stream/270676-lean4/topic/LoogleView/near/445327171\">said</a>:</p>\n<blockquote>\n<p>Two questions: Doesn't this override the loogle lean extension's shortcut <code>Ctrl+Shift+L</code>?</p>\n</blockquote>\n<p>Oh, sorry! I overlooked that the Loogle extension already had a keybind and apparently managed to choose the same one. Would you prefer me to change it to something else, or would you prefer to have the Loogle webview on <code>Ctrl+Shift+L</code>?</p>\n<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/stream/270676-lean4/topic/LoogleView/near/445331142\">said</a>:</p>\n<blockquote>\n<p>Also, <span class=\"user-mention silent\" data-user-id=\"221921\">Marc Huisinga</span> and <span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span>  : what's the preferrence for the loogle lean extension in general. I'd prefer to  leave it as it is (maybe add unicode support in the input but nothing more).</p>\n</blockquote>\n<p>I certainly don't mind it remaining available for people who prefer the alternative input.</p>",
        "id": 445334151,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1718710042
    },
    {
        "content": "<p>Right now, I have too much muscle memory for Ctrl + Shift + L</p>",
        "id": 445334354,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1718710089
    },
    {
        "content": "<p>Changing shortcuts on my extension would be too much breakage right now (at least for the 250 odd installed users)</p>",
        "id": 445334559,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1718710148
    },
    {
        "content": "<p>Ok, I'll see if I can find another good shortcut then.</p>",
        "id": 445334841,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1718710217
    },
    {
        "content": "<p>Thanks,</p>\n<p>Also, a couple of other points:</p>\n<ol>\n<li>the font size in the webview seems unaffected by the vscode font settings. So I get really tiny characters right now </li>\n<li>The content of the webview doesn't adjust to the size of the window. Because of this and the font issue it feels too cluttered.</li>\n</ol>",
        "id": 445335289,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1718710347
    },
    {
        "content": "<p>I suggest folding the usage instructions by default and centering the loogle search bar vertically in the page (or at least bringing it closer to the center)</p>",
        "id": 445335406,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1718710401
    },
    {
        "content": "<p>To give you an idea of what it looks like : <br>\n<a href=\"/user_uploads/3121/kqAE42ALqna0eZjKOSxrYLIV/Screenshot-from-2024-06-18-13-34-59.png\">Screenshot-from-2024-06-18-13-34-59.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/kqAE42ALqna0eZjKOSxrYLIV/Screenshot-from-2024-06-18-13-34-59.png\" title=\"Screenshot-from-2024-06-18-13-34-59.png\"><img src=\"/user_uploads/3121/kqAE42ALqna0eZjKOSxrYLIV/Screenshot-from-2024-06-18-13-34-59.png\"></a></div>",
        "id": 445335754,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1718710525
    },
    {
        "content": "<p>To be fair, I also have this font issue in my extension. At the moment you can get the full type signature  by hovering the mouse pointer over the type (vscode even staggers it nicely), but the font size is too small</p>",
        "id": 445336327,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1718710751
    },
    {
        "content": "<p>Another suggestion if I may: Could the results have some spacing between them? I tried to incorporate this by making module names appear in the second line and providing an option to turn that off. It has a nice effect on readability as in the screenshot<br>\n<a href=\"/user_uploads/3121/lT2NXNedomIPPHmhLp4Y7i5Z/Screenshot-from-2024-06-18-13-42-08.png\">Screenshot-from-2024-06-18-13-42-08.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/lT2NXNedomIPPHmhLp4Y7i5Z/Screenshot-from-2024-06-18-13-42-08.png\" title=\"Screenshot-from-2024-06-18-13-42-08.png\"><img src=\"/user_uploads/3121/lT2NXNedomIPPHmhLp4Y7i5Z/Screenshot-from-2024-06-18-13-42-08.png\"></a></div><p>But in a webview you might have more flexibility.</p>",
        "id": 445336621,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1718710861
    },
    {
        "content": "<p>The shortcut for the LoogleView will change to the <code>Ctrl+K Ctrl+S</code> chord.</p>\n<blockquote>\n<p>the font size in the webview seems unaffected by the vscode font settings. So I get really tiny characters right now</p>\n</blockquote>\n<p>Which font setting are you talking about, exactly? Regular WebView content is not supposed to be affected by your editor font size. It scales with the zoom level (like all other non-editor content in VS Code).</p>\n<blockquote>\n<p>The content of the webview doesn't adjust to the size of the window</p>\n</blockquote>\n<p>It does, but the <code>max-width</code> is too low. I'll remove it.</p>\n<blockquote>\n<p>I suggest folding the usage instructions by default and centering the loogle search bar vertically in the page (or at least bringing it closer to the center)</p>\n</blockquote>\n<p>I prefer it being left-aligned.</p>\n<blockquote>\n<p>Could the results have some spacing between them?</p>\n</blockquote>\n<p>I think that the highlighting on the link of the identifier is sufficient separation.</p>",
        "id": 445345044,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1718713766
    },
    {
        "content": "<p>Would be nice if it had \"locally installed only\" and \"project only\" modes through a locally run loogle instance. Also an ability to use it from side bar without obscuring the active tab, i.e like normal search in vscode.</p>",
        "id": 445355050,
        "sender_full_name": "Super Veridical",
        "timestamp": 1718716630
    },
    {
        "content": "<p>Random idea from my side for future work: maybe the extension could pass the list of open namespaces at the current cursor position to Loogle, so that queries don't have to qualify names. Especially when working on <code>open Lean</code> this would be very convenient.</p>",
        "id": 445357388,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1718717323
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"221921\">Marc Huisinga</span> <a href=\"#narrow/stream/270676-lean4/topic/LoogleView/near/445345044\">said</a>:</p>\n<blockquote>\n<p>Which font setting are you talking about, exactly? Regular WebView content is not supposed to be affected by your editor font size. It scales with the zoom level (like all other non-editor content in VS Code).</p>\n</blockquote>\n<p>The editor font. But it would be nice to have a font size setting for this webview. Currently on my screen it is too small.</p>\n<blockquote>\n<p>I prefer it being left-aligned.</p>\n</blockquote>\n<p>I am referring to vertical alignment. Currently the search bar is too far at the top and there is a lot of clutter with the usage info. Back in the stone age of the internet, google got this right by keeping the search page simple. The usage info is nice, but if it is collapsed and unfolded optionally and the search bar looks bigger and vertically centered, then it would be much easier to use.</p>",
        "id": 445372195,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1718720842
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"221921\">Marc Huisinga</span> <a href=\"#narrow/stream/270676-lean4/topic/LoogleView/near/445326343\">said</a>:</p>\n<blockquote>\n<p>Another result of this is that the unicode input mechanism of the VS Code extension has been factored out into a separate TypeScript component and can now be installed from NPM if you want to implement your own unicode input mechanisms that are similar to the one in VS Code. The logic of the LoogleView unicode input component has also been factored out into a separate package if you simply want to use a HTML input component that supports unicode input.</p>\n<p>The packages can be found here:</p>\n<ul>\n<li>Unicode input component: <a href=\"https://www.npmjs.com/package/@leanprover/unicode-input-component\">https://www.npmjs.com/package/@leanprover/unicode-input-component</a></li>\n</ul>\n</blockquote>\n<p>Thanks, <span class=\"user-mention\" data-user-id=\"221921\">@Marc Huisinga</span>! I already successfully added this to the react app behind the NNG! One issue I have currently is that on entering a space, the cursor jumps back to the beginning of the input. This also happens on successful completion with the option <code>eagerReplacementEnabled: true</code> set.</p>\n<p>I haven't minimised it yet, so I can't completely exclude that it's a problem with my setup, but I was wondering if you maybe had a small template you used for testing which I could use to create a MWE?</p>",
        "id": 445384848,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1718723600
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/vscode-lean4/blob/79c2e39ba34fdecf545fb3f23aec2c6aa014cd88/vscode-lean4/loogleview/index.ts#L94\">https://github.com/leanprover/vscode-lean4/blob/79c2e39ba34fdecf545fb3f23aec2c6aa014cd88/vscode-lean4/loogleview/index.ts#L94</a><br>\n<a href=\"https://github.com/leanprover/vscode-lean4/blob/79c2e39ba34fdecf545fb3f23aec2c6aa014cd88/vscode-lean4/loogleview/static/index.html#L4\">https://github.com/leanprover/vscode-lean4/blob/79c2e39ba34fdecf545fb3f23aec2c6aa014cd88/vscode-lean4/loogleview/static/index.html#L4</a></p>",
        "id": 445404534,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1718727707
    },
    {
        "content": "<p>My first guess without having looked at any code is that React is probably allergic to the kind of <a href=\"https://github.com/leanprover/vscode-lean4/blob/79c2e39ba34fdecf545fb3f23aec2c6aa014cd88/lean4-unicode-input-component/src/index.ts#L122\">window selection mutation</a> that is needed to ensure that the cursor is at the right position after replacing the abbreviation and when inserting underline tags (since the cursor will otherwise just reset to the start), and that you may need to work around that somehow (e.g. using effects?).</p>",
        "id": 445419807,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1718731931
    },
    {
        "content": "<p>Asking out of complete ignorance (I still grep :-), what does \"Loogle Lean\" extension offer now? Can we consolidate on a single solution here, e.g. by providing notifications suggesting using the built-in Loogle view, and then deprecating the extension?</p>",
        "id": 445758453,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1718858453
    },
    {
        "content": "<p>In place search, quick insert and copy. Basically a very different UI.</p>",
        "id": 445759171,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1718859081
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"221921\">Marc Huisinga</span> <a href=\"#narrow/stream/270676-lean4/topic/LoogleView/near/445334151\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/stream/270676-lean4/topic/LoogleView/near/445327599\">said</a>:</p>\n<blockquote>\n<p>One possibility is that I could integrate the quick search workflow into the vscode extension</p>\n</blockquote>\n<p>I really like the quick pick dialog in principle but the fact that we can't properly make it support unicode input and the fact that it is relatively limited in terms of the available space for displaying types is a deal-breaker to me and why I went with a webview instead. The webview is certainly a bit more clunky in terms of input. I would prefer not to support multiple different ways to display loogle queries in the VS Code extension.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/stream/270676-lean4/topic/LoogleView/near/445327171\">said</a>:</p>\n<blockquote>\n<p>Two questions: Doesn't this override the loogle lean extension's shortcut <code>Ctrl+Shift+L</code>?</p>\n</blockquote>\n<p>Oh, sorry! I overlooked that the Loogle extension already had a keybind and apparently managed to choose the same one. Would you prefer me to change it to something else, or would you prefer to have the Loogle webview on <code>Ctrl+Shift+L</code>?</p>\n<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/stream/270676-lean4/topic/LoogleView/near/445331142\">said</a>:</p>\n<blockquote>\n<p>Also, <span class=\"user-mention silent\" data-user-id=\"221921\">Marc Huisinga</span> and <span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span>  : what's the preferrence for the loogle lean extension in general. I'd prefer to  leave it as it is (maybe add unicode support in the input but nothing more).</p>\n</blockquote>\n<p>I certainly don't mind it remaining available for people who prefer the alternative input.</p>\n</blockquote>\n<p>We discussed it here</p>",
        "id": 445759188,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1718859104
    },
    {
        "content": "<p>When <span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span> and I were adding Unicode input support to the Loogle website, we noticed that the Unicode input component does not work out of the box on Firefox because Firefox will insert <code>&lt;br&gt;</code> tags into <code>contenteditable</code> divs when adding a space.<br>\nYou can fix this by adding <code>white-space: -moz-pre-space;</code> to the style of the <code>contenteditable</code> div.</p>",
        "id": 446043718,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1718962126
    }
]