[
    {
        "content": "<p>If I create a new package with <code>lake</code> and follow the instructions from the doc-gen4 repo, I get the following error:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>chenson@pop-os:~/git$<span class=\"w\"> </span>lake<span class=\"w\"> </span>new<span class=\"w\"> </span>docs_mwe\nchenson@pop-os:~/git$<span class=\"w\"> </span><span class=\"nb\">cd</span><span class=\"w\"> </span>docs_mwe/\nchenson@pop-os:~/git/docs_mwe$<span class=\"w\"> </span>vim<span class=\"w\"> </span>lakefile.lean\nchenson@pop-os:~/git/docs_mwe$<span class=\"w\"> </span>lake<span class=\"w\"> </span>-R<span class=\"w\"> </span>-Kenv<span class=\"o\">=</span>dev<span class=\"w\"> </span>update\n«doc-gen4»:<span class=\"w\"> </span>cloning<span class=\"w\"> </span>https://github.com/leanprover/doc-gen4<span class=\"w\"> </span>to<span class=\"w\"> </span><span class=\"s1\">'./.lake/packages/doc-gen4'</span>\nwarning:<span class=\"w\"> </span>«doc-gen4»:<span class=\"w\"> </span>ignoring<span class=\"w\"> </span>dependency<span class=\"w\"> </span>manifest<span class=\"w\"> </span>because<span class=\"w\"> </span>it<span class=\"w\"> </span>failed<span class=\"w\"> </span>to<span class=\"w\"> </span>load:<span class=\"w\"> </span>./.lake/packages/doc-gen4/lake-manifest.json:<span class=\"w\"> </span>unknown<span class=\"w\"> </span>manifest<span class=\"w\"> </span>version<span class=\"w\"> </span><span class=\"s1\">'\"1.0.0\"'</span>\nMD4Lean:<span class=\"w\"> </span>cloning<span class=\"w\"> </span>https://github.com/acmepjz/md4lean<span class=\"w\"> </span>to<span class=\"w\"> </span><span class=\"s1\">'./.lake/packages/MD4Lean'</span>\nUnicodeBasic:<span class=\"w\"> </span>cloning<span class=\"w\"> </span>https://github.com/fgdorais/lean4-unicode-basic<span class=\"w\"> </span>to<span class=\"w\"> </span><span class=\"s1\">'./.lake/packages/UnicodeBasic'</span>\nCli:<span class=\"w\"> </span>cloning<span class=\"w\"> </span>https://github.com/mhuisi/lean4-cli<span class=\"w\"> </span>to<span class=\"w\"> </span><span class=\"s1\">'./.lake/packages/Cli'</span>\nerror:<span class=\"w\"> </span>./.lake/packages/MD4Lean/lakefile.lean:12:53:<span class=\"w\"> </span>error:<span class=\"w\"> </span><span class=\"k\">function</span><span class=\"w\"> </span>expected<span class=\"w\"> </span>at\n<span class=\"w\">  </span>FetchM\nterm<span class=\"w\"> </span>has<span class=\"w\"> </span><span class=\"nb\">type</span>\n<span class=\"w\">  </span>?m.155\nerror:<span class=\"w\"> </span>./.lake/packages/MD4Lean/lakefile.lean:25:37:<span class=\"w\"> </span>error:<span class=\"w\"> </span><span class=\"k\">function</span><span class=\"w\"> </span>expected<span class=\"w\"> </span>at\n<span class=\"w\">  </span>FetchM\nterm<span class=\"w\"> </span>has<span class=\"w\"> </span><span class=\"nb\">type</span>\n<span class=\"w\">  </span>?m.197\nwarning:<span class=\"w\"> </span>./.lake/packages/MD4Lean/lakefile.lean:43:11:<span class=\"w\"> </span>warning:<span class=\"w\"> </span>declaration<span class=\"w\"> </span>uses<span class=\"w\"> </span><span class=\"s1\">'sorry'</span>\nerror:<span class=\"w\"> </span>./.lake/packages/MD4Lean/lakefile.lean:<span class=\"w\"> </span>package<span class=\"w\"> </span>configuration<span class=\"w\"> </span>has<span class=\"w\"> </span>errors\n</code></pre></div>\n<p>This is what  <code>lakefile.lean</code> looks like, everything else untouched:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lake</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lake</span><span class=\"w\"> </span><span class=\"n\">DSL</span>\n\n<span class=\"c1\">-- added this based on doc-gen4 instructions</span>\n<span class=\"n\">meta</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">get_config?</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"s2\">\"dev\"</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"c1\">-- dev is so not everyone has to build it</span>\n<span class=\"n\">require</span><span class=\"w\"> </span><span class=\"bp\">«</span><span class=\"n\">doc</span><span class=\"bp\">-</span><span class=\"n\">gen4</span><span class=\"bp\">»</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/leanprover/doc-gen4\"</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"w\"> </span><span class=\"s2\">\"main\"</span>\n\n<span class=\"n\">package</span><span class=\"w\"> </span><span class=\"bp\">«</span><span class=\"n\">docs_mwe</span><span class=\"bp\">»</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"c1\">-- add package configuration options here</span>\n\n<span class=\"n\">lean_lib</span><span class=\"w\"> </span><span class=\"bp\">«</span><span class=\"n\">DocsMwe</span><span class=\"bp\">»</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"c1\">-- add library configuration options here</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">default_target</span><span class=\"kd\">]</span>\n<span class=\"n\">lean_exe</span><span class=\"w\"> </span><span class=\"bp\">«</span><span class=\"n\">docs_mwe</span><span class=\"bp\">»</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">root</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"ss\">`Main</span>\n</code></pre></div>",
        "id": 447279761,
        "sender_full_name": "Chris Henson",
        "timestamp": 1719422474
    },
    {
        "content": "<p>Most likely using an outdated lean version</p>",
        "id": 447281916,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1719422975
    },
    {
        "content": "<p>(i.e., please paste the contents of <code>lean-toolchain</code> as well)</p>",
        "id": 447283100,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1719423243
    },
    {
        "content": "<p>This is what I'm using:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>chenson@pop-os:~/git/docs_mwe$<span class=\"w\"> </span>lake<span class=\"w\"> </span>--version\nLake<span class=\"w\"> </span>version<span class=\"w\"> </span><span class=\"m\">5</span>.0.0-6fce8f7<span class=\"w\"> </span><span class=\"o\">(</span>Lean<span class=\"w\"> </span>version<span class=\"w\"> </span><span class=\"m\">4</span>.7.0<span class=\"o\">)</span>\nchenson@pop-os:~/git/docs_mwe$<span class=\"w\"> </span>cat<span class=\"w\"> </span>lean-toolchain\nstable\n</code></pre></div>\n<p>I use the nix package for <code>elan</code>, could it maybe be a bit outdated?</p>",
        "id": 447284232,
        "sender_full_name": "Chris Henson",
        "timestamp": 1719423511
    },
    {
        "content": "<p><code>stable</code> means \"whatever was the stable version when you first downloaded it, unless you explicitly updated it by running <code>elan update stable</code>\". It's best to look at what doc-gen4 has in its lean-toolchain file and copy that explicitly</p>",
        "id": 447286236,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1719423918
    },
    {
        "content": "<p>(this behavior will change in a future version of <code>elan</code>, if I understand correctly)</p>",
        "id": 447286386,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1719423947
    },
    {
        "content": "<p><code>leanprover/lean4:v4.9.0-rc1</code> is what doc-gen is using (though probably you should go with <code>leanprover/lean4:v4.9.0-rc3</code> since not much changes between release candidates and you get a few bugfixes for free)</p>",
        "id": 447286917,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1719424049
    },
    {
        "content": "<p>Thanks, all good now! I didn't understand the meaning of stable there.</p>",
        "id": 447289938,
        "sender_full_name": "Chris Henson",
        "timestamp": 1719424772
    }
]