[
    {
        "content": "<p>Something seems to have changed with the selection behavior of code blocks. If I copy and paste the lines:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">def</span> <span class=\"n\">foo</span> <span class=\"o\">:=</span> <span class=\"mi\">1</span>\n<span class=\"kd\">def</span> <span class=\"n\">bar</span> <span class=\"o\">:=</span> <span class=\"mi\">2</span>\n</code></pre></div>\n<p>including previous text, I get</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">Something</span> <span class=\"n\">seems</span> <span class=\"n\">to</span> <span class=\"k\">have</span> <span class=\"n\">changed</span> <span class=\"k\">with</span> <span class=\"n\">the</span> <span class=\"n\">selection</span> <span class=\"n\">behavior</span> <span class=\"n\">of</span> <span class=\"n\">code</span> <span class=\"n\">blocks.</span> <span class=\"n\">If</span> <span class=\"n\">I</span> <span class=\"n\">copy</span> <span class=\"n\">and</span> <span class=\"n\">paste</span> <span class=\"n\">the</span> <span class=\"n\">lines</span><span class=\"o\">:</span>\n\n\n\n<span class=\"kd\">def</span> <span class=\"n\">foo</span> <span class=\"o\">:=</span> <span class=\"mi\">1</span>\n<span class=\"kd\">def</span> <span class=\"n\">bar</span> <span class=\"o\">:=</span> <span class=\"mi\">2</span>\n</code></pre></div>\n<p>where there are three blank lines before the code starts. When I select just the code I can sometimes get two blank lines before the code starts, and in other posts I've seen 5 lines and some whitespace too. This wasn't happening until recently. (I know, there is a \"copy code\" button I should probably be using instead, but this is weird anyway.)</p>",
        "id": 429159933,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711260566
    },
    {
        "content": "<p>On Chrome I get just one blank line</p>",
        "id": 429519023,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1711404283
    },
    {
        "content": "<p>One thing that changed recently is that you can now select part of the original message, and the \"quote and reply\" button will quote just that part.</p>",
        "id": 429519068,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1711404307
    },
    {
        "content": "<p>On Firefox (124, macOS) I also just get one:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">Something</span> <span class=\"n\">seems</span> <span class=\"n\">to</span> <span class=\"k\">have</span> <span class=\"n\">changed</span> <span class=\"k\">with</span> <span class=\"n\">the</span> <span class=\"n\">selection</span> <span class=\"n\">behavior</span> <span class=\"n\">of</span> <span class=\"n\">code</span> <span class=\"n\">blocks.</span> <span class=\"n\">If</span> <span class=\"n\">I</span> <span class=\"n\">copy</span> <span class=\"n\">and</span> <span class=\"n\">paste</span> <span class=\"n\">the</span> <span class=\"n\">lines</span><span class=\"o\">:</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">foo</span> <span class=\"o\">:=</span> <span class=\"mi\">1</span>\n<span class=\"kd\">def</span> <span class=\"n\">bar</span> <span class=\"o\">:=</span> <span class=\"mi\">2</span>\n</code></pre></div>",
        "id": 429520835,
        "sender_full_name": "Julian Berman",
        "timestamp": 1711405276
    },
    {
        "content": "<p>tried it again just now and got 6 blank lines (FF 123 + ubuntu)</p>",
        "id": 429520997,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711405367
    },
    {
        "content": "<p>tried it in chromium and got 2 blank lines</p>",
        "id": 429521308,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711405570
    },
    {
        "content": "<p>did it again and got 1.. what the heck</p>",
        "id": 429521414,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711405633
    },
    {
        "content": "<p>I've narrowed it down to the usage of <code>display: flex</code> in the <code>div class=\"code-buttons-container\"</code> used for holding the \"copy code\" and \"view in playground\" buttons. Even if I delete the contents of the div (those two buttons), I still get 3 blank lines, but if I disable <code>display: flex</code> then I get 1 blank line in the selection</p>",
        "id": 429522727,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711406461
    },
    {
        "content": "<p>Oh, I figured out at least a bit of the nondeterminism here: if I do the selection from top to bottom (shift-click body text, drag over code) then I get 2 blank lines, while if I do it the other way around (shift-click code, drag to body text) then I get 1 blank line in chromium. My guess is that this is because what gets copied depends on the display elements visible at the time I type ctrl-C, i.e. whether I'm currently hovering over the code such that the code buttons are visible</p>",
        "id": 429523566,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711406925
    },
    {
        "content": "<p>doing likewise in FF reveals 3 blank lines when the code buttons are not hovered and 6 blank lines when they are</p>",
        "id": 429523750,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1711407013
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/236604-Zulip-meta/topic/Copying.20code.20now.20produces.20several.20blank.20lines/near/429523566\">said</a>:</p>\n<blockquote>\n<p>I figured out at least a bit of the nondeterminism here: if I do the selection from top to bottom (shift-click body text, drag over code) then I get 2 blank lines, while if I do it the other way around (shift-click code, drag to body text) then I get 1 blank line in chromium</p>\n</blockquote>\n<p>Can reproduce on Chrome on macOS</p>",
        "id": 429524174,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1711407207
    },
    {
        "content": "<p>Thanks for the report! We implemented formatted text pasting fairly recently, so there may be kinks to iron out.</p>\n<p>In the mean time, you can paste as plain text whenever that seems better (Ctrl-Shift-V, or the finger-tangling Option+Shift+Command+V on a Mac).</p>",
        "id": 429553082,
        "sender_full_name": "Alya Abbott",
        "timestamp": 1711427813
    }
]