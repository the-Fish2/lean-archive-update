[
    {
        "content": "<p>I was looking at <a href=\"https://github.com/leanprover-community/mathlib4/pull/13032\">#13032</a> . In this, <span class=\"user-mention\" data-user-id=\"479359\">@Michael Stoll</span> increases the priority of <a href=\"http://Algebra.id\">Algebra.id</a> . The idea is that the obvious instance <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Algebra.id#doc\">docs#Algebra.id</a> of type <code>Algebra R R</code> should hopefully be quick to fail (is this right? Typeclass inference only uses a weak quick-to-fail <code>rfl</code>, right?) so there's no harm in trying it first rather than last (it is the first-declared instance of <code>Algebra X Y</code> declared in mathlib so the typeclass algorithm places it at the back of the  queue behind all other default prio Algebra instances in mathlib; the PR is arguing that it should be at the front). </p>\n<p>The change broke mathlib in two places. One of them was <code>Mathlib/RingTheory/Jacobson.lean</code>, where the proof of the (private, although this is not the issue) theorem <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=quotient_mk_comp_C_isIntegral_of_jacobson%27#doc\">docs#quotient_mk_comp_C_isIntegral_of_jacobson'</a> broke. At a point where the goal was </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">⊢</span> <span class=\"o\">(</span><span class=\"n\">quotientMap</span> <span class=\"n\">P</span> <span class=\"n\">C</span> <span class=\"n\">_</span> <span class=\"o\">:</span> <span class=\"n\">R</span> <span class=\"bp\">⧸</span> <span class=\"n\">comap</span> <span class=\"n\">C</span> <span class=\"n\">P</span> <span class=\"bp\">→+*</span> <span class=\"n\">R</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span> <span class=\"bp\">⧸</span> <span class=\"n\">P</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">IsIntegral</span>\n</code></pre></div>\n<p>the tactic</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code>  <span class=\"n\">refine'</span> <span class=\"n\">RingHom.IsIntegral.tower_bot</span> <span class=\"n\">φ</span> <span class=\"o\">(</span><span class=\"n\">algebraMap</span> <span class=\"n\">_</span> <span class=\"o\">(</span><span class=\"n\">Localization</span> <span class=\"n\">M'</span><span class=\"o\">))</span> <span class=\"n\">_</span> <span class=\"n\">_</span>\n</code></pre></div>\n<p>was breaking. At first glance you can imagine that something involving <code>algebraMap _ X</code> could well be affected by a change to <code>Algebra.id : algebraMap R R</code> on the basis that it might apply (I am reminded of <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> 's comment to me years ago when I asked them whether one should fill in underscores or not, when we know what they are, and they replied that it was probably good practice, although I think that leaving easy-to-fill-in underscores is part of \"golf culture\" so of course they plague mathlib). I figured out the underscore manually (it was <code>R[X] ⧸ P</code>) and filled it in. <span class=\"user-mention\" data-user-id=\"307953\">@Ruben Van de Velde</span> then benchmarked the PR and there was a 10% reduction in the file speed!</p>\n<p>This inspired me to look at some traces, so I started with dumping <code>set_option trace.profiler true in</code> before the proof of the theorem, and then I kept opening the trace following it towards the <code>refine'</code> line, which was indeed looking like it was taking a suspicious amount of time:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code>      <span class=\"o\">[]</span> <span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"bp\">.</span><span class=\"mi\">882695</span><span class=\"o\">]</span> <span class=\"n\">refine'</span> <span class=\"n\">RingHom.IsIntegral.tower_bot</span> <span class=\"n\">φ</span> <span class=\"o\">(</span><span class=\"n\">algebraMap</span> <span class=\"n\">_</span> <span class=\"o\">(</span><span class=\"n\">Localization</span> <span class=\"n\">M'</span><span class=\"o\">))</span> <span class=\"n\">_</span> <span class=\"n\">_</span>  <span class=\"bp\">▶</span>\n</code></pre></div>\n<p>which turned into a </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code>              <span class=\"o\">[</span><span class=\"n\">Meta.synthInstance</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"bp\">.</span><span class=\"mi\">796256</span><span class=\"o\">]</span> <span class=\"bp\">💥</span> <span class=\"n\">CommSemiring</span> <span class=\"bp\">?</span><span class=\"n\">m.264932</span>  <span class=\"bp\">▶</span>\n</code></pre></div>\n<p>Intrigued, I clicked onto the triangle to see what was causing the explosion, and VS Code crashed. </p>\n<p>So I compiled the file through lake on the command line and piped the output to a file. It was 19 megabytes long. This is completely absurd. My first question is: is there a way to profile every declaration in mathlib like this, and flag proofs whose traces turn out to be 19 megabytes long?</p>\n<p>I'm currently trying to make sense of the trace. Most of it seems to be really really really long lines which start</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code>                <span class=\"o\">[</span><span class=\"n\">Meta.synthInstance</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"bp\">.</span><span class=\"mi\">010800</span><span class=\"o\">]</span> <span class=\"bp\">✅</span> <span class=\"n\">apply</span> <span class=\"bp\">@</span><span class=\"k\">Pi</span><span class=\"bp\">.</span><span class=\"n\">commSemiring</span> <span class=\"n\">to</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">:</span> <span class=\"bp\">?</span><span class=\"n\">m.265071</span><span class=\"o\">)</span> <span class=\"bp\">→</span>\n                      <span class=\"o\">(</span><span class=\"n\">i_1</span> <span class=\"o\">:</span> <span class=\"bp\">?</span><span class=\"n\">m.265127</span> <span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"bp\">→</span>\n                        <span class=\"o\">(</span><span class=\"n\">i_2</span> <span class=\"o\">:</span> <span class=\"bp\">?</span><span class=\"n\">m.265191</span> <span class=\"n\">i</span> <span class=\"n\">i_1</span><span class=\"o\">)</span> <span class=\"bp\">→</span>\n                          <span class=\"o\">(</span><span class=\"n\">i_3</span> <span class=\"o\">:</span> <span class=\"bp\">?</span><span class=\"n\">m.265263</span> <span class=\"n\">i</span> <span class=\"n\">i_1</span> <span class=\"n\">i_2</span><span class=\"o\">)</span> <span class=\"bp\">→</span>\n                            <span class=\"o\">(</span><span class=\"n\">i_4</span> <span class=\"o\">:</span> <span class=\"bp\">?</span><span class=\"n\">m.265343</span> <span class=\"n\">i</span> <span class=\"n\">i_1</span> <span class=\"n\">i_2</span> <span class=\"n\">i_3</span><span class=\"o\">)</span> <span class=\"bp\">→</span>\n                              <span class=\"o\">(</span><span class=\"n\">i_5</span> <span class=\"o\">:</span> <span class=\"bp\">?</span><span class=\"n\">m.265431</span> <span class=\"n\">i</span> <span class=\"n\">i_1</span> <span class=\"n\">i_2</span> <span class=\"n\">i_3</span> <span class=\"n\">i_4</span><span class=\"o\">)</span> <span class=\"bp\">→</span>\n                                <span class=\"o\">(</span><span class=\"n\">i_6</span> <span class=\"o\">:</span> <span class=\"bp\">?</span><span class=\"n\">m.265527</span> <span class=\"n\">i</span> <span class=\"n\">i_1</span> <span class=\"n\">i_2</span> <span class=\"n\">i_3</span> <span class=\"n\">i_4</span> <span class=\"n\">i_5</span><span class=\"o\">)</span> <span class=\"bp\">→</span>\n                                  <span class=\"o\">(</span><span class=\"n\">i_7</span> <span class=\"o\">:</span> <span class=\"bp\">?</span><span class=\"n\">m.265631</span> <span class=\"n\">i</span> <span class=\"n\">i_1</span> <span class=\"n\">i_2</span> <span class=\"n\">i_3</span> <span class=\"n\">i_4</span> <span class=\"n\">i_5</span> <span class=\"n\">i_6</span><span class=\"o\">)</span> <span class=\"bp\">→</span>\n                                    <span class=\"o\">(</span><span class=\"n\">i_8</span> <span class=\"o\">:</span> <span class=\"bp\">?</span><span class=\"n\">m.265743</span> <span class=\"n\">i</span> <span class=\"n\">i_1</span> <span class=\"n\">i_2</span> <span class=\"n\">i_3</span> <span class=\"n\">i_4</span> <span class=\"n\">i_5</span> <span class=\"n\">i_6</span> <span class=\"n\">i_7</span><span class=\"o\">)</span> <span class=\"bp\">→</span>\n                                      <span class=\"o\">(</span><span class=\"n\">i_9</span> <span class=\"o\">:</span> <span class=\"bp\">?</span><span class=\"n\">m.265863</span> <span class=\"n\">i</span> <span class=\"n\">i_1</span> <span class=\"n\">i_2</span> <span class=\"n\">i_3</span> <span class=\"n\">i_4</span> <span class=\"n\">i_5</span> <span class=\"n\">i_6</span> <span class=\"n\">i_7</span> <span class=\"n\">i_8</span><span class=\"o\">)</span> <span class=\"bp\">→</span>\n                                        <span class=\"o\">(</span><span class=\"n\">i_10</span> <span class=\"o\">:</span> <span class=\"bp\">?</span><span class=\"n\">m.265991</span> <span class=\"n\">i</span> <span class=\"n\">i_1</span> <span class=\"n\">i_2</span> <span class=\"n\">i_3</span> <span class=\"n\">i_4</span> <span class=\"n\">i_5</span> <span class=\"n\">i_6</span> <span class=\"n\">i_7</span> <span class=\"n\">i_8</span> <span class=\"n\">i_9</span><span class=\"o\">)</span> <span class=\"bp\">→</span>\n                                          <span class=\"o\">(</span><span class=\"n\">i_11</span> <span class=\"o\">:</span> <span class=\"bp\">?</span><span class=\"n\">m.266127</span> <span class=\"n\">i</span> <span class=\"n\">i_1</span> <span class=\"n\">i_2</span> <span class=\"n\">i_3</span> <span class=\"n\">i_4</span> <span class=\"n\">i_5</span> <span class=\"n\">i_6</span> <span class=\"n\">i_7</span> <span class=\"n\">i_8</span> <span class=\"n\">i_9</span> <span class=\"n\">i_10</span><span class=\"o\">)</span> <span class=\"bp\">→</span>\n                                            <span class=\"o\">(</span><span class=\"n\">i_12</span> <span class=\"o\">:</span> <span class=\"bp\">?</span><span class=\"n\">m.266271</span> <span class=\"n\">i</span> <span class=\"n\">i_1</span> <span class=\"n\">i_2</span> <span class=\"n\">i_3</span> <span class=\"n\">i_4</span> <span class=\"n\">i_5</span> <span class=\"n\">i_6</span> <span class=\"n\">i_7</span> <span class=\"n\">i_8</span> <span class=\"n\">i_9</span> <span class=\"n\">i_10</span> <span class=\"n\">i_11</span><span class=\"o\">)</span> <span class=\"bp\">→</span>\n      <span class=\"bp\">...</span>\n</code></pre></div>\n<p>or</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code>                  <span class=\"o\">[</span><span class=\"n\">Meta.synthInstance.tryResolve</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"bp\">.</span><span class=\"mi\">012807</span><span class=\"o\">]</span> <span class=\"bp\">✅</span> <span class=\"n\">CommSemiring</span>\n                        <span class=\"o\">((</span><span class=\"n\">i_1</span> <span class=\"o\">:</span>\n                            <span class=\"bp\">?</span><span class=\"n\">m.316431</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁰⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁰⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁰³</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁰²</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁰¹</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁰⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹³</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹²</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹¹</span>\n                              <span class=\"n\">i</span><span class=\"bp\">✝⁹⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸³</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸²</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸¹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷³</span>\n                              <span class=\"n\">i</span><span class=\"bp\">✝⁷²</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷¹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶³</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶²</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶¹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵⁵</span>\n                              <span class=\"n\">i</span><span class=\"bp\">✝⁵⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵³</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵²</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵¹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴³</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴²</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴¹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝³⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝³⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝³⁷</span>\n                              <span class=\"n\">i</span><span class=\"bp\">✝³⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝³⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝³⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝³³</span> <span class=\"n\">i</span><span class=\"bp\">✝³²</span> <span class=\"n\">i</span><span class=\"bp\">✝³¹</span> <span class=\"n\">i</span><span class=\"bp\">✝³⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝²⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝²⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝²⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝²⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝²⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝²⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝²³</span> <span class=\"n\">i</span><span class=\"bp\">✝²²</span> <span class=\"n\">i</span><span class=\"bp\">✝²¹</span> <span class=\"n\">i</span><span class=\"bp\">✝²⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁹</span>\n                              <span class=\"n\">i</span><span class=\"bp\">✝¹⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝¹³</span> <span class=\"n\">i</span><span class=\"bp\">✝¹²</span> <span class=\"n\">i</span><span class=\"bp\">✝¹¹</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝³</span> <span class=\"n\">i</span><span class=\"bp\">✝²</span> <span class=\"n\">i</span><span class=\"bp\">✝¹</span> <span class=\"n\">i</span><span class=\"bp\">✝</span> <span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"bp\">→</span>\n</code></pre></div>\n<p>Again one could ask whether it's possible to ask Lean which proofs involve metavariables with the name <code>i✝³⁷</code> because you would imagine that something had gone wrong at this point.</p>\n<p>The punchline seems to be</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code>                  <span class=\"o\">[</span><span class=\"n\">Meta.synthInstance.tryResolve</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"bp\">.</span><span class=\"mi\">012807</span><span class=\"o\">]</span> <span class=\"bp\">✅</span> <span class=\"n\">CommSemiring</span>\n                        <span class=\"o\">((</span><span class=\"n\">i_1</span> <span class=\"o\">:</span>\n                            <span class=\"bp\">?</span><span class=\"n\">m.316431</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁰⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁰⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁰³</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁰²</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁰¹</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁰⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹³</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹²</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹¹</span>\n                              <span class=\"n\">i</span><span class=\"bp\">✝⁹⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸³</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸²</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸¹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷³</span>\n                              <span class=\"n\">i</span><span class=\"bp\">✝⁷²</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷¹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶³</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶²</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶¹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵⁵</span>\n                              <span class=\"n\">i</span><span class=\"bp\">✝⁵⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵³</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵²</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵¹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴³</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴²</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴¹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝³⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝³⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝³⁷</span>\n                              <span class=\"n\">i</span><span class=\"bp\">✝³⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝³⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝³⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝³³</span> <span class=\"n\">i</span><span class=\"bp\">✝³²</span> <span class=\"n\">i</span><span class=\"bp\">✝³¹</span> <span class=\"n\">i</span><span class=\"bp\">✝³⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝²⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝²⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝²⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝²⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝²⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝²⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝²³</span> <span class=\"n\">i</span><span class=\"bp\">✝²²</span> <span class=\"n\">i</span><span class=\"bp\">✝²¹</span> <span class=\"n\">i</span><span class=\"bp\">✝²⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁹</span>\n                              <span class=\"n\">i</span><span class=\"bp\">✝¹⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝¹³</span> <span class=\"n\">i</span><span class=\"bp\">✝¹²</span> <span class=\"n\">i</span><span class=\"bp\">✝¹¹</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝³</span> <span class=\"n\">i</span><span class=\"bp\">✝²</span> <span class=\"n\">i</span><span class=\"bp\">✝¹</span> <span class=\"n\">i</span><span class=\"bp\">✝</span> <span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"bp\">→</span>\n                          <span class=\"bp\">?</span><span class=\"n\">m.316432</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁰⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁰⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁰³</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁰²</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁰¹</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁰⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹³</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹²</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹¹</span>\n                            <span class=\"n\">i</span><span class=\"bp\">✝⁹⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸³</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸²</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸¹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷³</span>\n                            <span class=\"n\">i</span><span class=\"bp\">✝⁷²</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷¹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶³</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶²</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶¹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵⁵</span>\n                            <span class=\"n\">i</span><span class=\"bp\">✝⁵⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵³</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵²</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵¹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴³</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴²</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴¹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝³⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝³⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝³⁷</span>\n                            <span class=\"n\">i</span><span class=\"bp\">✝³⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝³⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝³⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝³³</span> <span class=\"n\">i</span><span class=\"bp\">✝³²</span> <span class=\"n\">i</span><span class=\"bp\">✝³¹</span> <span class=\"n\">i</span><span class=\"bp\">✝³⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝²⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝²⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝²⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝²⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝²⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝²⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝²³</span> <span class=\"n\">i</span><span class=\"bp\">✝²²</span> <span class=\"n\">i</span><span class=\"bp\">✝²¹</span> <span class=\"n\">i</span><span class=\"bp\">✝²⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁹</span>\n                            <span class=\"n\">i</span><span class=\"bp\">✝¹⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝¹³</span> <span class=\"n\">i</span><span class=\"bp\">✝¹²</span> <span class=\"n\">i</span><span class=\"bp\">✝¹¹</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝³</span> <span class=\"n\">i</span><span class=\"bp\">✝²</span> <span class=\"n\">i</span><span class=\"bp\">✝¹</span> <span class=\"n\">i</span><span class=\"bp\">✝</span> <span class=\"n\">i</span>\n                            <span class=\"n\">i_1</span><span class=\"o\">)</span> <span class=\"bp\">≟</span> <span class=\"n\">CommSemiring</span>\n                        <span class=\"o\">((</span><span class=\"n\">i_1</span> <span class=\"o\">:</span>\n                            <span class=\"bp\">?</span><span class=\"n\">m.316431</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁰⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁰⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁰³</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁰²</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁰¹</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁰⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹³</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹²</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹¹</span>\n                              <span class=\"n\">i</span><span class=\"bp\">✝⁹⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸³</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸²</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸¹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷³</span>\n                              <span class=\"n\">i</span><span class=\"bp\">✝⁷²</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷¹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶³</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶²</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶¹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵⁵</span>\n                              <span class=\"n\">i</span><span class=\"bp\">✝⁵⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵³</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵²</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵¹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴³</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴²</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴¹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝³⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝³⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝³⁷</span>\n                              <span class=\"n\">i</span><span class=\"bp\">✝³⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝³⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝³⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝³³</span> <span class=\"n\">i</span><span class=\"bp\">✝³²</span> <span class=\"n\">i</span><span class=\"bp\">✝³¹</span> <span class=\"n\">i</span><span class=\"bp\">✝³⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝²⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝²⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝²⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝²⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝²⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝²⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝²³</span> <span class=\"n\">i</span><span class=\"bp\">✝²²</span> <span class=\"n\">i</span><span class=\"bp\">✝²¹</span> <span class=\"n\">i</span><span class=\"bp\">✝²⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁹</span>\n                              <span class=\"n\">i</span><span class=\"bp\">✝¹⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝¹³</span> <span class=\"n\">i</span><span class=\"bp\">✝¹²</span> <span class=\"n\">i</span><span class=\"bp\">✝¹¹</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝³</span> <span class=\"n\">i</span><span class=\"bp\">✝²</span> <span class=\"n\">i</span><span class=\"bp\">✝¹</span> <span class=\"n\">i</span><span class=\"bp\">✝</span> <span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"bp\">→</span>\n                          <span class=\"bp\">?</span><span class=\"n\">m.316432</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁰⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁰⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁰³</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁰²</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁰¹</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁰⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹³</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹²</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹¹</span>\n                            <span class=\"n\">i</span><span class=\"bp\">✝⁹⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸³</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸²</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸¹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷³</span>\n                            <span class=\"n\">i</span><span class=\"bp\">✝⁷²</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷¹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶³</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶²</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶¹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵⁵</span>\n                            <span class=\"n\">i</span><span class=\"bp\">✝⁵⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵³</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵²</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵¹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴³</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴²</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴¹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝³⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝³⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝³⁷</span>\n                            <span class=\"n\">i</span><span class=\"bp\">✝³⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝³⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝³⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝³³</span> <span class=\"n\">i</span><span class=\"bp\">✝³²</span> <span class=\"n\">i</span><span class=\"bp\">✝³¹</span> <span class=\"n\">i</span><span class=\"bp\">✝³⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝²⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝²⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝²⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝²⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝²⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝²⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝²³</span> <span class=\"n\">i</span><span class=\"bp\">✝²²</span> <span class=\"n\">i</span><span class=\"bp\">✝²¹</span> <span class=\"n\">i</span><span class=\"bp\">✝²⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁹</span>\n                            <span class=\"n\">i</span><span class=\"bp\">✝¹⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝¹³</span> <span class=\"n\">i</span><span class=\"bp\">✝¹²</span> <span class=\"n\">i</span><span class=\"bp\">✝¹¹</span> <span class=\"n\">i</span><span class=\"bp\">✝¹⁰</span> <span class=\"n\">i</span><span class=\"bp\">✝⁹</span> <span class=\"n\">i</span><span class=\"bp\">✝⁸</span> <span class=\"n\">i</span><span class=\"bp\">✝⁷</span> <span class=\"n\">i</span><span class=\"bp\">✝⁶</span> <span class=\"n\">i</span><span class=\"bp\">✝⁵</span> <span class=\"n\">i</span><span class=\"bp\">✝⁴</span> <span class=\"n\">i</span><span class=\"bp\">✝³</span> <span class=\"n\">i</span><span class=\"bp\">✝²</span> <span class=\"n\">i</span><span class=\"bp\">✝¹</span> <span class=\"n\">i</span><span class=\"bp\">✝</span> <span class=\"n\">i</span> <span class=\"n\">i_1</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Just getting off a train, will be offline for several hours now but that's as far as I got.</p>",
        "id": 439568603,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1716209939
    },
    {
        "content": "<p>What about changing <code>refine'</code> to <code>refine</code>?</p>",
        "id": 439569108,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1716210092
    },
    {
        "content": "<p>Solves it!</p>",
        "id": 439569546,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1716210234
    },
    {
        "content": "<p>So what is the reason for the explosion?</p>",
        "id": 439569632,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1716210250
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/lean4/pull/4206\">lean#4206</a> I believe</p>",
        "id": 439569676,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1716210268
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"479299\">@Jovan Gerbscheid</span> mentions that <code>refine'</code> and <code>convert</code> share this issue</p>",
        "id": 439569771,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1716210307
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/stream/287929-mathlib4/topic/explosion.20involving.20.60Pi.2EcommSemiring.60/near/439568603\">said</a>:</p>\n<blockquote>\n<p>Intrigued, I clicked onto the triangle to see what was causing the explosion, and VS Code crashed.</p>\n</blockquote>\n<p>Forbidden knowledge <span aria-label=\"zip it\" class=\"emoji emoji-1f910\" role=\"img\" title=\"zip it\">:zip_it:</span></p>",
        "id": 439570985,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1716210703
    },
    {
        "content": "<p>Vs code is protecting you from the horrors that lean is creating</p>",
        "id": 439571445,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1716210844
    },
    {
        "content": "<p>(and now I have an actual argument against <code>refine'</code>)</p>",
        "id": 439571533,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1716210875
    },
    {
        "content": "<p>Terrible Secret of Lean</p>",
        "id": 439571540,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1716210879
    },
    {
        "content": "<p>On the branch with the bug fix, the proof does not break :)</p>",
        "id": 439591369,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1716217285
    },
    {
        "content": "<p>Also, Mathlib.RingTheory.Jacobson is the most affected file by the bug fix, reducing build instructions by 28%</p>",
        "id": 439592999,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1716217733
    },
    {
        "content": "<p>I think it is fine to backport this change from <a href=\"https://github.com/leanprover-community/mathlib4/pull/13001\">#13001</a> to master </p>\n<div class=\"codehilite\" data-code-language=\"Diff\"><pre><span></span><code><span class=\"gd\">- refine' ((isMaximal_iff_isMaximal_disjoint (Localization M) _ _).mp (by rwa [map_bot])).1</span>\n<span class=\"gi\">+ exact ((isMaximal_iff_isMaximal_disjoint (Localization M) a _).mp (by rwa [map_bot])).1</span>\n</code></pre></div>",
        "id": 439611008,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1716223255
    },
    {
        "content": "<p>I decided to clean out this file <a href=\"https://github.com/leanprover-community/mathlib4/pull/13062\">#13062</a></p>",
        "id": 439612845,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1716223889
    },
    {
        "content": "<p>So <code>refine'</code> should be purged from mathlib? Can one automatically check for other occurrences of instance search going out of control in this precise way? (the \"is there a ^{37} in the term\" test).</p>",
        "id": 439616188,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1716225016
    },
    {
        "content": "<p>Let's see the results of <span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span> 's experiment at <a href=\"https://github.com/leanprover-community/mathlib4/pull/13059\">#13059</a> before we get too aggressive about purging.</p>",
        "id": 439616534,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1716225130
    },
    {
        "content": "<p>It looks like the <code>refine'</code> penalty might be localized</p>",
        "id": 439617613,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1716225496
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306577\">Matthew Ballard</span> <a href=\"#narrow/stream/287929-mathlib4/topic/explosion.20involving.20.60Pi.2EcommSemiring.60/near/439612845\">said</a>:</p>\n<blockquote>\n<p>I decided to clean out this file <a href=\"https://github.com/leanprover-community/mathlib4/pull/13062\">#13062</a></p>\n</blockquote>\n<p>That's funny, it looks like the speedup you get from replacing the <code>refine'</code> with <code>refine</code> is the same as the speedup that we get from the bug fix. 28% for the bug-fix, 29% for your clean-up</p>",
        "id": 439679304,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1716238889
    },
    {
        "content": "<p>Yes, the erroneous metavariable assignments seem to be the main source of performance degradation. Even so, I think <code>refine'</code> should be phased out</p>",
        "id": 439679506,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1716238967
    },
    {
        "content": "<p>I'm not up to date with the difference. What is wrong with <code>refine'</code>?</p>",
        "id": 439679600,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1716239008
    },
    {
        "content": "<p>I think the main issue is that it is less declarative impacting readability. It was also developed during the port because <code>refine</code> itself had some rough edges. Things are different now</p>",
        "id": 439680509,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1716239363
    },
    {
        "content": "<p>For something like <code>refine (isIntegral_quotientMap_iff _).mp ?_</code>, where <code>apply (isIntegral_quotientMap_iff _).mp</code> also works, do we prefer <code>refine</code> for the same readability reason, that you can immediately see the arity of the application?</p>",
        "id": 439680992,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1716239536
    },
    {
        "content": "<p>I would say no but that is very much my personal taste speaking. Others might feel differently</p>",
        "id": 439681173,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1716239604
    }
]