[
    {
        "content": "<p>It seems that our Lean4 monad map isn't rendering very well: <a href=\"https://github.com/leanprover-community/mathlib4/wiki/Monad-map\">https://github.com/leanprover-community/mathlib4/wiki/Monad-map</a> </p>\n<p>At least on my computer (with firefox), I see many of the nodes rendered as plaintext html tags. Is anyone else seeing a similar issue?</p>",
        "id": 420525354,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1707419710
    },
    {
        "content": "<p>I see the plaintext html tags also on Chrome on my mobile (Android).</p>",
        "id": 420530680,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1707421886
    },
    {
        "content": "<p>Is this just an issue with how github renders markdown?</p>",
        "id": 420531325,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1707422117
    },
    {
        "content": "<p>did this use to work?</p>",
        "id": 420531762,
        "sender_full_name": "Eric Rodriguez",
        "timestamp": 1707422275
    },
    {
        "content": "<p>it did. But I assume that github's markdown rendering engine changed.</p>",
        "id": 420531880,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1707422313
    },
    {
        "content": "<p>Yeah, it looks like a mermaid update, GitHub bug, or stricter escaping rules broke this</p>",
        "id": 420540920,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1707426014
    },
    {
        "content": "<p>It seems like using mermaid's <a href=\"https://mermaid.js.org/syntax/flowchart.html#interaction\">click functionality</a> for nodes instead of html or markdown provides a partial workaround? Weirdly, I get a clickable hand and a tooltip showing the link, but clicking doesn't work. However, command-clicking <em>does</em> work. Not sure what to make of that...I'm asking on the mermaid discord server.</p>",
        "id": 420551929,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1707430888
    },
    {
        "content": "<p>In the meantime it also seems there's also a <a href=\"https://github.com/orgs/community/discussions/106690\">github discussion</a> about the issue.</p>",
        "id": 420552266,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1707431051
    },
    {
        "content": "<p>For the time being I updated it to use the partially-working click functionality (meaning you have to command/ctrl click to follow the link) so that it's at least readable. :)</p>",
        "id": 420554488,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1707432202
    },
    {
        "content": "<p>Perhaps it's time to migrate this to the docs</p>",
        "id": 420595675,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1707461870
    },
    {
        "content": "<p>Where we can presumably load mermaid without the security restrictions</p>",
        "id": 420595732,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1707461896
    },
    {
        "content": "<p>With Chrome on Linux, the <a href=\"https://github.com/leanprover-community/mathlib4/wiki/Monad-map\">Monad map</a> is again not working:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">Unable</span> <span class=\"n\">to</span> <span class=\"n\">render</span> <span class=\"n\">rich</span> <span class=\"n\">display</span>\n\n<span class=\"n\">Lexical</span> <span class=\"n\">error</span> <span class=\"n\">on</span> <span class=\"n\">line</span> <span class=\"mi\">20</span><span class=\"bp\">.</span> <span class=\"n\">Unrecognized</span> <span class=\"n\">text.</span>\n<span class=\"bp\">...</span> <span class=\"n\">MetaM</span> <span class=\"bp\">-.</span> <span class=\"n\">TermElabM.run</span> <span class=\"bp\">..-</span> <span class=\"n\">TermElabM</span><span class=\"bp\">;</span>\n<span class=\"c1\">-----------------------^</span>\n\n<span class=\"n\">For</span> <span class=\"n\">more</span> <span class=\"n\">information</span><span class=\"o\">,</span> <span class=\"n\">see</span> <span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">docs.github.com</span><span class=\"bp\">/</span><span class=\"n\">get</span><span class=\"bp\">-</span><span class=\"n\">started</span><span class=\"bp\">/</span><span class=\"n\">writing</span><span class=\"bp\">-</span><span class=\"n\">on</span><span class=\"bp\">-</span><span class=\"n\">github</span><span class=\"bp\">/</span><span class=\"n\">working</span><span class=\"bp\">-</span><span class=\"k\">with</span><span class=\"bp\">-</span><span class=\"n\">advanced</span><span class=\"bp\">-</span><span class=\"n\">formatting</span><span class=\"bp\">/</span><span class=\"n\">creating</span><span class=\"bp\">-</span><span class=\"n\">diagrams</span><span class=\"bp\">#</span><span class=\"n\">creating</span><span class=\"bp\">-</span><span class=\"n\">mermaid</span><span class=\"bp\">-</span><span class=\"n\">diagrams</span>\n</code></pre></div>",
        "id": 423928035,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1709166925
    },
    {
        "content": "<p>Fixed :) (At least, on Firefox on Mac. But I think this was due to a change on github's end anyway.)</p>",
        "id": 423944839,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1709177885
    },
    {
        "content": "<p>Thanks!  It is fixed for me too!</p>",
        "id": 423960892,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1709190358
    },
    {
        "content": "<p>GitHub notified me (via discussion update) that anchor links are working again for mermaid! :) I updated the monad map so that</p>\n<ol>\n<li>all nodes have links</li>\n<li>all edge labels have links (new)</li>\n<li>all links point directly to the docs page for that declaration instead of a search query for the declaration</li>\n</ol>",
        "id": 425167048,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1709754837
    },
    {
        "content": "<p>Also, apparently <code>Simp.M</code> no longer exists (there used to be both <code>Simp.M</code> and <code>SimpM</code>), so I removed it. (<code>SimpAll.M</code> still exists, but I figured the map was good enough without it.)</p>",
        "id": 425167236,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1709754915
    },
    {
        "content": "<p>Going from a declaration to a URL might exist somewhere in docgen, but in case the map needs to be updated at some point, here's the quick code I used to generate anchors (<code>#docs_url</code> is included just for completeness):</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">Lean</span>\n<span class=\"kn\">import</span> <span class=\"n\">ImportGraph.RequiredModules</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">Lean</span> <span class=\"n\">Elab</span> <span class=\"n\">Command</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">toDocsURL</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"n\">Ident</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">CommandElabM</span> <span class=\"n\">String</span> <span class=\"o\">:=</span> <span class=\"k\">do</span>\n  <span class=\"k\">let</span> <span class=\"n\">n</span> <span class=\"bp\">←</span> <span class=\"n\">resolveGlobalConstNoOverload</span> <span class=\"n\">n</span>\n  <span class=\"k\">let</span> <span class=\"n\">some</span> <span class=\"n\">module</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"bp\">←</span> <span class=\"n\">getEnv</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">getModuleFor</span><span class=\"bp\">?</span> <span class=\"n\">n</span>\n    <span class=\"bp\">|</span> <span class=\"n\">throwError</span> <span class=\"s2\">\"could not find module for {n}\"</span>\n  <span class=\"k\">let</span> <span class=\"n\">path</span> <span class=\"o\">:=</span> <span class=\"n\">module.toStringWithSep</span> <span class=\"s2\">\"/\"</span> <span class=\"n\">true</span>\n  <span class=\"n\">return</span> <span class=\"s2\">\"https://leanprover-community.github.io/mathlib4_docs/\"</span> <span class=\"bp\">++</span> <span class=\"n\">path</span> <span class=\"bp\">++</span> <span class=\"s2\">\".html#\"</span> <span class=\"bp\">++</span> <span class=\"n\">n.toString</span>\n\n<span class=\"n\">elab</span> <span class=\"s2\">\"#docs_url \"</span> <span class=\"n\">n</span><span class=\"o\">:</span><span class=\"n\">ident</span> <span class=\"o\">:</span> <span class=\"n\">command</span> <span class=\"bp\">=&gt;</span> <span class=\"k\">do</span> <span class=\"n\">logInfo</span> <span class=\"o\">(</span><span class=\"bp\">←</span> <span class=\"n\">toDocsURL</span> <span class=\"n\">n</span><span class=\"o\">)</span>\n\n<span class=\"c1\">-- Note: ident's are printed as strings with a leading \"`\", so drop it</span>\n<span class=\"n\">elab</span> <span class=\"s2\">\"#anchor \"</span> <span class=\"n\">n</span><span class=\"o\">:</span><span class=\"n\">ident</span> <span class=\"o\">:</span> <span class=\"n\">command</span> <span class=\"bp\">=&gt;</span> <span class=\"k\">do</span> <span class=\"n\">logInfo</span> <span class=\"bp\">&lt;|</span>\n  <span class=\"s2\">\"&lt;a href='\"</span> <span class=\"bp\">++</span> <span class=\"o\">(</span><span class=\"bp\">←</span> <span class=\"n\">toDocsURL</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"bp\">++</span> <span class=\"s2\">\"'&gt;\"</span> <span class=\"bp\">++</span> <span class=\"o\">(</span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\"{n}&lt;/a&gt;\"</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">drop</span> <span class=\"mi\">1</span>\n</code></pre></div>",
        "id": 425167594,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1709755050
    },
    {
        "content": "<p>You can find out that \"somewhere\" by looking at where <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat#doc\">docs#Nat</a> leads to (before the redirect)</p>",
        "id": 425174285,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1709757776
    },
    {
        "content": "<p>Ah, ok—simply fully resolving the name would have been enough, then! (It's easy to move to <code>?pattern=</code> style with a regex replacement, but it turns out the redirect takes a second extra when following the link—so I figure I'll leave it as is, at the cost of slightly busier source for that diagram. Hopefully none of these declarations will be moving very soon. :) )</p>",
        "id": 425181809,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1709760941
    }
]