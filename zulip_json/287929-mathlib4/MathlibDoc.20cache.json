[
    {
        "content": "<p>At CIRM I managed to get CI for Lean blueprint to work, see <a href=\"#narrow/stream/113488-general/topic/leanblueprint.20command.20line.20tool/near/430297595\">here</a>. <br>\nI just noticed that it fully re-builds Mathlib docs every time. For example, in <a href=\"https://github.com/samvang/StoneDualityInLean/actions/runs/8938909785/job/24553948554\">this job</a>, and all previous ones, there is an attempt to find a cache for the docs but it <a href=\"https://github.com/samvang/StoneDualityInLean/actions/runs/8938909785/job/24553948554#step:8:18\">fails</a> ... Does anyone know how to fix this?</p>",
        "id": 436875760,
        "sender_full_name": "Sam van G",
        "timestamp": 1714740242
    },
    {
        "content": "<p>Update: I just did<br>\n<code>lake update</code><br>\nand<br>\n<code>lake update -R -K doc=on</code><br>\nand<br>\n<code>lake update -R -K env=dev doc-gen4</code><br>\nand copied Mathlib's <code>lean-toolchain</code> into the repo.<br>\nNow the <a href=\"https://github.com/samvang/StoneDualityInLean/actions/runs/8939054867/job/24554365685#step:4:26\">CI build fails entirely</a> already during the \"Update docgen4\" step... <br>\nSo perhaps the above question is outdated, but then my question becomes: What did I do wrong when bumping mathlib? Any ideas on how to get the blueprint to build again?</p>",
        "id": 436876352,
        "sender_full_name": "Sam van G",
        "timestamp": 1714740447
    },
    {
        "content": "<p>For failing entirely, probably you need to wait until <a href=\"#narrow/stream/113488-general/topic/mathlib.20docs.20are.20broken\">https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib.20docs.20are.20broken</a> is fixed. (The error in the log is the same.)</p>",
        "id": 436887114,
        "sender_full_name": "Utensil Song",
        "timestamp": 1714744015
    },
    {
        "content": "<p>An official Mathlib doc cache would be really nice, I spent little time rebuilding Mathlib thanks to olean cache, but quite some time rebuilding Mathlib doc (at least the part the formalization project depends on) since using lean4 blueprint which jumps to the doc generated by docgen4.</p>",
        "id": 436887551,
        "sender_full_name": "Utensil Song",
        "timestamp": 1714744143
    },
    {
        "content": "<p>Ah, the doc cache step in the CI was set up by me, but the cache will <del>miss every Mathlib bump, that's expected.</del></p>",
        "id": 436889580,
        "sender_full_name": "Utensil Song",
        "timestamp": 1714744734
    },
    {
        "content": "<p>But I just recalled that it was designed to fall back to the previous Mathlib doc cache, and lake will pick up the outdated part and only rebuilds them. So a total cache miss is not expected as long as CI has built the doc recently and the cache hasn't been cleared by Github.</p>",
        "id": 436890280,
        "sender_full_name": "Utensil Song",
        "timestamp": 1714744927
    },
    {
        "content": "<p>Just noticed that your last build was a month ago.</p>\n<blockquote>\n<p>GitHub will remove any cache entries that have not been accessed in over 7 days. <a href=\"https://docs.github.com/en/actions/using-workflows/caching-dependencies-to-speed-up-workflows\">https://docs.github.com/en/actions/using-workflows/caching-dependencies-to-speed-up-workflows</a></p>\n</blockquote>",
        "id": 436894996,
        "sender_full_name": "Utensil Song",
        "timestamp": 1714746396
    },
    {
        "content": "<p>I have noticed the same behavior in <br>\n<a href=\"https://github.com/fpvandoorn/BonnAnalysis/\">https://github.com/fpvandoorn/BonnAnalysis/</a><br>\nand<br>\n<a href=\"https://github.com/fpvandoorn/carleson\">https://github.com/fpvandoorn/carleson</a><br>\neven when the last few commits didn't change any Lean files, and even if the last few commits were hours/days ago.</p>",
        "id": 436896521,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1714746929
    },
    {
        "content": "<p>E.g. this run is from a commit from this morning:<br>\n<a href=\"https://github.com/fpvandoorn/BonnAnalysis/actions/runs/8931698445/job/24534250156\">https://github.com/fpvandoorn/BonnAnalysis/actions/runs/8931698445/job/24534250156</a></p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>Run actions/cache@v3\n  with:\n    path: .lake/build/doc/Mathlib\n    key: DocGen4-ebb92e4b5a3e8836555c5ce18c2b1ff5e08a6fd829e51a675df2f1966e798dfb\n    restore-keys: DocGen4-\n\n    enableCrossOsArchive: false\n    fail-on-cache-miss: false\n    lookup-only: false\nCache not found for input keys: DocGen4-ebb92e4b5a3e8836555c5ce18c2b1ff5e08a6fd829e51a675df2f1966e798dfb, DocGen4-\n</code></pre></div>",
        "id": 436896732,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1714747007
    },
    {
        "content": "<p>and there were multiple commits yesterday that succesfully built the docs.</p>",
        "id": 436896827,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1714747044
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"296911\">Utensil Song</span> <a href=\"#narrow/stream/287929-mathlib4/topic/MathlibDoc.20cache/near/436887114\">said</a>:</p>\n<blockquote>\n<p>For failing entirely, probably you need to wait until <a href=\"#narrow/stream/113488-general/topic/mathlib.20docs.20are.20broken\">https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib.20docs.20are.20broken</a> is fixed. (The error in the log is the same.)</p>\n</blockquote>\n<p>Thanks, looks like I chose the wrong day to bump Mathlib, but I can wait</p>",
        "id": 436900508,
        "sender_full_name": "Sam van G",
        "timestamp": 1714747956
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"296911\">Utensil Song</span> <a href=\"#narrow/stream/287929-mathlib4/topic/MathlibDoc.20cache/near/436894996\">said</a>:</p>\n<blockquote>\n<p>Just noticed that your last build was a month ago.</p>\n<blockquote>\n<p>GitHub will remove any cache entries that have not been accessed in over 7 days. <a href=\"https://docs.github.com/en/actions/using-workflows/caching-dependencies-to-speed-up-workflows\">https://docs.github.com/en/actions/using-workflows/caching-dependencies-to-speed-up-workflows</a></p>\n</blockquote>\n</blockquote>\n<p>Ah! That explains at least this cache issue. Thank you.</p>",
        "id": 436900827,
        "sender_full_name": "Sam van G",
        "timestamp": 1714748059
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"111080\">@Floris van Doorn</span> For BonnAnalysis and carleson, the path to cache doesn't exist</p>",
        "id": 436903939,
        "sender_full_name": "Utensil Song",
        "timestamp": 1714748938
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/UNJjGDcEj_DzaV0OE1MDZue_/72D24EDA-D8EA-416C-A792-900F9036DFAD.jpg\">72D24EDA-D8EA-416C-A792-900F9036DFAD.jpg</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/UNJjGDcEj_DzaV0OE1MDZue_/72D24EDA-D8EA-416C-A792-900F9036DFAD.jpg\" title=\"72D24EDA-D8EA-416C-A792-900F9036DFAD.jpg\"><img src=\"/user_uploads/3121/UNJjGDcEj_DzaV0OE1MDZue_/72D24EDA-D8EA-416C-A792-900F9036DFAD.jpg\"></a></div>",
        "id": 436903987,
        "sender_full_name": "Utensil Song",
        "timestamp": 1714748950
    },
    {
        "content": "<p>Because the CI has moved the doc for deployment but didn't put it back</p>",
        "id": 436904658,
        "sender_full_name": "Utensil Song",
        "timestamp": 1714749132
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/psSPTBsunVHaQBaTa6gnjKj1/B4B9C39D-1523-4FF2-9C08-5872C8DC3DE8.jpg\">B4B9C39D-1523-4FF2-9C08-5872C8DC3DE8.jpg</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/psSPTBsunVHaQBaTa6gnjKj1/B4B9C39D-1523-4FF2-9C08-5872C8DC3DE8.jpg\" title=\"B4B9C39D-1523-4FF2-9C08-5872C8DC3DE8.jpg\"><img src=\"/user_uploads/3121/psSPTBsunVHaQBaTa6gnjKj1/B4B9C39D-1523-4FF2-9C08-5872C8DC3DE8.jpg\"></a></div><p>My setup moved it back so it would be ok. Is your project generated by the new leanblueprint cli that Patrick wrote after last Christmas?</p>",
        "id": 436905156,
        "sender_full_name": "Utensil Song",
        "timestamp": 1714749279
    },
    {
        "content": "<p><a href=\"https://github.com/PatrickMassot/leanblueprint/blob/master/leanblueprint/templates/blueprint.yml\">https://github.com/PatrickMassot/leanblueprint/blob/master/leanblueprint/templates/blueprint.yml</a></p>\n<p>The step is still there even though Patrick or someone also modified the workflow in one of the formalization projects changed it to cp, and mv is no longer necessary.</p>",
        "id": 436905485,
        "sender_full_name": "Utensil Song",
        "timestamp": 1714749367
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/HmWeTRbIi96epTqgPo59f8Pj/BA8B09D4-33F3-4638-9A22-590313644F80.jpg\">BA8B09D4-33F3-4638-9A22-590313644F80.jpg</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/HmWeTRbIi96epTqgPo59f8Pj/BA8B09D4-33F3-4638-9A22-590313644F80.jpg\" title=\"BA8B09D4-33F3-4638-9A22-590313644F80.jpg\"><img src=\"/user_uploads/3121/HmWeTRbIi96epTqgPo59f8Pj/BA8B09D4-33F3-4638-9A22-590313644F80.jpg\"></a></div>",
        "id": 436905579,
        "sender_full_name": "Utensil Song",
        "timestamp": 1714749402
    },
    {
        "content": "<p>Can you follow blueprint.yml to fix it? Sorry I'm on mobile for the next few days of vacation.</p>",
        "id": 436906406,
        "sender_full_name": "Utensil Song",
        "timestamp": 1714749663
    },
    {
        "content": "<p>Ok, thanks. That is very helpful, with this help I can fix it. Thanks!<br>\nI didn't use Patrick's leanblueprint command, but copied it from another repo, so it's my fault.</p>",
        "id": 436927134,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1714756956
    }
]