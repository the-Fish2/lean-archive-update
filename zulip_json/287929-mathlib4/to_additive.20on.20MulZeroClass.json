[
    {
        "content": "<p>While working with shrinks, I encountered a <code>to_additive</code> failure that I tracked down to <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Equiv.instMulZeroClassShrink#doc\">docs#Equiv.instMulZeroClassShrink</a> which is tagged with <code>to_additive</code> and produces <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Equiv.instAddZeroClassShrink#doc\">docs#Equiv.instAddZeroClassShrink</a> (which has identical type signature).</p>\n<p>Currently adding <code>to_additive</code> in (<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Equiv.instMulOneClassShrink#doc\">docs#Equiv.instMulOneClassShrink</a>)</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">to_additive</span><span class=\"kd\">]</span>\n<span class=\"kd\">noncomputable</span> <span class=\"kd\">instance</span> <span class=\"o\">[</span><span class=\"n\">Small.</span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"o\">}</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">MulOneClass</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">MulOneClass</span> <span class=\"o\">(</span><span class=\"n\">Shrink.</span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"o\">}</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n  <span class=\"o\">(</span><span class=\"n\">equivShrink</span> <span class=\"n\">α</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">symm.mulOneClass</span>\n</code></pre></div>\n<p>yields a warning that the additive declaration already exists. Indeed, it generates the name <code>Equiv.instAddZeroClassShrink</code> which is the non-sensical <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Equiv.instAddZeroClassShrink#doc\">docs#Equiv.instAddZeroClassShrink</a>.</p>\n<p>I suggest to remove the <code>to_additive</code> attribute on <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Equiv.instMulZeroClassShrink#doc\">docs#Equiv.instMulZeroClassShrink</a> and put it instead on <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Equiv.instMulOneClassShrink#doc\">docs#Equiv.instMulOneClassShrink</a>. Do you agree?</p>\n<p>(In general I suspect that any <code>to_additive</code> tag on something related to <code>MulZeroClass</code> is wrong).</p>",
        "id": 425766315,
        "sender_full_name": "Christian Merten",
        "timestamp": 1710070524
    },
    {
        "content": "<p>Yeah that just looks like an oversight</p>",
        "id": 425768495,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1710072624
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/11277\">#11277</a></p>",
        "id": 425768863,
        "sender_full_name": "Christian Merten",
        "timestamp": 1710072981
    }
]