[
    {
        "content": "<p>Im trying to add Mathlib as a dependency to my Lean4 project in the lakefile like follows:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">require</span> <span class=\"n\">mathlib</span> <span class=\"k\">from</span> <span class=\"n\">git</span>\n <span class=\"s2\">\"https://github.com/leanprover-community/mathlib4.git\"</span>\n</code></pre></div>\n<p>lean prompted me with</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">dependency</span> <span class=\"bp\">'</span><span class=\"n\">mathlib'</span> <span class=\"n\">not</span> <span class=\"k\">in</span> <span class=\"n\">manifest</span><span class=\"bp\">;</span> <span class=\"n\">use</span> <span class=\"bp\">`</span><span class=\"n\">lake</span> <span class=\"n\">update</span> <span class=\"n\">mathlib</span><span class=\"bp\">`</span> <span class=\"n\">to</span> <span class=\"n\">add</span> <span class=\"n\">it</span>\n</code></pre></div>\n<p>and when running lake update mathlib i receive the following error</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">cloning</span> <span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github.com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4.git</span> <span class=\"n\">to</span> <span class=\"bp\">./</span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"bp\">./</span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/</span><span class=\"n\">lakefile.lean</span><span class=\"o\">:</span><span class=\"mi\">6</span><span class=\"o\">:</span><span class=\"mi\">2</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"bp\">'</span><span class=\"n\">leanOptions'</span> <span class=\"n\">is</span> <span class=\"n\">not</span> <span class=\"n\">a</span> <span class=\"n\">field</span> <span class=\"n\">of</span> <span class=\"kd\">structure</span> <span class=\"bp\">'</span><span class=\"n\">Lake.PackageConfig'</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"bp\">./</span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/</span><span class=\"n\">lakefile.lean</span><span class=\"o\">:</span><span class=\"mi\">76</span><span class=\"o\">:</span><span class=\"mi\">2</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">unexpected</span> <span class=\"n\">identifier</span><span class=\"bp\">;</span> <span class=\"n\">expected</span> <span class=\"bp\">'</span><span class=\"n\">abbrev'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"n\">add_decl_doc'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"kd\">axiom</span><span class=\"bp\">'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"n\">builtin_initialize'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"kd\">class</span><span class=\"bp\">'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"n\">custom_data'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"n\">declare_opaque_type'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"n\">declare_simp_like_tactic'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"n\">declare_syntax_cat'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"kd\">def</span><span class=\"bp\">'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"n\">elab'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"n\">elab_rules'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"kd\">example</span><span class=\"bp\">'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"n\">extern_lib'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"n\">family_def'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"kd\">inductive</span><span class=\"bp\">'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"kd\">infix</span><span class=\"bp\">'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"kd\">infixl</span><span class=\"bp\">'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"kd\">infixr</span><span class=\"bp\">'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"n\">initialize'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"kd\">instance</span><span class=\"bp\">'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"n\">lean_exe'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"n\">lean_lib'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"n\">library_data'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"n\">library_facet'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"n\">macro'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"n\">macro_rules'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"n\">module_data'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"n\">module_facet'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"kd\">notation</span><span class=\"bp\">'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"n\">opaque'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"n\">package'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"n\">package_data'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"n\">package_facet'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"kd\">postfix</span><span class=\"bp\">'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"kd\">prefix</span><span class=\"bp\">'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"n\">register_builtin_option'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"n\">register_option'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"n\">script'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"kd\">structure</span><span class=\"bp\">'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"n\">syntax'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"n\">target'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"n\">target_data'</span><span class=\"o\">,</span> <span class=\"bp\">'</span><span class=\"kd\">theorem</span><span class=\"bp\">'</span> <span class=\"n\">or</span> <span class=\"bp\">'</span><span class=\"n\">unif_hint'</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"bp\">./</span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/</span><span class=\"n\">lakefile.lean</span><span class=\"o\">:</span> <span class=\"n\">package</span> <span class=\"n\">configuration</span> <span class=\"n\">has</span> <span class=\"n\">errors</span>\n</code></pre></div>\n<p>any ideas? maybe its a common problem</p>",
        "id": 419331068,
        "sender_full_name": "Simon Daniel",
        "timestamp": 1706820725
    },
    {
        "content": "<p>First update the version of Lean your project uses</p>",
        "id": 419331249,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1706820805
    },
    {
        "content": "<p>ie copy the content of <a href=\"https://github.com/leanprover-community/mathlib4/blob/master/lean-toolchain\">https://github.com/leanprover-community/mathlib4/blob/master/lean-toolchain</a> into the corresponding file of your project</p>",
        "id": 419331384,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1706820846
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"684702\">Simon Daniel</span> has marked this topic as resolved.</p>",
        "id": 419332197,
        "sender_full_name": "Notification Bot",
        "timestamp": 1706821138
    },
    {
        "content": "<p>thanks,<br>\n the error message didnt make it very clear that the Lean versions are incompatible</p>",
        "id": 419332328,
        "sender_full_name": "Simon Daniel",
        "timestamp": 1706821201
    },
    {
        "content": "<p>Yeah sadly this is because syntax changed and Lean is not backward-compatible</p>",
        "id": 419332692,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1706821322
    },
    {
        "content": "<p>note that this is not merely a backward compatibility problem, this is a forward compatibility problem caused by the fact that the script which says to update lake can't be read by the old lake</p>",
        "id": 419407088,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1706861345
    }
]