[
    {
        "content": "<p>I am doing the <a href=\"https://adam.math.hhu.de/#/g/leanprover-community/NNG4\">Lean Natural Number game</a> and having difficulty understanding the behavior of <code>rw</code> and <code>nth_rewrite</code>. </p>\n<p>According to the game itself (in tutorial level 8), <code>rw</code> is supposed to replace all occurrences of a term, but when I write</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">theorem</span> <span class=\"n\">add_assoc</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">â„•</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">+</span> <span class=\"n\">c</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">b</span> <span class=\"bp\">+</span> <span class=\"n\">c</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n  <span class=\"n\">induction</span> <span class=\"n\">a</span> <span class=\"k\">with</span> <span class=\"n\">x</span> <span class=\"n\">hx</span>\n  <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">zero_add</span><span class=\"o\">,</span> <span class=\"n\">zero_add</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>then the last step needs two applications of the rewrite rule to also rewrite the right side of the goal equation. Also, if I replace the <code>rw</code> with <code>nth_rewrite 2 [zero_add]</code> (which is not a useful step here, I know) to only remove the <code>0 +</code> on the right side, I get</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">tactic</span> <span class=\"bp\">'</span><span class=\"n\">rewrite'</span> <span class=\"n\">failed</span><span class=\"o\">,</span> <span class=\"n\">did</span> <span class=\"n\">not</span> <span class=\"n\">find</span> <span class=\"kd\">instance</span> <span class=\"n\">of</span> <span class=\"n\">the</span> <span class=\"n\">pattern</span> <span class=\"k\">in</span> <span class=\"n\">the</span> <span class=\"n\">target</span> <span class=\"n\">expression</span>\n  <span class=\"mi\">0</span> <span class=\"bp\">+</span> <span class=\"n\">b</span>\n</code></pre></div>\n<p>Is that a bug in the game? How can I apply a rewrite only to the right side of the goal?</p>",
        "id": 409469383,
        "sender_full_name": "Nikolai Morin",
        "timestamp": 1703195561
    },
    {
        "content": "<p>If you click on the \"rw\" tactic (in the list of tactics on the right-hand side), it will tell you more precisely what it means by \"all occurrences\" in the \"Targetted usage\" section. Not sure if it's useful for your particular question, but the documentation there is quite detailed and it's worth a read.</p>",
        "id": 409470954,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1703196232
    },
    {
        "content": "<p>But basically, <code>rw</code> and <code>nth_rewrite</code> first try to locate some part of the expression that matches the lemma you passed. Then it infers the arguments to the relevant lemma, and those parameters will be \"fixed\" for some purposes; it won't \"reinfer\" them to match other instances of the desired expression.</p>",
        "id": 409471626,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1703196517
    },
    {
        "content": "<p>Thanks, that's helpful. So, are you saying thet when I do <code>nth_rewrite 2 [zero_add]</code> to the goal <code>0 + b + c = 0 + (b + c)</code>, then it finds the first match of <code>0 + ?</code> at the very beginning and infers <code>?</code> to be <code>b</code>, then searches for another instance of <code>0 + b</code> only, instead of <code>0 + ?</code>?</p>",
        "id": 409472937,
        "sender_full_name": "Nikolai Morin",
        "timestamp": 1703197120
    },
    {
        "content": "<p>I have no idea why <code>nth_rewrite 2 [zero_add]</code> doesn't change only the second <code>0 + ?</code>, I am surprised by this. You can write  <code>rw [zero_add (b + c)]</code> to change only the RHS.</p>",
        "id": 409476122,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1703198460
    },
    {
        "content": "<p>I've asked in <a class=\"stream\" data-stream-id=\"287929\" href=\"/#narrow/stream/287929-mathlib4\">#mathlib4</a> -- see <a href=\"#narrow/stream/287929-mathlib4/topic/nth_rewrite/near/409476457\">here</a>.</p>",
        "id": 409476553,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1703198744
    }
]