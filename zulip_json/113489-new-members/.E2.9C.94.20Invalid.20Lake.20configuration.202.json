[
    {
        "content": "<p>I suddenly started getting a <code>Invalid Lake configuration.</code> error. Full error below. I was working on <a href=\"https://github.com/quinnculver/MacaulayDuration\">this project</a> (specifically the Duration.lean file) and it happened out of nowhere. Re-cloning didn't fix it. Has mathlib's URL really changed? What to do?</p>\n<p>'''<br>\n<code>c:\\Users\\qculver\\.elan\\toolchains\\leanprover--lean4---v4.5.0-rc1\\bin\\lake.exe setup-file C:/Users/qculver/OneDrive - Hawaii Pacific University/Research/MacaulayDuration/MacaulayDuration/Duration.lean Init Mathlib Mathlib.Analysis.Calculus.Taylor Mathlib.Analysis.Calculus.Deriv.Basic Mathlib.Analysis.SpecialFunctions.Log.Deriv --no-build</code> failed:</p>\n<p>stderr:<br>\ninfo: mathlib: URL has changed; you might need to delete '.\\.lake/packages\\mathlib' manually<br>\ninfo: mathlib: updating repository '.\\.lake/packages\\mathlib' to revision '0bcd6be6b061f4b3465ad878329e8af982ebb987'<br>\nerror: &gt; git checkout --detach 0bcd6be6b061f4b3465ad878329e8af982ebb987    # in directory .\\.lake/packages\\mathlib<br>\nerror: stderr:<br>\nfatal: reference is not a tree: 0bcd6be6b061f4b3465ad878329e8af982ebb987<br>\nerror: external command <code>git</code> exited with code 128<br>\nInvalid Lake configuration.  Please restart the server after fixing the Lake configuration file.</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code>\n</code></pre></div>",
        "id": 431607014,
        "sender_full_name": "Quinn Culver",
        "timestamp": 1712352481
    },
    {
        "content": "<p><a href=\"#narrow/stream/113489-new-members/topic/Invalid.20Lake.20configuration.202/near/431607014\">A message</a> was moved here from <a class=\"stream-topic\" data-stream-id=\"113489\" href=\"/#narrow/stream/113489-new-members/topic/Invalid.20Lake.20configuration\">#new members &gt; Invalid Lake configuration</a> by <span class=\"user-mention silent\" data-user-id=\"245476\">Quinn Culver</span>.</p>",
        "id": 431609825,
        "sender_full_name": "Notification Bot",
        "timestamp": 1712353982
    },
    {
        "content": "<p>Can you do <code>lake build -R</code>?</p>",
        "id": 431649037,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1712387730
    },
    {
        "content": "<p>Tried that while the file was open in vscode and got</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">$</span> <span class=\"n\">lake</span> <span class=\"n\">build</span> <span class=\"bp\">-</span><span class=\"n\">R</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">permission</span> <span class=\"n\">denied</span> <span class=\"o\">(</span><span class=\"n\">error</span> <span class=\"n\">code</span><span class=\"o\">:</span> <span class=\"mi\">13</span><span class=\"o\">)</span>\n  <span class=\"n\">file</span><span class=\"o\">:</span> <span class=\"bp\">.\\.</span><span class=\"n\">lake</span><span class=\"bp\">\\</span><span class=\"n\">lakefile.olean</span>\n</code></pre></div>\n<p>I'm an administrator on this machine.</p>\n<p>With vscode closed, got this</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">$</span> <span class=\"n\">lake</span> <span class=\"n\">build</span> <span class=\"bp\">-</span><span class=\"n\">R</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"bp\">'</span><span class=\"n\">MacaulayDuration'</span><span class=\"o\">:</span> <span class=\"n\">no</span> <span class=\"n\">such</span> <span class=\"n\">file</span> <span class=\"n\">or</span> <span class=\"n\">directory</span> <span class=\"o\">(</span><span class=\"n\">error</span> <span class=\"n\">code</span><span class=\"o\">:</span> <span class=\"mi\">2</span><span class=\"o\">)</span>\n  <span class=\"n\">file</span><span class=\"o\">:</span> <span class=\"bp\">.\\.\\.\\</span><span class=\"n\">MacaulayDuration.lean</span>\n</code></pre></div>",
        "id": 431683378,
        "sender_full_name": "Quinn Culver",
        "timestamp": 1712418282
    },
    {
        "content": "<p>The latter one just sounds like you're running the command from the wrong folder</p>",
        "id": 431689080,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1712423204
    },
    {
        "content": "<p>I'm running it from the top-level folder of the project, where <code>lakefile.lean</code> is.  Is that incorrect? Seems to work from the corresponding folder of other projects.</p>",
        "id": 431730035,
        "sender_full_name": "Quinn Culver",
        "timestamp": 1712463753
    },
    {
        "content": "<p>Can you share the project? Is it on Github somewhere?</p>",
        "id": 431739150,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1712473257
    },
    {
        "content": "<p>Can you confirm that there's no <code>MacaulayDuration.lean</code> file in the top-level folder of the project? And maybe share your lakefile?</p>",
        "id": 431758107,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1712487230
    },
    {
        "content": "<p>Confirmed; no such file in that folder. lakefile:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">Lake</span>\n<span class=\"kn\">open</span> <span class=\"n\">Lake</span> <span class=\"n\">DSL</span>\n\n<span class=\"n\">package</span> <span class=\"bp\">«</span><span class=\"n\">macaulay_duration</span><span class=\"bp\">»</span> <span class=\"o\">{</span>\n  <span class=\"c1\">-- add any package configuration options here</span>\n<span class=\"o\">}</span>\n\n<span class=\"n\">require</span> <span class=\"n\">mathlib</span> <span class=\"k\">from</span> <span class=\"n\">git</span>\n  <span class=\"s2\">\"https://github.com/leanprover-community/mathlib4.git\"</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">default_target</span><span class=\"kd\">]</span>\n<span class=\"n\">lean_lib</span> <span class=\"bp\">«</span><span class=\"n\">MacaulayDuration</span><span class=\"bp\">»</span> <span class=\"o\">{</span>\n  <span class=\"c1\">-- add any library configuration options here</span>\n<span class=\"o\">}</span>\n</code></pre></div>",
        "id": 431800743,
        "sender_full_name": "Quinn Culver",
        "timestamp": 1712511790
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/stream/113489-new-members/topic/Invalid.20Lake.20configuration.202/near/431739150\">said</a>:</p>\n<blockquote>\n<p>Can you share the project? Is it on Github somewhere?</p>\n</blockquote>\n<p><a href=\"https://github.com/quinnculver/MacaulayDuration\">Here</a> is the project.</p>",
        "id": 431800890,
        "sender_full_name": "Quinn Culver",
        "timestamp": 1712511867
    },
    {
        "content": "<p>You really are missing a <code>MacauleyDuration.lean</code> file in the top-level directory. It should just import every file you want a bare <code>lake build</code> to build. So, for example, it can contain <code>import MacaulayDuration.Duration</code>.</p>",
        "id": 431928843,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1712571772
    },
    {
        "content": "<p>If you don't have this file, you have to specify targets to build, as in <code>lake build MacaulayDuration.Duration</code></p>",
        "id": 431929112,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1712571836
    },
    {
        "content": "<p>You added <code>MacaulayDuration.lean</code> to <code>.gitignore</code>, but typically this top-level file is committed.</p>",
        "id": 431929459,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1712571925
    },
    {
        "content": "<p>I wonder how it got added to <code>.gitignore'. Is it reasonably possible that I would have added it to </code>.gitignore` accidentally?</p>",
        "id": 432029036,
        "sender_full_name": "Quinn Culver",
        "timestamp": 1712596428
    },
    {
        "content": "<p>When I ran <code>lake build MacaulayDuration.Duration</code>, I got</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">$</span> <span class=\"n\">lake</span> <span class=\"n\">build</span> <span class=\"n\">MacaulayDuration.Duration</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"bp\">'</span><span class=\"n\">MacaulayDuration.Duration'</span> <span class=\"bp\">▸</span> <span class=\"bp\">'</span><span class=\"n\">Mathlib.Topology.Defs.Filter'</span><span class=\"o\">:</span> <span class=\"n\">no</span> <span class=\"n\">such</span> <span class=\"n\">file</span> <span class=\"n\">or</span> <span class=\"n\">directory</span> <span class=\"o\">(</span><span class=\"n\">error</span> <span class=\"n\">code</span><span class=\"o\">:</span> <span class=\"mi\">2</span><span class=\"o\">)</span>\n  <span class=\"n\">file</span><span class=\"o\">:</span> <span class=\"bp\">.\\.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">mathlib</span><span class=\"bp\">\\.\\.\\</span><span class=\"n\">Mathlib</span><span class=\"bp\">\\</span><span class=\"n\">Topology</span><span class=\"bp\">\\</span><span class=\"n\">Defs</span><span class=\"bp\">\\</span><span class=\"n\">Filter.lean</span>\n</code></pre></div>",
        "id": 432029867,
        "sender_full_name": "Quinn Culver",
        "timestamp": 1712596718
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"325367\">Mauricio Collares</span> <a href=\"#narrow/stream/113489-new-members/topic/Invalid.20Lake.20configuration.202/near/431929112\">said</a>:</p>\n<blockquote>\n<p>If you don't have this file, you have to specify targets to build, as in <code>lake build MacaulayDuration.Duration</code></p>\n</blockquote>\n<p>There is a third option; add <code>globs := #[.submodules `MacaulayDuration]</code> to the <code>lean_lib</code></p>",
        "id": 432030455,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1712596981
    },
    {
        "content": "<p>Where &amp; what is the <code>lean_lib</code>?</p>",
        "id": 432031819,
        "sender_full_name": "Quinn Culver",
        "timestamp": 1712597478
    },
    {
        "content": "<p>The problem seems to have been solved by deleting the <code>.lake/packages</code> directory and running <code>lake build MacaulayDuration.Duration</code>.</p>",
        "id": 432067001,
        "sender_full_name": "Quinn Culver",
        "timestamp": 1712610327
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"245476\">Quinn Culver</span> has marked this topic as resolved.</p>",
        "id": 432067008,
        "sender_full_name": "Notification Bot",
        "timestamp": 1712610329
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/stream/113489-new-members/topic/.E2.9C.94.20Invalid.20Lake.20configuration.202/near/431758107\">said</a>:</p>\n<blockquote>\n<p>Can you confirm that there's no <code>MacaulayDuration.lean</code> file in the top-level folder of the project? And maybe share your lakefile?</p>\n</blockquote>\n<p>What's the significance of there being no <code>MacaulayDuration.lean</code> file in the top-level folder of the project?</p>",
        "id": 432074046,
        "sender_full_name": "Quinn Culver",
        "timestamp": 1712613355
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"245476\">Quinn Culver</span> <a href=\"#narrow/stream/113489-new-members/topic/.E2.9C.94.20Invalid.20Lake.20configuration.202/near/432031819\">said</a>:</p>\n<blockquote>\n<p>Where &amp; what is the <code>lean_lib</code>?</p>\n</blockquote>\n<p>It's in the code sample you pasted <a href=\"#narrow/stream/113489-new-members/topic/.E2.9C.94.20Invalid.20Lake.20configuration.202/near/431800743\">above</a>!</p>",
        "id": 432075927,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1712614376
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"245476\">Quinn Culver</span> <a href=\"#narrow/stream/113489-new-members/topic/.E2.9C.94.20Invalid.20Lake.20configuration.202/near/432074046\">said</a>:</p>\n<blockquote>\n<p>What's the significance of there being no <code>MacaulayDuration.lean</code> file in the top-level folder of the project?</p>\n</blockquote>\n<p>Well, the absence of that file is exactly what the error message you pasted <a href=\"#narrow/stream/113489-new-members/topic/.E2.9C.94.20Invalid.20Lake.20configuration.202/near/431683378\">above</a> was complaining about.</p>",
        "id": 432075994,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1712614434
    }
]