[
    {
        "content": "<p>I was looking at <code>unitary</code> definition in Mathlib and was a bit confused by its syntax. Usually, I expect something like <code>def a: b := c</code>, but it's <code>def a:b where c</code>. When can I use the latter syntax? Is it used only when <code>b</code> is a complicated structure?</p>\n<p>Here is the definition:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">def</span> <span class=\"n\">unitary</span> <span class=\"o\">(</span><span class=\"n\">R</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">Monoid</span> <span class=\"n\">R</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">StarMul</span> <span class=\"n\">R</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">Submonoid</span> <span class=\"n\">R</span> <span class=\"n\">where</span>\n  <span class=\"n\">carrier</span> <span class=\"o\">:=</span> <span class=\"o\">{</span> <span class=\"n\">U</span> <span class=\"bp\">|</span> <span class=\"n\">star</span> <span class=\"n\">U</span> <span class=\"bp\">*</span> <span class=\"n\">U</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span> <span class=\"bp\">∧</span> <span class=\"n\">U</span> <span class=\"bp\">*</span> <span class=\"n\">star</span> <span class=\"n\">U</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span> <span class=\"o\">}</span>\n  <span class=\"n\">one_mem'</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">mul_one</span><span class=\"o\">,</span> <span class=\"n\">and_self_iff</span><span class=\"o\">,</span> <span class=\"n\">Set.mem_setOf_eq</span><span class=\"o\">,</span> <span class=\"n\">star_one</span><span class=\"o\">]</span>\n  <span class=\"n\">mul_mem'</span> <span class=\"o\">:=</span> <span class=\"bp\">@</span><span class=\"k\">fun</span> <span class=\"n\">U</span> <span class=\"n\">B</span> <span class=\"o\">⟨</span><span class=\"n\">hA₁</span><span class=\"o\">,</span> <span class=\"n\">hA₂</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"n\">hB₁</span><span class=\"o\">,</span> <span class=\"n\">hB₂</span><span class=\"o\">⟩</span> <span class=\"bp\">=&gt;</span> <span class=\"kd\">by</span>\n    <span class=\"n\">refine'</span> <span class=\"o\">⟨</span><span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">⟩</span>\n    <span class=\"bp\">·</span> <span class=\"k\">calc</span>\n        <span class=\"n\">star</span> <span class=\"o\">(</span><span class=\"n\">U</span> <span class=\"bp\">*</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">U</span> <span class=\"bp\">*</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">star</span> <span class=\"n\">B</span> <span class=\"bp\">*</span> <span class=\"n\">star</span> <span class=\"n\">U</span> <span class=\"bp\">*</span> <span class=\"n\">U</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">mul_assoc</span><span class=\"o\">,</span> <span class=\"n\">star_mul</span><span class=\"o\">]</span>\n        <span class=\"n\">_</span> <span class=\"bp\">=</span> <span class=\"n\">star</span> <span class=\"n\">B</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">star</span> <span class=\"n\">U</span> <span class=\"bp\">*</span> <span class=\"n\">U</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"bp\">←</span> <span class=\"n\">mul_assoc</span><span class=\"o\">]</span>\n        <span class=\"n\">_</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">hA₁</span><span class=\"o\">,</span> <span class=\"n\">mul_one</span><span class=\"o\">,</span> <span class=\"n\">hB₁</span><span class=\"o\">]</span>\n    <span class=\"bp\">·</span> <span class=\"k\">calc</span>\n        <span class=\"n\">U</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"bp\">*</span> <span class=\"n\">star</span> <span class=\"o\">(</span><span class=\"n\">U</span> <span class=\"bp\">*</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">U</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">star</span> <span class=\"n\">B</span> <span class=\"bp\">*</span> <span class=\"n\">star</span> <span class=\"n\">U</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">star_mul</span><span class=\"o\">]</span>\n        <span class=\"n\">_</span> <span class=\"bp\">=</span> <span class=\"n\">U</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">B</span> <span class=\"bp\">*</span> <span class=\"n\">star</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">star</span> <span class=\"n\">U</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">simp_rw</span> <span class=\"o\">[</span><span class=\"bp\">←</span> <span class=\"n\">mul_assoc</span><span class=\"o\">]</span>\n        <span class=\"n\">_</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">hB₂</span><span class=\"o\">,</span> <span class=\"n\">mul_one</span><span class=\"o\">,</span> <span class=\"n\">hA₂</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 417255162,
        "sender_full_name": "Yunong Shi",
        "timestamp": 1705937589
    },
    {
        "content": "<p>where syntax is applicable whenever the type of your definition or instance is any kind of <code>structure</code></p>",
        "id": 417255484,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1705937670
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"395550\">Henrik Böving</span> <a href=\"#narrow/stream/113489-new-members/topic/.60def.60.20with.20.60where.60.20syntax/near/417255484\">said</a>:</p>\n<blockquote>\n<p>where syntax is applicable whenever the type of your definition or instance is any kind of <code>structure</code></p>\n</blockquote>\n<p>Thanks! Makes sense. iiuc, I also noticed that I can use the name of the fields in the <code>structure</code> directly.</p>",
        "id": 417255700,
        "sender_full_name": "Yunong Shi",
        "timestamp": 1705937744
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"671093\">Yunong Shi</span> has marked this topic as resolved.</p>",
        "id": 417277276,
        "sender_full_name": "Notification Bot",
        "timestamp": 1705943536
    }
]