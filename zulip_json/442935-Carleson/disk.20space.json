[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"111080\">@Floris van Doorn</span> um…<br>\n<a href=\"/user_uploads/3121/rRgC930LyF47hKvAK-VCDeLF/Screenshot-from-2024-06-26-17-09-17.png\">Screenshot-from-2024-06-26-17-09-17.png</a><br>\n<a href=\"https://github.com/fpvandoorn/carleson/actions/runs/9676609250\">https://github.com/fpvandoorn/carleson/actions/runs/9676609250</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/rRgC930LyF47hKvAK-VCDeLF/Screenshot-from-2024-06-26-17-09-17.png\" title=\"Screenshot-from-2024-06-26-17-09-17.png\"><img src=\"/user_uploads/3121/rRgC930LyF47hKvAK-VCDeLF/Screenshot-from-2024-06-26-17-09-17.png\"></a></div>",
        "id": 447163971,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1719393087
    },
    {
        "content": "<p>Is your computer out of space?</p>",
        "id": 447170162,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1719394937
    },
    {
        "content": "<p>No, it's a standard github runner, as seen from the error</p>",
        "id": 447170585,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1719395075
    },
    {
        "content": "<p>This is the CI that is failed, potentially related to <a href=\"#narrow/stream/113488-general/topic/clean.20up.20documentation.20directory\">https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/clean.20up.20documentation.20directory</a></p>",
        "id": 447170618,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1719395088
    },
    {
        "content": "<p>I added a cleanup step that I found in the Mathlib CI, and that seems to have fixed the issue.</p>",
        "id": 447179308,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1719397637
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"111080\">Floris van Doorn</span> <a href=\"#narrow/stream/442935-Carleson/topic/disk.20space/near/447179308\">said</a>:</p>\n<blockquote>\n<p>I added a cleanup step that I found in the Mathlib CI, and that seems to have fixed the issue.</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"111080\">@Floris van Doorn</span>, was this the </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">      </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cleanup</span>\n<span class=\"w\">        </span><span class=\"n\">run</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">|</span>\n<span class=\"w\">          </span><span class=\"n\">find</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">prune</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">exec</span><span class=\"w\"> </span><span class=\"n\">rm</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">rf</span><span class=\"w\"> </span><span class=\"c1\">-- {} +</span>\n<span class=\"w\">          </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">Delete</span><span class=\"w\"> </span><span class=\"n\">all</span><span class=\"w\"> </span><span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"n\">most</span><span class=\"w\"> </span><span class=\"n\">recent</span><span class=\"w\"> </span><span class=\"n\">toolchains</span><span class=\"bp\">.</span>\n<span class=\"w\">          </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">Make</span><span class=\"w\"> </span><span class=\"n\">sure</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">delete</span><span class=\"w\"> </span><span class=\"n\">both</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"bp\">`~/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">X</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"bp\">`~/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">update</span><span class=\"bp\">-</span><span class=\"n\">hashes</span><span class=\"bp\">/</span><span class=\"n\">X</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"bp\">.</span>\n<span class=\"w\">          </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">Skip</span><span class=\"w\"> </span><span class=\"n\">symbolic</span><span class=\"w\"> </span><span class=\"n\">links</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">`-</span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"bp\">`</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">current</span><span class=\"w\"> </span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">`!</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">.`</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"ss\">`nightly</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"ss\">`stable</span><span class=\"bp\">`.</span>\n<span class=\"w\">          </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"bp\">~/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"w\"> </span><span class=\"bp\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">find</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">maxdepth</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">print0</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">xargs</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">ls</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"n\">td</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">grep</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">nightly</span><span class=\"bp\">$'</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">grep</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">stable</span><span class=\"bp\">$'</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">tail</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">xargs</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">{}</span><span class=\"w\"> </span><span class=\"n\">sh</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">echo</span><span class=\"w\"> </span><span class=\"o\">{}</span><span class=\"w\"> </span><span class=\"bp\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">rm</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">rf</span><span class=\"w\"> </span><span class=\"s2\">\"{}\"</span><span class=\"w\"> </span><span class=\"bp\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">rm</span><span class=\"w\"> </span><span class=\"s2\">\"../update-hashes/{}\"</span><span class=\"bp\">';</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">              </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">Do</span><span class=\"w\"> </span><span class=\"n\">nothing</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">success</span>\n<span class=\"w\">          </span><span class=\"k\">else</span>\n<span class=\"w\">              </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">Do</span><span class=\"w\"> </span><span class=\"n\">nothing</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">failure</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">suppress</span><span class=\"w\"> </span><span class=\"n\">errors</span>\n<span class=\"w\">          </span><span class=\"n\">fi</span>\n</code></pre></div>\n<p>step? If people are having to do this downstream, perhaps it it time for <code>elan</code> to add some support here so we don't end up with too many copies of this shell scripting nightmare. :-)</p>",
        "id": 447368036,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1719451903
    },
    {
        "content": "<p>Yes. Though I should note that only the first line actually did anything, I believe (I looked at one CI output, and it silently succeeded, but with the warning that <code>~/.elan/toolchains</code> didn't exist).</p>",
        "id": 447396689,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1719469814
    },
    {
        "content": "<p>Oh, the cleanup was not a permanent solution, CI ran out of disk space again: <a href=\"https://github.com/fpvandoorn/carleson/actions/runs/9700051881\">https://github.com/fpvandoorn/carleson/actions/runs/9700051881</a></p>\n<p>I have no idea what I'm doing with CI, and don't have time to investigate this in the next few days, so if anyone is willing to investigate / spot something stupid I do in the CI, please do!</p>",
        "id": 447547055,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1719511934
    },
    {
        "content": "<p>Since disabling Jekyll worked, and the website is static, I think you need to move the landing website <a href=\"https://florisvandoorn.com/carleson\">https://florisvandoorn.com/carleson</a> to a separate repository</p>",
        "id": 448279697,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1719827595
    },
    {
        "content": "<p>...as is done with the leanprover-community website</p>",
        "id": 448326567,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1719839516
    },
    {
        "content": "<p>Yes, that is probably a good idea. I'm still trying to figure out what is exactly happening. It is a website with literally 2 pages (the landing page and the 404 page), and I'm not sure why it should take up any significant amount of disk space. <br>\nUnless it's transforming all doc pages in some way...</p>",
        "id": 448334467,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1719841370
    },
    {
        "content": "<p>Surely it's also hosting the blueprint and the docs?</p>",
        "id": 448334803,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1719841443
    },
    {
        "content": "<p>Yes, but disabling Jekyll somehow fixes the disk space issue. But maybe that's just the \"drop that overflows the bucket\" as we say in Dutch (i.e. the straw that broke the camel’s back).</p>\n<p>Have you ever encountered these spaces issues in LeanCamCombi, Yael?</p>",
        "id": 448335609,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1719841570
    },
    {
        "content": "<p>I <em>think</em> so, but it's almost two years ago now and I've fixed CI issues for three separate projects since then</p>",
        "id": 448336248,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1719841674
    },
    {
        "content": "<p>I've basically copied the CI from one of the repos you did the CI for (PFR, I believe), so I'm not sure what I'm doing wrong.</p>",
        "id": 448336728,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1719841750
    },
    {
        "content": "<p>Depends on how stringent you were with the copying. From experience, it is overwhelmingly easy to mess up copying an existing project (because an important file is in an unexpected directory, because there are github settings you don't see in the files, etc...)</p>",
        "id": 448337725,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1719841894
    },
    {
        "content": "<p>Ohhh... I have an idea: I'm deleting everything, and then fetching the cache, but I don't have the step</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">      </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Make</span><span class=\"w\"> </span><span class=\"n\">sure</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">works</span>\n<span class=\"w\">        </span><span class=\"n\">run</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">|</span>\n<span class=\"w\">          </span><span class=\"n\">mv</span><span class=\"w\"> </span><span class=\"n\">docs</span><span class=\"bp\">/</span><span class=\"n\">docs</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">doc</span>\n</code></pre></div>\n<p>which means that the cache never gets smaller, only bigger...</p>",
        "id": 448337857,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1719841918
    },
    {
        "content": "<p>Yep, looks like that could be it!</p>",
        "id": 448338158,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1719841963
    },
    {
        "content": "<p>If I just add that step, will thinks automatically work? I should probably also change something in Lean, so that I don't just fetch the existing (too large) cache?</p>",
        "id": 448338572,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1719842030
    },
    {
        "content": "<p>You could first try removing the cache-fetching step, let CI run once, then restore it... or simply change the name of the cache token to ensure your CI is not trying to fetch the old huge cache</p>",
        "id": 448340225,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1719842244
    }
]