[
    {
        "content": "<p>Continued from <a href=\"#narrow/stream/113488-general/topic/.E2.9C.94.20Using.20the.20REPL.20from.20another.20project.20issues\">previous topic</a>. Prev topic was resolved for v4.8.0 but seems to have broke again in v4.9.0. </p>\n<p>With the new 4.9.0 release of the repl, the same old issue is coming up again despite both the repl and the project being on v4.9.0 (the fix for the previous question). The same MWE as before is causing the same issue, but the versions are the same, and I'm running from the directory with the lakefile as suggested before. Any ideas on how to fix this?</p>",
        "id": 448249510,
        "sender_full_name": "Riyaz Ahuja",
        "timestamp": 1719819034
    },
    {
        "content": "<p>Note that <code>repl</code> master is now on <code>v4.10.0-rc1</code>.</p>",
        "id": 448251568,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1719819682
    },
    {
        "content": "<p>Can you tell me how to repro what you're seeing? (i.e. exactly what do I type!)</p>",
        "id": 448251622,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1719819695
    },
    {
        "content": "<p>Yep I saw, Its just that my project that uses the repl is currently on <code>v4.9.0</code> just for consistency with all its other dependencies. I'll port to <code>v4.10.0</code> whenever it is released and the project has matured a bit.</p>\n<p>As for how to reproduce, the same MWE from the linked previous thread causes the same error. For reference, here it is:</p>\n<p>As a MWE, I made a fresh clone of the github above to <code>Desktop/lean-repl</code>, and ran the <code>lake exe repl</code> to initially build everything and then <code>echo '{\"path\": \"test/file.lean\", \"allTactics\": true}' | lake exe repl</code> as per the ReadMe. I get the expected output, completely identical to <code>test/file.expected.out</code>. </p>\n<p>Then I made an empty folder <code>Desktop/test</code> and used the VSCode widget (<code>∀</code>) to make a new lean 4 project with mathlib called Test. I then go to my project folder <code>Desktop/test/Test</code> and with the default <code>Test/Basic.lean</code>, I copied over the <code>file.in</code> and <code>file.lean</code> from the REPL's source code. Note that the infoview works perfectly fine and running <code>lake build</code> returned success. Then, just as the readme says, i ran from this directory: <code>lake env /Users/ahuja/Desktop/lean-repl/.lake/build/bin/repl &lt; Test/file.in</code> and got the following:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">{</span><span class=\"s2\">\"messages\"</span><span class=\"o\">:</span>\n<span class=\"w\"> </span><span class=\"o\">[{</span><span class=\"s2\">\"severity\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"error\"</span><span class=\"o\">,</span>\n<span class=\"w\">   </span><span class=\"s2\">\"pos\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"s2\">\"line\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"column\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">15</span><span class=\"o\">},</span>\n<span class=\"w\">   </span><span class=\"s2\">\"endPos\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"s2\">\"line\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"column\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">17</span><span class=\"o\">},</span>\n<span class=\"w\">   </span><span class=\"s2\">\"data\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"unknown constant 'OfNat'\"</span><span class=\"o\">},</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"s2\">\"severity\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"error\"</span><span class=\"o\">,</span>\n<span class=\"w\">   </span><span class=\"s2\">\"pos\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"s2\">\"line\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"column\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">15</span><span class=\"o\">},</span>\n<span class=\"w\">   </span><span class=\"s2\">\"endPos\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"s2\">\"line\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"column\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">17</span><span class=\"o\">},</span>\n<span class=\"w\">   </span><span class=\"s2\">\"data\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"unknown constant 'sorryAx'\"</span><span class=\"o\">},</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"s2\">\"severity\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"error\"</span><span class=\"o\">,</span>\n<span class=\"w\">   </span><span class=\"s2\">\"pos\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"s2\">\"line\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"column\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"o\">},</span>\n<span class=\"w\">   </span><span class=\"s2\">\"endPos\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"s2\">\"line\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"column\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">},</span>\n<span class=\"w\">   </span><span class=\"s2\">\"data\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"unknown constant 'sorryAx'\"</span><span class=\"o\">},</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"s2\">\"severity\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"error\"</span><span class=\"o\">,</span>\n<span class=\"w\">   </span><span class=\"s2\">\"pos\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"s2\">\"line\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"column\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">9</span><span class=\"o\">},</span>\n<span class=\"w\">   </span><span class=\"s2\">\"endPos\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"s2\">\"line\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"column\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"o\">},</span>\n<span class=\"w\">   </span><span class=\"s2\">\"data\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"unknown constant 'OfNat'\"</span><span class=\"o\">},</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"s2\">\"severity\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"error\"</span><span class=\"o\">,</span>\n<span class=\"w\">   </span><span class=\"s2\">\"pos\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"s2\">\"line\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"column\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">9</span><span class=\"o\">},</span>\n<span class=\"w\">   </span><span class=\"s2\">\"endPos\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"s2\">\"line\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"column\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"o\">},</span>\n<span class=\"w\">   </span><span class=\"s2\">\"data\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"unknown constant 'sorryAx'\"</span><span class=\"o\">},</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"s2\">\"severity\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"error\"</span><span class=\"o\">,</span>\n<span class=\"w\">   </span><span class=\"s2\">\"pos\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"s2\">\"line\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"column\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">13</span><span class=\"o\">},</span>\n<span class=\"w\">   </span><span class=\"s2\">\"endPos\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"s2\">\"line\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"column\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">15</span><span class=\"o\">},</span>\n<span class=\"w\">   </span><span class=\"s2\">\"data\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"unexpected token '+'; expected ':=', 'where' or '|'\"</span><span class=\"o\">}],</span>\n<span class=\"w\"> </span><span class=\"s2\">\"env\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">}</span>\n</code></pre></div>\n<p>In comparison to when run as mentioned before from the repl's directory:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">{</span><span class=\"s2\">\"tactics\"</span><span class=\"o\">:</span>\n<span class=\"w\"> </span><span class=\"o\">[{</span><span class=\"s2\">\"tactic\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"exact rfl\"</span><span class=\"o\">,</span>\n<span class=\"w\">   </span><span class=\"s2\">\"proofState\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span>\n<span class=\"w\">   </span><span class=\"s2\">\"pos\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"s2\">\"line\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"column\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">29</span><span class=\"o\">},</span>\n<span class=\"w\">   </span><span class=\"s2\">\"goals\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"⊢ f + g = 39\"</span><span class=\"o\">,</span>\n<span class=\"w\">   </span><span class=\"s2\">\"endPos\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"s2\">\"line\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"column\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">38</span><span class=\"o\">}}],</span>\n<span class=\"w\"> </span><span class=\"s2\">\"env\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">}</span>\n</code></pre></div>\n<p>For reference, here's the file.lean that is copied in <code>Desktop/lean-repl</code> and <code>Desktop/test/Test/Test</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">37</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">39</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<p>I made sure that <code>Test/lakefile.lean</code> has the requires statement for mathlib, and still getting this issue. Any help would be super appreciated.</p>",
        "id": 448337721,
        "sender_full_name": "Riyaz Ahuja",
        "timestamp": 1719841893
    },
    {
        "content": "<p>Note that I just tested on <code>v4.10.0-rc1</code> and the same error came up</p>",
        "id": 448359176,
        "sender_full_name": "Riyaz Ahuja",
        "timestamp": 1719846507
    }
]