[
    {
        "content": "<p>I am trying to install everything on a fresh machine with Ubuntu 23.10, following the official <a href=\"https://leanprover-community.github.io/install/debian.html\">instructions</a>.</p>\n<p>It seems something doesn't work and VsCode is not installed</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>wget<span class=\"w\"> </span>-q<span class=\"w\"> </span>https://raw.githubusercontent.com/leanprover-community/mathlib4/master/scripts/install_debian.sh<span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span>bash<span class=\"w\"> </span>install_debian.sh<span class=\"w\"> </span><span class=\"p\">;</span><span class=\"w\"> </span>rm<span class=\"w\"> </span>-f<span class=\"w\"> </span>install_debian.sh<span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"nb\">source</span><span class=\"w\"> </span>~/.profile\n+<span class=\"w\"> </span>sudo<span class=\"w\"> </span>apt<span class=\"w\"> </span>install<span class=\"w\"> </span>-y<span class=\"w\"> </span>git<span class=\"w\"> </span>curl\n<span class=\"o\">[</span>sudo<span class=\"o\">]</span><span class=\"w\"> </span>password<span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span>riccardo:\nReading<span class=\"w\"> </span>package<span class=\"w\"> </span>lists...<span class=\"w\"> </span>Done\nBuilding<span class=\"w\"> </span>dependency<span class=\"w\"> </span>tree...<span class=\"w\"> </span>Done\nReading<span class=\"w\"> </span>state<span class=\"w\"> </span>information...<span class=\"w\"> </span>Done\nThe<span class=\"w\"> </span>following<span class=\"w\"> </span>additional<span class=\"w\"> </span>packages<span class=\"w\"> </span>will<span class=\"w\"> </span>be<span class=\"w\"> </span>installed:\n<span class=\"w\">  </span>git-man<span class=\"w\"> </span>liberror-perl\nSuggested<span class=\"w\"> </span>packages:\n<span class=\"w\">  </span>git-daemon-run<span class=\"w\"> </span><span class=\"p\">|</span><span class=\"w\"> </span>git-daemon-sysvinit<span class=\"w\"> </span>git-doc<span class=\"w\"> </span>git-email<span class=\"w\"> </span>git-gui<span class=\"w\"> </span>gitk<span class=\"w\"> </span>gitweb<span class=\"w\"> </span>git-cvs<span class=\"w\"> </span>git-mediawiki<span class=\"w\"> </span>git-svn\nThe<span class=\"w\"> </span>following<span class=\"w\"> </span>NEW<span class=\"w\"> </span>packages<span class=\"w\"> </span>will<span class=\"w\"> </span>be<span class=\"w\"> </span>installed:\n<span class=\"w\">  </span>curl<span class=\"w\"> </span>git<span class=\"w\"> </span>git-man<span class=\"w\"> </span>liberror-perl\n<span class=\"m\">0</span><span class=\"w\"> </span>upgraded,<span class=\"w\"> </span><span class=\"m\">4</span><span class=\"w\"> </span>newly<span class=\"w\"> </span>installed,<span class=\"w\"> </span><span class=\"m\">0</span><span class=\"w\"> </span>to<span class=\"w\"> </span>remove<span class=\"w\"> </span>and<span class=\"w\"> </span><span class=\"m\">8</span><span class=\"w\"> </span>not<span class=\"w\"> </span>upgraded.\nNeed<span class=\"w\"> </span>to<span class=\"w\"> </span>get<span class=\"w\"> </span><span class=\"m\">4</span>,910<span class=\"w\"> </span>kB<span class=\"w\"> </span>of<span class=\"w\"> </span>archives.\nAfter<span class=\"w\"> </span>this<span class=\"w\"> </span>operation,<span class=\"w\"> </span><span class=\"m\">24</span>.5<span class=\"w\"> </span>MB<span class=\"w\"> </span>of<span class=\"w\"> </span>additional<span class=\"w\"> </span>disk<span class=\"w\"> </span>space<span class=\"w\"> </span>will<span class=\"w\"> </span>be<span class=\"w\"> </span>used.\nGet:1<span class=\"w\"> </span>http://fr.archive.ubuntu.com/ubuntu<span class=\"w\"> </span>mantic-updates/main<span class=\"w\"> </span>amd64<span class=\"w\"> </span>curl<span class=\"w\"> </span>amd64<span class=\"w\"> </span><span class=\"m\">8</span>.2.1-1ubuntu3.2<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">216</span><span class=\"w\"> </span>kB<span class=\"o\">]</span>\nGet:2<span class=\"w\"> </span>http://fr.archive.ubuntu.com/ubuntu<span class=\"w\"> </span>mantic/main<span class=\"w\"> </span>amd64<span class=\"w\"> </span>liberror-perl<span class=\"w\"> </span>all<span class=\"w\"> </span><span class=\"m\">0</span>.17029-2<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">25</span>.6<span class=\"w\"> </span>kB<span class=\"o\">]</span>\nGet:3<span class=\"w\"> </span>http://fr.archive.ubuntu.com/ubuntu<span class=\"w\"> </span>mantic/main<span class=\"w\"> </span>amd64<span class=\"w\"> </span>git-man<span class=\"w\"> </span>all<span class=\"w\"> </span><span class=\"m\">1</span>:2.40.1-1ubuntu1<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">1</span>,085<span class=\"w\"> </span>kB<span class=\"o\">]</span>\nGet:4<span class=\"w\"> </span>http://fr.archive.ubuntu.com/ubuntu<span class=\"w\"> </span>mantic/main<span class=\"w\"> </span>amd64<span class=\"w\"> </span>git<span class=\"w\"> </span>amd64<span class=\"w\"> </span><span class=\"m\">1</span>:2.40.1-1ubuntu1<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">3</span>,583<span class=\"w\"> </span>kB<span class=\"o\">]</span>\nFetched<span class=\"w\"> </span><span class=\"m\">4</span>,910<span class=\"w\"> </span>kB<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>0s<span class=\"w\"> </span><span class=\"o\">(</span><span class=\"m\">25</span>.6<span class=\"w\"> </span>MB/s<span class=\"o\">)</span>\nSelecting<span class=\"w\"> </span>previously<span class=\"w\"> </span>unselected<span class=\"w\"> </span>package<span class=\"w\"> </span>curl.\n<span class=\"o\">(</span>Reading<span class=\"w\"> </span>database<span class=\"w\"> </span>...<span class=\"w\"> </span><span class=\"m\">142561</span><span class=\"w\"> </span>files<span class=\"w\"> </span>and<span class=\"w\"> </span>directories<span class=\"w\"> </span>currently<span class=\"w\"> </span>installed.<span class=\"o\">)</span>\nPreparing<span class=\"w\"> </span>to<span class=\"w\"> </span>unpack<span class=\"w\"> </span>.../curl_8.2.1-1ubuntu3.2_amd64.deb<span class=\"w\"> </span>...\nUnpacking<span class=\"w\"> </span>curl<span class=\"w\"> </span><span class=\"o\">(</span><span class=\"m\">8</span>.2.1-1ubuntu3.2<span class=\"o\">)</span><span class=\"w\"> </span>...\nSelecting<span class=\"w\"> </span>previously<span class=\"w\"> </span>unselected<span class=\"w\"> </span>package<span class=\"w\"> </span>liberror-perl.\nPreparing<span class=\"w\"> </span>to<span class=\"w\"> </span>unpack<span class=\"w\"> </span>.../liberror-perl_0.17029-2_all.deb<span class=\"w\"> </span>...\nUnpacking<span class=\"w\"> </span>liberror-perl<span class=\"w\"> </span><span class=\"o\">(</span><span class=\"m\">0</span>.17029-2<span class=\"o\">)</span><span class=\"w\"> </span>...\nSelecting<span class=\"w\"> </span>previously<span class=\"w\"> </span>unselected<span class=\"w\"> </span>package<span class=\"w\"> </span>git-man.\nPreparing<span class=\"w\"> </span>to<span class=\"w\"> </span>unpack<span class=\"w\"> </span>.../git-man_1%3a2.40.1-1ubuntu1_all.deb<span class=\"w\"> </span>...\nUnpacking<span class=\"w\"> </span>git-man<span class=\"w\"> </span><span class=\"o\">(</span><span class=\"m\">1</span>:2.40.1-1ubuntu1<span class=\"o\">)</span><span class=\"w\"> </span>...\nSelecting<span class=\"w\"> </span>previously<span class=\"w\"> </span>unselected<span class=\"w\"> </span>package<span class=\"w\"> </span>git.\nPreparing<span class=\"w\"> </span>to<span class=\"w\"> </span>unpack<span class=\"w\"> </span>.../git_1%3a2.40.1-1ubuntu1_amd64.deb<span class=\"w\"> </span>...\nUnpacking<span class=\"w\"> </span>git<span class=\"w\"> </span><span class=\"o\">(</span><span class=\"m\">1</span>:2.40.1-1ubuntu1<span class=\"o\">)</span><span class=\"w\"> </span>...\nSetting<span class=\"w\"> </span>up<span class=\"w\"> </span>liberror-perl<span class=\"w\"> </span><span class=\"o\">(</span><span class=\"m\">0</span>.17029-2<span class=\"o\">)</span><span class=\"w\"> </span>...\nSetting<span class=\"w\"> </span>up<span class=\"w\"> </span>git-man<span class=\"w\"> </span><span class=\"o\">(</span><span class=\"m\">1</span>:2.40.1-1ubuntu1<span class=\"o\">)</span><span class=\"w\"> </span>...\nSetting<span class=\"w\"> </span>up<span class=\"w\"> </span>curl<span class=\"w\"> </span><span class=\"o\">(</span><span class=\"m\">8</span>.2.1-1ubuntu3.2<span class=\"o\">)</span><span class=\"w\"> </span>...\nSetting<span class=\"w\"> </span>up<span class=\"w\"> </span>git<span class=\"w\"> </span><span class=\"o\">(</span><span class=\"m\">1</span>:2.40.1-1ubuntu1<span class=\"o\">)</span><span class=\"w\"> </span>...\nProcessing<span class=\"w\"> </span>triggers<span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span>man-db<span class=\"w\"> </span><span class=\"o\">(</span><span class=\"m\">2</span>.11.2-3<span class=\"o\">)</span><span class=\"w\"> </span>...\n+<span class=\"w\"> </span>wget<span class=\"w\"> </span>https://raw.githubusercontent.com/leanprover/elan/master/elan-init.sh\n--2024-01-16<span class=\"w\"> </span><span class=\"m\">16</span>:05:53--<span class=\"w\">  </span>https://raw.githubusercontent.com/leanprover/elan/master/elan-init.sh\nResolving<span class=\"w\"> </span>raw.githubusercontent.com<span class=\"w\"> </span><span class=\"o\">(</span>raw.githubusercontent.com<span class=\"o\">)</span>...<span class=\"w\"> </span><span class=\"m\">185</span>.199.110.133,<span class=\"w\"> </span><span class=\"m\">185</span>.199.109.133,<span class=\"w\"> </span><span class=\"m\">185</span>.199.111.133,<span class=\"w\"> </span>...\nConnecting<span class=\"w\"> </span>to<span class=\"w\"> </span>raw.githubusercontent.com<span class=\"w\"> </span><span class=\"o\">(</span>raw.githubusercontent.com<span class=\"o\">)</span><span class=\"p\">|</span><span class=\"m\">185</span>.199.110.133<span class=\"p\">|</span>:443...<span class=\"w\"> </span>connected.\nHTTP<span class=\"w\"> </span>request<span class=\"w\"> </span>sent,<span class=\"w\"> </span>awaiting<span class=\"w\"> </span>response...<span class=\"w\"> </span><span class=\"m\">200</span><span class=\"w\"> </span>OK\nLength:<span class=\"w\"> </span><span class=\"m\">10006</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"m\">9</span>.8K<span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span>text/plain<span class=\"o\">]</span>\nSaving<span class=\"w\"> </span>to:<span class=\"w\"> </span>‘elan-init.sh’\n\nelan-init.sh<span class=\"w\">                                  </span><span class=\"m\">100</span>%<span class=\"o\">[================================================================================================</span>&gt;<span class=\"o\">]</span><span class=\"w\">   </span><span class=\"m\">9</span>.77K<span class=\"w\">  </span>--.-KB/s<span class=\"w\">    </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"m\">0</span>.001s\n\n<span class=\"m\">2024</span>-01-16<span class=\"w\"> </span><span class=\"m\">16</span>:05:53<span class=\"w\"> </span><span class=\"o\">(</span><span class=\"m\">16</span>.8<span class=\"w\"> </span>MB/s<span class=\"o\">)</span><span class=\"w\"> </span>-<span class=\"w\"> </span>‘elan-init.sh’<span class=\"w\"> </span>saved<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">10006</span>/10006<span class=\"o\">]</span>\n\n+<span class=\"w\"> </span>bash<span class=\"w\"> </span>elan-init.sh<span class=\"w\"> </span>-y\ninfo:<span class=\"w\"> </span>downloading<span class=\"w\"> </span>installer\ninfo:<span class=\"w\"> </span>syncing<span class=\"w\"> </span>channel<span class=\"w\"> </span>updates<span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"s1\">'stable'</span>\ninfo:<span class=\"w\"> </span>latest<span class=\"w\"> </span>update<span class=\"w\"> </span>on<span class=\"w\"> </span>stable,<span class=\"w\"> </span>lean<span class=\"w\"> </span>version<span class=\"w\"> </span>v4.4.0\ninfo:<span class=\"w\"> </span>downloading<span class=\"w\"> </span>component<span class=\"w\"> </span><span class=\"s1\">'lean'</span>\n<span class=\"m\">182</span>.6<span class=\"w\"> </span>MiB<span class=\"w\"> </span>/<span class=\"w\"> </span><span class=\"m\">182</span>.6<span class=\"w\"> </span>MiB<span class=\"w\"> </span><span class=\"o\">(</span><span class=\"m\">100</span><span class=\"w\"> </span>%<span class=\"o\">)</span><span class=\"w\">  </span><span class=\"m\">89</span>.0<span class=\"w\"> </span>MiB/s<span class=\"w\"> </span>ETA:<span class=\"w\">   </span><span class=\"m\">0</span><span class=\"w\"> </span>s\ninfo:<span class=\"w\"> </span>installing<span class=\"w\"> </span>component<span class=\"w\"> </span><span class=\"s1\">'lean'</span>\ninfo:<span class=\"w\"> </span>default<span class=\"w\"> </span>toolchain<span class=\"w\"> </span><span class=\"nb\">set</span><span class=\"w\"> </span>to<span class=\"w\"> </span><span class=\"s1\">'stable'</span>\n\n<span class=\"w\">  </span>stable<span class=\"w\"> </span>installed<span class=\"w\"> </span>-<span class=\"w\"> </span>Lean<span class=\"w\"> </span><span class=\"o\">(</span>version<span class=\"w\"> </span><span class=\"m\">4</span>.4.0,<span class=\"w\"> </span>commit<span class=\"w\"> </span>ca7d6dadb9e1,<span class=\"w\"> </span>Release<span class=\"o\">)</span>\n\n+<span class=\"w\"> </span>rm<span class=\"w\"> </span>elan-init.sh\n++<span class=\"w\"> </span>which<span class=\"w\"> </span>code\n++<span class=\"w\"> </span>which<span class=\"w\"> </span>codium\n+<span class=\"w\"> </span><span class=\"nv\">vsc</span><span class=\"o\">=</span>\n</code></pre></div>\n<p>Am I a missing something or there is actually a problem with the script?</p>\n<p>Note that I am not asking how to finish the installation, just to check if the script is correct.</p>",
        "id": 413176002,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1705418063
    },
    {
        "content": "<p>I think the script is wrong.</p>",
        "id": 413187761,
        "sender_full_name": "Julian Berman",
        "timestamp": 1705420997
    },
    {
        "content": "<p>Specifically I think <code>which</code> at least in some shells will spit out its message to <code>stdout</code> and not <code>stderr</code>, so <code>2&gt;/dev/null</code> doesn't do anything, and <code>vsc</code> will be non-empty but the script is trying to check whether it exists.</p>",
        "id": 413187917,
        "sender_full_name": "Julian Berman",
        "timestamp": 1705421031
    },
    {
        "content": "<p>I personally avoid <code>which</code> at all costs (not to mention avoiding shell at all costs) but at worst it lies, and at best it can be confusing. But yeah that's I think the problem there.</p>",
        "id": 413188180,
        "sender_full_name": "Julian Berman",
        "timestamp": 1705421084
    },
    {
        "content": "<p>(On macOS by the way <code>which</code> behaves this way as well it seems, it outputs <code>foo not found</code> to stdout.)</p>",
        "id": 413188284,
        "sender_full_name": "Julian Berman",
        "timestamp": 1705421110
    },
    {
        "content": "<p>Maybe using <code>/usr/bin/which</code> (i.e. not the shell command) was intended or is a better idea, but probably some CI is also not a bad idea.</p>",
        "id": 413188512,
        "sender_full_name": "Julian Berman",
        "timestamp": 1705421167
    },
    {
        "content": "<p>have you tried <code>which which</code>? <span aria-label=\"laughing\" class=\"emoji emoji-1f606\" role=\"img\" title=\"laughing\">:laughing:</span></p>",
        "id": 413188686,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1705421218
    },
    {
        "content": "<p>which which<code>which code</code> does not return anything, as expected</p>",
        "id": 413190903,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1705421905
    },
    {
        "content": "<p>it seems it doesn't enter the <code>if</code></p>",
        "id": 413190945,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1705421916
    },
    {
        "content": "<p>It does the same thing on a fresh debian installation</p>",
        "id": 413191440,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1705422046
    },
    {
        "content": "<p>I don't know anything about shell scripts, but if I run by hand the line (erasing from the script)</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code><span class=\"nv\">vsc</span><span class=\"o\">=</span><span class=\"s2\">\"</span><span class=\"k\">$(</span>which<span class=\"w\"> </span>code1<span class=\"w\"> </span><span class=\"m\">2</span>&gt;/dev/null<span class=\"w\"> </span><span class=\"o\">||</span><span class=\"w\"> </span>which<span class=\"w\"> </span>codium<span class=\"w\"> </span><span class=\"m\">2</span>&gt;/dev/null<span class=\"k\">)</span><span class=\"s2\">\"</span>\n</code></pre></div>\n<p>and then I do <code>bash install_debian.sh</code> it works.</p>",
        "id": 413193962,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1705422803
    },
    {
        "content": "<p>Oh right, it's other shell nonsense.</p>",
        "id": 413193981,
        "sender_full_name": "Julian Berman",
        "timestamp": 1705422808
    },
    {
        "content": "<p>It's because <code>vsc=\"$(which code 2&gt;/dev/null || which codium 2&gt;/dev/null)\"</code> has nonzero exit code, and <code>set -e</code> will stop the script there</p>",
        "id": 413194376,
        "sender_full_name": "Julian Berman",
        "timestamp": 1705422916
    },
    {
        "content": "<p>Presumably you tried it at an interactive shell where you didn't run <code>set -e</code>.</p>",
        "id": 413194410,
        "sender_full_name": "Julian Berman",
        "timestamp": 1705422927
    },
    {
        "content": "<p>You can put <code>|| true</code> at the end there to fix it -- <code>vsc=\"$(which code 2&gt;/dev/null || which codium 2&gt;/dev/null || true)\"</code></p>",
        "id": 413194459,
        "sender_full_name": "Julian Berman",
        "timestamp": 1705422942
    },
    {
        "content": "<p>Yep, this works</p>",
        "id": 413194632,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1705422987
    },
    {
        "content": "<p>So what is the best solution? It seems pretty bad that literally the first thing a new user is supposed to run doesn't work as expected.</p>",
        "id": 413195427,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1705423271
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/9784\">#9784</a></p>",
        "id": 413199464,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1705424429
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"130384\">Riccardo Brasca</span> <a href=\"#narrow/stream/113488-general/topic/Installation.20on.20fresh.20Ubuntu/near/413195427\">said</a>:</p>\n<blockquote>\n<p>So what is the best solution? It seems pretty bad that literally the first thing a new user is supposed to run doesn't work as expected.</p>\n</blockquote>\n<p>the <code>|| true</code> would be my recommendation for being a small change. Removing the <code>set -e</code> is \"worse\" as it makes it a lot easier to <em>not</em> exit when something fails and you'd expect things to \"blow up\" in some reasonable language -- shell is a disaster.</p>",
        "id": 413211626,
        "sender_full_name": "Julian Berman",
        "timestamp": 1705428327
    }
]