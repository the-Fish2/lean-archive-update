[
    {
        "content": "<p>This isn't a full bug report/reproducer clearly, but I found again when updating to <code>4.8.0-rc1</code> and rebuilding mathlib4 that <code>lake build</code> produced obscure output and fails (repeatedly), necessitating an <code>rm -r .lake</code>, at which point now it appears to be running fine. Here's the output I got from updating to 4.8.0-rc1 and then running <code>lake build</code> in my Mathlib4 repository which I haven't built in around a month. Including the first 15 and last 15 lines and then the full file below as Zulip seems unhappy with the length:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">âŠ™</span>  <span class=\"n\">caffeinate</span> <span class=\"bp\">-</span><span class=\"n\">i</span> <span class=\"n\">lake</span> <span class=\"n\">build</span>                                                                                                                                                                                                                                                     <span class=\"n\">julian</span><span class=\"bp\">@</span><span class=\"n\">Mini</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">batteries</span><span class=\"o\">:</span> <span class=\"n\">cloning</span> <span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github.com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">batteries</span> <span class=\"n\">to</span> <span class=\"bp\">'././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">batteries'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">Qq</span><span class=\"o\">:</span> <span class=\"n\">updating</span> <span class=\"n\">repository</span> <span class=\"bp\">'././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">Qq'</span> <span class=\"n\">to</span> <span class=\"n\">revision</span> <span class=\"bp\">'</span><span class=\"mi\">53156671405</span><span class=\"n\">fbbd5402ed17a79bd129b961bd8d6'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">aesop</span><span class=\"o\">:</span> <span class=\"n\">updating</span> <span class=\"n\">repository</span> <span class=\"bp\">'././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">aesop'</span> <span class=\"n\">to</span> <span class=\"n\">revision</span> <span class=\"bp\">'</span><span class=\"mi\">2225</span><span class=\"n\">b0e4a3528da20499e2304b521e0c4c2a4563'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">proofwidgets</span><span class=\"o\">:</span> <span class=\"n\">updating</span> <span class=\"n\">repository</span> <span class=\"bp\">'././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">proofwidgets'</span> <span class=\"n\">to</span> <span class=\"n\">revision</span> <span class=\"bp\">'</span><span class=\"n\">e6b6247c61280c77ade6bbf0bc3c66a44fe2e0c5'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">Cli</span><span class=\"o\">:</span> <span class=\"n\">updating</span> <span class=\"n\">repository</span> <span class=\"bp\">'././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">Cli'</span> <span class=\"n\">to</span> <span class=\"n\">revision</span> <span class=\"bp\">'</span><span class=\"n\">a11566029bd9ec4f68a65394e8c3ff1af74c1a29'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">importGraph</span><span class=\"o\">:</span> <span class=\"n\">updating</span> <span class=\"n\">repository</span> <span class=\"bp\">'././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">importGraph'</span> <span class=\"n\">to</span> <span class=\"n\">revision</span> <span class=\"bp\">'</span><span class=\"n\">c46d22bbe4f8363c0829ce0eb48a95012cdc0d79'</span>\n<span class=\"o\">[</span><span class=\"mi\">279</span><span class=\"bp\">/</span><span class=\"mi\">4462</span><span class=\"o\">]</span> <span class=\"n\">Building</span> <span class=\"n\">Aesop.RuleSet.Filter</span>\n<span class=\"n\">trace</span><span class=\"o\">:</span> <span class=\"bp\">.&gt;</span> <span class=\"n\">LEAN_PATH</span><span class=\"bp\">=././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">batteries</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"o\">:</span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">Qq</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"o\">:</span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">aesop</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"o\">:</span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">proofwidgets</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"o\">:</span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">Cli</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"o\">:</span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">importGraph</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"o\">:</span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span> <span class=\"n\">DYLD_LIBRARY_PATH</span><span class=\"bp\">=././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">aesop</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span> <span class=\"bp\">/</span><span class=\"n\">opt</span><span class=\"bp\">/</span><span class=\"n\">homebrew</span><span class=\"bp\">/</span><span class=\"n\">Cellar</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"bp\">.</span><span class=\"mi\">8</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">-</span><span class=\"n\">rc1</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"n\">lean</span> <span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">aesop</span><span class=\"bp\">/././</span><span class=\"n\">Aesop</span><span class=\"bp\">/</span><span class=\"n\">RuleSet</span><span class=\"bp\">/</span><span class=\"n\">Filter.lean</span> <span class=\"bp\">-</span><span class=\"n\">R</span> <span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">aesop</span><span class=\"bp\">/./.</span> <span class=\"bp\">-</span><span class=\"n\">o</span> <span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">aesop</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">Aesop</span><span class=\"bp\">/</span><span class=\"n\">RuleSet</span><span class=\"bp\">/</span><span class=\"n\">Filter.olean</span> <span class=\"bp\">-</span><span class=\"n\">i</span> <span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">aesop</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">Aesop</span><span class=\"bp\">/</span><span class=\"n\">RuleSet</span><span class=\"bp\">/</span><span class=\"n\">Filter.ilean</span> <span class=\"bp\">-</span><span class=\"n\">c</span> <span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">aesop</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">ir</span><span class=\"bp\">/</span><span class=\"n\">Aesop</span><span class=\"bp\">/</span><span class=\"n\">RuleSet</span><span class=\"bp\">/</span><span class=\"n\">Filter.c</span> <span class=\"c1\">--json</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">aesop</span><span class=\"bp\">/././</span><span class=\"n\">Aesop</span><span class=\"bp\">/</span><span class=\"n\">RuleSet</span><span class=\"bp\">/</span><span class=\"n\">Filter.lean</span><span class=\"o\">:</span><span class=\"mi\">69</span><span class=\"o\">:</span><span class=\"mi\">18</span><span class=\"bp\">-</span><span class=\"mi\">69</span><span class=\"o\">:</span><span class=\"mi\">33</span><span class=\"o\">:</span> <span class=\"n\">failed</span> <span class=\"n\">to</span> <span class=\"n\">synthesize</span> <span class=\"kd\">instance</span>\n  <span class=\"n\">BEq</span> <span class=\"n\">RuleSetName</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">Lean</span> <span class=\"n\">exited</span> <span class=\"k\">with</span> <span class=\"n\">code</span> <span class=\"mi\">1</span>\n<span class=\"o\">[</span><span class=\"mi\">287</span><span class=\"bp\">/</span><span class=\"mi\">4462</span><span class=\"o\">]</span> <span class=\"n\">Building</span> <span class=\"n\">Aesop.Builder.Apply</span>\n<span class=\"n\">trace</span><span class=\"o\">:</span> <span class=\"bp\">.&gt;</span> <span class=\"n\">LEAN_PATH</span><span class=\"bp\">=././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">batteries</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"o\">:</span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">Qq</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"o\">:</span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">aesop</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"o\">:</span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">proofwidgets</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"o\">:</span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">Cli</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"o\">:</span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">importGraph</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"o\">:</span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span> <span class=\"n\">DYLD_LIBRARY_PATH</span><span class=\"bp\">=././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">aesop</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span> <span class=\"bp\">/</span><span class=\"n\">opt</span><span class=\"bp\">/</span><span class=\"n\">homebrew</span><span class=\"bp\">/</span><span class=\"n\">Cellar</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"bp\">.</span><span class=\"mi\">8</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">-</span><span class=\"n\">rc1</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"n\">lean</span> <span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">aesop</span><span class=\"bp\">/././</span><span class=\"n\">Aesop</span><span class=\"bp\">/</span><span class=\"n\">Builder</span><span class=\"bp\">/</span><span class=\"n\">Apply.lean</span> <span class=\"bp\">-</span><span class=\"n\">R</span> <span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">aesop</span><span class=\"bp\">/./.</span> <span class=\"bp\">-</span><span class=\"n\">o</span> <span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">aesop</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">Aesop</span><span class=\"bp\">/</span><span class=\"n\">Builder</span><span class=\"bp\">/</span><span class=\"n\">Apply.olean</span> <span class=\"bp\">-</span><span class=\"n\">i</span> <span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">aesop</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">Aesop</span><span class=\"bp\">/</span><span class=\"n\">Builder</span><span class=\"bp\">/</span><span class=\"n\">Apply.ilean</span> <span class=\"bp\">-</span><span class=\"n\">c</span> <span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">aesop</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">ir</span><span class=\"bp\">/</span><span class=\"n\">Aesop</span><span class=\"bp\">/</span><span class=\"n\">Builder</span><span class=\"bp\">/</span><span class=\"n\">Apply.c</span> <span class=\"c1\">--json</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">aesop</span><span class=\"bp\">/././</span><span class=\"n\">Aesop</span><span class=\"bp\">/</span><span class=\"n\">Builder</span><span class=\"bp\">/</span><span class=\"n\">Apply.lean</span><span class=\"o\">:</span><span class=\"mi\">41</span><span class=\"o\">:</span><span class=\"mi\">4</span><span class=\"bp\">-</span><span class=\"mi\">41</span><span class=\"o\">:</span><span class=\"mi\">76</span><span class=\"o\">:</span> <span class=\"n\">failed</span> <span class=\"n\">to</span> <span class=\"n\">synthesize</span> <span class=\"kd\">instance</span>\n</code></pre></div>\n<p>and last 20:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code>  <span class=\"n\">Monad</span> <span class=\"n\">ElabM</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">Lean</span> <span class=\"n\">exited</span> <span class=\"k\">with</span> <span class=\"n\">code</span> <span class=\"mi\">1</span>\n<span class=\"o\">[</span><span class=\"mi\">295</span><span class=\"bp\">/</span><span class=\"mi\">4462</span><span class=\"o\">]</span> <span class=\"n\">Building</span> <span class=\"n\">Aesop.Builder.Unfold</span>\n<span class=\"n\">trace</span><span class=\"o\">:</span> <span class=\"bp\">.&gt;</span> <span class=\"n\">LEAN_PATH</span><span class=\"bp\">=././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">batteries</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"o\">:</span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">Qq</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"o\">:</span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">aesop</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"o\">:</span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">proofwidgets</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"o\">:</span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">Cli</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"o\">:</span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">importGraph</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"o\">:</span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span> <span class=\"n\">DYLD_LIBRARY_PATH</span><span class=\"bp\">=././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">aesop</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span> <span class=\"bp\">/</span><span class=\"n\">opt</span><span class=\"bp\">/</span><span class=\"n\">homebrew</span><span class=\"bp\">/</span><span class=\"n\">Cellar</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"bp\">.</span><span class=\"mi\">8</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">-</span><span class=\"n\">rc1</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"n\">lean</span> <span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">aesop</span><span class=\"bp\">/././</span><span class=\"n\">Aesop</span><span class=\"bp\">/</span><span class=\"n\">Builder</span><span class=\"bp\">/</span><span class=\"n\">Unfold.lean</span> <span class=\"bp\">-</span><span class=\"n\">R</span> <span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">aesop</span><span class=\"bp\">/./.</span> <span class=\"bp\">-</span><span class=\"n\">o</span> <span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">aesop</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">Aesop</span><span class=\"bp\">/</span><span class=\"n\">Builder</span><span class=\"bp\">/</span><span class=\"n\">Unfold.olean</span> <span class=\"bp\">-</span><span class=\"n\">i</span> <span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">aesop</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">Aesop</span><span class=\"bp\">/</span><span class=\"n\">Builder</span><span class=\"bp\">/</span><span class=\"n\">Unfold.ilean</span> <span class=\"bp\">-</span><span class=\"n\">c</span> <span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">aesop</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">ir</span><span class=\"bp\">/</span><span class=\"n\">Aesop</span><span class=\"bp\">/</span><span class=\"n\">Builder</span><span class=\"bp\">/</span><span class=\"n\">Unfold.c</span> <span class=\"c1\">--json</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">aesop</span><span class=\"bp\">/././</span><span class=\"n\">Aesop</span><span class=\"bp\">/</span><span class=\"n\">Builder</span><span class=\"bp\">/</span><span class=\"n\">Unfold.lean</span><span class=\"o\">:</span><span class=\"mi\">39</span><span class=\"o\">:</span><span class=\"mi\">2</span><span class=\"bp\">-</span><span class=\"mi\">39</span><span class=\"o\">:</span><span class=\"mi\">59</span><span class=\"o\">:</span> <span class=\"n\">failed</span> <span class=\"n\">to</span> <span class=\"n\">synthesize</span> <span class=\"kd\">instance</span>\n  <span class=\"n\">Pure</span> <span class=\"n\">ElabM</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">aesop</span><span class=\"bp\">/././</span><span class=\"n\">Aesop</span><span class=\"bp\">/</span><span class=\"n\">Builder</span><span class=\"bp\">/</span><span class=\"n\">Unfold.lean</span><span class=\"o\">:</span><span class=\"mi\">38</span><span class=\"o\">:</span><span class=\"mi\">2</span><span class=\"bp\">-</span><span class=\"mi\">38</span><span class=\"o\">:</span><span class=\"mi\">44</span><span class=\"o\">:</span> <span class=\"n\">failed</span> <span class=\"n\">to</span> <span class=\"n\">synthesize</span> <span class=\"kd\">instance</span>\n  <span class=\"n\">Bind</span> <span class=\"n\">ElabM</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">aesop</span><span class=\"bp\">/././</span><span class=\"n\">Aesop</span><span class=\"bp\">/</span><span class=\"n\">Builder</span><span class=\"bp\">/</span><span class=\"n\">Unfold.lean</span><span class=\"o\">:</span><span class=\"mi\">37</span><span class=\"o\">:</span><span class=\"mi\">2</span><span class=\"bp\">-</span><span class=\"mi\">37</span><span class=\"o\">:</span><span class=\"mi\">51</span><span class=\"o\">:</span> <span class=\"n\">failed</span> <span class=\"n\">to</span> <span class=\"n\">synthesize</span> <span class=\"kd\">instance</span>\n  <span class=\"n\">Bind</span> <span class=\"n\">ElabM</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">Lean</span> <span class=\"n\">exited</span> <span class=\"k\">with</span> <span class=\"n\">code</span> <span class=\"mi\">1</span>\n<span class=\"n\">Some</span> <span class=\"n\">build</span> <span class=\"n\">steps</span> <span class=\"n\">logged</span> <span class=\"n\">failures</span><span class=\"o\">:</span>\n<span class=\"bp\">-</span> <span class=\"n\">Building</span> <span class=\"n\">Aesop.RuleSet.Filter</span>\n<span class=\"bp\">-</span> <span class=\"n\">Building</span> <span class=\"n\">Aesop.Builder.Apply</span>\n<span class=\"bp\">-</span> <span class=\"n\">Building</span> <span class=\"n\">Aesop.Builder.Cases</span>\n<span class=\"bp\">-</span> <span class=\"n\">Building</span> <span class=\"n\">Aesop.Builder.NormSimp</span>\n<span class=\"bp\">-</span> <span class=\"n\">Building</span> <span class=\"n\">Aesop.Builder.Tactic</span>\n<span class=\"bp\">-</span> <span class=\"n\">Building</span> <span class=\"n\">Aesop.Builder.Forward</span>\n<span class=\"bp\">-</span> <span class=\"n\">Building</span> <span class=\"n\">Aesop.Builder.Unfold</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">build</span> <span class=\"n\">failed</span>\n</code></pre></div>\n<p><a href=\"/user_uploads/3121/w8EGcmopKhfMa2DmwNSpRHf1/foo\">Full output</a></p>\n<p>If there's something I can include in the future that helps diagnose <em>why</em> lake is confused let me know.</p>",
        "id": 437530292,
        "sender_full_name": "Julian Berman",
        "timestamp": 1715115689
    },
    {
        "content": "<p>A question which is only intended to be the slightest bit leading is \"should <code>lake build</code> imply <code>lake clean</code> if the toolchain has changed / mismatches the contents of <code>.lake</code>, which I presume must have some idea of what it was the last time things were built\"? It's the case that <code>olean</code>s are pinned to a version right, so is there any reason to be any more clever than \"guess I should throw everything away before starting\"?</p>",
        "id": 437531258,
        "sender_full_name": "Julian Berman",
        "timestamp": 1715116087
    },
    {
        "content": "<p>Yes, I find that I need <code>rm -rf .lake</code> too often when switching toolchains. It would be good to get to the bottom of this. <span class=\"user-mention\" data-user-id=\"315577\">@Mac Malone</span>, do you have any suggestions about how we might obtain a repro for this?</p>",
        "id": 437545080,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1715122291
    },
    {
        "content": "<p>My suggestion is to figure out why those Lean errors are being produced. For example, have those instances changed between the old version and the new version you are updating to? If so, that would imply that Lean/Lake is somehow reusing the old oleans. In that case, it would be useful to know which oleans it is reusing  and why (e.g., what are traces, etc.).</p>",
        "id": 437554811,
        "sender_full_name": "Mac Malone",
        "timestamp": 1715128846
    },
    {
        "content": "<p>From there it may be possible to build a MWE, which would really help with fixing whatever is going wrong here.</p>",
        "id": 437554842,
        "sender_full_name": "Mac Malone",
        "timestamp": 1715128879
    },
    {
        "content": "<p>My recollection is that the specific errors there are slight red herrings, I'm pretty sure I see something like this nearly each time I upgrade, albeit that's around once a month obviously given the release cycle, but it's definitely not the first time, I knew immediately that blowing away the directory was going to fix it when I saw the error -- anyways I say that because I am fairly sure that the last two times this happened the errors were some other different ones than instance synthesis it was whatever other kind of errors happened -- so I definitely assumed the cause was reusing old oleans, but I don't/didn't know how to answer the \"why are they being used\" question -- if you have any specific advice for how to debug that (I take it you were teaching me that one of the traces will tell me at least some information there?) them I'm happy to try to poke next month.</p>",
        "id": 437557647,
        "sender_full_name": "Julian Berman",
        "timestamp": 1715130906
    },
    {
        "content": "<p>Oh maybe I don't even need to wait until then, do I have any other built projects cloned other than Mathlib...</p>",
        "id": 437557820,
        "sender_full_name": "Julian Berman",
        "timestamp": 1715131056
    },
    {
        "content": "<p>I just upgraded to rc2 and sure enough have the same issue -- removing <code>.lake</code> of course again gets me a working build.<br>\nThis time before doing so I backed up the directory, so I have a \"broken\" copy as well still.</p>",
        "id": 440171808,
        "sender_full_name": "Julian Berman",
        "timestamp": 1716407902
    },
    {
        "content": "<p>Let me know if there's anything I can poke at to diagnose.</p>",
        "id": 440171842,
        "sender_full_name": "Julian Berman",
        "timestamp": 1716407916
    }
]