[
    {
        "content": "<p>I needed a browser-only syntax highlighting solution for Lean 4 a few days ago. I've chosen <a href=\"https://shiki.style/\">shiki</a> because it can reuse themes and language syntaxes from VSCode. I want to reuse my favorite theme from VSCode (Railscasts Renewed), and most highlighting js libraries don't support highlighting Lean 4, e.g. <a href=\"https://highlightjs.readthedocs.io/en/latest/language-contribution.html\">highlight.js</a>, <a href=\"https://prismjs.com/extending.html#language-definitions\">prism.js</a>, <a href=\"https://codemirror.net/examples/lang-package/\">code mirror</a> (these are links to add a new language to them). </p>\n<p>So I would like to share my (quite simple) solution in case anyone needs it too, besides <a href=\"#narrow/stream/113489-new-members/topic/LaTeX.20Syntax.20rendering\">the syntax highligting solution for LaTeX based on minted</a> and <a href=\"https://github.com/pygments/pygments/pull/2618\">pygments</a>.</p>\n<p>The script is <a href=\"https://github.com/utensil/forest/blob/main/assets/shiki.js\">here</a>, it could be simplified if one only wishes to use <a href=\"https://shiki.style/themes\">bundled themes</a>, or one deploys the <a href=\"https://github.com/leanprover/vscode-lean4/blob/master/vscode-lean4/syntaxes/lean4.json\">VSCode Lean syntax json</a> like it's bundled. There's also a bit of light/dark theme switch code that needs adaption for the switch mechanism in use.</p>\n<p>To use the sciprt, add the following to your html:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">&lt;</span><span class=\"n\">script</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"bp\">=</span><span class=\"s2\">\"module\"</span><span class=\"w\"> </span><span class=\"n\">src</span><span class=\"bp\">=</span><span class=\"s2\">\"shiki.js\"</span><span class=\"bp\">&gt;&lt;/</span><span class=\"n\">script</span><span class=\"bp\">&gt;</span>\n</code></pre></div>\n<p>It looks like this in dark theme (<a href=\"https://utensil.github.io/forest/math-0003.xml\">test page</a>):</p>\n<p><a href=\"/user_uploads/3121/vydtWQyjHg2HtIeureiRjaex/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/vydtWQyjHg2HtIeureiRjaex/image.png\" title=\"image.png\"><img src=\"/user_uploads/3121/vydtWQyjHg2HtIeureiRjaex/image.png\"></a></div>",
        "id": 441373212,
        "sender_full_name": "Utensil Song",
        "timestamp": 1717041777
    },
    {
        "content": "<p>There are a few potential improvements though:</p>\n<ol>\n<li>single line comments that doesn't start at the beginning of a line are not highlighted:</li>\n</ol>\n<p><a href=\"/user_uploads/3121/yPR8Oiqb4gdar_QTERP-LHXq/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/yPR8Oiqb4gdar_QTERP-LHXq/image.png\" title=\"image.png\"><img src=\"/user_uploads/3121/yPR8Oiqb4gdar_QTERP-LHXq/image.png\"></a></div><ol start=\"2\">\n<li>some tricky syntax is not handled:</li>\n</ol>\n<p><a href=\"/user_uploads/3121/GYuTlgpfbJi87EefmreH48yV/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/GYuTlgpfbJi87EefmreH48yV/image.png\" title=\"image.png\"><img src=\"/user_uploads/3121/GYuTlgpfbJi87EefmreH48yV/image.png\"></a></div><p>These issue don't show up in VS Code probably due to <a href=\"#narrow/stream/270676-lean4/topic/Semantic.20highlighting.20export\">semantic highlighting</a>.</p>",
        "id": 441373880,
        "sender_full_name": "Utensil Song",
        "timestamp": 1717042204
    },
    {
        "content": "<p>@Marc Huisinga Can you help evaluating if these syntax json files will accept PRs to fix these issues, or are they non-issue because LSP will fix them with semantic highlighting? Thanks, no hurry, I can see that you are in vocation. <span aria-label=\"palm tree\" class=\"emoji emoji-1f334\" role=\"img\" title=\"palm tree\">:palm_tree:</span></p>",
        "id": 441374934,
        "sender_full_name": "Utensil Song",
        "timestamp": 1717042913
    },
    {
        "content": "<p>Issue 1. is not an issue in VS Code when you disable semantic highlighting using the 'Editor &gt; Semantic Highlighting: Enabled' setting. In fact, we do not use the <code>comment</code> semantic token kind at all, so all comment highlighting you see is provided by the editor.</p>\n<p>I can confirm that issue 2. is reproducible in VS Code. I'm happy to accept PRs to the TextMate Lean 4 syntax highlighting as long as it's not excessively tricky to make the adjustment; the regexes in the grammar shouldn't get too messy and there shouldn't be lots of additional edge cases introduced by a change. Searching Mathlib with the regexes that you are trying to implement can be helpful in this regard.</p>",
        "id": 441409381,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1717058185
    },
    {
        "content": "<p>Thanks, then I suspect issue 1 could be caused by shiki instead. I'll take a look into them. As for regex, hopefully it's not going to be messy as <span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> 's pygments lexer has already handled this case, and we just need to port it from there.</p>",
        "id": 441420956,
        "sender_full_name": "Utensil Song",
        "timestamp": 1717062266
    },
    {
        "content": "<p>There is already highlight.js support for lean3, in a package in the leanprover-community organization</p>",
        "id": 441422804,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1717062974
    },
    {
        "content": "<p>I have a lean 4 version somewhere that I should upload somewhere central</p>",
        "id": 441422858,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1717062995
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/stream/113488-general/topic/browser-only.20syntax.20highlighting/near/441422804\">said</a>:</p>\n<blockquote>\n<p>There is already highlight.js support for lean3, in a package in the leanprover-community organization</p>\n</blockquote>\n<p>Yeah, I know about that one, but it looked obsolete. So I thought, the VS Code syntax file is certainly going to be maintained. Then I found shiki to consume it.</p>",
        "id": 441423718,
        "sender_full_name": "Utensil Song",
        "timestamp": 1717063295
    },
    {
        "content": "<p>What would be really really useful would be a way to export semantic syntax highlighting information. It is currently extremely painful to write a paper showing Lean code.</p>",
        "id": 441454435,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1717074903
    },
    {
        "content": "<blockquote>\n<p>It is currently extremely painful to write a paper showing Lean code</p>\n</blockquote>\n<p>I think this is no longer true on bleeding edge versions of things; <code>minted</code> now works out of the box, and LuaLaTeX can load JuliaMono without much difficulty</p>",
        "id": 441456582,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1717075580
    },
    {
        "content": "<p>Of course the export would give better highlighting</p>",
        "id": 441456669,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1717075613
    },
    {
        "content": "<p>The new version of minted would not do semantic syntax highlighting, right?</p>",
        "id": 441470526,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1717079538
    },
    {
        "content": "<p>Correct, but it does the same syntax higlihting as Zulip at least</p>",
        "id": 441492474,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1717084513
    }
]