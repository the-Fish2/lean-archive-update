[
    {
        "content": "<p>Is there a standard setup for GitHub Actions to check that PRs against some lean4/mathlib4 project are building (and also to help keeping up to date with mathlib updates)?</p>",
        "id": 420429436,
        "sender_full_name": "Marcello Seri",
        "timestamp": 1707388806
    },
    {
        "content": "<p>I'll add a solution which works here because the thread might be useful for others. The <a href=\"https://leanprover-community.github.io/ci.html\">page about github CI</a> on the lean community site is outdated.  Adding the following to a Github action will build a lean project. Action will fail on a lean error but will succeed even if there are warnings, e.g., from a <code>sorry</code>.</p>\n<div class=\"codehilite\" data-code-language=\"YAML\"><pre><span></span><code><span class=\"nt\">jobs</span><span class=\"p\">:</span>\n<span class=\"w\">  </span><span class=\"nt\">build_project</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"nt\">runs-on</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">ubuntu-latest</span>\n<span class=\"w\">    </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">Build project</span>\n<span class=\"w\">    </span><span class=\"nt\">steps</span><span class=\"p\">:</span>\n<span class=\"w\">      </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">Checkout project</span>\n<span class=\"w\">        </span><span class=\"nt\">uses</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">actions/checkout@v4</span>\n<span class=\"w\">      </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">Install elan</span>\n<span class=\"w\">        </span><span class=\"nt\">run</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">curl https://raw.githubusercontent.com/leanprover/elan/master/elan-init.sh -sSf | sh -s -- -y</span>\n<span class=\"w\">      </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">Get cache</span>\n<span class=\"w\">        </span><span class=\"nt\">run</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">~/.elan/bin/lake exe cache get || true</span>\n<span class=\"w\">      </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">Build project</span>\n<span class=\"w\">        </span><span class=\"nt\">run</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">~/.elan/bin/lake build</span>\n</code></pre></div>\n<p>Full file: <a href=\"/user_uploads/3121/ptNcRoMtuhA6GnWhQ-7D7wJy/build.yml\">build.yml</a>. <br>\nThen one probably wants to do other things like linting, building documentation, building the blueprint.  For example as done in in the CLT project <a href=\"https://github.com/RemyDegenne/CLT/blob/master/.github/workflows/push.yml\">push.yml</a>.</p>",
        "id": 420879307,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1707647565
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"613177\">@Oliver Butterley</span>, thanks for this!</p>\n<p>Why the <code>-Kenv=dev</code>?</p>\n<p>Would you be able to make a PR to correct that information on the community site?</p>",
        "id": 420881698,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1707649838
    },
    {
        "content": "<p>No, <code>-Kenv=dev</code> shouldn't be there for this (I'll edit the message). Thanks for the correction! </p>\n<p>OK, fairly soon I'll try to write something to update that page.</p>",
        "id": 420882959,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1707651150
    },
    {
        "content": "<p>By the way, I noticed that the <a href=\"https://leanprover-community.github.io/ci.html\">page about github CI</a> on the lean community site no longer exists in the source. It appears the build setup there updates changed pages but doesn't remove pages which are removed in the source. Anyway, I promised to update that page but did nothing because it appears that it was decided somewhere to remove it instead. </p>\n<p>Anyway, I do believe that useful info about using github actions is relevant to many and I'm willing to add some info somewhere. I see that an action is being developed for this task so I believe an update to the documentation can wait for that.</p>",
        "id": 437003527,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1714811072
    },
    {
        "content": "<p>Concerning an update workflow, we have been testing our own creation that runs on cron, checks if an update is available, opens a PR if it is available and the updated version builds or opens an issue if the updated version fails to build. Still unclear to us what the preferred behaviour is from the user side but I could turn our sketch into a fully fledged action if that were useful.</p>",
        "id": 437004011,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1714811638
    },
    {
        "content": "<p>I don't think they were removed because we don't want them, but rather because the information was misleading because it was too out of date</p>",
        "id": 437004333,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1714811981
    },
    {
        "content": "<p>See <a href=\"https://github.com/leanprover-community/leanprover-community.github.io/commit/892d9086699a5676dbc4d24d7909c0ac9b1be212\">https://github.com/leanprover-community/leanprover-community.github.io/commit/892d9086699a5676dbc4d24d7909c0ac9b1be212</a> for the commit which removes that page</p>",
        "id": 437004389,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1714812013
    }
]