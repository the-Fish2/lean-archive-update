[
    {
        "content": "<p>I'm trying to use the REPL from a different project as per the last section in the readme in <a href=\"https://github.com/leanprover-community/repl\">the github</a>. However, instead of getting the repl output as it normally does, I'm getting many errors. </p>\n<p>As a MWE, I made a fresh clone of the github above to <code>Desktop/lean-repl</code>, and ran the <code>lake exe repl</code> to initially build everything and then <code>echo '{\"path\": \"test/file.lean\", \"allTactics\": true}' | lake exe repl</code> as per the ReadMe. I get the expected output, completely identical to <code>test/file.expected.out</code>. </p>\n<p>Then I made an empty folder <code>Desktop/test</code> and used the VSCode widget (<code>âˆ€</code>) to make a new lean 4 project with mathlib called Test. I then go to my project folder <code>Desktop/test/Test</code> and with the default <code>Test/Basic.lean</code>, I copied over the <code>file.in</code> and <code>file.lean</code> from the REPL's source code. Note that the infoview works perfectly fine and running <code>lake build</code> returned success. Then, just as the readme says, i ran from this directory: <code>lake env /Users/ahuja/Desktop/lean-repl/.lake/build/bin/repl &lt; Test/file.in</code> and got the following:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">{</span><span class=\"s2\">\"messages\"</span><span class=\"o\">:</span>\n<span class=\"w\"> </span><span class=\"o\">[{</span><span class=\"s2\">\"severity\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"error\"</span><span class=\"o\">,</span>\n<span class=\"w\">   </span><span class=\"s2\">\"pos\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"s2\">\"line\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"column\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">15</span><span class=\"o\">},</span>\n<span class=\"w\">   </span><span class=\"s2\">\"endPos\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"s2\">\"line\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"column\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">17</span><span class=\"o\">},</span>\n<span class=\"w\">   </span><span class=\"s2\">\"data\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"unknown constant 'OfNat'\"</span><span class=\"o\">},</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"s2\">\"severity\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"error\"</span><span class=\"o\">,</span>\n<span class=\"w\">   </span><span class=\"s2\">\"pos\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"s2\">\"line\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"column\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">15</span><span class=\"o\">},</span>\n<span class=\"w\">   </span><span class=\"s2\">\"endPos\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"s2\">\"line\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"column\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">17</span><span class=\"o\">},</span>\n<span class=\"w\">   </span><span class=\"s2\">\"data\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"unknown constant 'sorryAx'\"</span><span class=\"o\">},</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"s2\">\"severity\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"error\"</span><span class=\"o\">,</span>\n<span class=\"w\">   </span><span class=\"s2\">\"pos\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"s2\">\"line\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"column\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"o\">},</span>\n<span class=\"w\">   </span><span class=\"s2\">\"endPos\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"s2\">\"line\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"column\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">},</span>\n<span class=\"w\">   </span><span class=\"s2\">\"data\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"unknown constant 'sorryAx'\"</span><span class=\"o\">},</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"s2\">\"severity\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"error\"</span><span class=\"o\">,</span>\n<span class=\"w\">   </span><span class=\"s2\">\"pos\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"s2\">\"line\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"column\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">9</span><span class=\"o\">},</span>\n<span class=\"w\">   </span><span class=\"s2\">\"endPos\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"s2\">\"line\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"column\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"o\">},</span>\n<span class=\"w\">   </span><span class=\"s2\">\"data\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"unknown constant 'OfNat'\"</span><span class=\"o\">},</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"s2\">\"severity\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"error\"</span><span class=\"o\">,</span>\n<span class=\"w\">   </span><span class=\"s2\">\"pos\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"s2\">\"line\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"column\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">9</span><span class=\"o\">},</span>\n<span class=\"w\">   </span><span class=\"s2\">\"endPos\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"s2\">\"line\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"column\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"o\">},</span>\n<span class=\"w\">   </span><span class=\"s2\">\"data\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"unknown constant 'sorryAx'\"</span><span class=\"o\">},</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"s2\">\"severity\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"error\"</span><span class=\"o\">,</span>\n<span class=\"w\">   </span><span class=\"s2\">\"pos\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"s2\">\"line\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"column\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">13</span><span class=\"o\">},</span>\n<span class=\"w\">   </span><span class=\"s2\">\"endPos\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"s2\">\"line\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"column\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">15</span><span class=\"o\">},</span>\n<span class=\"w\">   </span><span class=\"s2\">\"data\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"unexpected token '+'; expected ':=', 'where' or '|'\"</span><span class=\"o\">}],</span>\n<span class=\"w\"> </span><span class=\"s2\">\"env\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">}</span>\n</code></pre></div>\n<p>In comparison to when run as mentioned before from the repl's directory:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">{</span><span class=\"s2\">\"tactics\"</span><span class=\"o\">:</span>\n<span class=\"w\"> </span><span class=\"o\">[{</span><span class=\"s2\">\"tactic\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"exact rfl\"</span><span class=\"o\">,</span>\n<span class=\"w\">   </span><span class=\"s2\">\"proofState\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span>\n<span class=\"w\">   </span><span class=\"s2\">\"pos\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"s2\">\"line\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"column\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">29</span><span class=\"o\">},</span>\n<span class=\"w\">   </span><span class=\"s2\">\"goals\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"âŠ¢ f + g = 39\"</span><span class=\"o\">,</span>\n<span class=\"w\">   </span><span class=\"s2\">\"endPos\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"s2\">\"line\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"column\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">38</span><span class=\"o\">}}],</span>\n<span class=\"w\"> </span><span class=\"s2\">\"env\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">}</span>\n</code></pre></div>\n<p>For reference, here's the file.lean that is copied in <code>Desktop/lean-repl</code> and <code>Desktop/test/Test/Test</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">37</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">39</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<p>I made sure that <code>Test/lakefile.lean</code> has the requires statement for mathlib, and still getting this issue. Any help would be super appreciated.</p>",
        "id": 442628100,
        "sender_full_name": "Riyaz Ahuja",
        "timestamp": 1717535532
    },
    {
        "content": "<p>Are you running <code>lake env ...</code> from the <em>same</em> directory as the file containing your <code>lakefile.lean</code> or <code>lakefile.toml</code>? Running from a subdirectory will fail.</p>",
        "id": 442666105,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1717549470
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/113488-general/topic/Using.20the.20REPL.20from.20another.20project.20issues/near/442666105\">said</a>:</p>\n<blockquote>\n<p>Are you running <code>lake env ...</code> from the <em>same</em> directory as the file containing your <code>lakefile.lean</code> or <code>lakefile.toml</code>? Running from a subdirectory will fail.</p>\n</blockquote>\n<p>Yep, the repl is in <code>Desktop/lean-repl</code> and the test project is in <code>Desktop/lean-test/test</code> with the <code>lakefile.lean</code> inside the latter. I'm running the whole <code>lake env ...</code> from <code>Desktop/lean-test/test</code>.</p>",
        "id": 442667201,
        "sender_full_name": "Riyaz Ahuja",
        "timestamp": 1717549914
    },
    {
        "content": "<p>This error occurs if your project is on a newer toolchain than repl. It's on 4.8.0 rc1, and yours is likely on 4.8.0 rc2.</p>",
        "id": 442668049,
        "sender_full_name": "Utensil Song",
        "timestamp": 1717550252
    },
    {
        "content": "<p>This was it, thanks so much!</p>",
        "id": 442675504,
        "sender_full_name": "Riyaz Ahuja",
        "timestamp": 1717553350
    },
    {
        "content": "<p>I noticed this a few days ago with <a href=\"https://github.com/utensil/lean4_jupyter\">lean4_jupyter</a> but forgot to report as I was thinking about a chore PR to bump but got distracted by other stuff.</p>",
        "id": 442694989,
        "sender_full_name": "Utensil Song",
        "timestamp": 1717563554
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"642696\">Riyaz Ahuja</span> has marked this topic as resolved.</p>",
        "id": 442811694,
        "sender_full_name": "Notification Bot",
        "timestamp": 1717599672
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"642696\">@Riyaz Ahuja</span> lean-repl has bumped to 4.8.0 (which is <del>equivalent to</del> newer than 4.8.0-rc2), you can also bump your project.</p>",
        "id": 442957607,
        "sender_full_name": "Utensil Song",
        "timestamp": 1717645814
    },
    {
        "content": "<p>(v4.8.0 and v4.8.0-rc2 are not quite identical: <code>lake</code> has some behavioural differences)</p>",
        "id": 442958530,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1717646039
    },
    {
        "content": "<p><del>Reviving this thread as with the new 4.9.0 release of the repl, the same old issue is coming up again despite both the repl and the project being on v4.9.0. Same example as before is causing the same old issue, but the versions are the same, and I'm running from the directory with the lakefile as suggested before. Any ideas on how to fix this?</del></p>\n<p><em>sorry for the double post; I didnâ€™t realize this thread was marked resolved already - use <a href=\"#narrow/stream/113488-general/topic/Using.20the.20Repl.20from.20another.20project.20.28again.29.20v4.2E9.2E0\">this</a></em></p>",
        "id": 448238048,
        "sender_full_name": "Riyaz Ahuja",
        "timestamp": 1719816089
    }
]