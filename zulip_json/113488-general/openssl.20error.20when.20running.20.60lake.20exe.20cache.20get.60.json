[
    {
        "content": "<p>I am trying to start a lean project in a computing cluster, and I get the following error when running <code>lake exe cache get</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">Attempting</span> <span class=\"n\">to</span> <span class=\"n\">download</span> <span class=\"mi\">4014</span> <span class=\"n\">file</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span>\n<span class=\"n\">OpenSSL</span><span class=\"bp\">/</span><span class=\"mi\">3</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">.</span><span class=\"mi\">8</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span><span class=\"mi\">16000069</span><span class=\"o\">:</span><span class=\"n\">STORE</span> <span class=\"n\">routines</span><span class=\"o\">::</span><span class=\"n\">unregistered</span> <span class=\"n\">scheme</span>\n<span class=\"n\">Downloaded</span><span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"n\">file</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">attempted</span> <span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4014</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span><span class=\"bp\">%</span><span class=\"o\">],</span> <span class=\"mi\">1</span> <span class=\"n\">failedOpenSSL</span><span class=\"bp\">/</span><span class=\"mi\">3</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">.</span><span class=\"mi\">8</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span><span class=\"mi\">16000069</span><span class=\"o\">:</span><span class=\"n\">STORE</span> <span class=\"n\">routines</span><span class=\"o\">::</span><span class=\"n\">unregistered</span> <span class=\"n\">scheme</span>\n<span class=\"n\">Downloaded</span><span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"n\">file</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">attempted</span> <span class=\"mi\">2</span><span class=\"bp\">/</span><span class=\"mi\">4014</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span><span class=\"bp\">%</span><span class=\"o\">],</span> <span class=\"mi\">2</span> <span class=\"n\">failedOpenSSL</span><span class=\"bp\">/</span><span class=\"mi\">3</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">.</span><span class=\"mi\">8</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span><span class=\"mi\">16000069</span><span class=\"o\">:</span><span class=\"n\">STORE</span> <span class=\"n\">routines</span><span class=\"o\">::</span><span class=\"n\">unregistered</span> <span class=\"n\">scheme</span>\n<span class=\"n\">Downloaded</span><span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"n\">file</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">attempted</span> <span class=\"mi\">3</span><span class=\"bp\">/</span><span class=\"mi\">4014</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span><span class=\"bp\">%</span><span class=\"o\">],</span> <span class=\"mi\">3</span> <span class=\"n\">failedOpenSSL</span><span class=\"bp\">/</span><span class=\"mi\">3</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">.</span><span class=\"mi\">8</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span><span class=\"mi\">16000069</span><span class=\"o\">:</span><span class=\"n\">STORE</span> <span class=\"n\">routines</span><span class=\"o\">::</span><span class=\"n\">unregistered</span> <span class=\"n\">scheme</span>\n<span class=\"bp\">...</span>\n</code></pre></div>\n<p>Any idea of what could be the problem?</p>",
        "id": 407716344,
        "sender_full_name": "Miguel Marco",
        "timestamp": 1702470807
    },
    {
        "content": "<p>does it work to call <code>curl</code> directly to download a file?</p>",
        "id": 407717406,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1702471180
    },
    {
        "content": "<p>e.g.</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">curl</span> <span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">lakecache.blob.core.windows.net</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"bp\">/</span><span class=\"n\">f</span><span class=\"bp\">/</span><span class=\"mi\">7</span><span class=\"n\">d56bc4bb976be8d.ltar</span> <span class=\"c1\">--output out.ltar</span>\n</code></pre></div>",
        "id": 407717613,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1702471236
    },
    {
        "content": "<p>also try adding <code>-v</code> and show the error message</p>",
        "id": 407717913,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1702471338
    },
    {
        "content": "<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>what I get</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"gp\">$ </span>curl<span class=\"w\"> </span>https://lakecache.blob.core.windows.net/mathlib4/f/7d56bc4bb976be8d.ltar<span class=\"w\"> </span>--output<span class=\"w\"> </span>out.ltar<span class=\"w\"> </span>-v\n<span class=\"gp\">  % </span>Total<span class=\"w\">    </span>%<span class=\"w\"> </span>Received<span class=\"w\"> </span>%<span class=\"w\"> </span>Xferd<span class=\"w\">  </span>Average<span class=\"w\"> </span>Speed<span class=\"w\">   </span>Time<span class=\"w\">    </span>Time<span class=\"w\">     </span>Time<span class=\"w\">  </span>Current\n<span class=\"go\">                                 Dload  Upload   Total   Spent    Left  Speed</span>\n<span class=\"go\">  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying 20.150.95.196:443...</span>\n<span class=\"go\">* Connected to lakecache.blob.core.windows.net (20.150.95.196) port 443 (#0)</span>\n<span class=\"go\">* ALPN, offering h2</span>\n<span class=\"go\">* ALPN, offering http/1.1</span>\n<span class=\"go\">*  CAfile: /etc/ssl/certs/ca-certificates.crt</span>\n<span class=\"go\">*  CApath: /etc/ssl/certs</span>\n<span class=\"go\">* TLSv1.0 (OUT), TLS header, Certificate Status (22):</span>\n<span class=\"go\">} [5 bytes data]</span>\n<span class=\"go\">* TLSv1.3 (OUT), TLS handshake, Client hello (1):</span>\n<span class=\"go\">} [512 bytes data]</span>\n<span class=\"go\">* TLSv1.2 (IN), TLS header, Certificate Status (22):</span>\n<span class=\"go\">{ [5 bytes data]</span>\n<span class=\"go\">  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0* TLSv1.3 (IN), TLS handshake, Server hello (2):</span>\n<span class=\"go\">{ [85 bytes data]</span>\n<span class=\"go\">* TLSv1.2 (IN), TLS handshake, Certificate (11):</span>\n<span class=\"go\">{ [5254 bytes data]</span>\n<span class=\"go\">* TLSv1.2 (IN), TLS handshake, Server key exchange (12):</span>\n<span class=\"go\">{ [365 bytes data]</span>\n<span class=\"go\">* TLSv1.2 (IN), TLS handshake, Server finished (14):</span>\n<span class=\"go\">{ [4 bytes data]</span>\n<span class=\"go\">* TLSv1.2 (OUT), TLS header, Certificate Status (22):</span>\n<span class=\"go\">} [5 bytes data]</span>\n<span class=\"go\">* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):</span>\n<span class=\"go\">} [102 bytes data]</span>\n<span class=\"go\">* TLSv1.2 (OUT), TLS header, Finished (20):</span>\n<span class=\"go\">} [5 bytes data]</span>\n<span class=\"go\">* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):</span>\n<span class=\"go\">} [1 bytes data]</span>\n<span class=\"go\">* TLSv1.2 (OUT), TLS header, Certificate Status (22):</span>\n<span class=\"go\">} [5 bytes data]</span>\n<span class=\"go\">* TLSv1.2 (OUT), TLS handshake, Finished (20):</span>\n<span class=\"go\">} [16 bytes data]</span>\n<span class=\"go\">* TLSv1.2 (IN), TLS header, Finished (20):</span>\n<span class=\"go\">{ [5 bytes data]</span>\n<span class=\"go\">* TLSv1.2 (IN), TLS header, Certificate Status (22):</span>\n<span class=\"go\">{ [5 bytes data]</span>\n<span class=\"go\">* TLSv1.2 (IN), TLS handshake, Finished (20):</span>\n<span class=\"go\">{ [16 bytes data]</span>\n<span class=\"go\">* SSL connection using TLSv1.2 / ECDHE-RSA-AES256-GCM-SHA384</span>\n<span class=\"go\">* ALPN, server did not agree to a protocol</span>\n<span class=\"go\">* Server certificate:</span>\n<span class=\"go\">*  subject: C=US; ST=WA; L=Redmond; O=Microsoft Corporation; CN=*.blob.core.windows.net</span>\n<span class=\"go\">*  start date: Nov 20 00:42:40 2023 GMT</span>\n<span class=\"go\">*  expire date: Jun 27 23:59:59 2024 GMT</span>\n<span class=\"go\">*  subjectAltName: host \"lakecache.blob.core.windows.net\" matched cert's \"*.blob.core.windows.net\"</span>\n<span class=\"go\">*  issuer: C=US; O=Microsoft Corporation; CN=Microsoft Azure TLS Issuing CA 01</span>\n<span class=\"go\">*  SSL certificate verify ok.</span>\n<span class=\"go\">* TLSv1.2 (OUT), TLS header, Supplemental data (23):</span>\n<span class=\"go\">} [5 bytes data]</span>\n<span class=\"go\">&gt; GET /mathlib4/f/7d56bc4bb976be8d.ltar HTTP/1.1</span>\n<span class=\"go\">&gt; Host: lakecache.blob.core.windows.net</span>\n<span class=\"go\">&gt; User-Agent: curl/7.81.0</span>\n<span class=\"go\">&gt; Accept: */*</span>\n<span class=\"go\">&gt;</span>\n<span class=\"go\">* TLSv1.2 (IN), TLS header, Supplemental data (23):</span>\n<span class=\"go\">{ [5 bytes data]</span>\n<span class=\"go\">* Mark bundle as not supporting multiuse</span>\n<span class=\"go\">&lt; HTTP/1.1 200 OK</span>\n<span class=\"go\">&lt; Content-Length: 3415</span>\n<span class=\"go\">&lt; Content-Type: application/octet-stream</span>\n<span class=\"go\">&lt; Content-MD5: 4hT1W1Edt739hfMG5CG7oA==</span>\n<span class=\"go\">&lt; Last-Modified: Fri, 17 Nov 2023 11:48:53 GMT</span>\n<span class=\"go\">&lt; ETag: 0x8DBE7632C53A08E</span>\n<span class=\"go\">&lt; Server: Windows-Azure-Blob/1.0 Microsoft-HTTPAPI/2.0</span>\n<span class=\"go\">&lt; x-ms-request-id: c506cae5-601e-002b-1ac1-2d4477000000</span>\n<span class=\"go\">&lt; x-ms-version: 2009-09-19</span>\n<span class=\"go\">&lt; x-ms-lease-status: unlocked</span>\n<span class=\"go\">&lt; x-ms-blob-type: BlockBlob</span>\n<span class=\"go\">&lt; Date: Wed, 13 Dec 2023 12:42:02 GMT</span>\n<span class=\"go\">&lt;</span>\n<span class=\"go\">{ [3415 bytes data]</span>\n<span class=\"go\">100  3415  100  3415    0     0   4454      0 --:--:-- --:--:-- --:--:--  4452</span>\n<span class=\"go\">* Connection #0 to host lakecache.blob.core.windows.net left intact</span>\n</code></pre></div>\n</div></div>",
        "id": 407718132,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1702471426
    },
    {
        "content": "<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>I get this</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p>[mmarco@gauss test]$ curl <a href=\"https://lakecache.blob.core.windows.net/mathlib4/f/7d56bc4bb976be8d.ltar\">https://lakecache.blob.core.windows.net/mathlib4/f/7d56bc4bb976be8d.ltar</a> --output out.ltar -v<br>\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br>\n                                 Dload  Upload   Total   Spent    Left  Speed<br>\n  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying 20.150.95.196...<br>\n* TCP_NODELAY set<br>\n* Connected to <a href=\"http://lakecache.blob.core.windows.net\">lakecache.blob.core.windows.net</a> (20.150.95.196) port 443 (<a href=\"https://github.com/leanprover-community/mathlib4/pull/0\">#0</a>)<br>\n  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0* ALPN, offering h2<br>\n* ALPN, offering http/1.1<br>\n* successfully set certificate verify locations:<br>\n*   CAfile: /etc/pki/tls/certs/ca-bundle.crt<br>\n  CApath: none<br>\n} [5 bytes data]<br>\n* TLSv1.3 (OUT), TLS handshake, Client hello (1):<br>\n} [512 bytes data]<br>\n* TLSv1.3 (IN), TLS handshake, Server hello (2):<br>\n{ [85 bytes data]<br>\n* TLSv1.2 (IN), TLS handshake, Certificate (11):<br>\n{ [5254 bytes data]<br>\n* TLSv1.2 (IN), TLS handshake, Server key exchange (12):<br>\n{ [365 bytes data]<br>\n* TLSv1.2 (IN), TLS handshake, Server finished (14):<br>\n{ [4 bytes data]<br>\n* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):<br>\n} [102 bytes data]<br>\n* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):<br>\n} [1 bytes data]<br>\n* TLSv1.2 (OUT), TLS handshake, Finished (20):<br>\n} [16 bytes data]<br>\n* TLSv1.2 (IN), TLS handshake, Finished (20):<br>\n{ [16 bytes data]<br>\n* SSL connection using TLSv1.2 / ECDHE-RSA-AES256-GCM-SHA384<br>\n* ALPN, server did not agree to a protocol<br>\n* Server certificate:<br>\n*  subject: C=US; ST=WA; L=Redmond; O=Microsoft Corporation; CN=*.blob.core.windows.net<br>\n*  start date: Nov 20 00:42:40 2023 GMT<br>\n*  expire date: Jun 27 23:59:59 2024 GMT<br>\n*  subjectAltName: host \"<a href=\"http://lakecache.blob.core.windows.net\">lakecache.blob.core.windows.net</a>\" matched cert's \"*.blob.core.windows.net\"<br>\n*  issuer: C=US; O=Microsoft Corporation; CN=Microsoft Azure TLS Issuing CA 01<br>\n*  SSL certificate verify ok.<br>\n} [5 bytes data]</p>\n<blockquote>\n<p>GET /mathlib4/f/7d56bc4bb976be8d.ltar HTTP/1.1<br>\nHost: <a href=\"http://lakecache.blob.core.windows.net\">lakecache.blob.core.windows.net</a><br>\nUser-Agent: curl/7.61.1<br>\nAccept: <em>/</em></p>\n<p>{ [5 bytes data]<br>\n&lt; HTTP/1.1 200 OK<br>\n&lt; Content-Length: 3415<br>\n&lt; Content-Type: application/octet-stream<br>\n&lt; Content-MD5: 4hT1W1Edt739hfMG5CG7oA==<br>\n&lt; Last-Modified: Fri, 17 Nov 2023 11:48:53 GMT<br>\n&lt; ETag: 0x8DBE7632C53A08E<br>\n&lt; Server: Windows-Azure-Blob/1.0 Microsoft-HTTPAPI/2.0<br>\n&lt; x-ms-request-id: dfa43897-501e-0023-75ce-2d5f04000000<br>\n&lt; x-ms-version: 2009-09-19<br>\n&lt; x-ms-lease-status: unlocked<br>\n&lt; x-ms-blob-type: BlockBlob<br>\n&lt; Date: Wed, 13 Dec 2023 14:16:04 GMT<br>\n&lt; <br>\n{ [3415 bytes data]<br>\n100  3415  100  3415    0     0   4949      0 --:--:-- --:--:-- --:--:--  4942<br>\n* Connection <a href=\"https://github.com/leanprover-community/mathlib4/pull/0\">#0</a> to host <a href=\"http://lakecache.blob.core.windows.net\">lakecache.blob.core.windows.net</a> left intact</p>\n</blockquote>\n</div></div>",
        "id": 407736198,
        "sender_full_name": "Miguel Marco",
        "timestamp": 1702476937
    },
    {
        "content": "<p>Does anyone know the solution to this?  I'm getting the exact same error as the top.  I can also perform <span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> 's curl command without problem.  I'm also on a compute cluster, which I'm sure is part of it.  It could just be a permissions/firewall thing, but why these files and not others?  (I also don't know which files curl is complaining about downloading.)</p>",
        "id": 420174192,
        "sender_full_name": "Jason Rute",
        "timestamp": 1707276457
    },
    {
        "content": "<p>If it is helpful: <a href=\"https://github.com/curl/curl/issues/10702\">https://github.com/curl/curl/issues/10702</a></p>",
        "id": 420174766,
        "sender_full_name": "Jason Rute",
        "timestamp": 1707276828
    },
    {
        "content": "<p>I don't see any immediate obvious cause from scanning what <code>Cache/Requests.lean</code> does.</p>",
        "id": 420238479,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707308140
    },
    {
        "content": "<p>Can you show <code>type -a curl</code> perhaps as a left field guess.</p>",
        "id": 420238501,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707308150
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321696\">@Julian Berman</span>:</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"gp\">$ </span><span class=\"nb\">type</span><span class=\"w\"> </span>-a<span class=\"w\"> </span>curl\n<span class=\"go\">curl is /usr/bin/curl</span>\n<span class=\"go\">curl is /bin/curl</span>\n<span class=\"go\">curl is /usr/bin/curl</span>\n</code></pre></div>",
        "id": 420274861,
        "sender_full_name": "Jason Rute",
        "timestamp": 1707318897
    },
    {
        "content": "<p>what message do you get with the direct download?</p>",
        "id": 420275018,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1707318940
    },
    {
        "content": "<p>OK, so my ~10% likely guess is maybe a different curl is being used for one or the other. Can you try Mario's command but replace <code>curl</code> explicitly with <code>/usr/bin/curl</code> and then <code>/bin/curl</code>?</p>",
        "id": 420275059,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707318951
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/113488-general/topic/openssl.20error.20when.20running.20.60lake.20exe.20cache.20get.60/near/420275018\">said</a>:</p>\n<blockquote>\n<p>what message do you get with the direct download?</p>\n</blockquote>\n<p>I think they're saying it works fine and the file downloads.</p>",
        "id": 420275283,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707319010
    },
    {
        "content": "<p>I'll try that.  Also here is a full reproduction where I make a new project with <code>lake new myproject math</code> and run <code>lean exe cache get</code>.  It seems like some stuff downloads, but then it gets to a point where it errs:</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"gp\">$ </span>lake<span class=\"w\"> </span>new<span class=\"w\"> </span>test_project_math<span class=\"w\"> </span>math\n<span class=\"gp\">$ </span><span class=\"nb\">cd</span><span class=\"w\"> </span>test_project_math/\n<span class=\"gp\">$ </span>lake<span class=\"w\"> </span>exe<span class=\"w\"> </span>cache<span class=\"w\"> </span>get\n<span class=\"go\">info: downloading component 'lean'</span>\n<span class=\"go\">153.6 MiB / 153.6 MiB (100 %)  12.6 MiB/s ETA:   0 s</span>\n<span class=\"go\">info: installing component 'lean'</span>\n<span class=\"go\">info: test_project_math: no previous manifest, creating one from scratch</span>\n<span class=\"go\">info: mathlib: cloning https://github.com/leanprover-community/mathlib4.git to './.lake/packages/mathlib'</span>\n<span class=\"go\">info: std: cloning https://github.com/leanprover/std4 to './.lake/packages/std'</span>\n<span class=\"go\">info: Qq: cloning https://github.com/leanprover-community/quote4 to './.lake/packages/Qq'</span>\n<span class=\"go\">info: aesop: cloning https://github.com/leanprover-community/aesop to './.lake/packages/aesop'</span>\n<span class=\"go\">info: proofwidgets: cloning https://github.com/leanprover-community/ProofWidgets4 to './.lake/packages/proofwidgets'</span>\n<span class=\"go\">info: Cli: cloning https://github.com/leanprover/lean4-cli to './.lake/packages/Cli'</span>\n<span class=\"go\">info: importGraph: cloning https://github.com/leanprover-community/import-graph.git to './.lake/packages/importGraph'</span>\n<span class=\"go\">warning: Qq: ignoring missing dependency manifest './.lake/packages/Qq/lake-manifest.json'</span>\n<span class=\"go\">warning: Cli: ignoring missing dependency manifest './.lake/packages/Cli/lake-manifest.json'</span>\n<span class=\"go\">info: mathlib: running post-update hooks</span>\n<span class=\"go\">info: [0/9] Downloading proofwidgets cloud release</span>\n<span class=\"go\">info: [0/9] Unpacking proofwidgets cloud release</span>\n<span class=\"go\">info: [1/9] Building Cache.IO</span>\n<span class=\"go\">info: [2/9] Compiling Cache.IO</span>\n<span class=\"go\">info: [2/9] Building Cache.Hashing</span>\n<span class=\"go\">info: [3/9] Compiling Cache.Hashing</span>\n<span class=\"go\">info: [3/9] Building Cache.Requests</span>\n<span class=\"go\">info: [5/9] Compiling Cache.Requests</span>\n<span class=\"go\">info: [5/9] Building Cache.Main</span>\n<span class=\"go\">info: [6/9] Compiling Cache.Main</span>\n<span class=\"go\">info: [9/9] Linking cache</span>\n<span class=\"go\">installing leantar 0.1.11</span>\n<span class=\"gp\">  % </span>Total<span class=\"w\">    </span>%<span class=\"w\"> </span>Received<span class=\"w\"> </span>%<span class=\"w\"> </span>Xferd<span class=\"w\">  </span>Average<span class=\"w\"> </span>Speed<span class=\"w\">   </span>Time<span class=\"w\">    </span>Time<span class=\"w\">     </span>Time<span class=\"w\">  </span>Current\n<span class=\"go\">                                 Dload  Upload   Total   Spent    Left  Speed</span>\n<span class=\"go\">  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0</span>\n<span class=\"go\">100 1906k  100 1906k    0     0  5139k      0 --:--:-- --:--:-- --:--:-- 5139k</span>\n\n<span class=\"go\">Attempting to download 4208 file(s)</span>\n<span class=\"go\">OpenSSL/3.0.8: error:16000069:STORE routines::unregistered scheme</span>\n<span class=\"go\">Downloaded: 0 file(s) [attempted 1/4208 = 0%], 1 failedOpenSSL/3.0.8: error:16000069:STORE routines::unregistered scheme</span>\n<span class=\"go\">Downloaded: 0 file(s) [attempted 2/4208 = 0%], 2 failedOpenSSL/3.0.8: error:16000069:STORE routines::unregistered scheme</span>\n<span class=\"go\">Downloaded: 0 file(s) [attempted 3/4208 = 0%], 3 failedOpenSSL/3.0.8: error:16000069:STORE routines::unregistered scheme</span>\n<span class=\"go\">Downloaded: 0 file(s) [attempted 4/4208 = 0%], 4 failedOpenSSL/3.0.8: error:16000069:STORE routines::unregistered scheme</span>\n</code></pre></div>\n</div></div>",
        "id": 420277424,
        "sender_full_name": "Jason Rute",
        "timestamp": 1707319630
    },
    {
        "content": "<p>After running this, is there a <code>~/.cache/mathlib/curl.cfg</code> file?</p>",
        "id": 420277752,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1707319712
    },
    {
        "content": "<p>if so you could try re-running the curl command that cache uses</p>",
        "id": 420277826,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1707319737
    },
    {
        "content": "<p>The head of <code>~/.cache/mathlib/curl.cfg</code> looks like this:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>url = https://lakecache.blob.core.windows.net/mathlib4/f/63693f3c2d08d318.ltar\n-o \"/u/jasonrute/.cache/mathlib/63693f3c2d08d318.ltar.part\"\nurl = https://lakecache.blob.core.windows.net/mathlib4/f/a89f099760a13f5b.ltar\n-o \"/u/jasonrute/.cache/mathlib/a89f099760a13f5b.ltar.part\"\nurl = https://lakecache.blob.core.windows.net/mathlib4/f/87d92ae0d8d8646d.ltar\n-o \"/u/jasonrute/.cache/mathlib/87d92ae0d8d8646d.ltar.part\"\nurl = https://lakecache.blob.core.windows.net/mathlib4/f/7085d882c5487719.ltar\n-o \"/u/jasonrute/.cache/mathlib/7085d882c5487719.ltar.part\"\nurl = https://lakecache.blob.core.windows.net/mathlib4/f/4f4c3ec5261651a0.ltar\n-o \"/u/jasonrute/.cache/mathlib/4f4c3ec5261651a0.ltar.part\"\n</code></pre></div>\n<p>What should I try running?</p>",
        "id": 420278509,
        "sender_full_name": "Jason Rute",
        "timestamp": 1707319924
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>curl<span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">  </span>--request<span class=\"w\"> </span>GET<span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">  </span>--parallel<span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">  </span>--fail<span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">  </span>--silent<span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">  </span>--retry<span class=\"w\"> </span><span class=\"m\">5</span><span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">  </span>--write-out<span class=\"w\"> </span><span class=\"s2\">\"%{json}\\n\"</span><span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">  </span>--config<span class=\"w\"> </span>~/.cache/mathlib/curl.cfg\n</code></pre></div>",
        "id": 420278899,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1707320035
    },
    {
        "content": "<p>maybe without the <code>--silent</code> and <code>--write-out \"%{json}\\n\"</code></p>",
        "id": 420278990,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1707320051
    },
    {
        "content": "<p>That seems to be downloading something.  (I also had to remove <code>--parallel</code> since it didn't recognize that parameter.)</p>",
        "id": 420281596,
        "sender_full_name": "Jason Rute",
        "timestamp": 1707320704
    },
    {
        "content": "<p>Trying that i get</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">curl</span><span class=\"o\">:</span> <span class=\"n\">option</span> <span class=\"c1\">--parallel: is unknown</span>\n<span class=\"n\">curl</span><span class=\"o\">:</span> <span class=\"n\">try</span> <span class=\"bp\">'</span><span class=\"n\">curl</span> <span class=\"c1\">--help' or 'curl --manual' for more information</span>\n</code></pre></div>",
        "id": 420281646,
        "sender_full_name": "Miguel Marco",
        "timestamp": 1707320717
    },
    {
        "content": "<p>What happens/happened when you tried <code>/bin/curl</code>?</p>",
        "id": 420282030,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707320815
    },
    {
        "content": "<p>Oh, in that case you should be using the downloaded <code>curl</code></p>",
        "id": 420282065,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1707320824
    },
    {
        "content": "<p>Oh -- it downloads its own third curl?</p>",
        "id": 420282145,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707320841
    },
    {
        "content": "<p>which should be in <code>~/.cache/mathlib/curl-7.88.1</code></p>",
        "id": 420282154,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1707320843
    },
    {
        "content": "<p>It downloads <code>curl</code> if the system <code>curl</code> is too old</p>",
        "id": 420282226,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1707320865
    },
    {
        "content": "<p>Does it compile curl on the machine?</p>",
        "id": 420282504,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707320934
    },
    {
        "content": "<p>If not probably that will fail in these kinds of cases where I bet they've changed the CA bundle</p>",
        "id": 420282543,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707320946
    },
    {
        "content": "<p>Yes, that is the problem:</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"gp\">$ </span>~/.cache/mathlib/curl-7.88.1<span class=\"w\"> </span>https://lakecache.blob.core.windows.net/mathlib4/f/7d56bc4bb976be8d.ltar<span class=\"w\"> </span>--output<span class=\"w\"> </span>out.ltar\n<span class=\"gp\">  % </span>Total<span class=\"w\">    </span>%<span class=\"w\"> </span>Received<span class=\"w\"> </span>%<span class=\"w\"> </span>Xferd<span class=\"w\">  </span>Average<span class=\"w\"> </span>Speed<span class=\"w\">   </span>Time<span class=\"w\">    </span>Time<span class=\"w\">     </span>Time<span class=\"w\">  </span>Current\n<span class=\"go\">                                 Dload  Upload   Total   Spent    Left  Speed</span>\n<span class=\"go\">  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0</span>\n<span class=\"go\">curl: (35) OpenSSL/3.0.8: error:16000069:STORE routines::unregistered scheme</span>\n</code></pre></div>",
        "id": 420282545,
        "sender_full_name": "Jason Rute",
        "timestamp": 1707320947
    },
    {
        "content": "<p>no, it downloads it from <a href=\"https://github.com/leanprover-community/static-curl\">https://github.com/leanprover-community/static-curl</a></p>",
        "id": 420282564,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1707320952
    },
    {
        "content": "<p>Yeah I don't think that will work if someone's compiled some curl on the machine that has a different CA bundle somewhere with whatever certs they're using to MITM the requests</p>",
        "id": 420282691,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707320993
    },
    {
        "content": "<p>interesting, why would that be baked into the executable?</p>",
        "id": 420282810,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1707321015
    },
    {
        "content": "<p>I think it's done at compile time, but I am no curl expert, I just googled it</p>",
        "id": 420282865,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707321029
    },
    {
        "content": "<p>I would have assumed the certs are coming from some system directory</p>",
        "id": 420282896,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1707321040
    },
    {
        "content": "<p>\"Add the CA cert for your server to the existing default CA certificate store. The default CA certificate store can be changed at compile time with the following configure options:</p>\n<p>--with-ca-bundle=FILE: use the specified file as the CA certificate store. CA certificates need to be concatenated in PEM format into this file.\"</p>\n<p>from <a href=\"https://curl.se/docs/sslcerts.html\">https://curl.se/docs/sslcerts.html</a></p>",
        "id": 420282945,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707321055
    },
    {
        "content": "<p>is there a way to say \"don't use the builtin certs\"?</p>",
        "id": 420282958,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1707321059
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/113488-general/topic/openssl.20error.20when.20running.20.60lake.20exe.20cache.20get.60/near/420282896\">said</a>:</p>\n<blockquote>\n<p>I would have assumed the certs are coming from some system directory</p>\n</blockquote>\n<p>That's certainly the normal behavior but you can change it</p>",
        "id": 420282989,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707321067
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/113488-general/topic/openssl.20error.20when.20running.20.60lake.20exe.20cache.20get.60/near/420282958\">said</a>:</p>\n<blockquote>\n<p>is there a way to say \"don't use the builtin certs\"?</p>\n</blockquote>\n<p>I think that will fail in other ways no? It's being done presumably because they're MITM'ing the HTTPS traffic, and they're adding their root cert. But we haven't seen the real error yet.</p>",
        "id": 420283120,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707321109
    },
    {
        "content": "<p>I think that dumb openssl error is a way of saying it can't read the right cert store directory, from other googling</p>",
        "id": 420283226,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707321126
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"115715\">@Jason Rute</span> I don't know what the exact right command to run is yet, but can you try perhaps showing us <code>openssl s_client -showcerts -connect lakecache.blob.core.windows.net:443</code></p>",
        "id": 420283618,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707321238
    },
    {
        "content": "<p>I'm not sure what is in that output and since it has a lot of keys, I'm hesitant to share it here without understanding it better.  What are you looking for in it?</p>",
        "id": 420284316,
        "sender_full_name": "Jason Rute",
        "timestamp": 1707321404
    },
    {
        "content": "<p>Yes, sorry, that's a good concern of course. They should all be public keys. I'm looking for the names of the certs that are used in connecting to that.</p>",
        "id": 420284429,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707321436
    },
    {
        "content": "<p>there should be some way of asking you for that without the public keys</p>",
        "id": 420284489,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707321452
    },
    {
        "content": "<p>but when I run that, the first cert I see is...</p>",
        "id": 420284518,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707321461
    },
    {
        "content": "<p>ah it's just at the top. So I see:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">CONNECTED</span><span class=\"o\">(</span><span class=\"mi\">00000006</span><span class=\"o\">)</span>\n<span class=\"n\">depth</span><span class=\"bp\">=</span><span class=\"mi\">2</span> <span class=\"n\">C</span><span class=\"bp\">=</span><span class=\"n\">US</span><span class=\"o\">,</span> <span class=\"n\">O</span><span class=\"bp\">=</span><span class=\"n\">DigiCert</span> <span class=\"n\">Inc</span><span class=\"o\">,</span> <span class=\"n\">OU</span><span class=\"bp\">=</span><span class=\"n\">www.digicert.com</span><span class=\"o\">,</span> <span class=\"n\">CN</span><span class=\"bp\">=</span><span class=\"n\">DigiCert</span> <span class=\"n\">Global</span> <span class=\"n\">Root</span> <span class=\"n\">G2</span>\n<span class=\"n\">verify</span> <span class=\"n\">return</span><span class=\"o\">:</span><span class=\"mi\">1</span>\n<span class=\"n\">depth</span><span class=\"bp\">=</span><span class=\"mi\">1</span> <span class=\"n\">C</span><span class=\"bp\">=</span><span class=\"n\">US</span><span class=\"o\">,</span> <span class=\"n\">O</span><span class=\"bp\">=</span><span class=\"n\">Microsoft</span> <span class=\"n\">Corporation</span><span class=\"o\">,</span> <span class=\"n\">CN</span><span class=\"bp\">=</span><span class=\"n\">Microsoft</span> <span class=\"n\">Azure</span> <span class=\"n\">TLS</span> <span class=\"n\">Issuing</span> <span class=\"n\">CA</span> <span class=\"mi\">01</span>\n<span class=\"n\">verify</span> <span class=\"n\">return</span><span class=\"o\">:</span><span class=\"mi\">1</span>\n<span class=\"n\">depth</span><span class=\"bp\">=</span><span class=\"mi\">0</span> <span class=\"n\">C</span><span class=\"bp\">=</span><span class=\"n\">US</span><span class=\"o\">,</span> <span class=\"n\">ST</span><span class=\"bp\">=</span><span class=\"n\">WA</span><span class=\"o\">,</span> <span class=\"n\">L</span><span class=\"bp\">=</span><span class=\"n\">Redmond</span><span class=\"o\">,</span> <span class=\"n\">O</span><span class=\"bp\">=</span><span class=\"n\">Microsoft</span> <span class=\"n\">Corporation</span><span class=\"o\">,</span> <span class=\"n\">CN</span><span class=\"bp\">=*.</span><span class=\"n\">blob.core.windows.net</span>\n</code></pre></div>",
        "id": 420284593,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707321481
    },
    {
        "content": "<p>do you see something like that? Two microsoft certs and a DigiCert root cert? Or do you see some other certificate that presumably is self-signed maybe</p>",
        "id": 420284779,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707321517
    },
    {
        "content": "<p>That part is the same.</p>",
        "id": 420284800,
        "sender_full_name": "Jason Rute",
        "timestamp": 1707321523
    },
    {
        "content": "<p>Well different CONNECTED number.  I assume that doesn't matter.</p>",
        "id": 420284913,
        "sender_full_name": "Jason Rute",
        "timestamp": 1707321554
    },
    {
        "content": "<p>Hrm. And does <code>type -a openssl</code> have more than one result?</p>",
        "id": 420284922,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707321558
    },
    {
        "content": "<p>Bleh surely there's a way to get curl to print this out too, that's probably smarter since that's what we know doesn't work.</p>",
        "id": 420285080,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707321600
    },
    {
        "content": "<p>Aha looks like it's <code>--write-out {certs}</code></p>",
        "id": 420285323,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707321647
    },
    {
        "content": "<p>(Sorry, clearly still guessing here) but two other things to try are to add <code>--ca-native</code> to the curl commands to see what happens if you try to force curl to use the system CA store -- both the system one and the lean one</p>",
        "id": 420285788,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707321765
    },
    {
        "content": "<p>Yes, there are many results for <code>type -a openssl</code>.  (The default was from my base conda installation.)</p>",
        "id": 420285835,
        "sender_full_name": "Jason Rute",
        "timestamp": 1707321779
    },
    {
        "content": "<p>so run <code>~/.cache/mathlib/curl-7.88.1 --ca-native https://lakecache.blob.core.windows.net/mathlib4/f/7d56bc4bb976be8d.ltar --output out.ltar</code></p>",
        "id": 420285889,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707321792
    },
    {
        "content": "<p>oh right, did we confirm that that one also fails with the downloaded <code>curl</code>?</p>",
        "id": 420286038,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1707321834
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"gp\">$ </span>~/.cache/mathlib/curl-7.88.1<span class=\"w\"> </span>--ca-native<span class=\"w\"> </span>https://lakecache.blob.core.windows.net/mathlib4/f/7d56bc4bb976be8d.ltar<span class=\"w\"> </span>--output<span class=\"w\"> </span>out.ltar\n<span class=\"go\">curl: option --ca-native: is unknown</span>\n<span class=\"go\">curl: try 'curl --help' for more information</span>\n</code></pre></div>",
        "id": 420286042,
        "sender_full_name": "Jason Rute",
        "timestamp": 1707321836
    },
    {
        "content": "<p>Hrm, ok, guess that's new in curl 8</p>",
        "id": 420286291,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707321882
    },
    {
        "content": "<p>let's see what curl 7 has :/</p>",
        "id": 420286358,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707321898
    },
    {
        "content": "<p>I am now somewhat sure this is the problem (some different CA bundle being used than the one your cluster owners were trying to force curl to use) but we have to find where that bundle is I think, and I've got to run for a bit, but can come back later if you don't figure it out</p>",
        "id": 420286782,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707321989
    },
    {
        "content": "<p><code>export CURL_CA_BUNDLE=/etc/ssl/certs/ca-certificates.crt</code> that looks like the other way to do this</p>",
        "id": 420286975,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707322033
    },
    {
        "content": "<p>But that path won't be right for your system</p>",
        "id": 420287003,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707322041
    },
    {
        "content": "<p>Okay, here is a <strong>hack</strong> that works for me.  cc <span class=\"user-mention\" data-user-id=\"461731\">@Miguel Marco</span>:</p>\n<ol>\n<li>Delete <code>~/.cache/mathlib/curl-7.88.1</code></li>\n<li>Install an updated curl.  Since my system is locked down, I make a conda environment and installed <code>conda install curl</code> into it.</li>\n</ol>\n<p>Then it works.  (The first step seems important.  It is not just enough to update curl.)</p>",
        "id": 420288944,
        "sender_full_name": "Jason Rute",
        "timestamp": 1707322499
    },
    {
        "content": "<p>It also means if I ever forget and run it without being in my environment it will install the bad curl and I will have to delete it.</p>",
        "id": 420289490,
        "sender_full_name": "Jason Rute",
        "timestamp": 1707322614
    },
    {
        "content": "<p>Does compiling it using nix work? There are some build instructions at <a href=\"https://github.com/leanprover-community/static-curl\">https://github.com/leanprover-community/static-curl</a> but I don't really know whether they include local certs or something</p>",
        "id": 420289711,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1707322661
    },
    {
        "content": "<p>I have to go soon, but I'll try that later.</p>",
        "id": 420289975,
        "sender_full_name": "Jason Rute",
        "timestamp": 1707322722
    },
    {
        "content": "<p>Actually, I realize I don't understand nix.  It is sort of like conda right?  Do you create an nix environment or something and install curl into that?  Also you are talking about just installing curl through nix right?  (I remember a while ago there was talk about installing Lean through nix.)</p>",
        "id": 420291409,
        "sender_full_name": "Jason Rute",
        "timestamp": 1707323077
    },
    {
        "content": "<p>I also don't have any first-hand experience with nix, maybe <span class=\"user-mention\" data-user-id=\"110024\">@Sebastian Ullrich</span> can say more about how that line works. My understanding is that you can use <code>nix-shell</code> to enter a nix environment and then there is some content addressed build store you can make use of with <code>nix build</code></p>",
        "id": 420291798,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1707323186
    },
    {
        "content": "<p>that said I have no idea what sources or what build script corresponds to <code>github:NixOS/nixpkgs/8f40f2f90b9c9032d1b824442cfbbe0dbabd0dbd#pkgsStatic.curl</code></p>",
        "id": 420291976,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1707323236
    },
    {
        "content": "<p>my best guess is <a href=\"https://github.com/NixOS/nixpkgs/blob/8f40f2f90b9c9032d1b824442cfbbe0dbabd0dbd/pkgs/tools/networking/curl/default.nix\">https://github.com/NixOS/nixpkgs/blob/8f40f2f90b9c9032d1b824442cfbbe0dbabd0dbd/pkgs/tools/networking/curl/default.nix</a></p>",
        "id": 420292348,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1707323339
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"115715\">Jason Rute</span> <a href=\"#narrow/stream/113488-general/topic/openssl.20error.20when.20running.20.60lake.20exe.20cache.20get.60/near/420289490\">said</a>:</p>\n<blockquote>\n<p>It also means if I ever forget and run it without being in my environment it will install the bad curl and I will have to delete it.</p>\n</blockquote>\n<p>you can evade this at least with another (arguable nonhack), namely link your updated <code>curl</code> into <code>~/.local/bin</code> and ensure that that is early on your <code>PATH</code>.</p>",
        "id": 420292738,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707323435
    },
    {
        "content": "<p>it appears that <code>--without-ca-bundle</code> is set only when building on OSX</p>",
        "id": 420292823,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1707323457
    },
    {
        "content": "<p>I don't know conda unfortunately, but I would bet there's a tool in its ecosystem that does this.</p>",
        "id": 420292835,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707323459
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321696\">Julian Berman</span> <a href=\"#narrow/stream/113488-general/topic/openssl.20error.20when.20running.20.60lake.20exe.20cache.20get.60/near/420292738\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"115715\">Jason Rute</span> <a href=\"#narrow/stream/113488-general/topic/openssl.20error.20when.20running.20.60lake.20exe.20cache.20get.60/near/420289490\">said</a>:</p>\n<blockquote>\n<p>It also means if I ever forget and run it without being in my environment it will install the bad curl and I will have to delete it.</p>\n</blockquote>\n<p>you can evade this at least with another (arguable nonhack), namely link your updated <code>curl</code> into <code>~/.local/bin</code> and ensure that that is early on your <code>PATH</code>.</p>\n</blockquote>\n<p>(In case the thinking emoji is confusion) -- the point is you want anything to find your newer curl before it finds the older one, and you want that to happen globally, not just in your conda env.</p>",
        "id": 420293088,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707323513
    },
    {
        "content": "<p>I can look again at how to find your bundle if that's helpful, but if you're happy with your hack it sounds reasonable to me to move on with life</p>",
        "id": 420293293,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707323549
    },
    {
        "content": "<p>The emoji was just that I think there is a slightly better way to do that, but <code>~/.local/bin</code> is a good idea.  I could also just just upgrade curl in my base conda environment (although I don't like having the base environment on since it is easy to accidentally <code>conda install</code> stuff into it thinking you are in your custom environment.)  But the fact that <code>lake exe cache get</code> by default uses this \"broken\" curl it downloaded is a bit annoying even when I've upgraded my system curl.</p>",
        "id": 420294697,
        "sender_full_name": "Jason Rute",
        "timestamp": 1707323879
    },
    {
        "content": "<p>it won't download the broken curl if you have a good version</p>",
        "id": 420295441,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1707324056
    },
    {
        "content": "<p>So do we know which curl is using which certificate?</p>",
        "id": 420295819,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1707324154
    },
    {
        "content": "<p>Jason can you try one more thing (now or later) -- run <code>strace -e trace=open ~/.cache/mathlib/curl-7.88.1 https://lakecache.blob.core.windows.net/</code> which should tell us where that curl is looking -- at least then maybe we can get the error message to change and show us the \"real\" error</p>",
        "id": 420295831,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707324156
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110024\">Sebastian Ullrich</span> <a href=\"#narrow/stream/113488-general/topic/openssl.20error.20when.20running.20.60lake.20exe.20cache.20get.60/near/420295819\">said</a>:</p>\n<blockquote>\n<p>So do we know which curl is using which certificate?</p>\n</blockquote>\n<p>no but ^ may help</p>",
        "id": 420295888,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707324172
    },
    {
        "content": "<p>also <code>--write-out {certs}</code> still hasn't been tested</p>",
        "id": 420296033,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1707324207
    },
    {
        "content": "<p>Yeah I'm less excited about that one now though because the man page says it only works when the transfer completes</p>",
        "id": 420296107,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707324226
    },
    {
        "content": "<p>But you can try that too.</p>",
        "id": 420296122,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707324230
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"gp\">$ </span>strace<span class=\"w\"> </span>-e<span class=\"w\"> </span><span class=\"nv\">trace</span><span class=\"o\">=</span>open<span class=\"w\"> </span>~/.cache/mathlib/_curl-7.88.1<span class=\"w\"> </span>https://lakecache.blob.core.windows.net/\n<span class=\"go\">open(\"/./nix/store/6k1wq0nhs6vwxj92vdy2hz7cg1f9997p-openssl-static-x86_64-unknown-linux-musl-3.0.8-etc/etc/ssl/openssl.cnf\", O_RDONLY|O_LARGEFILE) = -1 ENOENT (No such file or directory)</span>\n<span class=\"go\">open(\"/u/jasonrute/.curlrc\", O_RDONLY|O_LARGEFILE) = -1 ENOENT (No such file or directory)</span>\n<span class=\"go\">open(\"/u/jasonrute/.config/curlrc\", O_RDONLY|O_LARGEFILE) = -1 ENOENT (No such file or directory)</span>\n<span class=\"go\">open(\"/etc/passwd\", O_RDONLY|O_LARGEFILE|O_CLOEXEC) = 3</span>\n<span class=\"go\">open(\"/etc/ssl/certs/ca-certificates.crt\", O_RDONLY|O_LARGEFILE) = -1 ENOENT (No such file or directory)</span>\n<span class=\"go\">curl: (35) OpenSSL/3.0.8: error:16000069:STORE routines::unregistered scheme</span>\n<span class=\"go\">+++ exited with 35 +++</span>\n</code></pre></div>\n<p>(Note, I moved <code>curl-7.88.1</code> to <code>_curl-7.88.1</code>.)  Also, here it is with a working curl installed through conda:</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"gp\">$ </span>strace<span class=\"w\"> </span>-e<span class=\"w\"> </span><span class=\"nv\">trace</span><span class=\"o\">=</span>open<span class=\"w\"> </span>curl<span class=\"w\"> </span>https://lakecache.blob.core.windows.net/\n<span class=\"go\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;Error&gt;&lt;Code&gt;InvalidQueryParameterValue&lt;/Code&gt;&lt;Message&gt;Value for one of the query parameters specified in the request URI is invalid.</span>\n<span class=\"go\">RequestId:79697fb5-301e-0011-44e4-5907d4000000</span>\n<span class=\"go\">Time:2024-02-07T16:44:45.8996568Z&lt;/Message&gt;&lt;QueryParameterName&gt;comp&lt;/QueryParameterName&gt;&lt;QueryParameterValue /&gt;&lt;Reason /&gt;&lt;/Error&gt;+++ exited with 0 +++</span>\n</code></pre></div>",
        "id": 420296845,
        "sender_full_name": "Jason Rute",
        "timestamp": 1707324428
    },
    {
        "content": "<p>(The error in the second one is the same error just running that curl command.  (I don't know enough about <code>strace</code> to know if you want me to adjust something here.)</p>",
        "id": 420297815,
        "sender_full_name": "Jason Rute",
        "timestamp": 1707324725
    },
    {
        "content": "<p>Hrm, yes that second output means it didn't go try to read a file somewhere to find certificates</p>",
        "id": 420297900,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707324758
    },
    {
        "content": "<p>Have you shown us <code>curl -v https://lakecache.blob.core.windows.net/</code>?</p>",
        "id": 420298373,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707324889
    },
    {
        "content": "<p>(i.e. with the working one)</p>",
        "id": 420298446,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707324906
    },
    {
        "content": "<p>that should have the CAfile in it judging from my output</p>",
        "id": 420298512,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707324928
    },
    {
        "content": "<p>From running that command, it appears the CAfile is in the conda virtual environment folder: <code>CAfile: .../venv/ssl/cacert.pem</code></p>",
        "id": 420304819,
        "sender_full_name": "Jason Rute",
        "timestamp": 1707326831
    },
    {
        "content": "<p>(I redacted the rest of the path.)</p>",
        "id": 420304951,
        "sender_full_name": "Jason Rute",
        "timestamp": 1707326879
    },
    {
        "content": "<p>Does <code>~/.cache/mathlib/_curl-7.88.1 --cacert /that/conda/env/path/venv/ssl/cacert.pem https://lakecache.blob.core.windows.net/</code> work?</p>",
        "id": 420306216,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707327292
    },
    {
        "content": "<p>I get the following:</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"go\">~/.cache/mathlib/_curl-7.88.1 --cacert /that/conda/env/path/venv/ssl/cacert.pem https://lakecache.blob.core.windows.net/</span>\n<span class=\"go\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;Error&gt;&lt;Code&gt;InvalidQueryParameterValue&lt;/Code&gt;&lt;Message&gt;Value for one of the query parameters specified in the request URI is invalid.</span>\n<span class=\"go\">RequestId:287b8ec2-e01e-0013-5aff-59052e000000</span>\n<span class=\"go\">Time:2024-02-07T19:55:25.5334457Z&lt;/Message&gt;&lt;QueryParameterName&gt;comp&lt;/QueryParameterName&gt;&lt;Q</span>\n</code></pre></div>",
        "id": 420331681,
        "sender_full_name": "Jason Rute",
        "timestamp": 1707335802
    },
    {
        "content": "<p>I think that means, yes it works.</p>",
        "id": 420331775,
        "sender_full_name": "Jason Rute",
        "timestamp": 1707335833
    },
    {
        "content": "<p>does it work if you set <code>CURL_CA_BUNDLE=/that/conda/env/path/venv/ssl/cacert.pem</code>?</p>",
        "id": 420332144,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1707335982
    },
    {
        "content": "<p>I guess this hack will not work automatically if i just use the vscode extension to start a new project with mathlib, right?</p>",
        "id": 420332265,
        "sender_full_name": "Miguel Marco",
        "timestamp": 1707336018
    },
    {
        "content": "<p>if the env var works then that would just work on new projects etc</p>",
        "id": 420332358,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1707336051
    },
    {
        "content": "<p>In my case, this works:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"o\">[</span><span class=\"n\">mmarco</span><span class=\"bp\">@</span><span class=\"n\">nodo01</span> <span class=\"bp\">~</span><span class=\"o\">]</span><span class=\"bp\">$</span> <span class=\"bp\">.</span><span class=\"n\">cache</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/</span><span class=\"n\">curl</span><span class=\"bp\">-</span><span class=\"mi\">7</span><span class=\"bp\">.</span><span class=\"mi\">88</span><span class=\"bp\">.</span><span class=\"mi\">1</span> <span class=\"bp\">-</span><span class=\"n\">v</span> <span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">lakecache.blob.core.windows.net</span> <span class=\"c1\">--cacert /etc/ssl/certs/ca-bundle.trust.crt</span>\n<span class=\"bp\">*</span>   <span class=\"n\">Trying</span> <span class=\"mi\">20</span><span class=\"bp\">.</span><span class=\"mi\">150</span><span class=\"bp\">.</span><span class=\"mi\">95</span><span class=\"bp\">.</span><span class=\"mi\">196</span><span class=\"o\">:</span><span class=\"mi\">443</span><span class=\"bp\">...</span>\n<span class=\"bp\">*</span> <span class=\"n\">Connected</span> <span class=\"n\">to</span> <span class=\"n\">lakecache.blob.core.windows.net</span> <span class=\"o\">(</span><span class=\"mi\">20</span><span class=\"bp\">.</span><span class=\"mi\">150</span><span class=\"bp\">.</span><span class=\"mi\">95</span><span class=\"bp\">.</span><span class=\"mi\">196</span><span class=\"o\">)</span> <span class=\"n\">port</span> <span class=\"mi\">443</span> <span class=\"o\">(</span><span class=\"bp\">#</span><span class=\"mi\">0</span><span class=\"o\">)</span>\n<span class=\"bp\">*</span> <span class=\"n\">ALPN</span><span class=\"o\">:</span> <span class=\"n\">offers</span> <span class=\"n\">h2</span><span class=\"o\">,</span><span class=\"n\">http</span><span class=\"bp\">/</span><span class=\"mi\">1</span><span class=\"bp\">.</span><span class=\"mi\">1</span>\n<span class=\"bp\">*</span> <span class=\"n\">TLSv1.3</span> <span class=\"o\">(</span><span class=\"n\">OUT</span><span class=\"o\">),</span> <span class=\"n\">TLS</span> <span class=\"n\">handshake</span><span class=\"o\">,</span> <span class=\"n\">Client</span> <span class=\"n\">hello</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">):</span>\n<span class=\"bp\">*</span>  <span class=\"n\">CAfile</span><span class=\"o\">:</span> <span class=\"bp\">/</span><span class=\"n\">etc</span><span class=\"bp\">/</span><span class=\"n\">ssl</span><span class=\"bp\">/</span><span class=\"n\">certs</span><span class=\"bp\">/</span><span class=\"n\">ca</span><span class=\"bp\">-</span><span class=\"n\">bundle.trust.crt</span>\n<span class=\"bp\">*</span>  <span class=\"n\">CApath</span><span class=\"o\">:</span> <span class=\"n\">none</span>\n<span class=\"bp\">*</span> <span class=\"n\">TLSv1.3</span> <span class=\"o\">(</span><span class=\"n\">IN</span><span class=\"o\">),</span> <span class=\"n\">TLS</span> <span class=\"n\">handshake</span><span class=\"o\">,</span> <span class=\"n\">Server</span> <span class=\"n\">hello</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">):</span>\n<span class=\"bp\">*</span> <span class=\"n\">TLSv1.2</span> <span class=\"o\">(</span><span class=\"n\">IN</span><span class=\"o\">),</span> <span class=\"n\">TLS</span> <span class=\"n\">handshake</span><span class=\"o\">,</span> <span class=\"n\">Certificate</span> <span class=\"o\">(</span><span class=\"mi\">11</span><span class=\"o\">):</span>\n<span class=\"bp\">*</span> <span class=\"n\">TLSv1.2</span> <span class=\"o\">(</span><span class=\"n\">IN</span><span class=\"o\">),</span> <span class=\"n\">TLS</span> <span class=\"n\">handshake</span><span class=\"o\">,</span> <span class=\"n\">Server</span> <span class=\"n\">key</span> <span class=\"n\">exchange</span> <span class=\"o\">(</span><span class=\"mi\">12</span><span class=\"o\">):</span>\n<span class=\"bp\">*</span> <span class=\"n\">TLSv1.2</span> <span class=\"o\">(</span><span class=\"n\">IN</span><span class=\"o\">),</span> <span class=\"n\">TLS</span> <span class=\"n\">handshake</span><span class=\"o\">,</span> <span class=\"n\">Server</span> <span class=\"n\">finished</span> <span class=\"o\">(</span><span class=\"mi\">14</span><span class=\"o\">):</span>\n<span class=\"bp\">*</span> <span class=\"n\">TLSv1.2</span> <span class=\"o\">(</span><span class=\"n\">OUT</span><span class=\"o\">),</span> <span class=\"n\">TLS</span> <span class=\"n\">handshake</span><span class=\"o\">,</span> <span class=\"n\">Client</span> <span class=\"n\">key</span> <span class=\"n\">exchange</span> <span class=\"o\">(</span><span class=\"mi\">16</span><span class=\"o\">):</span>\n<span class=\"bp\">*</span> <span class=\"n\">TLSv1.2</span> <span class=\"o\">(</span><span class=\"n\">OUT</span><span class=\"o\">),</span> <span class=\"n\">TLS</span> <span class=\"n\">change</span> <span class=\"n\">cipher</span><span class=\"o\">,</span> <span class=\"n\">Change</span> <span class=\"n\">cipher</span> <span class=\"n\">spec</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">):</span>\n<span class=\"bp\">*</span> <span class=\"n\">TLSv1.2</span> <span class=\"o\">(</span><span class=\"n\">OUT</span><span class=\"o\">),</span> <span class=\"n\">TLS</span> <span class=\"n\">handshake</span><span class=\"o\">,</span> <span class=\"n\">Finished</span> <span class=\"o\">(</span><span class=\"mi\">20</span><span class=\"o\">):</span>\n<span class=\"bp\">*</span> <span class=\"n\">TLSv1.2</span> <span class=\"o\">(</span><span class=\"n\">IN</span><span class=\"o\">),</span> <span class=\"n\">TLS</span> <span class=\"n\">handshake</span><span class=\"o\">,</span> <span class=\"n\">Finished</span> <span class=\"o\">(</span><span class=\"mi\">20</span><span class=\"o\">):</span>\n<span class=\"bp\">*</span> <span class=\"n\">SSL</span> <span class=\"n\">connection</span> <span class=\"n\">using</span> <span class=\"n\">TLSv1.2</span> <span class=\"bp\">/</span> <span class=\"n\">ECDHE</span><span class=\"bp\">-</span><span class=\"n\">RSA</span><span class=\"bp\">-</span><span class=\"n\">AES256</span><span class=\"bp\">-</span><span class=\"n\">GCM</span><span class=\"bp\">-</span><span class=\"n\">SHA384</span>\n<span class=\"bp\">*</span> <span class=\"n\">ALPN</span><span class=\"o\">:</span> <span class=\"n\">server</span> <span class=\"n\">did</span> <span class=\"n\">not</span> <span class=\"n\">agree</span> <span class=\"n\">on</span> <span class=\"n\">a</span> <span class=\"n\">protocol.</span> <span class=\"n\">Uses</span> <span class=\"n\">default.</span>\n<span class=\"bp\">*</span> <span class=\"n\">Server</span> <span class=\"n\">certificate</span><span class=\"o\">:</span>\n<span class=\"bp\">*</span>  <span class=\"n\">subject</span><span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"bp\">=</span><span class=\"n\">US</span><span class=\"bp\">;</span> <span class=\"n\">ST</span><span class=\"bp\">=</span><span class=\"n\">WA</span><span class=\"bp\">;</span> <span class=\"n\">L</span><span class=\"bp\">=</span><span class=\"n\">Redmond</span><span class=\"bp\">;</span> <span class=\"n\">O</span><span class=\"bp\">=</span><span class=\"n\">Microsoft</span> <span class=\"n\">Corporation</span><span class=\"bp\">;</span> <span class=\"n\">CN</span><span class=\"bp\">=*.</span><span class=\"n\">blob.core.windows.net</span>\n<span class=\"bp\">*</span>  <span class=\"n\">start</span> <span class=\"n\">date</span><span class=\"o\">:</span> <span class=\"n\">Nov</span> <span class=\"mi\">20</span> <span class=\"mi\">00</span><span class=\"o\">:</span><span class=\"mi\">42</span><span class=\"o\">:</span><span class=\"mi\">40</span> <span class=\"mi\">2023</span> <span class=\"n\">GMT</span>\n<span class=\"bp\">*</span>  <span class=\"n\">expire</span> <span class=\"n\">date</span><span class=\"o\">:</span> <span class=\"n\">Jun</span> <span class=\"mi\">27</span> <span class=\"mi\">23</span><span class=\"o\">:</span><span class=\"mi\">59</span><span class=\"o\">:</span><span class=\"mi\">59</span> <span class=\"mi\">2024</span> <span class=\"n\">GMT</span>\n<span class=\"bp\">*</span>  <span class=\"n\">subjectAltName</span><span class=\"o\">:</span> <span class=\"n\">host</span> <span class=\"s2\">\"lakecache.blob.core.windows.net\"</span> <span class=\"n\">matched</span> <span class=\"n\">cert's</span> <span class=\"s2\">\"*.blob.core.windows.net\"</span>\n<span class=\"bp\">*</span>  <span class=\"n\">issuer</span><span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"bp\">=</span><span class=\"n\">US</span><span class=\"bp\">;</span> <span class=\"n\">O</span><span class=\"bp\">=</span><span class=\"n\">Microsoft</span> <span class=\"n\">Corporation</span><span class=\"bp\">;</span> <span class=\"n\">CN</span><span class=\"bp\">=</span><span class=\"n\">Microsoft</span> <span class=\"n\">Azure</span> <span class=\"n\">TLS</span> <span class=\"n\">Issuing</span> <span class=\"n\">CA</span> <span class=\"mi\">01</span>\n<span class=\"bp\">*</span>  <span class=\"n\">SSL</span> <span class=\"n\">certificate</span> <span class=\"n\">verify</span> <span class=\"n\">ok.</span>\n<span class=\"bp\">*</span> <span class=\"n\">using</span> <span class=\"n\">HTTP</span><span class=\"bp\">/</span><span class=\"mi\">1</span><span class=\"bp\">.</span><span class=\"n\">x</span>\n<span class=\"bp\">&gt;</span> <span class=\"n\">GET</span> <span class=\"bp\">/</span> <span class=\"n\">HTTP</span><span class=\"bp\">/</span><span class=\"mi\">1</span><span class=\"bp\">.</span><span class=\"mi\">1</span>\n<span class=\"bp\">&gt;</span> <span class=\"n\">Host</span><span class=\"o\">:</span> <span class=\"n\">lakecache.blob.core.windows.net</span>\n<span class=\"bp\">&gt;</span> <span class=\"n\">User</span><span class=\"bp\">-</span><span class=\"n\">Agent</span><span class=\"o\">:</span> <span class=\"n\">curl</span><span class=\"bp\">/</span><span class=\"mi\">7</span><span class=\"bp\">.</span><span class=\"mi\">88</span><span class=\"bp\">.</span><span class=\"mi\">1</span>\n<span class=\"bp\">&gt;</span> <span class=\"n\">Accept</span><span class=\"o\">:</span> <span class=\"bp\">*/*</span>\n<span class=\"bp\">&gt;</span>\n<span class=\"bp\">&lt;</span> <span class=\"n\">HTTP</span><span class=\"bp\">/</span><span class=\"mi\">1</span><span class=\"bp\">.</span><span class=\"mi\">1</span> <span class=\"mi\">400</span> <span class=\"n\">Value</span> <span class=\"n\">for</span> <span class=\"n\">one</span> <span class=\"n\">of</span> <span class=\"n\">the</span> <span class=\"n\">query</span> <span class=\"kd\">parameters</span> <span class=\"n\">specified</span> <span class=\"k\">in</span> <span class=\"n\">the</span> <span class=\"n\">request</span> <span class=\"n\">URI</span> <span class=\"n\">is</span> <span class=\"n\">invalid.</span>\n<span class=\"bp\">&lt;</span> <span class=\"n\">Content</span><span class=\"bp\">-</span><span class=\"n\">Length</span><span class=\"o\">:</span> <span class=\"mi\">351</span>\n<span class=\"bp\">&lt;</span> <span class=\"n\">Content</span><span class=\"bp\">-</span><span class=\"kt\">Type</span><span class=\"o\">:</span> <span class=\"n\">application</span><span class=\"bp\">/</span><span class=\"n\">xml</span>\n<span class=\"bp\">&lt;</span> <span class=\"n\">Server</span><span class=\"o\">:</span> <span class=\"n\">Microsoft</span><span class=\"bp\">-</span><span class=\"n\">HTTPAPI</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"bp\">.</span><span class=\"mi\">0</span>\n<span class=\"bp\">&lt;</span> <span class=\"n\">x</span><span class=\"bp\">-</span><span class=\"n\">ms</span><span class=\"bp\">-</span><span class=\"n\">request</span><span class=\"bp\">-</span><span class=\"n\">id</span><span class=\"o\">:</span> <span class=\"mi\">7</span><span class=\"n\">f249d91</span><span class=\"bp\">-</span><span class=\"n\">c01e</span><span class=\"bp\">-</span><span class=\"mi\">0040</span><span class=\"bp\">-</span><span class=\"mi\">1701</span><span class=\"bp\">-</span><span class=\"mi\">5</span><span class=\"n\">a1921000000</span>\n<span class=\"bp\">&lt;</span> <span class=\"n\">Date</span><span class=\"o\">:</span> <span class=\"n\">Wed</span><span class=\"o\">,</span> <span class=\"mi\">07</span> <span class=\"n\">Feb</span> <span class=\"mi\">2024</span> <span class=\"mi\">20</span><span class=\"o\">:</span><span class=\"mi\">09</span><span class=\"o\">:</span><span class=\"mi\">03</span> <span class=\"n\">GMT</span>\n<span class=\"bp\">&lt;</span>\n<span class=\"bp\">&lt;?</span><span class=\"n\">xml</span> <span class=\"n\">version</span><span class=\"bp\">=</span><span class=\"s2\">\"1.0\"</span> <span class=\"n\">encoding</span><span class=\"bp\">=</span><span class=\"s2\">\"utf-8\"</span><span class=\"bp\">?&gt;&lt;</span><span class=\"n\">Error</span><span class=\"bp\">&gt;&lt;</span><span class=\"n\">Code</span><span class=\"bp\">&gt;</span><span class=\"n\">InvalidQueryParameterValue</span><span class=\"bp\">&lt;/</span><span class=\"n\">Code</span><span class=\"bp\">&gt;&lt;</span><span class=\"n\">Message</span><span class=\"bp\">&gt;</span><span class=\"n\">Value</span> <span class=\"n\">for</span> <span class=\"n\">one</span> <span class=\"n\">of</span> <span class=\"n\">the</span> <span class=\"n\">query</span> <span class=\"kd\">parameters</span> <span class=\"n\">specified</span> <span class=\"k\">in</span> <span class=\"n\">the</span> <span class=\"n\">request</span> <span class=\"n\">URI</span> <span class=\"n\">is</span> <span class=\"n\">invalid.</span>\n<span class=\"n\">RequestId</span><span class=\"o\">:</span><span class=\"mi\">7</span><span class=\"n\">f249d91</span><span class=\"bp\">-</span><span class=\"n\">c01e</span><span class=\"bp\">-</span><span class=\"mi\">0040</span><span class=\"bp\">-</span><span class=\"mi\">1701</span><span class=\"bp\">-</span><span class=\"mi\">5</span><span class=\"n\">a1921000000</span>\n<span class=\"bp\">*</span> <span class=\"n\">Connection</span> <span class=\"bp\">#</span><span class=\"mi\">0</span> <span class=\"n\">to</span> <span class=\"n\">host</span> <span class=\"n\">lakecache.blob.core.windows.net</span> <span class=\"n\">left</span> <span class=\"n\">intact</span>\n</code></pre></div>\n<p>but this doesn't </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"o\">[</span><span class=\"n\">mmarco</span><span class=\"bp\">@</span><span class=\"n\">nodo01</span> <span class=\"bp\">~</span><span class=\"o\">]</span><span class=\"bp\">$</span> <span class=\"n\">CURL_CA_BUNDLE</span><span class=\"bp\">=/</span><span class=\"n\">etc</span><span class=\"bp\">/</span><span class=\"n\">ssl</span><span class=\"bp\">/</span><span class=\"n\">certs</span><span class=\"bp\">/</span>\n<span class=\"o\">[</span><span class=\"n\">mmarco</span><span class=\"bp\">@</span><span class=\"n\">nodo01</span> <span class=\"bp\">~</span><span class=\"o\">]</span><span class=\"bp\">$</span> <span class=\"bp\">.</span><span class=\"n\">cache</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/</span><span class=\"n\">curl</span><span class=\"bp\">-</span><span class=\"mi\">7</span><span class=\"bp\">.</span><span class=\"mi\">88</span><span class=\"bp\">.</span><span class=\"mi\">1</span> <span class=\"bp\">-</span><span class=\"n\">v</span> <span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">lakecache.blob.core.windows.net</span>\n<span class=\"bp\">*</span>   <span class=\"n\">Trying</span> <span class=\"mi\">20</span><span class=\"bp\">.</span><span class=\"mi\">150</span><span class=\"bp\">.</span><span class=\"mi\">95</span><span class=\"bp\">.</span><span class=\"mi\">196</span><span class=\"o\">:</span><span class=\"mi\">443</span><span class=\"bp\">...</span>\n<span class=\"bp\">*</span> <span class=\"n\">Connected</span> <span class=\"n\">to</span> <span class=\"n\">lakecache.blob.core.windows.net</span> <span class=\"o\">(</span><span class=\"mi\">20</span><span class=\"bp\">.</span><span class=\"mi\">150</span><span class=\"bp\">.</span><span class=\"mi\">95</span><span class=\"bp\">.</span><span class=\"mi\">196</span><span class=\"o\">)</span> <span class=\"n\">port</span> <span class=\"mi\">443</span> <span class=\"o\">(</span><span class=\"bp\">#</span><span class=\"mi\">0</span><span class=\"o\">)</span>\n<span class=\"bp\">*</span> <span class=\"n\">ALPN</span><span class=\"o\">:</span> <span class=\"n\">offers</span> <span class=\"n\">h2</span><span class=\"o\">,</span><span class=\"n\">http</span><span class=\"bp\">/</span><span class=\"mi\">1</span><span class=\"bp\">.</span><span class=\"mi\">1</span>\n<span class=\"bp\">*</span> <span class=\"n\">TLSv1.3</span> <span class=\"o\">(</span><span class=\"n\">OUT</span><span class=\"o\">),</span> <span class=\"n\">TLS</span> <span class=\"n\">handshake</span><span class=\"o\">,</span> <span class=\"n\">Client</span> <span class=\"n\">hello</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">):</span>\n<span class=\"bp\">*</span> <span class=\"n\">TLSv1.3</span> <span class=\"o\">(</span><span class=\"n\">IN</span><span class=\"o\">),</span> <span class=\"n\">TLS</span> <span class=\"n\">handshake</span><span class=\"o\">,</span> <span class=\"n\">Server</span> <span class=\"n\">hello</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">):</span>\n<span class=\"bp\">*</span> <span class=\"n\">TLSv1.2</span> <span class=\"o\">(</span><span class=\"n\">IN</span><span class=\"o\">),</span> <span class=\"n\">TLS</span> <span class=\"n\">handshake</span><span class=\"o\">,</span> <span class=\"n\">Certificate</span> <span class=\"o\">(</span><span class=\"mi\">11</span><span class=\"o\">):</span>\n<span class=\"bp\">*</span> <span class=\"n\">TLSv1.2</span> <span class=\"o\">(</span><span class=\"n\">OUT</span><span class=\"o\">),</span> <span class=\"n\">TLS</span> <span class=\"n\">alert</span><span class=\"o\">,</span> <span class=\"n\">unknown</span> <span class=\"n\">CA</span> <span class=\"o\">(</span><span class=\"mi\">560</span><span class=\"o\">):</span>\n<span class=\"bp\">*</span> <span class=\"n\">OpenSSL</span><span class=\"bp\">/</span><span class=\"mi\">3</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">.</span><span class=\"mi\">8</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span><span class=\"mi\">16000069</span><span class=\"o\">:</span><span class=\"n\">STORE</span> <span class=\"n\">routines</span><span class=\"o\">::</span><span class=\"n\">unregistered</span> <span class=\"n\">scheme</span>\n<span class=\"bp\">*</span> <span class=\"n\">Closing</span> <span class=\"n\">connection</span> <span class=\"mi\">0</span>\n<span class=\"n\">curl</span><span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">35</span><span class=\"o\">)</span> <span class=\"n\">OpenSSL</span><span class=\"bp\">/</span><span class=\"mi\">3</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">.</span><span class=\"mi\">8</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span><span class=\"mi\">16000069</span><span class=\"o\">:</span><span class=\"n\">STORE</span> <span class=\"n\">routines</span><span class=\"o\">::</span><span class=\"n\">unregistered</span> <span class=\"n\">scheme</span>\n</code></pre></div>",
        "id": 420333755,
        "sender_full_name": "Miguel Marco",
        "timestamp": 1707336590
    },
    {
        "content": "<p>You need <code>export CURL_CA_BUNDLE</code></p>",
        "id": 420334044,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707336699
    },
    {
        "content": "<p>But this seems to work:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"o\">[</span><span class=\"n\">mmarco</span><span class=\"bp\">@</span><span class=\"n\">nodo01</span> <span class=\"bp\">~</span><span class=\"o\">]</span><span class=\"bp\">$</span> <span class=\"kn\">export</span> <span class=\"n\">CURL_CA_BUNDLE</span><span class=\"bp\">=/</span><span class=\"n\">etc</span><span class=\"bp\">/</span><span class=\"n\">ssl</span><span class=\"bp\">/</span><span class=\"n\">certs</span><span class=\"bp\">/</span><span class=\"n\">ca</span><span class=\"bp\">-</span><span class=\"n\">bundle.trust.crt</span>\n<span class=\"o\">[</span><span class=\"n\">mmarco</span><span class=\"bp\">@</span><span class=\"n\">nodo01</span> <span class=\"bp\">~</span><span class=\"o\">]</span><span class=\"bp\">$</span> <span class=\"bp\">.</span><span class=\"n\">cache</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/</span><span class=\"n\">curl</span><span class=\"bp\">-</span><span class=\"mi\">7</span><span class=\"bp\">.</span><span class=\"mi\">88</span><span class=\"bp\">.</span><span class=\"mi\">1</span> <span class=\"bp\">-</span><span class=\"n\">v</span> <span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">lakecache.blob.core.windows.net</span>\n<span class=\"bp\">*</span>   <span class=\"n\">Trying</span> <span class=\"mi\">20</span><span class=\"bp\">.</span><span class=\"mi\">150</span><span class=\"bp\">.</span><span class=\"mi\">95</span><span class=\"bp\">.</span><span class=\"mi\">196</span><span class=\"o\">:</span><span class=\"mi\">443</span><span class=\"bp\">...</span>\n<span class=\"bp\">*</span> <span class=\"n\">Connected</span> <span class=\"n\">to</span> <span class=\"n\">lakecache.blob.core.windows.net</span> <span class=\"o\">(</span><span class=\"mi\">20</span><span class=\"bp\">.</span><span class=\"mi\">150</span><span class=\"bp\">.</span><span class=\"mi\">95</span><span class=\"bp\">.</span><span class=\"mi\">196</span><span class=\"o\">)</span> <span class=\"n\">port</span> <span class=\"mi\">443</span> <span class=\"o\">(</span><span class=\"bp\">#</span><span class=\"mi\">0</span><span class=\"o\">)</span>\n<span class=\"bp\">*</span> <span class=\"n\">ALPN</span><span class=\"o\">:</span> <span class=\"n\">offers</span> <span class=\"n\">h2</span><span class=\"o\">,</span><span class=\"n\">http</span><span class=\"bp\">/</span><span class=\"mi\">1</span><span class=\"bp\">.</span><span class=\"mi\">1</span>\n<span class=\"bp\">*</span> <span class=\"n\">TLSv1.3</span> <span class=\"o\">(</span><span class=\"n\">OUT</span><span class=\"o\">),</span> <span class=\"n\">TLS</span> <span class=\"n\">handshake</span><span class=\"o\">,</span> <span class=\"n\">Client</span> <span class=\"n\">hello</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">):</span>\n<span class=\"bp\">*</span>  <span class=\"n\">CAfile</span><span class=\"o\">:</span> <span class=\"bp\">/</span><span class=\"n\">etc</span><span class=\"bp\">/</span><span class=\"n\">ssl</span><span class=\"bp\">/</span><span class=\"n\">certs</span><span class=\"bp\">/</span><span class=\"n\">ca</span><span class=\"bp\">-</span><span class=\"n\">bundle.trust.crt</span>\n<span class=\"bp\">*</span>  <span class=\"n\">CApath</span><span class=\"o\">:</span> <span class=\"n\">none</span>\n<span class=\"bp\">*</span> <span class=\"n\">TLSv1.3</span> <span class=\"o\">(</span><span class=\"n\">IN</span><span class=\"o\">),</span> <span class=\"n\">TLS</span> <span class=\"n\">handshake</span><span class=\"o\">,</span> <span class=\"n\">Server</span> <span class=\"n\">hello</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">):</span>\n<span class=\"bp\">*</span> <span class=\"n\">TLSv1.2</span> <span class=\"o\">(</span><span class=\"n\">IN</span><span class=\"o\">),</span> <span class=\"n\">TLS</span> <span class=\"n\">handshake</span><span class=\"o\">,</span> <span class=\"n\">Certificate</span> <span class=\"o\">(</span><span class=\"mi\">11</span><span class=\"o\">):</span>\n<span class=\"bp\">*</span> <span class=\"n\">TLSv1.2</span> <span class=\"o\">(</span><span class=\"n\">IN</span><span class=\"o\">),</span> <span class=\"n\">TLS</span> <span class=\"n\">handshake</span><span class=\"o\">,</span> <span class=\"n\">Server</span> <span class=\"n\">key</span> <span class=\"n\">exchange</span> <span class=\"o\">(</span><span class=\"mi\">12</span><span class=\"o\">):</span>\n<span class=\"bp\">*</span> <span class=\"n\">TLSv1.2</span> <span class=\"o\">(</span><span class=\"n\">IN</span><span class=\"o\">),</span> <span class=\"n\">TLS</span> <span class=\"n\">handshake</span><span class=\"o\">,</span> <span class=\"n\">Server</span> <span class=\"n\">finished</span> <span class=\"o\">(</span><span class=\"mi\">14</span><span class=\"o\">):</span>\n<span class=\"bp\">*</span> <span class=\"n\">TLSv1.2</span> <span class=\"o\">(</span><span class=\"n\">OUT</span><span class=\"o\">),</span> <span class=\"n\">TLS</span> <span class=\"n\">handshake</span><span class=\"o\">,</span> <span class=\"n\">Client</span> <span class=\"n\">key</span> <span class=\"n\">exchange</span> <span class=\"o\">(</span><span class=\"mi\">16</span><span class=\"o\">):</span>\n<span class=\"bp\">*</span> <span class=\"n\">TLSv1.2</span> <span class=\"o\">(</span><span class=\"n\">OUT</span><span class=\"o\">),</span> <span class=\"n\">TLS</span> <span class=\"n\">change</span> <span class=\"n\">cipher</span><span class=\"o\">,</span> <span class=\"n\">Change</span> <span class=\"n\">cipher</span> <span class=\"n\">spec</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">):</span>\n<span class=\"bp\">*</span> <span class=\"n\">TLSv1.2</span> <span class=\"o\">(</span><span class=\"n\">OUT</span><span class=\"o\">),</span> <span class=\"n\">TLS</span> <span class=\"n\">handshake</span><span class=\"o\">,</span> <span class=\"n\">Finished</span> <span class=\"o\">(</span><span class=\"mi\">20</span><span class=\"o\">):</span>\n<span class=\"bp\">*</span> <span class=\"n\">TLSv1.2</span> <span class=\"o\">(</span><span class=\"n\">IN</span><span class=\"o\">),</span> <span class=\"n\">TLS</span> <span class=\"n\">handshake</span><span class=\"o\">,</span> <span class=\"n\">Finished</span> <span class=\"o\">(</span><span class=\"mi\">20</span><span class=\"o\">):</span>\n<span class=\"bp\">*</span> <span class=\"n\">SSL</span> <span class=\"n\">connection</span> <span class=\"n\">using</span> <span class=\"n\">TLSv1.2</span> <span class=\"bp\">/</span> <span class=\"n\">ECDHE</span><span class=\"bp\">-</span><span class=\"n\">RSA</span><span class=\"bp\">-</span><span class=\"n\">AES256</span><span class=\"bp\">-</span><span class=\"n\">GCM</span><span class=\"bp\">-</span><span class=\"n\">SHA384</span>\n<span class=\"bp\">*</span> <span class=\"n\">ALPN</span><span class=\"o\">:</span> <span class=\"n\">server</span> <span class=\"n\">did</span> <span class=\"n\">not</span> <span class=\"n\">agree</span> <span class=\"n\">on</span> <span class=\"n\">a</span> <span class=\"n\">protocol.</span> <span class=\"n\">Uses</span> <span class=\"n\">default.</span>\n<span class=\"bp\">*</span> <span class=\"n\">Server</span> <span class=\"n\">certificate</span><span class=\"o\">:</span>\n<span class=\"bp\">*</span>  <span class=\"n\">subject</span><span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"bp\">=</span><span class=\"n\">US</span><span class=\"bp\">;</span> <span class=\"n\">ST</span><span class=\"bp\">=</span><span class=\"n\">WA</span><span class=\"bp\">;</span> <span class=\"n\">L</span><span class=\"bp\">=</span><span class=\"n\">Redmond</span><span class=\"bp\">;</span> <span class=\"n\">O</span><span class=\"bp\">=</span><span class=\"n\">Microsoft</span> <span class=\"n\">Corporation</span><span class=\"bp\">;</span> <span class=\"n\">CN</span><span class=\"bp\">=*.</span><span class=\"n\">blob.core.windows.net</span>\n<span class=\"bp\">*</span>  <span class=\"n\">start</span> <span class=\"n\">date</span><span class=\"o\">:</span> <span class=\"n\">Nov</span> <span class=\"mi\">20</span> <span class=\"mi\">00</span><span class=\"o\">:</span><span class=\"mi\">42</span><span class=\"o\">:</span><span class=\"mi\">40</span> <span class=\"mi\">2023</span> <span class=\"n\">GMT</span>\n<span class=\"bp\">*</span>  <span class=\"n\">expire</span> <span class=\"n\">date</span><span class=\"o\">:</span> <span class=\"n\">Jun</span> <span class=\"mi\">27</span> <span class=\"mi\">23</span><span class=\"o\">:</span><span class=\"mi\">59</span><span class=\"o\">:</span><span class=\"mi\">59</span> <span class=\"mi\">2024</span> <span class=\"n\">GMT</span>\n<span class=\"bp\">*</span>  <span class=\"n\">subjectAltName</span><span class=\"o\">:</span> <span class=\"n\">host</span> <span class=\"s2\">\"lakecache.blob.core.windows.net\"</span> <span class=\"n\">matched</span> <span class=\"n\">cert's</span> <span class=\"s2\">\"*.blob.core.windows.net\"</span>\n<span class=\"bp\">*</span>  <span class=\"n\">issuer</span><span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"bp\">=</span><span class=\"n\">US</span><span class=\"bp\">;</span> <span class=\"n\">O</span><span class=\"bp\">=</span><span class=\"n\">Microsoft</span> <span class=\"n\">Corporation</span><span class=\"bp\">;</span> <span class=\"n\">CN</span><span class=\"bp\">=</span><span class=\"n\">Microsoft</span> <span class=\"n\">Azure</span> <span class=\"n\">TLS</span> <span class=\"n\">Issuing</span> <span class=\"n\">CA</span> <span class=\"mi\">01</span>\n<span class=\"bp\">*</span>  <span class=\"n\">SSL</span> <span class=\"n\">certificate</span> <span class=\"n\">verify</span> <span class=\"n\">ok.</span>\n<span class=\"bp\">*</span> <span class=\"n\">using</span> <span class=\"n\">HTTP</span><span class=\"bp\">/</span><span class=\"mi\">1</span><span class=\"bp\">.</span><span class=\"n\">x</span>\n<span class=\"bp\">&gt;</span> <span class=\"n\">GET</span> <span class=\"bp\">/</span> <span class=\"n\">HTTP</span><span class=\"bp\">/</span><span class=\"mi\">1</span><span class=\"bp\">.</span><span class=\"mi\">1</span>\n<span class=\"bp\">&gt;</span> <span class=\"n\">Host</span><span class=\"o\">:</span> <span class=\"n\">lakecache.blob.core.windows.net</span>\n<span class=\"bp\">&gt;</span> <span class=\"n\">User</span><span class=\"bp\">-</span><span class=\"n\">Agent</span><span class=\"o\">:</span> <span class=\"n\">curl</span><span class=\"bp\">/</span><span class=\"mi\">7</span><span class=\"bp\">.</span><span class=\"mi\">88</span><span class=\"bp\">.</span><span class=\"mi\">1</span>\n<span class=\"bp\">&gt;</span> <span class=\"n\">Accept</span><span class=\"o\">:</span> <span class=\"bp\">*/*</span>\n<span class=\"bp\">&gt;</span>\n<span class=\"bp\">&lt;</span> <span class=\"n\">HTTP</span><span class=\"bp\">/</span><span class=\"mi\">1</span><span class=\"bp\">.</span><span class=\"mi\">1</span> <span class=\"mi\">400</span> <span class=\"n\">Value</span> <span class=\"n\">for</span> <span class=\"n\">one</span> <span class=\"n\">of</span> <span class=\"n\">the</span> <span class=\"n\">query</span> <span class=\"kd\">parameters</span> <span class=\"n\">specified</span> <span class=\"k\">in</span> <span class=\"n\">the</span> <span class=\"n\">request</span> <span class=\"n\">URI</span> <span class=\"n\">is</span> <span class=\"n\">invalid.</span>\n<span class=\"bp\">&lt;</span> <span class=\"n\">Content</span><span class=\"bp\">-</span><span class=\"n\">Length</span><span class=\"o\">:</span> <span class=\"mi\">351</span>\n<span class=\"bp\">&lt;</span> <span class=\"n\">Content</span><span class=\"bp\">-</span><span class=\"kt\">Type</span><span class=\"o\">:</span> <span class=\"n\">application</span><span class=\"bp\">/</span><span class=\"n\">xml</span>\n<span class=\"bp\">&lt;</span> <span class=\"n\">Server</span><span class=\"o\">:</span> <span class=\"n\">Microsoft</span><span class=\"bp\">-</span><span class=\"n\">HTTPAPI</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"bp\">.</span><span class=\"mi\">0</span>\n<span class=\"bp\">&lt;</span> <span class=\"n\">x</span><span class=\"bp\">-</span><span class=\"n\">ms</span><span class=\"bp\">-</span><span class=\"n\">request</span><span class=\"bp\">-</span><span class=\"n\">id</span><span class=\"o\">:</span> <span class=\"mi\">6762566</span><span class=\"n\">a</span><span class=\"bp\">-</span><span class=\"n\">f01e</span><span class=\"bp\">-</span><span class=\"mi\">002</span><span class=\"n\">e</span><span class=\"bp\">-</span><span class=\"mi\">0301</span><span class=\"bp\">-</span><span class=\"mi\">5</span><span class=\"n\">ab008000000</span>\n<span class=\"bp\">&lt;</span> <span class=\"n\">Date</span><span class=\"o\">:</span> <span class=\"n\">Wed</span><span class=\"o\">,</span> <span class=\"mi\">07</span> <span class=\"n\">Feb</span> <span class=\"mi\">2024</span> <span class=\"mi\">20</span><span class=\"o\">:</span><span class=\"mi\">11</span><span class=\"o\">:</span><span class=\"mi\">11</span> <span class=\"n\">GMT</span>\n<span class=\"bp\">&lt;</span>\n<span class=\"bp\">&lt;?</span><span class=\"n\">xml</span> <span class=\"n\">version</span><span class=\"bp\">=</span><span class=\"s2\">\"1.0\"</span> <span class=\"n\">encoding</span><span class=\"bp\">=</span><span class=\"s2\">\"utf-8\"</span><span class=\"bp\">?&gt;&lt;</span><span class=\"n\">Error</span><span class=\"bp\">&gt;&lt;</span><span class=\"n\">Code</span><span class=\"bp\">&gt;</span><span class=\"n\">InvalidQueryParameterValue</span><span class=\"bp\">&lt;/</span><span class=\"n\">Code</span><span class=\"bp\">&gt;&lt;</span><span class=\"n\">Message</span><span class=\"bp\">&gt;</span><span class=\"n\">Value</span> <span class=\"n\">for</span> <span class=\"n\">one</span> <span class=\"n\">of</span> <span class=\"n\">the</span> <span class=\"n\">query</span> <span class=\"kd\">parameters</span> <span class=\"n\">specified</span> <span class=\"k\">in</span> <span class=\"n\">the</span> <span class=\"n\">request</span> <span class=\"n\">URI</span> <span class=\"n\">is</span> <span class=\"n\">invalid.</span>\n<span class=\"n\">RequestId</span><span class=\"o\">:</span><span class=\"mi\">6762566</span><span class=\"n\">a</span><span class=\"bp\">-</span><span class=\"n\">f01e</span><span class=\"bp\">-</span><span class=\"mi\">002</span><span class=\"n\">e</span><span class=\"bp\">-</span><span class=\"mi\">0301</span><span class=\"bp\">-</span><span class=\"mi\">5</span><span class=\"n\">ab008000000</span>\n<span class=\"bp\">*</span> <span class=\"n\">Connection</span> <span class=\"bp\">#</span><span class=\"mi\">0</span> <span class=\"n\">to</span> <span class=\"n\">host</span> <span class=\"n\">lakecache.blob.core.windows.net</span> <span class=\"n\">left</span> <span class=\"n\">intact</span>\n<span class=\"n\">Time</span><span class=\"o\">:</span><span class=\"mi\">2024</span><span class=\"bp\">-</span><span class=\"mi\">02</span><span class=\"bp\">-</span><span class=\"mi\">07</span><span class=\"n\">T20</span><span class=\"o\">:</span><span class=\"mi\">11</span><span class=\"o\">:</span><span class=\"mi\">12</span><span class=\"bp\">.</span><span class=\"mi\">1860407</span><span class=\"n\">Z</span><span class=\"bp\">&lt;/</span><span class=\"n\">Message</span><span class=\"bp\">&gt;&lt;</span><span class=\"n\">QueryParameterName</span><span class=\"bp\">&gt;</span><span class=\"n\">comp</span><span class=\"bp\">&lt;/</span><span class=\"n\">QueryParameterName</span><span class=\"bp\">&gt;&lt;</span><span class=\"n\">QueryParameterValue</span> <span class=\"bp\">/&gt;&lt;</span><span class=\"n\">Reason</span> <span class=\"bp\">/&gt;&lt;/</span><span class=\"n\">Error</span><span class=\"bp\">&gt;</span>\n</code></pre></div>",
        "id": 420334055,
        "sender_full_name": "Miguel Marco",
        "timestamp": 1707336707
    },
    {
        "content": "<p>Jason it'd be nice to also see what <code>ls -l that/cert/file</code> is as well -- specifically whether it's a symlink or not</p>",
        "id": 420334140,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707336729
    },
    {
        "content": "<p>I suppose I was wrong before, it's not that you're being MITM'ed, it's indeed that the statically downloaded curl can't find your certs</p>",
        "id": 420334197,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707336753
    },
    {
        "content": "<p>Is there a way to ask curl where is it looking for the certs?</p>",
        "id": 420334338,
        "sender_full_name": "Miguel Marco",
        "timestamp": 1707336816
    },
    {
        "content": "<p>Yes I'm sure there is I just didn't know it offhand and the man page didn't tell me</p>",
        "id": 420334448,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707336846
    },
    {
        "content": "<p>You ran the same <code>strace</code> as I mentioned above and it didn't say anything either I assume?</p>",
        "id": 420334481,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707336859
    },
    {
        "content": "<p>This is interesting: it seems to be looking at the right directory... but apparently doesn't find it:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"o\">[</span><span class=\"n\">mmarco</span><span class=\"bp\">@</span><span class=\"n\">nodo01</span> <span class=\"bp\">~</span><span class=\"o\">]</span><span class=\"bp\">$</span> <span class=\"n\">strace</span> <span class=\"bp\">-</span><span class=\"n\">e</span> <span class=\"n\">trace</span><span class=\"bp\">=</span><span class=\"kn\">open</span> <span class=\"bp\">.</span><span class=\"n\">cache</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/</span><span class=\"n\">curl</span><span class=\"bp\">-</span><span class=\"mi\">7</span><span class=\"bp\">.</span><span class=\"mi\">88</span><span class=\"bp\">.</span><span class=\"mi\">1</span> <span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">lakecache.blob.core.windows.net</span><span class=\"bp\">/</span>\n<span class=\"kn\">open</span><span class=\"o\">(</span><span class=\"s2\">\"/./nix/store/6k1wq0nhs6vwxj92vdy2hz7cg1f9997p-openssl-static-x86_64-unknown-linux-musl-3.0.8-etc/etc/ssl/openssl.cnf\"</span><span class=\"o\">,</span> <span class=\"n\">O_RDONLY</span><span class=\"bp\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"bp\">-</span><span class=\"mi\">1</span> <span class=\"n\">ENOENT</span> <span class=\"o\">(</span><span class=\"n\">No</span> <span class=\"n\">such</span> <span class=\"n\">file</span> <span class=\"n\">or</span> <span class=\"n\">directory</span><span class=\"o\">)</span>\n<span class=\"kn\">open</span><span class=\"o\">(</span><span class=\"s2\">\"/home/mmarco/.curlrc\"</span><span class=\"o\">,</span> <span class=\"n\">O_RDONLY</span><span class=\"bp\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"bp\">-</span><span class=\"mi\">1</span> <span class=\"n\">ENOENT</span> <span class=\"o\">(</span><span class=\"n\">No</span> <span class=\"n\">such</span> <span class=\"n\">file</span> <span class=\"n\">or</span> <span class=\"n\">directory</span><span class=\"o\">)</span>\n<span class=\"kn\">open</span><span class=\"o\">(</span><span class=\"s2\">\"/home/mmarco/.config/curlrc\"</span><span class=\"o\">,</span> <span class=\"n\">O_RDONLY</span><span class=\"bp\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"bp\">-</span><span class=\"mi\">1</span> <span class=\"n\">ENOENT</span> <span class=\"o\">(</span><span class=\"n\">No</span> <span class=\"n\">such</span> <span class=\"n\">file</span> <span class=\"n\">or</span> <span class=\"n\">directory</span><span class=\"o\">)</span>\n<span class=\"kn\">open</span><span class=\"o\">(</span><span class=\"s2\">\"/etc/passwd\"</span><span class=\"o\">,</span> <span class=\"n\">O_RDONLY</span><span class=\"bp\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"bp\">|</span><span class=\"n\">O_CLOEXEC</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"mi\">3</span>\n<span class=\"kn\">open</span><span class=\"o\">(</span><span class=\"s2\">\"/etc/ssl/certs/\"</span><span class=\"o\">,</span> <span class=\"n\">O_RDONLY</span><span class=\"bp\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"mi\">6</span>\n<span class=\"kn\">open</span><span class=\"o\">(</span><span class=\"s2\">\"/etc/ssl/certs/\"</span><span class=\"o\">,</span> <span class=\"n\">O_RDONLY</span><span class=\"bp\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"mi\">6</span>\n<span class=\"kn\">open</span><span class=\"o\">(</span><span class=\"s2\">\"/etc/ssl/certs/\"</span><span class=\"o\">,</span> <span class=\"n\">O_RDONLY</span><span class=\"bp\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"mi\">6</span>\n<span class=\"n\">curl</span><span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">77</span><span class=\"o\">)</span> <span class=\"n\">error</span> <span class=\"n\">setting</span> <span class=\"n\">certificate</span> <span class=\"n\">file</span><span class=\"o\">:</span> <span class=\"bp\">/</span><span class=\"n\">etc</span><span class=\"bp\">/</span><span class=\"n\">ssl</span><span class=\"bp\">/</span><span class=\"n\">certs</span><span class=\"bp\">/</span>\n<span class=\"bp\">+++</span> <span class=\"n\">exited</span> <span class=\"k\">with</span> <span class=\"mi\">77</span> <span class=\"bp\">+++</span>\n</code></pre></div>\n<p>Maybe it is confusing files and directories?</p>",
        "id": 420334802,
        "sender_full_name": "Miguel Marco",
        "timestamp": 1707336985
    },
    {
        "content": "<p>Did you run that with your environment variable set? Or without?</p>",
        "id": 420335075,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707337085
    },
    {
        "content": "<p>The <code>strace</code> did say where it was looking: <code>open(\"/etc/ssl/certs/ca-certificates.crt\", O_RDONLY|O_LARGEFILE) = -1 ENOENT (No such file or directory)</code></p>",
        "id": 420335134,
        "sender_full_name": "Jason Rute",
        "timestamp": 1707337106
    },
    {
        "content": "<p>With the environment set. Let me try without it:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"o\">[</span><span class=\"n\">mmarco</span><span class=\"bp\">@</span><span class=\"n\">nodo01</span> <span class=\"bp\">~</span><span class=\"o\">]</span><span class=\"bp\">$</span> <span class=\"n\">unset</span>  <span class=\"n\">CURL_CA_BUNDLE</span>\n<span class=\"o\">[</span><span class=\"n\">mmarco</span><span class=\"bp\">@</span><span class=\"n\">nodo01</span> <span class=\"bp\">~</span><span class=\"o\">]</span><span class=\"bp\">$</span> <span class=\"n\">strace</span> <span class=\"bp\">-</span><span class=\"n\">e</span> <span class=\"n\">trace</span><span class=\"bp\">=</span><span class=\"kn\">open</span> <span class=\"bp\">.</span><span class=\"n\">cache</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/</span><span class=\"n\">curl</span><span class=\"bp\">-</span><span class=\"mi\">7</span><span class=\"bp\">.</span><span class=\"mi\">88</span><span class=\"bp\">.</span><span class=\"mi\">1</span> <span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">lakecache.blob.core.windows.net</span><span class=\"bp\">/</span>\n<span class=\"kn\">open</span><span class=\"o\">(</span><span class=\"s2\">\"/./nix/store/6k1wq0nhs6vwxj92vdy2hz7cg1f9997p-openssl-static-x86_64-unknown-linux-musl-3.0.8-etc/etc/ssl/openssl.cnf\"</span><span class=\"o\">,</span> <span class=\"n\">O_RDONLY</span><span class=\"bp\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"bp\">-</span><span class=\"mi\">1</span> <span class=\"n\">ENOENT</span> <span class=\"o\">(</span><span class=\"n\">No</span> <span class=\"n\">such</span> <span class=\"n\">file</span> <span class=\"n\">or</span> <span class=\"n\">directory</span><span class=\"o\">)</span>\n<span class=\"kn\">open</span><span class=\"o\">(</span><span class=\"s2\">\"/home/mmarco/.curlrc\"</span><span class=\"o\">,</span> <span class=\"n\">O_RDONLY</span><span class=\"bp\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"bp\">-</span><span class=\"mi\">1</span> <span class=\"n\">ENOENT</span> <span class=\"o\">(</span><span class=\"n\">No</span> <span class=\"n\">such</span> <span class=\"n\">file</span> <span class=\"n\">or</span> <span class=\"n\">directory</span><span class=\"o\">)</span>\n<span class=\"kn\">open</span><span class=\"o\">(</span><span class=\"s2\">\"/home/mmarco/.config/curlrc\"</span><span class=\"o\">,</span> <span class=\"n\">O_RDONLY</span><span class=\"bp\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"bp\">-</span><span class=\"mi\">1</span> <span class=\"n\">ENOENT</span> <span class=\"o\">(</span><span class=\"n\">No</span> <span class=\"n\">such</span> <span class=\"n\">file</span> <span class=\"n\">or</span> <span class=\"n\">directory</span><span class=\"o\">)</span>\n<span class=\"kn\">open</span><span class=\"o\">(</span><span class=\"s2\">\"/etc/passwd\"</span><span class=\"o\">,</span> <span class=\"n\">O_RDONLY</span><span class=\"bp\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"bp\">|</span><span class=\"n\">O_CLOEXEC</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"mi\">3</span>\n<span class=\"kn\">open</span><span class=\"o\">(</span><span class=\"s2\">\"/etc/ssl/certs/ca-certificates.crt\"</span><span class=\"o\">,</span> <span class=\"n\">O_RDONLY</span><span class=\"bp\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"bp\">-</span><span class=\"mi\">1</span> <span class=\"n\">ENOENT</span> <span class=\"o\">(</span><span class=\"n\">No</span> <span class=\"n\">such</span> <span class=\"n\">file</span> <span class=\"n\">or</span> <span class=\"n\">directory</span><span class=\"o\">)</span>\n<span class=\"n\">curl</span><span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">35</span><span class=\"o\">)</span> <span class=\"n\">OpenSSL</span><span class=\"bp\">/</span><span class=\"mi\">3</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">.</span><span class=\"mi\">8</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span><span class=\"mi\">16000069</span><span class=\"o\">:</span><span class=\"n\">STORE</span> <span class=\"n\">routines</span><span class=\"o\">::</span><span class=\"n\">unregistered</span> <span class=\"n\">scheme</span>\n<span class=\"bp\">+++</span> <span class=\"n\">exited</span> <span class=\"k\">with</span> <span class=\"mi\">35</span> <span class=\"bp\">+++</span>\n</code></pre></div>",
        "id": 420335402,
        "sender_full_name": "Miguel Marco",
        "timestamp": 1707337203
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"gp\">$ </span>ls<span class=\"w\"> </span>-l<span class=\"w\"> </span>/the/path/to/my/conda/env/venv/ssl/cacert.pem\n<span class=\"go\">-rw-rw-r-- 2 jasonrute jasonrute 292541 Feb  1 22:14 /the/path/to/my/conda/env/venv/ssl/cacert.pem</span>\n</code></pre></div>",
        "id": 420335520,
        "sender_full_name": "Jason Rute",
        "timestamp": 1707337237
    },
    {
        "content": "<p>Doesn't look like a symbolic link.</p>",
        "id": 420335578,
        "sender_full_name": "Jason Rute",
        "timestamp": 1707337258
    },
    {
        "content": "<p>This is what I get when I export  the specific certificate file (instead of the directory)</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"o\">[</span><span class=\"n\">mmarco</span><span class=\"bp\">@</span><span class=\"n\">nodo01</span> <span class=\"bp\">~</span><span class=\"o\">]</span><span class=\"bp\">$</span> <span class=\"kn\">export</span> <span class=\"n\">CURL_CA_BUNDLE</span><span class=\"bp\">=/</span><span class=\"n\">etc</span><span class=\"bp\">/</span><span class=\"n\">ssl</span><span class=\"bp\">/</span><span class=\"n\">certs</span><span class=\"bp\">/</span><span class=\"n\">ca</span><span class=\"bp\">-</span><span class=\"n\">bundle.trust.crt</span>\n<span class=\"o\">[</span><span class=\"n\">mmarco</span><span class=\"bp\">@</span><span class=\"n\">nodo01</span> <span class=\"bp\">~</span><span class=\"o\">]</span><span class=\"bp\">$</span> <span class=\"n\">strace</span> <span class=\"bp\">-</span><span class=\"n\">e</span> <span class=\"n\">trace</span><span class=\"bp\">=</span><span class=\"kn\">open</span> <span class=\"bp\">.</span><span class=\"n\">cache</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/</span><span class=\"n\">curl</span><span class=\"bp\">-</span><span class=\"mi\">7</span><span class=\"bp\">.</span><span class=\"mi\">88</span><span class=\"bp\">.</span><span class=\"mi\">1</span> <span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">lakecache.blob.core.windows.net</span><span class=\"bp\">/</span>\n<span class=\"kn\">open</span><span class=\"o\">(</span><span class=\"s2\">\"/./nix/store/6k1wq0nhs6vwxj92vdy2hz7cg1f9997p-openssl-static-x86_64-unknown-linux-musl-3.0.8-etc/etc/ssl/openssl.cnf\"</span><span class=\"o\">,</span> <span class=\"n\">O_RDONLY</span><span class=\"bp\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"bp\">-</span><span class=\"mi\">1</span> <span class=\"n\">ENOENT</span> <span class=\"o\">(</span><span class=\"n\">No</span> <span class=\"n\">such</span> <span class=\"n\">file</span> <span class=\"n\">or</span> <span class=\"n\">directory</span><span class=\"o\">)</span>\n<span class=\"kn\">open</span><span class=\"o\">(</span><span class=\"s2\">\"/home/mmarco/.curlrc\"</span><span class=\"o\">,</span> <span class=\"n\">O_RDONLY</span><span class=\"bp\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"bp\">-</span><span class=\"mi\">1</span> <span class=\"n\">ENOENT</span> <span class=\"o\">(</span><span class=\"n\">No</span> <span class=\"n\">such</span> <span class=\"n\">file</span> <span class=\"n\">or</span> <span class=\"n\">directory</span><span class=\"o\">)</span>\n<span class=\"kn\">open</span><span class=\"o\">(</span><span class=\"s2\">\"/home/mmarco/.config/curlrc\"</span><span class=\"o\">,</span> <span class=\"n\">O_RDONLY</span><span class=\"bp\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"bp\">-</span><span class=\"mi\">1</span> <span class=\"n\">ENOENT</span> <span class=\"o\">(</span><span class=\"n\">No</span> <span class=\"n\">such</span> <span class=\"n\">file</span> <span class=\"n\">or</span> <span class=\"n\">directory</span><span class=\"o\">)</span>\n<span class=\"kn\">open</span><span class=\"o\">(</span><span class=\"s2\">\"/etc/passwd\"</span><span class=\"o\">,</span> <span class=\"n\">O_RDONLY</span><span class=\"bp\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"bp\">|</span><span class=\"n\">O_CLOEXEC</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"mi\">3</span>\n<span class=\"kn\">open</span><span class=\"o\">(</span><span class=\"s2\">\"/etc/ssl/certs/ca-bundle.trust.crt\"</span><span class=\"o\">,</span> <span class=\"n\">O_RDONLY</span><span class=\"bp\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"mi\">6</span>\n<span class=\"bp\">&lt;?</span><span class=\"n\">xml</span> <span class=\"n\">version</span><span class=\"bp\">=</span><span class=\"s2\">\"1.0\"</span> <span class=\"n\">encoding</span><span class=\"bp\">=</span><span class=\"s2\">\"utf-8\"</span><span class=\"bp\">?&gt;&lt;</span><span class=\"n\">Error</span><span class=\"bp\">&gt;&lt;</span><span class=\"n\">Code</span><span class=\"bp\">&gt;</span><span class=\"n\">InvalidQueryParameterValue</span><span class=\"bp\">&lt;/</span><span class=\"n\">Code</span><span class=\"bp\">&gt;&lt;</span><span class=\"n\">Message</span><span class=\"bp\">&gt;</span><span class=\"n\">Value</span> <span class=\"n\">for</span> <span class=\"n\">one</span> <span class=\"n\">of</span> <span class=\"n\">the</span> <span class=\"n\">query</span> <span class=\"kd\">parameters</span> <span class=\"n\">specified</span> <span class=\"k\">in</span> <span class=\"n\">the</span> <span class=\"n\">request</span> <span class=\"n\">URI</span> <span class=\"n\">is</span> <span class=\"n\">invalid.</span>\n<span class=\"n\">RequestId</span><span class=\"o\">:</span><span class=\"n\">e2598e19</span><span class=\"bp\">-</span><span class=\"mi\">701</span><span class=\"n\">e</span><span class=\"bp\">-</span><span class=\"mi\">0034</span><span class=\"bp\">-</span><span class=\"mi\">0403</span><span class=\"bp\">-</span><span class=\"mi\">5</span><span class=\"n\">a9f67000000</span>\n<span class=\"n\">Time</span><span class=\"o\">:</span><span class=\"mi\">2024</span><span class=\"bp\">-</span><span class=\"mi\">02</span><span class=\"bp\">-</span><span class=\"mi\">07</span><span class=\"n\">T20</span><span class=\"o\">:</span><span class=\"mi\">22</span><span class=\"o\">:</span><span class=\"mi\">28</span><span class=\"bp\">.</span><span class=\"mi\">7884785</span><span class=\"n\">Z</span><span class=\"bp\">&lt;/</span><span class=\"n\">Message</span><span class=\"bp\">&gt;&lt;</span><span class=\"n\">QueryParameterName</span><span class=\"bp\">&gt;</span><span class=\"n\">comp</span><span class=\"bp\">&lt;/</span><span class=\"n\">QueryParameterName</span><span class=\"bp\">&gt;&lt;</span><span class=\"n\">QueryParameterValue</span> <span class=\"bp\">/&gt;&lt;</span><span class=\"n\">Reason</span> <span class=\"bp\">/&gt;&lt;/</span><span class=\"n\">Error</span><span class=\"bp\">&gt;+++</span> <span class=\"n\">exited</span> <span class=\"k\">with</span> <span class=\"mi\">0</span> <span class=\"bp\">+++</span>\n</code></pre></div>",
        "id": 420336109,
        "sender_full_name": "Miguel Marco",
        "timestamp": 1707337434
    },
    {
        "content": "<p>Yeah that looks right/fine -- <code>CURL_CA_BUNDLE</code> is meant to be the file, and <code>CURL_CA_PATH</code> probably will work if you set it to the directory</p>",
        "id": 420336313,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707337504
    },
    {
        "content": "<p>(Certs can either be in a directory or all <code>cat</code>ted together in one file)</p>",
        "id": 420336342,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707337515
    },
    {
        "content": "<p>But if one works you're good. Which that looks like it is.</p>",
        "id": 420336379,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707337527
    },
    {
        "content": "<p>I.e. <code>lake whateeveryouwererunning</code> should also work.</p>",
        "id": 420336429,
        "sender_full_name": "Julian Berman",
        "timestamp": 1707337547
    },
    {
        "content": "<p>Thanks, I guess now I would need some tweaking in my install to set the variable when I launch the web version of vscode.</p>",
        "id": 420336675,
        "sender_full_name": "Miguel Marco",
        "timestamp": 1707337634
    },
    {
        "content": "<p>I think curl uses another program curl-config which is supposed to be in the same <code>bin</code> directory as <code>curl</code> to find this stuff.  See: <a href=\"https://serverfault.com/a/716313\">https://serverfault.com/a/716313</a></p>",
        "id": 420336866,
        "sender_full_name": "Jason Rute",
        "timestamp": 1707337715
    },
    {
        "content": "<p><code>curl-config --ca</code> will tell you where curl is looking.</p>",
        "id": 420337033,
        "sender_full_name": "Jason Rute",
        "timestamp": 1707337775
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"115715\">Jason Rute</span> <a href=\"#narrow/stream/113488-general/topic/openssl.20error.20when.20running.20.60lake.20exe.20cache.20get.60/near/420288944\">said</a>:</p>\n<blockquote>\n<p>Okay, here is a <strong>hack</strong> that works for me.  cc <span class=\"user-mention silent\" data-user-id=\"461731\">Miguel Marco</span>:</p>\n<ol>\n<li>Delete <code>~/.cache/mathlib/curl-7.88.1</code></li>\n<li>Install an updated curl.  Since my system is locked down, I make a conda environment and installed <code>conda install curl</code> into it.</li>\n</ol>\n<p>Then it works.  (The first step seems important.  It is not just enough to update curl.)</p>\n</blockquote>\n<p>Just wanted to add that I also ran into this exact issue on my university cluster. Ended up fixing it by settling on this hack, but still a bit unsatisfying that this seems to be the current best way to resolve it.</p>",
        "id": 425092218,
        "sender_full_name": "Alex Gu",
        "timestamp": 1709733575
    },
    {
        "content": "<p>Is there a good place to file an issue about this?</p>",
        "id": 425095564,
        "sender_full_name": "Jason Rute",
        "timestamp": 1709734347
    },
    {
        "content": "<p>Someone with nix and this issue needs to test if it's possible to update static-curl</p>",
        "id": 425096401,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1709734531
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> do you have a concrete set of instructions that one of us can follow to test this?  (It looks like Nix can be installed via conda so that is at least one path we could use to run nix.  If it can be locally installed like conda can, that is another option.)</p>",
        "id": 425304385,
        "sender_full_name": "Jason Rute",
        "timestamp": 1709818766
    },
    {
        "content": "<p>I'm afraid not, I have no idea how nix updates work. Maybe <span class=\"user-mention\" data-user-id=\"110024\">@Sebastian Ullrich</span> has guidance</p>",
        "id": 425354321,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1709831229
    },
    {
        "content": "<p>I'm not clear on the exact suggestion, do we expect that simply updating the curl version will fix the issue?</p>",
        "id": 425355963,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1709831734
    },
    {
        "content": "<p>I think so?</p>",
        "id": 425355993,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1709831746
    },
    {
        "content": "<p>AFAICT that's the fix that was applied, just download the latest version over top of the one we are vendoring</p>",
        "id": 425356137,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1709831789
    },
    {
        "content": "<p>I haven't read back to see what we did here but I don't think that was it?</p>",
        "id": 425356240,
        "sender_full_name": "Julian Berman",
        "timestamp": 1709831828
    },
    {
        "content": "<p>Users who run into this have old curl that doesn't support <code>--parallel</code></p>",
        "id": 425356278,
        "sender_full_name": "Julian Berman",
        "timestamp": 1709831840
    },
    {
        "content": "<p>And the behavior of one of our/Lean's tools is \"OK go download newer curl\"</p>",
        "id": 425356307,
        "sender_full_name": "Julian Berman",
        "timestamp": 1709831850
    },
    {
        "content": "<p>And that newer curl may not be configured the same way the host machine's curl was</p>",
        "id": 425356367,
        "sender_full_name": "Julian Berman",
        "timestamp": 1709831867
    },
    {
        "content": "<p>yeah but the fix is still to just get a newer curl, it's not being configured specially in <span class=\"user-mention silent\" data-user-id=\"115715\">Jason Rute</span> 's directions</p>",
        "id": 425356622,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1709831942
    },
    {
        "content": "<p>OK, I thought I recalled that new enough curl <em>was</em> being downloaded but still wasn't working right, but my memory is bad clearly and I can't reread at the minute</p>",
        "id": 425356882,
        "sender_full_name": "Julian Berman",
        "timestamp": 1709832022
    },
    {
        "content": "<p>In part I don't know whether it is nix's fault or if the package manager / conda has access to a better mechanism for configuring curl which is why I was hoping someone would test using the latest curl in nix</p>",
        "id": 425357137,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1709832109
    },
    {
        "content": "<p>Well let's try: <a href=\"https://github.com/leanprover-community/static-curl/releases/tag/v8.6.0\">https://github.com/leanprover-community/static-curl/releases/tag/v8.6.0</a></p>",
        "id": 425359386,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1709832835
    }
]