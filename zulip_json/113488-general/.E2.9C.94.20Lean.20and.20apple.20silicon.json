[
    {
        "content": "<p>Lean appears to be running quite slowly on my M1 MacBook Pro and I've been trying to diagnose the cause. I minimized imports and closed other applications and even restarted the computer, and it still runs very slowly. Lean shows up in the Activity Monitor as \"Intel\", so I'm wondering if it's slow because it's running through Rosetta Stone on emulation mode. </p>\n<p>There was a <a href=\"#narrow/stream/113488-general\">conversation about this</a> in 2020 but the lean release has changed in many ways and I'm hoping for simple instructions as to what to do.</p>",
        "id": 433801776,
        "sender_full_name": "Jeremy Kahn",
        "timestamp": 1713366135
    },
    {
        "content": "<p>Which Lean version are you using currently? (i.e., <code>4.x.x</code>)</p>",
        "id": 433803649,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1713366336
    },
    {
        "content": "<p>I think there are now many people using Apple silicon, and I haven't heard about these complaints in a long time. (I'm on Linux though)</p>",
        "id": 433803971,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1713366367
    },
    {
        "content": "<p>Rosetta wonâ€™t help but even that was pretty snappy back when it was necessary</p>",
        "id": 433805753,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1713366570
    },
    {
        "content": "<p>Generally, I would advise moving to a native elan install.</p>",
        "id": 433806173,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1713366614
    },
    {
        "content": "<p>Someone jump in to correct/adjust but I would </p>\n<ul>\n<li><code>rm -rf ~/.elan</code> </li>\n<li><code>curl https://raw.githubusercontent.com/leanprover/elan/master/elan-init.sh -sSf | sh</code></li>\n</ul>\n<p>And you should have the native version. You will have to redownload the lean releases used in your projects. </p>\n<p>If the slowness persists, then we will have to think harder.</p>",
        "id": 433810084,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1713367059
    },
    {
        "content": "<p>Okay thank you <span class=\"user-mention\" data-user-id=\"306577\">@Matthew Ballard</span> . Does it matter what directory I run the curl in?</p>",
        "id": 433814515,
        "sender_full_name": "Jeremy Kahn",
        "timestamp": 1713367557
    },
    {
        "content": "<p>I usually just run it in my home directory but I doubt it matters</p>",
        "id": 433815980,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1713367718
    },
    {
        "content": "<p>Hmm...I ran the curl and it says that I have lean installed in <code>/usr/bin/local</code>, and it won't install elan while lean is installed. Do I just run <code>rm -rf lean</code> in <code>/usr/bin/local</code>? There are also many other lean-like directories there.</p>",
        "id": 433821884,
        "sender_full_name": "Jeremy Kahn",
        "timestamp": 1713369185
    },
    {
        "content": "<p>I think on mac your safest bet is to remove the existing lean install completely and use the version on <code>brew</code>. It's usually up to date</p>",
        "id": 433823304,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1713369604
    },
    {
        "content": "<p>The issue appears to be that Intel brew was used to install Lean while <a href=\"http://elan-init.sh\">elan-init.sh</a> would have figured out the correct architecture so calling brew the safest bet is a bit of a stretch</p>",
        "id": 433828017,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1713370923
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"432565\">@Jeremy Kahn</span> In other words, try again after <code>brew uninstall elan-init</code></p>",
        "id": 433828486,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1713371105
    },
    {
        "content": "<p>A fresh install of brew on an apple silicon  machine does not install the Intel version. Did this elan installation get carried over by migration assistant from an Intel machine?</p>",
        "id": 433831281,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1713372077
    },
    {
        "content": "<p>I believe the recommendation when upgrading to apple silicon is a complete delete and reinstall of homebrew. I think homebrew has switched to <code>/opt/homebrew/</code> on silicon macs.</p>",
        "id": 433833487,
        "sender_full_name": "Richard Osborn",
        "timestamp": 1713372773
    },
    {
        "content": "<p>Okay I followed <span class=\"user-mention\" data-user-id=\"110024\">@Sebastian Ullrich</span> 's recommendation and it said:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code>  <span class=\"n\">stable</span> <span class=\"n\">installed</span> <span class=\"bp\">-</span> <span class=\"n\">Lean</span> <span class=\"o\">(</span><span class=\"n\">version</span> <span class=\"mi\">4</span><span class=\"bp\">.</span><span class=\"mi\">7</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"o\">,</span> <span class=\"n\">aarch64</span><span class=\"bp\">-</span><span class=\"n\">apple</span><span class=\"bp\">-</span><span class=\"n\">darwin</span><span class=\"o\">,</span> <span class=\"n\">commit</span> <span class=\"mi\">6</span><span class=\"n\">fce8f7d5cd1</span><span class=\"o\">,</span> <span class=\"n\">Release</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>My google results tell me that this is indeed apple silicon.</p>",
        "id": 433844331,
        "sender_full_name": "Jeremy Kahn",
        "timestamp": 1713376626
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"432565\">Jeremy Kahn</span> has marked this topic as resolved.</p>",
        "id": 433852953,
        "sender_full_name": "Notification Bot",
        "timestamp": 1713379657
    }
]