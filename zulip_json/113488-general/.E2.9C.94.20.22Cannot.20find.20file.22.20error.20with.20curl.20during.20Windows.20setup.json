[
    {
        "content": "<p>Hello, I'm trying to set up a lean4 mathlib project on Windows, following the <a href=\"https://leanprover-community.github.io/install/project.html#creating-a-lean-project\">tutorial in the docs</a>. However I get this very strange error and stacktrace when running the <code>lake</code> command:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">downloading</span> <span class=\"n\">component</span> <span class=\"bp\">'</span><span class=\"n\">lean'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">installing</span> <span class=\"n\">component</span> <span class=\"bp\">'</span><span class=\"n\">lean'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">Downloading</span> <span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">toolchain</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"bp\">&gt;</span> <span class=\"n\">curl</span> <span class=\"bp\">-</span><span class=\"n\">s</span> <span class=\"bp\">-</span><span class=\"n\">f</span> <span class=\"bp\">-</span><span class=\"n\">o</span> <span class=\"n\">mathlib_proj</span><span class=\"bp\">\\</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">toolchain</span> <span class=\"bp\">-</span><span class=\"n\">L</span> <span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">raw.githubusercontent.com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"bp\">/</span><span class=\"n\">master</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">toolchain</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">stdout</span><span class=\"o\">:</span>\n<span class=\"n\">Cannot</span> <span class=\"n\">find</span> <span class=\"n\">file</span> <span class=\"n\">at</span> <span class=\"bp\">'..\\\\</span><span class=\"n\">lib</span><span class=\"bp\">\\</span><span class=\"n\">curl</span><span class=\"bp\">\\</span><span class=\"n\">tools</span><span class=\"bp\">\\</span><span class=\"n\">curl</span><span class=\"bp\">-</span><span class=\"mi\">8</span><span class=\"bp\">.</span><span class=\"mi\">6</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"n\">_1</span><span class=\"bp\">-</span><span class=\"n\">win64</span><span class=\"bp\">-</span><span class=\"n\">mingw</span><span class=\"bp\">\\</span><span class=\"n\">bin</span><span class=\"bp\">\\</span><span class=\"n\">curl.exe'</span> <span class=\"o\">(</span><span class=\"n\">C</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">WINDOWS</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"bp\">\\</span><span class=\"n\">curl</span><span class=\"bp\">\\</span><span class=\"n\">tools</span><span class=\"bp\">\\</span><span class=\"n\">curl</span><span class=\"bp\">-</span><span class=\"mi\">8</span><span class=\"bp\">.</span><span class=\"mi\">6</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"n\">_1</span><span class=\"bp\">-</span><span class=\"n\">win64</span><span class=\"bp\">-</span><span class=\"n\">mingw</span><span class=\"bp\">\\</span><span class=\"n\">bin</span><span class=\"bp\">\\</span><span class=\"n\">curl.exe</span><span class=\"o\">)</span><span class=\"bp\">.</span> <span class=\"n\">This</span> <span class=\"n\">usually</span> <span class=\"n\">indicates</span> <span class=\"n\">a</span> <span class=\"n\">missing</span> <span class=\"n\">or</span> <span class=\"n\">moved</span> <span class=\"n\">file.</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">external</span> <span class=\"n\">command</span> <span class=\"bp\">`</span><span class=\"n\">curl</span><span class=\"bp\">`</span> <span class=\"n\">exited</span> <span class=\"k\">with</span> <span class=\"n\">code</span> <span class=\"mi\">4294967295</span>\n</code></pre></div>\n<p>Something tells me it shouldn't be looking for <code>curl</code> there. Thank you for your help.</p>",
        "id": 429470735,
        "sender_full_name": "Arthur MM",
        "timestamp": 1711387173
    },
    {
        "content": "<p>It does use curl intentionally, yes</p>",
        "id": 429470968,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1711387229
    },
    {
        "content": "<p>I mean that it shouldn't be looking for it there. I already have curl installed on my system through cygwin (i think), for the record.</p>",
        "id": 429472098,
        "sender_full_name": "Arthur MM",
        "timestamp": 1711387539
    },
    {
        "content": "<p>As can be seen in the fourth line, the program being started is simply <code>curl</code> without a path, which by default should run Windows' own curl. It looks like your cygwin setup somehow breaks that.</p>",
        "id": 429514505,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1711402089
    },
    {
        "content": "<p>I've deleted cygwin's files, but I don't think it was to blame after all. The problem now is there there is no \"libs\" folder under C:/Windows, Windows's <code>curl</code> is located in System32. Besides, I'm not entirely sure how the standalone <code>curl</code> fails, considering typing <code>curl.exe</code> in powershell works just fine.</p>",
        "id": 429615900,
        "sender_full_name": "Arthur MM",
        "timestamp": 1711446145
    },
    {
        "content": "<p>The error message from above is unchanged? And you're running this in powershell as well?</p>",
        "id": 429650893,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1711458412
    },
    {
        "content": "<p>Yes, the error message is unchanged. I am running this through a Git bash (aka Git for Windows) terminal.</p>",
        "id": 429658093,
        "sender_full_name": "Arthur MM",
        "timestamp": 1711460679
    },
    {
        "content": "<p>Can you please try using powershell instead?</p>",
        "id": 429729911,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1711483239
    },
    {
        "content": "<p>Identical error after running in powershell:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">Downloading</span> <span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">toolchain</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"bp\">&gt;</span> <span class=\"n\">curl</span> <span class=\"bp\">-</span><span class=\"n\">s</span> <span class=\"bp\">-</span><span class=\"n\">f</span> <span class=\"bp\">-</span><span class=\"n\">o</span> <span class=\"n\">math_project</span><span class=\"bp\">\\</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">toolchain</span> <span class=\"bp\">-</span><span class=\"n\">L</span> <span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">raw.githubusercontent.com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"bp\">/</span><span class=\"n\">master</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">toolchain</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">stdout</span><span class=\"o\">:</span>\n<span class=\"n\">Cannot</span> <span class=\"n\">find</span> <span class=\"n\">file</span> <span class=\"n\">at</span> <span class=\"bp\">'..\\\\</span><span class=\"n\">lib</span><span class=\"bp\">\\</span><span class=\"n\">curl</span><span class=\"bp\">\\</span><span class=\"n\">tools</span><span class=\"bp\">\\</span><span class=\"n\">curl</span><span class=\"bp\">-</span><span class=\"mi\">8</span><span class=\"bp\">.</span><span class=\"mi\">6</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"n\">_1</span><span class=\"bp\">-</span><span class=\"n\">win64</span><span class=\"bp\">-</span><span class=\"n\">mingw</span><span class=\"bp\">\\</span><span class=\"n\">bin</span><span class=\"bp\">\\</span><span class=\"n\">curl.exe'</span> <span class=\"o\">(</span><span class=\"n\">C</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">WINDOWS</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"bp\">\\</span><span class=\"n\">curl</span><span class=\"bp\">\\</span><span class=\"n\">tools</span><span class=\"bp\">\\</span><span class=\"n\">curl</span><span class=\"bp\">-</span><span class=\"mi\">8</span><span class=\"bp\">.</span><span class=\"mi\">6</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"n\">_1</span><span class=\"bp\">-</span><span class=\"n\">win64</span><span class=\"bp\">-</span><span class=\"n\">mingw</span><span class=\"bp\">\\</span><span class=\"n\">bin</span><span class=\"bp\">\\</span><span class=\"n\">curl.exe</span><span class=\"o\">)</span><span class=\"bp\">.</span> <span class=\"n\">This</span> <span class=\"n\">usually</span> <span class=\"n\">indicates</span> <span class=\"n\">a</span> <span class=\"n\">missing</span> <span class=\"n\">or</span> <span class=\"n\">moved</span> <span class=\"n\">file.</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">external</span> <span class=\"n\">command</span> <span class=\"bp\">`</span><span class=\"n\">curl</span><span class=\"bp\">`</span> <span class=\"n\">exited</span> <span class=\"k\">with</span> <span class=\"n\">code</span> <span class=\"mi\">4294967295</span>\n</code></pre></div>",
        "id": 429732634,
        "sender_full_name": "Arthur MM",
        "timestamp": 1711484312
    },
    {
        "content": "<p>C:\\WINDOWS\\lib\\curl\\tools\\curl-8.6.0_1-win64-mingw likely is a path specific to your system, no? I don't know why it works directly in powershell but this path continues to confuse Lake</p>",
        "id": 429739704,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1711487030
    },
    {
        "content": "<p>Yeah, I wish I knew why it's looking there. For what it's worth, I have identified that the <code>curl</code> PowerShell finds first is actually the one from my <em>Chocolatey</em> install (why did I have both cygwin and choco? good question). Should I do anything about that?</p>",
        "id": 429740950,
        "sender_full_name": "Arthur MM",
        "timestamp": 1711487594
    },
    {
        "content": "<p>I don't know. Lake should use the first <code>curl</code> in <code>PATH</code>.</p>",
        "id": 429741345,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1711487768
    },
    {
        "content": "<p>It just gets weirder. Now running <code>curl.exe</code> inside PS gives the same error as above. I swear it didn't do that before.</p>\n<p>To make matters worse, both <code>where</code> and PS's equivalent point to an actual location in PATH.</p>\n<p>EDIT: console log:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">PS</span> <span class=\"n\">C</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Users</span><span class=\"bp\">\\</span><span class=\"n\">Arthur</span><span class=\"bp\">&gt;</span> <span class=\"n\">curl.exe</span>\n<span class=\"n\">Cannot</span> <span class=\"n\">find</span> <span class=\"n\">file</span> <span class=\"n\">at</span> <span class=\"bp\">'..\\\\</span><span class=\"n\">lib</span><span class=\"bp\">\\</span><span class=\"n\">curl</span><span class=\"bp\">\\</span><span class=\"n\">tools</span><span class=\"bp\">\\</span><span class=\"n\">curl</span><span class=\"bp\">-</span><span class=\"mi\">8</span><span class=\"bp\">.</span><span class=\"mi\">6</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"n\">_1</span><span class=\"bp\">-</span><span class=\"n\">win64</span><span class=\"bp\">-</span><span class=\"n\">mingw</span><span class=\"bp\">\\</span><span class=\"n\">bin</span><span class=\"bp\">\\</span><span class=\"n\">curl.exe'</span> <span class=\"o\">(</span><span class=\"n\">C</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">WINDOWS</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"bp\">\\</span><span class=\"n\">curl</span><span class=\"bp\">\\</span><span class=\"n\">tools</span><span class=\"bp\">\\</span><span class=\"n\">curl</span><span class=\"bp\">-</span><span class=\"mi\">8</span><span class=\"bp\">.</span><span class=\"mi\">6</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"n\">_1</span><span class=\"bp\">-</span><span class=\"n\">win64</span><span class=\"bp\">-</span><span class=\"n\">mingw</span><span class=\"bp\">\\</span><span class=\"n\">bin</span><span class=\"bp\">\\</span><span class=\"n\">curl.exe</span><span class=\"o\">)</span><span class=\"bp\">.</span> <span class=\"n\">This</span> <span class=\"n\">usually</span> <span class=\"n\">indicates</span> <span class=\"n\">a</span> <span class=\"n\">missing</span> <span class=\"n\">or</span> <span class=\"n\">moved</span> <span class=\"n\">file.</span>\n\n<span class=\"n\">PS</span> <span class=\"n\">C</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Users</span><span class=\"bp\">\\</span><span class=\"n\">Arthur</span><span class=\"bp\">&gt;</span> <span class=\"n\">where.exe</span> <span class=\"n\">curl</span>\n<span class=\"n\">C</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Windows</span><span class=\"bp\">\\</span><span class=\"n\">System32</span><span class=\"bp\">\\</span><span class=\"n\">curl.exe</span>\n</code></pre></div>",
        "id": 429741781,
        "sender_full_name": "Arthur MM",
        "timestamp": 1711488002
    },
    {
        "content": "<p>I think that indicates that this is \"not elan's fault\", and you need to do some reinstalling. :-)</p>",
        "id": 429764225,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1711501567
    },
    {
        "content": "<p>Much to my dismay, it seems likely you are right.</p>",
        "id": 429795363,
        "sender_full_name": "Arthur MM",
        "timestamp": 1711522714
    },
    {
        "content": "<p>Aha! I finally managed solve the issue after someone on SE recognized what this was — the cause is incredibly stupid. I had tried fixing another issue by replacing the curl executable within sys32... with a Chocolatey shim that tries running it from another location. Extremely extremely silly.</p>\n<p>Anyhow, now that this is fixed I get another error, progress!</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">PS</span> <span class=\"n\">D</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Lean</span><span class=\"bp\">&gt;</span> <span class=\"n\">lake</span> <span class=\"bp\">+</span><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">nightly</span><span class=\"bp\">-</span><span class=\"mi\">2023</span><span class=\"bp\">-</span><span class=\"mi\">02</span><span class=\"bp\">-</span><span class=\"mi\">04</span> <span class=\"n\">new</span> <span class=\"n\">math_project</span> <span class=\"n\">math</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">Downloading</span> <span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">toolchain</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"bp\">&gt;</span> <span class=\"n\">curl</span> <span class=\"bp\">-</span><span class=\"n\">s</span> <span class=\"bp\">-</span><span class=\"n\">f</span> <span class=\"bp\">-</span><span class=\"n\">o</span> <span class=\"n\">math_project</span><span class=\"bp\">\\</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">toolchain</span> <span class=\"bp\">-</span><span class=\"n\">L</span> <span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">raw.githubusercontent.com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"bp\">/</span><span class=\"n\">master</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">toolchain</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">external</span> <span class=\"n\">command</span> <span class=\"bp\">`</span><span class=\"n\">curl</span><span class=\"bp\">`</span> <span class=\"n\">exited</span> <span class=\"k\">with</span> <span class=\"n\">code</span> <span class=\"mi\">60</span>\n</code></pre></div>\n<p>Does this error code correspond to anything?</p>\n<p>Disabling my antivirus doesn't do anything so it doesn't appear to be that. Here is what the curl docs have to say about this error code:<br>\n<a href=\"/user_uploads/3121/NODoj2AYprhusNMdJkbvQIbg/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/NODoj2AYprhusNMdJkbvQIbg/image.png\" title=\"image.png\"><img src=\"/user_uploads/3121/NODoj2AYprhusNMdJkbvQIbg/image.png\"></a></div>",
        "id": 429829696,
        "sender_full_name": "Arthur MM",
        "timestamp": 1711536015
    },
    {
        "content": "<p>Can you run the same command from above with <code>-v</code> at the end? So:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">curl</span> <span class=\"bp\">-</span><span class=\"n\">s</span> <span class=\"bp\">-</span><span class=\"n\">f</span> <span class=\"bp\">-</span><span class=\"n\">o</span> <span class=\"n\">math_project</span><span class=\"bp\">\\</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">toolchain</span> <span class=\"bp\">-</span><span class=\"n\">L</span> <span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">raw.githubusercontent.com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"bp\">/</span><span class=\"n\">master</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">toolchain</span> <span class=\"bp\">-</span><span class=\"n\">v</span>\n</code></pre></div>\n<p>That should give us more information about what curl is trying to do.</p>",
        "id": 429830965,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1711536339
    },
    {
        "content": "<p>Here is the log:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">PS</span> <span class=\"n\">D</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Lean</span><span class=\"bp\">&gt;</span> <span class=\"n\">curl.exe</span> <span class=\"bp\">-</span><span class=\"n\">s</span> <span class=\"bp\">-</span><span class=\"n\">f</span> <span class=\"bp\">-</span><span class=\"n\">o</span> <span class=\"n\">math_project</span><span class=\"bp\">\\</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">toolchain</span> <span class=\"bp\">-</span><span class=\"n\">L</span> <span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">raw.githubusercontent.com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"bp\">/</span><span class=\"n\">master</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">toolchain</span> <span class=\"bp\">-</span><span class=\"n\">v</span>\n<span class=\"bp\">&gt;&gt;</span>\n<span class=\"bp\">*</span> <span class=\"n\">Host</span> <span class=\"n\">raw.githubusercontent.com</span><span class=\"o\">:</span><span class=\"mi\">443</span> <span class=\"n\">was</span> <span class=\"n\">resolved.</span>\n<span class=\"bp\">*</span> <span class=\"n\">IPv6</span><span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">none</span><span class=\"o\">)</span>\n<span class=\"bp\">*</span> <span class=\"n\">IPv4</span><span class=\"o\">:</span> <span class=\"mi\">185</span><span class=\"bp\">.</span><span class=\"mi\">199</span><span class=\"bp\">.</span><span class=\"mi\">111</span><span class=\"bp\">.</span><span class=\"mi\">133</span><span class=\"o\">,</span> <span class=\"mi\">185</span><span class=\"bp\">.</span><span class=\"mi\">199</span><span class=\"bp\">.</span><span class=\"mi\">110</span><span class=\"bp\">.</span><span class=\"mi\">133</span><span class=\"o\">,</span> <span class=\"mi\">185</span><span class=\"bp\">.</span><span class=\"mi\">199</span><span class=\"bp\">.</span><span class=\"mi\">109</span><span class=\"bp\">.</span><span class=\"mi\">133</span><span class=\"o\">,</span> <span class=\"mi\">185</span><span class=\"bp\">.</span><span class=\"mi\">199</span><span class=\"bp\">.</span><span class=\"mi\">108</span><span class=\"bp\">.</span><span class=\"mi\">133</span>\n<span class=\"bp\">*</span>   <span class=\"n\">Trying</span> <span class=\"mi\">185</span><span class=\"bp\">.</span><span class=\"mi\">199</span><span class=\"bp\">.</span><span class=\"mi\">111</span><span class=\"bp\">.</span><span class=\"mi\">133</span><span class=\"o\">:</span><span class=\"mi\">443</span><span class=\"bp\">...</span>\n<span class=\"bp\">*</span> <span class=\"n\">Connected</span> <span class=\"n\">to</span> <span class=\"n\">raw.githubusercontent.com</span> <span class=\"o\">(</span><span class=\"mi\">185</span><span class=\"bp\">.</span><span class=\"mi\">199</span><span class=\"bp\">.</span><span class=\"mi\">111</span><span class=\"bp\">.</span><span class=\"mi\">133</span><span class=\"o\">)</span> <span class=\"n\">port</span> <span class=\"mi\">443</span>\n<span class=\"bp\">*</span> <span class=\"n\">ALPN</span><span class=\"o\">:</span> <span class=\"n\">curl</span> <span class=\"n\">offers</span> <span class=\"n\">h2</span><span class=\"o\">,</span><span class=\"n\">http</span><span class=\"bp\">/</span><span class=\"mi\">1</span><span class=\"bp\">.</span><span class=\"mi\">1</span>\n<span class=\"bp\">*</span> <span class=\"n\">TLSv1.3</span> <span class=\"o\">(</span><span class=\"n\">OUT</span><span class=\"o\">),</span> <span class=\"n\">TLS</span> <span class=\"n\">handshake</span><span class=\"o\">,</span> <span class=\"n\">Client</span> <span class=\"n\">hello</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">):</span>\n<span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"mi\">324</span> <span class=\"n\">bytes</span> <span class=\"n\">data</span><span class=\"o\">]</span>\n<span class=\"bp\">*</span> <span class=\"n\">TLSv1.3</span> <span class=\"o\">(</span><span class=\"n\">IN</span><span class=\"o\">),</span> <span class=\"n\">TLS</span> <span class=\"n\">handshake</span><span class=\"o\">,</span> <span class=\"n\">Server</span> <span class=\"n\">hello</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">):</span>\n<span class=\"o\">{</span> <span class=\"o\">[</span><span class=\"mi\">122</span> <span class=\"n\">bytes</span> <span class=\"n\">data</span><span class=\"o\">]</span>\n<span class=\"bp\">*</span> <span class=\"n\">TLSv1.3</span> <span class=\"o\">(</span><span class=\"n\">IN</span><span class=\"o\">),</span> <span class=\"n\">TLS</span> <span class=\"n\">handshake</span><span class=\"o\">,</span> <span class=\"n\">Unknown</span> <span class=\"o\">(</span><span class=\"mi\">8</span><span class=\"o\">):</span>\n<span class=\"o\">{</span> <span class=\"o\">[</span><span class=\"mi\">19</span> <span class=\"n\">bytes</span> <span class=\"n\">data</span><span class=\"o\">]</span>\n<span class=\"bp\">*</span> <span class=\"n\">TLSv1.3</span> <span class=\"o\">(</span><span class=\"n\">IN</span><span class=\"o\">),</span> <span class=\"n\">TLS</span> <span class=\"n\">handshake</span><span class=\"o\">,</span> <span class=\"n\">Certificate</span> <span class=\"o\">(</span><span class=\"mi\">11</span><span class=\"o\">):</span>\n<span class=\"o\">{</span> <span class=\"o\">[</span><span class=\"mi\">3099</span> <span class=\"n\">bytes</span> <span class=\"n\">data</span><span class=\"o\">]</span>\n<span class=\"bp\">*</span> <span class=\"n\">SSL</span> <span class=\"n\">certificate</span> <span class=\"n\">problem</span><span class=\"o\">:</span> <span class=\"n\">unable</span> <span class=\"n\">to</span> <span class=\"n\">get</span> <span class=\"kn\">local</span> <span class=\"n\">issuer</span> <span class=\"n\">certificate</span>\n<span class=\"bp\">*</span> <span class=\"n\">Closing</span> <span class=\"n\">connection</span>\n</code></pre></div>",
        "id": 429831139,
        "sender_full_name": "Arthur MM",
        "timestamp": 1711536388
    },
    {
        "content": "<p>Okay that's very interesting. What's going on here is that Github presents you with a certificate, then Windows attempts to verify that the certificate is okay and it doesn't find the crypto material that it needs for this on your machine. Since everyone else can visit this URL this is likely an issue with your setup.</p>\n<p>What Windows version are you running on? And since I don't use Windows: can you run</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">openssl</span> <span class=\"n\">version</span>\n</code></pre></div>\n<p>and see if this prints anything? If this errors this doesn't mean your setup is broken but <code>openssl</code> is the only tool that I know of to debug issues like this in the Linux world.</p>",
        "id": 429832340,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1711536808
    },
    {
        "content": "<p>I'm running on windows 10. <code>openssl</code> isn't available in cmd/powershell, I'm not sure what the equivalent is.</p>",
        "id": 429832541,
        "sender_full_name": "Arthur MM",
        "timestamp": 1711536873
    },
    {
        "content": "<p>What is your antivirus? I know you said you already disabled it, but I'm curious.</p>",
        "id": 429833578,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1711537255
    },
    {
        "content": "<p>I run the free version of Kasperky.</p>",
        "id": 429833620,
        "sender_full_name": "Arthur MM",
        "timestamp": 1711537275
    },
    {
        "content": "<p>And if you open <a href=\"https://raw.githubusercontent.com/leanprover-community/mathlib4/master/lean-toolchain\">https://raw.githubusercontent.com/leanprover-community/mathlib4/master/lean-toolchain</a> on your browser and look at the certificates, is Kaspersky mentioned anywhere? On Firefox, you do that by clicking the padlock next to the address bar, then \"Connection secure\", then \"More information\", then \"View certificate\"</p>",
        "id": 429834731,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1711537661
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/QihC7qpjF0eiQVCXzsKfvKIZ/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/QihC7qpjF0eiQVCXzsKfvKIZ/image.png\" title=\"image.png\"><img src=\"/user_uploads/3121/QihC7qpjF0eiQVCXzsKfvKIZ/image.png\"></a></div><p>Yes it is. The French here basically says that Firefox doesn't recognize who authored the certificate (in this case Kaspersky).</p>",
        "id": 429835006,
        "sender_full_name": "Arthur MM",
        "timestamp": 1711537801
    },
    {
        "content": "<p>If you haven't done it already, try <a href=\"https://support.kaspersky.com/KESWin/11.6.0/en-US/175124.htm\">https://support.kaspersky.com/KESWin/11.6.0/en-US/175124.htm</a> as well. Maybe the file scanning and the encrypted connection scanning are disabled separately.</p>",
        "id": 429835364,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1711537976
    },
    {
        "content": "<p>Did that and globally disabled Kaspersky again, issue persists.</p>",
        "id": 429835811,
        "sender_full_name": "Arthur MM",
        "timestamp": 1711538169
    },
    {
        "content": "<p>Maybe curl on windows requires a <code>cacert.pem</code> file instead of using the system's store? It could be missing, but I'm just guessing here.</p>",
        "id": 429836115,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1711538290
    },
    {
        "content": "<p>Yes, that did it! I added a (renamed) cacert.pem file (as explained <a href=\"https://superuser.com/questions/442793/why-cant-curl-properly-verify-a-certificate-on-windows\">here</a>) in the sys32 folder and now the curl call works perfectly!</p>",
        "id": 429837373,
        "sender_full_name": "Arthur MM",
        "timestamp": 1711538828
    },
    {
        "content": "<p>For the sake of completeness, I'll note that there was one more issue to troubleshoot. Git hadn't gotten the memo about the new certificate file, so I had to manually change the <code>http.sslcainfo</code> config option to point towards the correct file. Once that was done, there were no more problems and now lean is running perfectly.</p>\n<p>Thanks to everybody for their help.</p>",
        "id": 429875429,
        "sender_full_name": "Arthur MM",
        "timestamp": 1711550387
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"704253\">Arthur MM</span> has marked this topic as resolved.</p>",
        "id": 429875439,
        "sender_full_name": "Notification Bot",
        "timestamp": 1711550392
    }
]