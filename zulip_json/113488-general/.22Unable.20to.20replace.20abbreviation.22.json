[
    {
        "content": "<p>Every so often, I get an error saying that the Lean extension is \"unable to replace an abbreviation\" for some reason or another. Now, this is annoying, but sadly not that reproducible, so probably hard to diagnose. However, it does pop up a little console every time it does that, and that is _really_ annoying, as I have to stop the flow of typing what I was currently typing, move my mouse to the corner, find the correct line again, and click it - is there any way to make it so that it just fails silently (if the underlying issue can't be fixed)?</p>",
        "id": 411715240,
        "sender_full_name": "Eric Rodriguez",
        "timestamp": 1704711265
    },
    {
        "content": "<p>I think the underling issue is a resource one; too much CPU is being spent on the lean server and so the abbreviation replacer doesn't get to run soon enough; and when it does run, the document has changed too much for it to work out what it is supposed to do</p>",
        "id": 411715526,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1704711383
    },
    {
        "content": "<p>It could say it failed as a VSCode popup rather than opening a console.</p>",
        "id": 411715818,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1704711503
    },
    {
        "content": "<p>That sounds  more annoying, dismissing n popups is worse than 1 panel.</p>",
        "id": 411716522,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1704711758
    },
    {
        "content": "<p>... except that they don't change the focus</p>",
        "id": 411716609,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1704711791
    },
    {
        "content": "<p>For clarity, I mean <a href=\"/user_uploads/3121/uUPnuh0f5CUrLkipjLcQOUcc/image.png\">these popups</a>.</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/uUPnuh0f5CUrLkipjLcQOUcc/image.png\" title=\"these popups\"><img src=\"/user_uploads/3121/uUPnuh0f5CUrLkipjLcQOUcc/image.png\"></a></div>",
        "id": 411716673,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1704711819
    },
    {
        "content": "<p>I've not noticed the focus-stealing behavior before... I'll pay more attention next time</p>",
        "id": 411718542,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1704712574
    },
    {
        "content": "<p>Maybe it only steals the focus if the console wasn't already open? I usually keep it open to have a shell available for git, and maybe that's enough to make me immune</p>",
        "id": 411718624,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1704712623
    },
    {
        "content": "<p>I tend to do my terminal stuff in another window, so maybe that would make sense?</p>",
        "id": 411719455,
        "sender_full_name": "Eric Rodriguez",
        "timestamp": 1704713015
    },
    {
        "content": "<p>I recently discovered that this problem is <em>much</em> more frequent if you're in an ssh remote VSCode session, with bad ping.</p>\n<p>If anyone would trade an temporary ssh account on a machine in australia for a fix... :-)</p>",
        "id": 411729055,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1704716935
    },
    {
        "content": "<p>Maybe this can be reproduced by unplugging an ethernet cable, typing, then plugging it back in?</p>",
        "id": 411729445,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1704717076
    },
    {
        "content": "<p>Related issue: <a href=\"https://github.com/leanprover-community/vscode-lean4/pull/373\">vscode-lean4#373</a><br>\nI agree that displaying a timed progress notification is a better way to display these kinds of low-information errors that users cannot really act upon and that occur mostly concurrently without preventing progress.</p>",
        "id": 411760479,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1704727560
    },
    {
        "content": "<p>I'm surprised this is done via lsp, I would've assumed this is a fully local transformation.</p>",
        "id": 411779147,
        "sender_full_name": "Eric Rodriguez",
        "timestamp": 1704733523
    },
    {
        "content": "<p>For me, even worse than the \"unable to replace abbreviation\" (which I get a lot, because my computer is often doing some other compiling or similar while I'm typing) is the fact that the abbreviation can end up putting my cursor in the wrong position when lag is high, meaning that my characters end up out of order</p>",
        "id": 411874790,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1704782719
    },
    {
        "content": "<p>oh, this is <a href=\"https://github.com/leanprover-community/vscode-lean4/pull/332\">vscode-lean4#332</a></p>",
        "id": 411874932,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1704782811
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"284160\">Eric Rodriguez</span> <a href=\"#narrow/stream/113488-general/topic/.22Unable.20to.20replace.20abbreviation.22/near/411779147\">said</a>:</p>\n<blockquote>\n<p>I'm surprised this is done via lsp, I would've assumed this is a fully local transformation.</p>\n</blockquote>\n<p>It's not done via LSP.</p>",
        "id": 411877912,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1704784651
    },
    {
        "content": "<p>Then why does it need to communicate?</p>",
        "id": 411893733,
        "sender_full_name": "Eric Rodriguez",
        "timestamp": 1704792174
    },
    {
        "content": "<p>In general, it doesn't. Scott is likely connecting to a remote VS Code session where the extension is installed on the server. The extension does not communicate with the language server to complete abbreviations.</p>",
        "id": 411896209,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1704793087
    },
    {
        "content": "<p>I have released a mitigation for both the \"Unable to replace abbreviation\" error (<a href=\"https://github.com/leanprover-community/vscode-lean4/pull/373\">vscode-lean4#373</a>) and the cursor misplacement issue (<a href=\"https://github.com/leanprover-community/vscode-lean4/pull/332\">vscode-lean4#332</a>) as part of 0.0.125. The details are at <a href=\"https://github.com/leanprover-community/vscode-lean4/pull/389\">vscode-lean4#389</a>.</p>\n<p>Please let me know if you still encounter frequent issues with the abbreviation mechanism on 0.0.125.</p>",
        "id": 417593242,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1706084114
    }
]