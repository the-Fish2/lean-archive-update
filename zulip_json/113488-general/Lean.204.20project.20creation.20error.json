[
    {
        "content": "<p>If I follow these instructions to create a new Lean 4 project with mathlib4:</p>\n<p><a href=\"https://leanprover-community.github.io/install/project.html\">https://leanprover-community.github.io/install/project.html</a></p>\n<p>I get errors when executing \"lake update\". What's strange is that tar seems to mix slashes and backslashes for directory separation in the extract command but I'm not sure if this is the root of the problem and if it is how to fix it. If I check, the \"build\" directory tar claims does not exist, does indeed exist but tar doesn't seem to see it. Here is the log:</p>\n<p>$ lake update<br>\nwarning: Qq: ignoring missing dependency manifest '.\\.lake\\packages\\Qq\\lake-manifest.json'<br>\nwarning: Cli: ignoring missing dependency manifest '.\\.lake\\packages\\Cli\\lake-manifest.json'<br>\nmy_project: no previous manifest, creating one from scratch<br>\nmathlib: cloning <a href=\"https://github.com/leanprover-community/mathlib4.git\">https://github.com/leanprover-community/mathlib4.git</a> to '.\\.lake\\packages\\mathlib'<br>\nstd: cloning <a href=\"https://github.com/leanprover/std4\">https://github.com/leanprover/std4</a> to '.\\.lake\\packages\\std'<br>\nQq: cloning <a href=\"https://github.com/leanprover-community/quote4\">https://github.com/leanprover-community/quote4</a> to '.\\.lake\\packages\\Qq'<br>\naesop: cloning <a href=\"https://github.com/leanprover-community/aesop\">https://github.com/leanprover-community/aesop</a> to '.\\.lake\\packages\\aesop'<br>\nproofwidgets: cloning <a href=\"https://github.com/leanprover-community/ProofWidgets4\">https://github.com/leanprover-community/ProofWidgets4</a> to '.\\.lake\\packages\\proofwidgets'<br>\nCli: cloning <a href=\"https://github.com/leanprover/lean4-cli\">https://github.com/leanprover/lean4-cli</a> to '.\\.lake\\packages\\Cli'<br>\nimportGraph: cloning <a href=\"https://github.com/leanprover-community/import-graph.git\">https://github.com/leanprover-community/import-graph.git</a> to '.\\.lake\\packages\\importGraph'<br>\nmathlib: running post-update hooks<br>\ninfo: [0/9] Downloading proofwidgets cloud release<br>\ninfo: [0/9] Unpacking proofwidgets cloud release<br>\nerror: &gt; tar -xz -f .\\.lake/packages\\proofwidgets\\.lake\\ProofWidgets4.tar.gz -C .\\.lake/packages\\proofwidgets\\.lake\\build<br>\nerror: stderr:<br>\ntar: .lake/packages\\\\proofwidgets\\\\.lake\\build: Cannot open: No such file or directory<br>\ntar: Error is not recoverable: exiting now<br>\nerror: external command <code>tar</code> exited with code 2<br>\ninfo: [1/9] Building Cache.IO<br>\ninfo: [2/9] Compiling Cache.IO<br>\ninfo: [2/9] Building Cache.Hashing<br>\ninfo: [3/9] Compiling Cache.Hashing<br>\ninfo: [3/9] Building Cache.Requests<br>\ninfo: [5/9] Compiling Cache.Requests<br>\ninfo: [5/9] Building Cache.Main<br>\ninfo: [7/9] Compiling Cache.Main<br>\ninfo: [9/9] Linking cache.exe<br>\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br>\n                                 Dload  Upload   Total   Spent    Left  Speed<br>\n  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0<br>\n100  669k  100  669k    0     0   521k      0  0:00:01  0:00:01 --:--:-- 7295k</p>\n<p>installing leantar 0.1.11<br>\nuncaught exception: failure in tar #[-xf, C:\\Users\\Mario\\.cache\\mathlib\\leantar-0.1.11.exe.zip, -C, C:\\Users\\Mario\\.cache\\mathlib, --strip-components=1]:<br>\ntar: Cannot connect to C: resolve failed</p>\n<p>error: mathlib: failed to fetch cache</p>",
        "id": 420877955,
        "sender_full_name": "Mario Weitzer",
        "timestamp": 1707646294
    },
    {
        "content": "<p>Update:<br>\nWhen I try to execute the command \"tar -xz -f .\\.lake/packages\\proofwidgets\\.lake\\ProofWidgets4.tar.gz -C .\\.lake/packages\\proofwidgets\\.lake\\build\" from the log I get this error:</p>\n<p>$  tar -xz -f .\\.lake/packages\\proofwidgets\\.lake\\ProofWidgets4.tar.gz -C .\\.lake/packages\\proofwidgets\\.lake\\build<br>\ntar (child): ..lake/packagesproofwidgets.lakeProofWidgets4.tar.gz: Cannot open: No such file or directory<br>\ntar (child): Error is not recoverable: exiting now<br>\ntar: Child returned status 2<br>\ntar: Error is not recoverable: exiting now</p>\n<p>but when I change it to \"tar -xz -f ./.lake/packages/proofwidgets/.lake/ProofWidgets4.tar.gz -C ./.lake/packages/proofwidgets/.lake/build\" (i.e. change all backslashes to slashes) it works fine, so the problem indeed does seem to be with the mix of slashes and backslashes. But how can I make \"lake update\" use the correct command?</p>",
        "id": 420880521,
        "sender_full_name": "Mario Weitzer",
        "timestamp": 1707648734
    },
    {
        "content": "<p>are you on WSL?</p>",
        "id": 420881492,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1707649681
    },
    {
        "content": "<p>No, I don't use WSL. I exactly followed the instruction on this page</p>\n<p><a href=\"https://leanprover-community.github.io/install/windows.html\">https://leanprover-community.github.io/install/windows.html</a></p>\n<p>and executed the commands from this page</p>\n<p><a href=\"https://leanprover-community.github.io/install/project.html\">https://leanprover-community.github.io/install/project.html</a></p>\n<p>in git bash. I worked on Lean 3 for some time and wanted to transition to Lean 4. About half a year ago I was able to create a new Lean 4 project following the instructions of the above page but now it doesn't work anymore.</p>\n<p>Edit: Also, my old Lean 4 project (which I never did anything with) still works, just the creation of a new one using lake fails now.</p>",
        "id": 420882264,
        "sender_full_name": "Mario Weitzer",
        "timestamp": 1707650420
    },
    {
        "content": "<p>See whether it works in powershell and/or cmd.exe? I'm not on windows so I'm not sure what the usual thing is here. Perhaps someone else on windows can chime in</p>",
        "id": 420882427,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1707650609
    },
    {
        "content": "<p>The error messages are consistent with the commands being run on some linux emulation layer, which is confusing the tools which are expecting windows behavior because the host OS is windows</p>",
        "id": 420882513,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1707650666
    },
    {
        "content": "<p>cc: <span class=\"user-mention\" data-user-id=\"315577\">@Mac Malone</span></p>",
        "id": 420882553,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1707650745
    },
    {
        "content": "<p>I hacked the thing by renaming \"tar.exe\" to \"tar1.exe\" and writing a program called \"tar.exe\" which changes '\\' to '/' in the arguments it's called with and then passes on the command to tar1.exe. It works now, but the error at the end still remains:</p>\n<p>installing leantar 0.1.11<br>\nuncaught exception: failure in tar #[-xf, C:\\Users\\Mario\\.cache\\mathlib\\leantar-0.1.11.exe.zip, -C, C:\\Users\\Mario\\.cache\\mathlib, --strip-components=1]:<br>\ntar1: Cannot connect to C: resolve failed</p>",
        "id": 420886099,
        "sender_full_name": "Mario Weitzer",
        "timestamp": 1707654203
    },
    {
        "content": "<p>What does <code>echo $HOME</code> say?</p>",
        "id": 420886703,
        "sender_full_name": "Richard Copley",
        "timestamp": 1707654824
    },
    {
        "content": "<p>/c/Users/Mario</p>",
        "id": 420886753,
        "sender_full_name": "Mario Weitzer",
        "timestamp": 1707654852
    },
    {
        "content": "<p>That's not the problem then. You don't need to write your own version of <code>tar</code>. Everything should just work. The functionality for path conversion is hacked into all the MSYS applications indvidually.</p>\n<p><code>which tar</code> in MSYS or Git Bash should say <code>/usr/bin/tar</code>; does it?</p>",
        "id": 420886888,
        "sender_full_name": "Richard Copley",
        "timestamp": 1707655025
    },
    {
        "content": "<p>Yes, it does. But if that's true, why does it work with my own version of tar but not with the original one?</p>",
        "id": 420886983,
        "sender_full_name": "Mario Weitzer",
        "timestamp": 1707655128
    },
    {
        "content": "<p>That's the question indeed <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span> It works just fine for me.</p>",
        "id": 420887015,
        "sender_full_name": "Richard Copley",
        "timestamp": 1707655176
    },
    {
        "content": "<p>The instructions there are a bit baroque. Can you try this (in Git Bash)?</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>lake<span class=\"w\"> </span>new<span class=\"w\"> </span>testproject<span class=\"w\"> </span>math\n<span class=\"nb\">cd</span><span class=\"w\"> </span>testproject\nlake<span class=\"w\"> </span>update\n</code></pre></div>",
        "id": 420887214,
        "sender_full_name": "Richard Copley",
        "timestamp": 1707655385
    },
    {
        "content": "<p>Same problems.<br>\nI tried to modify my version of tar to also change \"C:\" to \"/C\" to solve the second problem but so far without success.</p>",
        "id": 420887613,
        "sender_full_name": "Mario Weitzer",
        "timestamp": 1707655815
    },
    {
        "content": "<p><code>env | grep MSYS</code> ?</p>",
        "id": 420888100,
        "sender_full_name": "Richard Copley",
        "timestamp": 1707656344
    },
    {
        "content": "<p>$ env | grep MSYS<br>\nMSYSTEM=MINGW64<br>\nMSYSTEM_CARCH=x86_64<br>\nMSYSTEM_CHOST=x86_64-w64-mingw32<br>\nPS1=\\[\\033]0;$TITLEPREFIX:$PWD\\007\\]\\n\\[\\033[32m\\]\\u@\\h \\[\\033[35m\\]$MSYSTEM \\[\\033[33m\\]\\w\\[\\033[36m\\]<code>__git_ps1</code>\\[\\033[0m\\]\\n$<br>\nMSYSTEM_PREFIX=/mingw64<br>\nMSYS=disable_pcon</p>",
        "id": 420888287,
        "sender_full_name": "Mario Weitzer",
        "timestamp": 1707656482
    },
    {
        "content": "<p>All good</p>",
        "id": 420888308,
        "sender_full_name": "Richard Copley",
        "timestamp": 1707656509
    },
    {
        "content": "<p>(<code>disable_pcon</code>: that's \"pseudoconsole\", not \"path conversion\")</p>",
        "id": 420888374,
        "sender_full_name": "Richard Copley",
        "timestamp": 1707656543
    },
    {
        "content": "<p>Want to try one more time?</p>\n<ul>\n<li>Restore <code>c:\\Program Files\\Git\\usr\\bin\\tar.exe</code> to the original</li>\n<li>Delete the <code>testproject</code> folder created earlier if necessary</li>\n</ul>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code><span class=\"nb\">export</span><span class=\"w\"> </span><span class=\"nv\">PATH</span><span class=\"o\">=</span>/mingw64/bin:/usr/local/bin:/usr/bin:/bin:/mingw64/bin:<span class=\"si\">${</span><span class=\"nv\">HOME</span><span class=\"si\">}</span>/.elan/bin\nlake<span class=\"w\"> </span>new<span class=\"w\"> </span>testproject<span class=\"w\"> </span>math\n<span class=\"nb\">cd</span><span class=\"w\"> </span>testproject\ncurl<span class=\"w\"> </span>-L<span class=\"w\"> </span>-O<span class=\"w\"> </span>https://raw.githubusercontent.com/leanprover-community/mathlib4/master/lean-toolchain\nlake<span class=\"w\"> </span>update\n</code></pre></div>",
        "id": 420888931,
        "sender_full_name": "Richard Copley",
        "timestamp": 1707657124
    },
    {
        "content": "<p>Same problems:</p>\n<p>info: [0/9] Unpacking proofwidgets cloud release<br>\nerror: &gt; tar -xz -f .\\.lake/packages\\proofwidgets\\.lake\\ProofWidgets4.tar.gz -C .\\.lake/packages\\proofwidgets\\.lake\\build<br>\nerror: stderr:<br>\ntar: .lake/packages\\\\proofwidgets\\\\.lake\\build: Cannot open: No such file or directory<br>\ntar: Error is not recoverable: exiting now<br>\nerror: external command <code>tar</code> exited with code 2</p>\n<p>and</p>\n<p>installing leantar 0.1.11<br>\nuncaught exception: failure in tar #[-xf, C:\\Users\\Mario\\.cache\\mathlib\\leantar-0.1.11.exe.zip, -C, C:\\Users\\Mario\\.cache\\mathlib, --strip-components=1]:<br>\ntar: Cannot connect to C: resolve failed</p>\n<p>error: mathlib: failed to fetch cache</p>",
        "id": 420889411,
        "sender_full_name": "Mario Weitzer",
        "timestamp": 1707657659
    },
    {
        "content": "<p>Interestingly, when I have my version of tar change \"C:\" to \"/C\" I get a different error message:</p>\n<p>tar1: This does not look like a tar archive<br>\ntar1: Skipping to next header<br>\ntar1: Exiting with failure status due to previous errors</p>\n<p>And it's correct, \"leantar-0.1.11.exe\" is a \".zip\" file, not a \".tar\" file.</p>",
        "id": 420889777,
        "sender_full_name": "Mario Weitzer",
        "timestamp": 1707658072
    },
    {
        "content": "<p>Have a look at the source code for <code>validateLeanTar</code> in <code>mathlib\\Cache\\IO.lean</code> (around where it prints the \"installing leantar\" message\") and see if anything jumps out at you</p>",
        "id": 420890117,
        "sender_full_name": "Richard Copley",
        "timestamp": 1707658441
    },
    {
        "content": "<p>(note <code>System.Platform.getIsWindows</code> just returns the constant 1, in a version of Lean that was compiled for Windows)</p>",
        "id": 420890181,
        "sender_full_name": "Richard Copley",
        "timestamp": 1707658490
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">$</span> <span class=\"n\">md5sum</span> <span class=\"bp\">$</span><span class=\"o\">{</span><span class=\"n\">HOME</span><span class=\"o\">}</span><span class=\"bp\">/.</span><span class=\"n\">cache</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/</span><span class=\"n\">leantar</span><span class=\"bp\">-</span><span class=\"mi\">0</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"bp\">.</span><span class=\"mi\">11</span><span class=\"bp\">.</span><span class=\"n\">exe</span><span class=\"o\">{,</span><span class=\"bp\">.</span><span class=\"n\">zip</span><span class=\"o\">}</span>\n<span class=\"n\">b7208cc6bde3e89da98808b3547da64d</span> <span class=\"bp\">*/</span><span class=\"n\">c</span><span class=\"bp\">/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">buster</span><span class=\"bp\">/.</span><span class=\"n\">cache</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/</span><span class=\"n\">leantar</span><span class=\"bp\">-</span><span class=\"mi\">0</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"bp\">.</span><span class=\"mi\">11</span><span class=\"bp\">.</span><span class=\"n\">exe</span>\n<span class=\"n\">da116448572ba930ee176e7dfbfef14e</span> <span class=\"bp\">*/</span><span class=\"n\">c</span><span class=\"bp\">/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">buster</span><span class=\"bp\">/.</span><span class=\"n\">cache</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/</span><span class=\"n\">leantar</span><span class=\"bp\">-</span><span class=\"mi\">0</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"bp\">.</span><span class=\"mi\">11</span><span class=\"bp\">.</span><span class=\"n\">exe.zip</span>\n</code></pre></div>\n<p>?</p>",
        "id": 420890640,
        "sender_full_name": "Richard Copley",
        "timestamp": 1707658961
    },
    {
        "content": "<p>$ md5sum ${HOME}/.cache/mathlib/leantar-0.1.11.exe{,.zip}<br>\nmd5sum: /c/Users/Mario/.cache/mathlib/leantar-0.1.11.exe: No such file or directory<br>\nda116448572ba930ee176e7dfbfef14e */c/Users/Mario/.cache/mathlib/leantar-0.1.11.exe.zip</p>\n<p>And if I manually extract leantar.exe</p>\n<p>$ md5sum ${HOME}/.cache/mathlib/leantar.exe<br>\nb7208cc6bde3e89da98808b3547da64d */c/Users/Mario/.cache/mathlib/leantar.exe</p>\n<p>I don't get how the tar command is supposed to work anyway. I can't make it extract the .exe file from the .zip archive. I had to use 7-zip.</p>",
        "id": 420890948,
        "sender_full_name": "Mario Weitzer",
        "timestamp": 1707659298
    },
    {
        "content": "<p>No, I don't get that either.<br>\nUnpack it to the expected filename <code>leantar-0.1.11.exe</code> and try again?</p>",
        "id": 420891063,
        "sender_full_name": "Richard Copley",
        "timestamp": 1707659414
    },
    {
        "content": "<p>$ md5sum ${HOME}/.cache/mathlib/leantar-0.1.11.exe{,.zip}<br>\nb7208cc6bde3e89da98808b3547da64d */c/Users/Mario/.cache/mathlib/leantar-0.1.11.exe<br>\nda116448572ba930ee176e7dfbfef14e */c/Users/Mario/.cache/mathlib/leantar-0.1.11.exe.zip</p>",
        "id": 420891115,
        "sender_full_name": "Mario Weitzer",
        "timestamp": 1707659475
    },
    {
        "content": "<p>sorry, try creating a project again (<code>validateLeanTar</code> starts by checking if leantar already exists at the expected location, and if so, does not try to untar it)</p>",
        "id": 420891186,
        "sender_full_name": "Richard Copley",
        "timestamp": 1707659527
    },
    {
        "content": "<p>Ah, I see. Yes, that worked, at least with my version of tar. Thank you very much! :)<br>\nBut I guess that's not how this is supposed to work...</p>",
        "id": 420891829,
        "sender_full_name": "Mario Weitzer",
        "timestamp": 1707659858
    },
    {
        "content": "<p>I'm happy it's working, but I'm sad we didn't work out why it was going wrong.</p>",
        "id": 420892763,
        "sender_full_name": "Richard Copley",
        "timestamp": 1707660643
    },
    {
        "content": "<p>Which versions of tar extract zip files? Is it the case that Windows comes with its own version of <code>tar</code> which can extract zip files, while the default <code>tar</code> in either Git Bash or MSYS doesn't?</p>",
        "id": 420894194,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1707661992
    },
    {
        "content": "<ul>\n<li>Apparently bsdtar and not GNU tar</li>\n<li>Apparently yes</li>\n</ul>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$<span class=\"w\"> </span>rm<span class=\"w\"> </span>-rf<span class=\"w\"> </span>leantar-v0.1.11-x86_64-pc-windows-msvc/\n$<span class=\"w\"> </span>/c/Windows/System32/tar.exe<span class=\"w\"> </span>-xf<span class=\"w\"> </span>leantar-0.1.11.exe.zip\n$<span class=\"w\"> </span>ls<span class=\"w\"> </span>-d<span class=\"w\"> </span>leantar-v0.1.11-x86_64-pc-windows-msvc\nleantar-v0.1.11-x86_64-pc-windows-msvc/\n\n$<span class=\"w\"> </span>/c/Windows/System32/tar.exe<span class=\"w\"> </span>--version\nbsdtar<span class=\"w\"> </span><span class=\"m\">3</span>.5.2<span class=\"w\"> </span>-<span class=\"w\"> </span>libarchive<span class=\"w\"> </span><span class=\"m\">3</span>.5.2<span class=\"w\"> </span>zlib/1.2.5.f-ipp\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$<span class=\"w\"> </span>rm<span class=\"w\"> </span>-rf<span class=\"w\"> </span>leantar-v0.1.11-x86_64-pc-windows-msvc/\n$<span class=\"w\"> </span>tar<span class=\"w\"> </span>-xf<span class=\"w\"> </span>leantar-0.1.11.exe.zip\ntar:<span class=\"w\"> </span>This<span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>look<span class=\"w\"> </span>like<span class=\"w\"> </span>a<span class=\"w\"> </span>tar<span class=\"w\"> </span>archive\ntar:<span class=\"w\"> </span>Skipping<span class=\"w\"> </span>to<span class=\"w\"> </span>next<span class=\"w\"> </span>header\ntar:<span class=\"w\"> </span>Exiting<span class=\"w\"> </span>with<span class=\"w\"> </span>failure<span class=\"w\"> </span>status<span class=\"w\"> </span>due<span class=\"w\"> </span>to<span class=\"w\"> </span>previous<span class=\"w\"> </span>errors\n\n$<span class=\"w\"> </span>tar<span class=\"w\"> </span>--version\ntar<span class=\"w\"> </span><span class=\"o\">(</span>GNU<span class=\"w\"> </span>tar<span class=\"o\">)</span><span class=\"w\"> </span><span class=\"m\">1</span>.35\nCopyright<span class=\"w\"> </span><span class=\"o\">(</span>C<span class=\"o\">)</span><span class=\"w\"> </span><span class=\"m\">2023</span><span class=\"w\"> </span>Free<span class=\"w\"> </span>Software<span class=\"w\"> </span>Foundation,<span class=\"w\"> </span>Inc.\nLicense<span class=\"w\"> </span>GPLv3+:<span class=\"w\"> </span>GNU<span class=\"w\"> </span>GPL<span class=\"w\"> </span>version<span class=\"w\"> </span><span class=\"m\">3</span><span class=\"w\"> </span>or<span class=\"w\"> </span>later<span class=\"w\"> </span>&lt;https://gnu.org/licenses/gpl.html&gt;.\nThis<span class=\"w\"> </span>is<span class=\"w\"> </span>free<span class=\"w\"> </span>software:<span class=\"w\"> </span>you<span class=\"w\"> </span>are<span class=\"w\"> </span>free<span class=\"w\"> </span>to<span class=\"w\"> </span>change<span class=\"w\"> </span>and<span class=\"w\"> </span>redistribute<span class=\"w\"> </span>it.\nThere<span class=\"w\"> </span>is<span class=\"w\"> </span>NO<span class=\"w\"> </span>WARRANTY,<span class=\"w\"> </span>to<span class=\"w\"> </span>the<span class=\"w\"> </span>extent<span class=\"w\"> </span>permitted<span class=\"w\"> </span>by<span class=\"w\"> </span>law.\n\nWritten<span class=\"w\"> </span>by<span class=\"w\"> </span>John<span class=\"w\"> </span>Gilmore<span class=\"w\"> </span>and<span class=\"w\"> </span>Jay<span class=\"w\"> </span>Fenlason.\n</code></pre></div>",
        "id": 420894686,
        "sender_full_name": "Richard Copley",
        "timestamp": 1707662408
    },
    {
        "content": "<p>It seems the easiest solution would be to reorder PATH, or not to use an MSYS-based shell for interacting with Lake (the Lean extension can already be used for that to some degree)</p>",
        "id": 420895539,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1707663240
    },
    {
        "content": "<p><code>validateLeanTar</code> calls <code>runCmd</code> which calls <code>IO.Process.output</code> which uses <code>IO.Process.spawn</code> which is implemented by <code>lean_io_process_spawn</code> which calls <code>spawn</code> (in <code>/src/runtime/process.cpp</code>) which is a wrapper around <a href=\"https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa\">CreateProcess</a> which has its own ideas about how to find executables and \"C:\\Windows\\System32\\tar.exe\" takes precedence over what is on the PATH environment variable.</p>\n<p><span class=\"user-mention\" data-user-id=\"595391\">@Mario Weitzer</span>, what's your Windows version? What do you get for <code>/c/Windows/System32/tar.exe --version</code>?</p>",
        "id": 420897041,
        "sender_full_name": "Richard Copley",
        "timestamp": 1707664399
    },
    {
        "content": "<p>Windows 7 Ultimate, but there is no tar.exe in system32. The only tar.exe I have on my laptop comes with git, is in \"C:\\Git\\usr\\bin\", and is up-to-date:</p>\n<p>$ tar --version<br>\ntar (GNU tar) 1.35<br>\nCopyright (C) 2023 Free Software Foundation, Inc.<br>\nLicense GPLv3+: GNU GPL version 3 or later &lt;<a href=\"https://gnu.org/licenses/gpl.html\">https://gnu.org/licenses/gpl.html</a>&gt;.<br>\nThis is free software: you are free to change and redistribute it.<br>\nThere is NO WARRANTY, to the extent permitted by law.</p>\n<p>Written by John Gilmore and Jay Fenlason.</p>",
        "id": 420897770,
        "sender_full_name": "Mario Weitzer",
        "timestamp": 1707664955
    },
    {
        "content": "<p>Nice, so Richard fully diagnosed the problem! Post April 2018, Windows 10 includes a <code>tar</code> binary by default which can handle zip files, and by Richard's observation it is used regardless of what you have in PATH. But on Windows 7 there is no such built-in binary, so it falls back to Git Bash tar, which is not bsdtar, and fails.</p>",
        "id": 420898453,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1707665493
    },
    {
        "content": "<p>I thought Lean 4 didn't support Windows 7, though</p>",
        "id": 420898553,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1707665551
    },
    {
        "content": "<p>Indeed it does not officially <a href=\"https://lean-lang.org/lean4/doc/setup.html\">https://lean-lang.org/lean4/doc/setup.html</a> - after all, Windows 7 was already end-of-life before Lean 4 was even released</p>",
        "id": 420898592,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1707665603
    },
    {
        "content": "<p>I shouldn't think it makes any effort to. <span class=\"user-mention\" data-user-id=\"595391\">@Mario Weitzer</span>, you have chosen to walk a difficult path <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 420898594,
        "sender_full_name": "Richard Copley",
        "timestamp": 1707665605
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"400544\">@Richard Copley</span> I guess so <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span><br>\nThis probably also explains the other problem as the version that comes with Windows 10 probably can handle slashes and backslashes simultaneously while the git version can't.</p>",
        "id": 420899185,
        "sender_full_name": "Mario Weitzer",
        "timestamp": 1707666009
    },
    {
        "content": "<p>I do wonder why leantar for Windows is a zip instead of a .tar.gz if it's going to be unpacked with tar anyway</p>",
        "id": 420899249,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1707666066
    },
    {
        "content": "<p>MSYS has bsdtar as an optional package, but I don't know if it handles slashes and backslashes</p>",
        "id": 420900027,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1707666703
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"325367\">Mauricio Collares</span> <a href=\"#narrow/stream/113488-general/topic/Lean.204.20project.20creation.20error/near/420899249\">said</a>:</p>\n<blockquote>\n<p>I do wonder why leantar for Windows is a zip instead of a .tar.gz if it's going to be unpacked with tar anyway</p>\n</blockquote>\n<p>It's generally easier for windows users to work with .zip files than .tar.gz files</p>",
        "id": 420922806,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1707686607
    },
    {
        "content": "<p>but maybe we need to tweak the command line to call <code>unzip</code> or whatever it is called on windows</p>",
        "id": 420922832,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1707686642
    },
    {
        "content": "<p>One final update: I replaced the tar.exe in git/usr/bin with bsdtar and now everything works without any additional effort (both, the slash/backslash problem and also the unpacking of leantar-0.1.11.exe). Since even for Windows 10/11 users it is conceivable that a wrong version of tar.exe is called it would probably be a good idea to address this issue somehow. In any case, thanks again for your combined help!</p>",
        "id": 421220412,
        "sender_full_name": "Mario Weitzer",
        "timestamp": 1707821996
    }
]