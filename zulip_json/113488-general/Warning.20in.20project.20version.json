[
    {
        "content": "<p>I have updated my <code>LocalClassFieldTheory</code> project and now I see</p>\n<blockquote>\n<p>Opened project is using a Lean 4 version (4.0.0-nightly-2023-02-04) from before the first Lean 4 stable release (4.0.0).<br>\nPre-stable Lean 4 versions are increasingly less supported, so please consider updating to a newer Lean 4 version.</p>\n</blockquote>\n<p>I would certainly want to update to a new Lean 4 version, but my toolchain says</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">8</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">rc2</span>\n</code></pre></div>\n<p>so I am not sure what I am supposed to do.</p>",
        "id": 442772383,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717590332
    },
    {
        "content": "<p>Also, since updating to <code>4..8.0-rc2</code> my lean server crashes very often, without noticeable trouble (I simply relaunch it) but it seems a bad sign...</p>",
        "id": 442772748,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717590429
    },
    {
        "content": "<p>Are there any error messages when it crashes?</p>",
        "id": 442773719,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1717590701
    },
    {
        "content": "<p>Yes, let me reopen it and copy-paste</p>",
        "id": 442773827,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717590726
    },
    {
        "content": "<p>OK, now I have launched it and can work well... Let's wait 3 mins</p>",
        "id": 442774302,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717590866
    },
    {
        "content": "<p>(as usual, you're never as fit as when you enter the doctor's room... <span aria-label=\"fever\" class=\"emoji emoji-1f912\" role=\"img\" title=\"fever\">:fever:</span> )</p>",
        "id": 442774577,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717590950
    },
    {
        "content": "<p>OK, now I got the</p>\n<blockquote>\n<p>Opened project is using a Lean 4 version (4.0.0-nightly-2023-02-04) from before the first Lean 4 stable release (4.0.0). Pre-stable Lean 4 versions are increasingly less supported, so please consider updating to a newer Lean 4 version.</p>\n</blockquote>",
        "id": 442774818,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717591006
    },
    {
        "content": "<p>But no crash \"yet\"</p>",
        "id": 442774836,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717591014
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"300245\">Filippo A. E. Nuccio</span> <a href=\"#narrow/stream/113488-general/topic/Warning.20in.20project.20version/near/442774818\">said</a>:</p>\n<blockquote>\n<p>OK, now I got the</p>\n<blockquote>\n<p>Opened project is using a Lean 4 version (4.0.0-nightly-2023-02-04) from before the first Lean 4 stable release (4.0.0). Pre-stable Lean 4 versions are increasingly less supported, so please consider updating to a newer Lean 4 version.<br>\n</p>\n</blockquote>\n</blockquote>\n<p>What's the setup information output in the file you are looking at?  (Forall menu &gt; Show setup information)</p>",
        "id": 442774984,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1717591062
    },
    {
        "content": "<p><strong>Operating system</strong>: Windows_NT (release: 10.0.22631)<br>\n<strong>CPU architecture</strong>: x64<br>\n<strong>CPU model</strong>: 8 x 11th Gen Intel(R) Core(TM) i7-1185G7 @ 3.00GHz<br>\n<strong>Available RAM</strong>: 34.19 GB</p>\n<p><strong>Curl installed</strong>: true<br>\n<strong>Git installed</strong>: true<br>\n<strong>Elan</strong>: Reasonably up-to-date (version: 3.1.1)<br>\n<strong>Lean</strong>: Reasonably up-to-date (version: 4.8.0-rc2)<br>\n<strong>Project</strong>: Valid Lean project (path: c:\\Users\\nf51454h\\Desktop\\Lean\\LocalClassFieldTheory)</p>\n<hr>\n<p><strong>Elan toolchains</strong>: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">installed</span><span class=\"w\"> </span><span class=\"n\">toolchains</span>\n<span class=\"c1\">--------------------</span>\n\n<span class=\"n\">stable</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">nightly</span><span class=\"bp\">-</span><span class=\"mi\">2023</span><span class=\"bp\">-</span><span class=\"mi\">02</span><span class=\"bp\">-</span><span class=\"mi\">04</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">default</span><span class=\"o\">)</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">8</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">rc2</span>\n\n\n<span class=\"n\">active</span><span class=\"w\"> </span><span class=\"n\">toolchain</span>\n<span class=\"c1\">----------------</span>\n\n\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">8</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">rc2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">overridden</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"bp\">'\\\\?\\</span><span class=\"n\">C</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Users</span><span class=\"bp\">\\</span><span class=\"n\">nf51454h</span><span class=\"bp\">\\</span><span class=\"n\">Desktop</span><span class=\"bp\">\\</span><span class=\"n\">Lean</span><span class=\"bp\">\\</span><span class=\"n\">LocalClassFieldTheory</span><span class=\"bp\">\\</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">toolchain'</span><span class=\"o\">)</span>\n\n<span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"mf\">4.8</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">rc2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x86_64</span><span class=\"bp\">-</span><span class=\"n\">w64</span><span class=\"bp\">-</span><span class=\"n\">windows</span><span class=\"bp\">-</span><span class=\"n\">gnu</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">commit</span><span class=\"w\"> </span><span class=\"mi\">873</span><span class=\"n\">ef2d894af</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Release</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 442775097,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717591087
    },
    {
        "content": "<p>Yes, now it goes: </p>\n<blockquote>\n<p>Lean Server has stopped unexpectedly </p>\n</blockquote>",
        "id": 442775409,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717591197
    },
    {
        "content": "<blockquote>\n<p>The Lean 4 server crashed 1 times in the last 3 minutes. The server will not be restarted. See the output for more information.</p>\n</blockquote>",
        "id": 442775500,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717591215
    },
    {
        "content": "<p>And if I look at the output</p>",
        "id": 442775542,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717591223
    },
    {
        "content": "<blockquote>\n<p>Watchdog error: cannot find open document 'file:///c%3A/Users/nf51454h/.elan/toolchains/leanprover--lean4---v4.8.0-rc2/src/lean/Lean/Elab/Declaration.lean'</p>\n<p>[Error - 2:39:22 PM] The Lean 4 server crashed 1 times in the last 3 minutes. The server will not be restarted. See the output for more information.</p>\n</blockquote>",
        "id": 442775612,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717591242
    },
    {
        "content": "<p>(Beside the trouble <em>per se</em> the fact that it crashes after 9 minutes is beyond my paygrade. I thought the idea of getting tired while jogging was a human feature...)</p>",
        "id": 442775842,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717591318
    },
    {
        "content": "<p>Did you open that file at some point (e.g. by using go-to-definition)?</p>",
        "id": 442775950,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1717591344
    },
    {
        "content": "<p>I opened another file (inside Mathlib) but almost immediately, certainly not after 9 minutes.</p>",
        "id": 442776107,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717591389
    },
    {
        "content": "<p>One thing you can try is to set <code>elan default leanprover/lean4:v4.8.0-rc2</code></p>",
        "id": 442776360,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1717591445
    },
    {
        "content": "<p>Let me try; and the probably close-reopen VSCode?</p>",
        "id": 442776435,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717591469
    },
    {
        "content": "<p>Yes</p>",
        "id": 442776460,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1717591474
    },
    {
        "content": "<p>OK, done. Now I fear I have to wait 9 more minutes for the next crash... <span aria-label=\"hourglass done\" class=\"emoji emoji-231b\" role=\"img\" title=\"hourglass done\">:hourglass_done:</span></p>",
        "id": 442776618,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717591522
    },
    {
        "content": "<p>Unfortunately, when opening core files, Lean uses the default toolchain because the core source files don't have a lean-toolchain file themselves (cc <span class=\"user-mention\" data-user-id=\"110024\">@Sebastian Ullrich</span>). This means that go to definition into core can break things.</p>",
        "id": 442776636,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1717591526
    },
    {
        "content": "<p>But I went to a declaration in <code>Mathlib.DedekindDomain.Ideal</code>...</p>",
        "id": 442776722,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717591552
    },
    {
        "content": "<p>OK, I still get the warning</p>\n<blockquote>\n<p>Opened project is using a Lean 4 version (4.0.0-nightly-2023-02-04) from before the first Lean 4 stable release (4.0.0).<br>\nPre-stable Lean 4 versions are increasingly less supported, so please consider updating to a newer Lean 4 version.</p>\n</blockquote>",
        "id": 442776869,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717591581
    },
    {
        "content": "<p>and beyond having a (seemingly) updated toolchain I do not know what to do</p>",
        "id": 442776933,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717591601
    },
    {
        "content": "<p>Does <code>elan show</code> now designate the correct toolchain as default?</p>",
        "id": 442776980,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1717591611
    },
    {
        "content": "<p>Ah no</p>",
        "id": 442777063,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717591634
    },
    {
        "content": "<p>It still gives the old one</p>",
        "id": 442777093,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717591641
    },
    {
        "content": "<p>Yes, now it is ok</p>",
        "id": 442777325,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717591698
    },
    {
        "content": "<p>$ elan show<br>\ninstalled toolchains</p>\n<hr>\n<p>stable<br>\nleanprover/lean4:nightly-2023-02-04<br>\nleanprover/lean4:v4.8.0-rc2 (default)</p>\n<p>active toolchain</p>\n<hr>\n<p>leanprover/lean4:v4.8.0-rc2 (overridden by '\\\\?\\C:\\Users\\nf51454h\\Desktop\\Lean\\LocalClassFieldTheory\\lean-toolchain')<br>\nLean (version 4.8.0-rc2, x86_64-w64-windows-gnu, commit 873ef2d894af, Release)</p>",
        "id": 442777369,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717591707
    },
    {
        "content": "<p>Let's try again with the project</p>",
        "id": 442777501,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717591739
    },
    {
        "content": "<p>OK, while it launches: I would be very happy to uninstall the old one, but I have the feeling that each time I will create a new project I would re-install it due to the instructions <a href=\"https://leanprover-community.github.io/install/project.html\">here</a>. Am I wrong?</p>",
        "id": 442777714,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717591796
    },
    {
        "content": "<p>The instructions at that documentation page now seem to refer to a more recent nightly</p>",
        "id": 442778013,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1717591867
    },
    {
        "content": "<p>Oh, you're right.</p>",
        "id": 442778267,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717591924
    },
    {
        "content": "<p>OK, so I will happily uninstall that old toolchain.</p>",
        "id": 442778331,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717591936
    },
    {
        "content": "<p>OK, now I am not getting the warning any more, let's see if it crashed in a while.</p>",
        "id": 442778409,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717591956
    },
    {
        "content": "<p>Yep, crashed again!</p>\n<blockquote>\n<p>Watchdog error: cannot find open document 'file:///c%3A/Users/nf51454h/.elan/toolchains/leanprover--lean4---v4.8.0-rc2/src/lean/Lean/Elab/Declaration.lean'</p>\n<p>[Error - 2:54:03 PM] The Lean 4 server crashed 1 times in the last 3 minutes. The server will not be restarted. See the output for more information.</p>\n</blockquote>",
        "id": 442778834,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717592075
    },
    {
        "content": "<p>And again, I was just fighting with a <code>rw</code> inside my file and had the <code>Mathlib.DedekindDomain.Ideal</code> open, where the declaration I was fighting against is.</p>",
        "id": 442779023,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717592123
    },
    {
        "content": "<p>And once more, if I simply <em>ignore</em> this \"crash\" I can keep working.</p>",
        "id": 442779209,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717592164
    },
    {
        "content": "<p>Ah, I have an idea for one more thing to narrow down the source of this issue. Could you try downgrading your Lean 4 extension version to 0.0.155? (Extensions &gt; Right click on Lean 4 extension &gt; Install another version)</p>",
        "id": 442779579,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1717592277
    },
    {
        "content": "<p>Sure, let me try.</p>",
        "id": 442779690,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717592294
    },
    {
        "content": "<p>OK, done and restarted; I have also disabled the auto-update</p>",
        "id": 442779910,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717592349
    },
    {
        "content": "<p>(VS Code sometimes opens ghost documents in the background for various features. I had to touch our logic for filtering these documents in fixing <a href=\"#narrow/stream/113489-new-members/topic/VSCODE.20outline.20mode.20not.20working.20in.20imports/near/442000461\">https://leanprover.zulipchat.com/#narrow/stream/113489-new-members/topic/VSCODE.20outline.20mode.20not.20working.20in.20imports/near/442000461</a>, so there's a chance that I overlooked something)</p>",
        "id": 442780030,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1717592381
    },
    {
        "content": "<p>Well, we're ready for another trial. I will keep fighting my <code>rw</code> and if in 5/7 minutes nothing happens is seems like a good sign.</p>",
        "id": 442780384,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717592453
    },
    {
        "content": "<p>... still good <span aria-label=\"silence\" class=\"emoji emoji-1f910\" role=\"img\" title=\"silence\">:silence:</span></p>",
        "id": 442782183,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717592867
    },
    {
        "content": "<p>I am inclined to believe that you found the problem! <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span></p>",
        "id": 442783692,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717593226
    },
    {
        "content": "<p>Well, it's still not really clear what the cause is and unfortunately I can't reproduce it myself. I have a suspicion though, so let's see if I can fix this regardless without a reproducer.</p>",
        "id": 442784440,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1717593402
    },
    {
        "content": "<p>Of course if you need/want to discuss by zoom to see/play with my PC, that's fine.</p>",
        "id": 442784722,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717593475
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"300245\">Filippo A. E. Nuccio</span> has marked this topic as resolved.</p>",
        "id": 442793235,
        "sender_full_name": "Notification Bot",
        "timestamp": 1717595269
    },
    {
        "content": "<p>I made an attempt at fixing this and the attempted fix is in a pre-release version (0.0.158) of the VS Code extension. You can install it by selecting the extension and then clicking \"Switch to pre-release\" in the page that opens.</p>",
        "id": 442803436,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1717597655
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"300245\">Filippo A. E. Nuccio</span> has marked this topic as unresolved.</p>",
        "id": 442803581,
        "sender_full_name": "Notification Bot",
        "timestamp": 1717597684
    },
    {
        "content": "<p>OK, let me check.</p>",
        "id": 442803588,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717597686
    },
    {
        "content": "<p>I still do not have it</p>",
        "id": 442804154,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717597819
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"300245\">Filippo A. E. Nuccio</span> has marked this topic as unresolved.</p>",
        "id": 442804335,
        "sender_full_name": "Notification Bot",
        "timestamp": 1717597870
    },
    {
        "content": "<p>If the issue you encountered didn't come up with 0.0.158 anymore, I'll release it tomorrow.</p>",
        "id": 442826591,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1717603124
    },
    {
        "content": "<p>Well, as a matter of fact I have not been able to download 0.0.158, I still only have 0.0.157 in the top of my list and no \"pre-release\" button in the extension page.... <span aria-label=\"sad\" class=\"emoji emoji-2639\" role=\"img\" title=\"sad\">:sad:</span></p>",
        "id": 442833531,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717604570
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"300245\">Filippo A. E. Nuccio</span> <a href=\"#narrow/stream/113488-general/topic/Warning.20in.20project.20version/near/442833531\">said</a>:</p>\n<blockquote>\n<p>Well, as a matter of fact I have not been able to download 0.0.158, I still only have 0.0.157 in the top of my list and no \"pre-release\" button in the extension page.... <span aria-label=\"sad\" class=\"emoji emoji-2639\" role=\"img\" title=\"sad\">:sad:</span></p>\n</blockquote>\n<p>This is what it looks like for me:<br>\n<a href=\"/user_uploads/3121/kZ0Oe4ixhHdyeOwhiyKQqOz5/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/kZ0Oe4ixhHdyeOwhiyKQqOz5/image.png\" title=\"image.png\"><img src=\"/user_uploads/3121/kZ0Oe4ixhHdyeOwhiyKQqOz5/image.png\"></a></div>",
        "id": 442834057,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1717604693
    },
    {
        "content": "<p>Perhaps you need to update to 0.0.157 first for the button to show up?</p>",
        "id": 442834479,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1717604799
    },
    {
        "content": "<p>Let me try</p>",
        "id": 442835003,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717604920
    },
    {
        "content": "<p>Yes indeed, good point.</p>",
        "id": 442835135,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717604949
    },
    {
        "content": "<p>I have just installed 0.0.158 then, I will work on it half an hour, say, and will report back if I have problems.</p>",
        "id": 442835213,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717604970
    },
    {
        "content": "<p>Well, for the time being everything still OK. I will soon need to leave, but I have not seen any problem as those before. Thanks!</p>",
        "id": 442841948,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1717606410
    }
]